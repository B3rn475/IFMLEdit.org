{"version":3,"sources":["almost-joint.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","global","window","almost","plugins","joint","this","self","./","2","Board","utils","createBoard","./lib/board","./lib/utils","3","4","5","_","$","ElementsMenu","options","container","template","Array","isArray","builders","createItemDragger","width","undefined","minHeight","padding","head","each","builder","item","clone","append","hasClass","find","el","createElements","6","ResizeReactor","EmbeddingReactor","paper","dia","Paper","model","isValidParent","undoReactor","startPosition","getParent","cellView","element","elementsBelow","findModelsInArea","getBBox","useModelGeometry","chain","map","parent","findViewByModel","filter","parentCellView","sortBy","method","last","value","on","evt","x","y","noop","isLink","position","start","toFront","deep","startBatch","invoke","getLinks","stopBatch","newPosition","oldparent","newparent","abort","stop","undo","reparent","getConnectedLinks","link","getCell","get","unembed","reparenting","embed","cell","set","defer","remove","./resizereactor","7","backbone","createMap","Map","ItemDragger","createPanReactor","PanReactor","createZoomReactor","ZoomReactor","createManipulationReactor","ManipulationReactor","createEmbeddingReactor","createUndoReactor","UndoReactor","createElementsMenu","linkConnectionPoint","validateConnection","defaultIsValidParent","id","extend","Events","actions","defaultLink","addClass","height","gridSize","multiLinks","linkPinning","interactive","readonly","zoomReactor","minScale","maxScale","manipulationReactor","resize","rotate","magnetize","embeddingReactor","updateViewport","left","offset","top","topLeft","g","point","bottomRight","min","clientToLocalPoint","max","setViewport","addEventListener","target","stopPropagation","snapToGrid","clientX","clientY","trigger","css","setDimensions","once","zoomE","download","clearHistory","clear","startUndoSequence","stopUndoSequence","./elementsmenu","./embeddingreactor","./itemdragger","./linkconnectionpoint","./manipulationreactor","./map","./panreactor","./undoreactor","./validateconnection","./zoomreactor","8","9","document","mainitem","mainposition","size","baseScale","paperHeight","paperWidth","overlayitems","preview","body","overlaymodel","Graph","overlaypaper","addCells","elements","bbox","reduce","memo","union","maxsize","Math","scale","actualwidth","actualheight","shapes","basic","Rect","attrs","rect","fill","stroke","wrapItems","addCell","items","$el","removeHandlers","translate","overlay","spacer","current","minLocal","maxLocal","startPoint","pointermove","setOrigin","pointerup","off","overlaytopitems","paperBBox","releasePoint","localToPaperPoint","localToClientPoint","containsPoint","mapping","cloneCells","unset","prototype","Object","create","./dragger.html","./overlay.html","10","11","12","allBorders","bottom","right","nearestPointOnBorder","me","other","borders","fixBorders","abs","origin","Infinity","corner","center","containsRect","fixPointByAngle","angle","normalizeAngle","intersectionLine","rbbox","rorigin","rtopRight","topRight","rcorner","rbottomLeft","bottomLeft","leftLine","line","topLine","bottomtLine","rightLine","sideNearestToPoint","bind","intersection","previousValue","currentValue","distance","linkView","view","magnet","reference","dTargetBorders","dTargetAngle","dTargetBBox","vertices","source","getTargetElement","getSourceElement","defaultConnectionPoint","targetBBox","targetAngle","rTargetBBox","intersect","minX","maxX","minY","maxY","pointNearestToPoint","perpendicular","intersectionWithLineFromCenterToPoint","13","mousetrap","navigator","createResizeReactor","createRotateReactor","RotateReactor","propertyChecker","property","defaultValue","canResize","canRotate","edit","delete","selectedViews","updateManipulator","bundle","cos","toRad","sin","closeManipulator","demagnetize","closeManipulators","currentid","attr","platform","substr","toLowerCase","metaKey","ctrlKey","tab","linkmarker","movemarker","manipulator","context","close","first","res","after","detach","magnetizeCycle","click","forEach","action","checker","marker","event","direction","angleStep","mouseover","focus","ary","shortcut","./delete.svg","./edit.svg","./link.svg","./manipulator.html","./move.svg","./rotatereactor","14","15","createPreview","Preview","createViewport","Viewport","mapContainer","viewportContainer","viewport","autoRefreshEnabled","hasActiveBatch","refresh","batchName","getElements","setBBox","disableAutorefresh","enableAutorefresh","./preview","./preview.html","./viewport","./viewport.html","16","17","atob","Uint8Array","Blob","saveAs","svg2png","lastScale","scaleX","scaleY","ox","oy","svgAsPngUri","svg","uri","slice","byteNumbers","byteArray","index","indexOf","b64Data","contentType","byteCharacters","byteArrays","charCodeAt","push","type","uriToBlob","save-svg-as-png","18","19","ViewportOutline","./viewportoutline","20","Generic","markup","defaults","util","deepSupplement",".almost-joint-viewport-bg-rect","follow-scale",".almost-joint-viewport-outer-rect","ref-x","ref-y","ref-width","ref-height","ref","./markup.svg","21","22","23","mouseout","startLocal","mousemove","offsetClient","terminate","removeClass","24","mouseenter","v","h","normalizeDirection","minsize","embedsbbox","msize","embeds","getEmbeddedCells","isContraint","minwidth","minheight","px","py","client","constrain","fixPoint","mouseleave","buttons","25","rad","atan2","round","toDeg","26","hasEffect","history","entry","opt","ui","delta","shouldMergeHistory","assign","mergeHistory","pop","./haseffect","27","every","key","isEqual","28","addToHistory","optimizeHistory","undoing","redoing","record","environments","changes","future","currentChangesStack","reapply","flattenDeep","forEachRight","step","changeId","add","commit","elem","stack","changedAttributes","keys","endpoint","previous","shouldStart","mapValues","shouldStop","save","arguments","redo","test","../../utils","./addtohistory","./optimizehistory","29","flow","optimized","unshift","takeRightWhile","difference","30","cellViewS","magnetS","cellViewT","magnetT","end","validSources","validTargets","31","paddingZoomE","mousewheel","normalizeScale","pow","preventDefault","pointerdblclick","rearg","32","newId","cells","inboundLinks","outboundLinks","oldId","graph","getCells","inbound","outbound","silent","prop","resetCells","33","sortCells","isFullyContained","./changeid","./isfullycontained","./sortcells","34","pbbox","35","computeAncestors","lookup","concat","zipObject","ancestors","compareRelatives","cell1","cell2","sort","commonUncestors","ancestors1","ancestors2","36","_REVERSE_MAP","_MAP","37","38","39","40","45","46","91","93","224","_KEYCODE_MAP","106","107","109","110","111","186","187","188","189","190","191","192","219","220","221","222","_SHIFT_MAP","~","!","@","#","%","^","&","*","(",")","+",":","\"","<",">","?","|","_SPECIAL_ALIASES","option","command","return","escape","plus","mod","toString","Mousetrap","callback","_bindMultiple","unbind","_directMap","reset","_callbacks","stopCallback","className","_belongsTo","ancestor","parentNode","composedPath","initialEventTarget","tagName","isContentEditable","handleKey","_handleKey","apply","addKeycodes","object","hasOwnProperty","init","documentMousetrap","charAt","define","amd","_addEvent","attachEvent","_characterFromEvent","character","String","fromCharCode","which","shiftKey","_isModifier","_pickBestAction","modifiers","_getReverseMap","_getKeyInfo","combination","replace","split","_keysFromString","targetElement","_resetTimer","_sequenceLevels","_ignoreNextKeyup","_ignoreNextKeypress","_nextExpectedAction","_resetSequences","doNotReset","activeSequences","_getMatches","sequenceName","level","modifiers1","modifiers2","matches","seq","join","deleteCombo","combo","deleteSequence","splice","_fireCallback","sequence","srcElement","returnValue","_preventDefault","cancelBubble","_stopPropagation","_handleKeyEvent","keyCode","altKey","_eventModifiers","_bindSequence","_increaseSequence","nextAction","clearTimeout","setTimeout","_callbackAndReset","wrappedCallback","_bindSingle","info","callbacks","maxLevel","processedSequenceCallback","ignoreThisKeypress","combinations","out$","default","xmlNs","svgNs","urlRegex","fontFormats","woff2","woff","otf","ttf","eot","sfnt","isElement","obj","HTMLElement","SVGElement","requireDomNode","requireDomNodePromise","Promise","resolve","reject","getDimension","dim","viewBox","baseVal","getAttribute","match","parseInt","getBoundingClientRect","style","getComputedStyle","getPropertyValue","isNaN","parseFloat","byteString","mimeString","buffer","ArrayBuffer","intArray","inlineImages","all","from","querySelectorAll","image","url","href","getAttributeNS","lastIndexOf","location","host","Date","valueOf","canvas","createElement","img","Image","crossOrigin","src","onerror","onload","getContext","drawImage","setAttributeNS","toDataURL","cachedFonts","inlineFonts","fonts","font","req","XMLHttpRequest","fontInBase64","binary","bytes","byteLength","btoa","arrayBufferToBase64","response","fontUri","text","format","console","warn","open","responseType","send","then","fontCss","cachedRules","inlineCss","_ref","selectorRemap","modifyStyle","modifyCss","excludeUnusedCss","generateCss","selector","properties","detectFonts","fontList","styleSheets","sheet","rules","cssRules","_ref2","rule","querySelector","err","query","selectorText","cssText","fontUrl","formats","fullUrl","startsWith","extension","error","detectCssFont","downloadOptions","msSaveOrOpenBlob","popup","prepareSvg","done","_ref3","_ref3$left","_ref3$top","w","_ref3$scale","_ref3$responsive","responsive","_ref3$excludeCss","excludeCss","cloneNode","backgroundColor","_getDimensions","_el$getBBox","getDimensions","setAttribute","createElementNS","appendChild","removeAttribute","foreignObject","innerHTML","defs","insertBefore","firstChild","outer","svgAsDataUri","_ref4","svgXml","decodeURIComponent","encodeURIComponent","p1","_ref5","_ref5$encoderType","encoderType","_ref5$encoderOptions","encoderOptions","canvg","convertToPng","_ref6","pixelRatio","devicePixelRatio","setTransform","png","SecurityError","name","saveLink","display","blob","URL","createObjectURL","onclick","requestAnimationFrame","revokeObjectURL","removeChild","title","saveSvg","downloadOpts","saveSvgAsPng"],"mappings":"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","file":"almost-joint.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true*/\r\n\"use strict\";\r\n\r\nvar window = (typeof window !== \"undefined\" ? window['window'] : typeof global !== \"undefined\" ? global['window'] : null);\r\n\r\nif (!window.almost) {\r\n    window.almost = {\r\n        plugins: {}\r\n    };\r\n}\r\nwindow.almost.plugins.joint = require('./');\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./\":2}],2:[function(require,module,exports){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true*/\r\n\"use strict\";\r\n\r\nvar Board = require('./lib/board').Board,\r\n    utils = require('./lib/utils');\r\n\r\n// Constructors\r\nexports.Board = Board;\r\n\r\n// Maker Functions\r\nexports.createBoard = Board;\r\n\r\n// utils\r\nexports.utils = utils;\r\n\n},{\"./lib/board\":7,\"./lib/utils\":33}],3:[function(require,module,exports){\nmodule.exports = \"<svg\\r\\n   xmlns:dc=\\\"http://purl.org/dc/elements/1.1/\\\"\\r\\n   xmlns:cc=\\\"http://creativecommons.org/ns#\\\"\\r\\n   xmlns:rdf=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\r\\n   xmlns:svg=\\\"http://www.w3.org/2000/svg\\\"\\r\\n   xmlns=\\\"http://www.w3.org/2000/svg\\\"\\r\\n   xmlns:sodipodi=\\\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\\\"\\r\\n   xmlns:inkscape=\\\"http://www.inkscape.org/namespaces/inkscape\\\"\\r\\n   version=\\\"1.1\\\"\\r\\n   id=\\\"Capa_1\\\"\\r\\n   x=\\\"0px\\\"\\r\\n   y=\\\"0px\\\"\\r\\n   width=\\\"44.238px\\\"\\r\\n   height=\\\"44.238px\\\"\\r\\n   viewBox=\\\"0 0 44.238 44.238\\\"\\r\\n   xml:space=\\\"preserve\\\"\\r\\n   inkscape:version=\\\"0.91 r13725\\\"\\r\\n   sodipodi:docname=\\\"delete.svg\\\"\\r\\n   style=\\\"enable-background:new 0 0 44.238 44.238;\\\"><metadata\\r\\n     id=\\\"metadata51\\\"><rdf:RDF><cc:Work\\r\\n         rdf:about=\\\"\\\"><dc:format>image/svg+xml</dc:format><dc:type\\r\\n           rdf:resource=\\\"http://purl.org/dc/dcmitype/StillImage\\\" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs\\r\\n     id=\\\"defs49\\\" /><sodipodi:namedview\\r\\n     pagecolor=\\\"#ffffff\\\"\\r\\n     bordercolor=\\\"#666666\\\"\\r\\n     borderopacity=\\\"1\\\"\\r\\n     objecttolerance=\\\"10\\\"\\r\\n     gridtolerance=\\\"10\\\"\\r\\n     guidetolerance=\\\"10\\\"\\r\\n     inkscape:pageopacity=\\\"0\\\"\\r\\n     inkscape:pageshadow=\\\"2\\\"\\r\\n     inkscape:window-width=\\\"1600\\\"\\r\\n     inkscape:window-height=\\\"837\\\"\\r\\n     id=\\\"namedview47\\\"\\r\\n     showgrid=\\\"false\\\"\\r\\n     inkscape:zoom=\\\"5.3347802\\\"\\r\\n     inkscape:cx=\\\"68.874387\\\"\\r\\n     inkscape:cy=\\\"22.118999\\\"\\r\\n     inkscape:window-x=\\\"-8\\\"\\r\\n     inkscape:window-y=\\\"-8\\\"\\r\\n     inkscape:window-maximized=\\\"1\\\"\\r\\n     inkscape:current-layer=\\\"Capa_1\\\"\\r\\n     showguides=\\\"true\\\"\\r\\n     inkscape:guide-bbox=\\\"true\\\" /><g\\r\\n     id=\\\"g4230\\\"><circle\\r\\n       r=\\\"21\\\"\\r\\n       cy=\\\"22.237999\\\"\\r\\n       cx=\\\"22\\\"\\r\\n       id=\\\"path4208\\\"\\r\\n       style=\\\"color:#000000;display:inline;overflow:visible;visibility:visible;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:0.40000001;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker:none;enable-background:accumulate\\\" /><g\\r\\n       style=\\\"fill:#000000;fill-opacity:1\\\"\\r\\n       id=\\\"g7\\\"><path\\r\\n         inkscape:connector-curvature=\\\"0\\\"\\r\\n         style=\\\"fill:#000000;fill-opacity:1\\\"\\r\\n         id=\\\"path9\\\"\\r\\n         d=\\\"m 15.533,29.455 c -0.192,0 -0.384,-0.073 -0.53,-0.22 -0.293,-0.293 -0.293,-0.769 0,-1.062 L 28.174,15.002 c 0.293,-0.293 0.768,-0.293 1.061,0 0.293,0.293 0.293,0.768 0,1.061 L 16.063,29.235 c -0.146,0.147 -0.338,0.22 -0.53,0.22 z\\\" /></g><g\\r\\n       style=\\\"fill:#000000;fill-opacity:1\\\"\\r\\n       id=\\\"g11\\\"><path\\r\\n         inkscape:connector-curvature=\\\"0\\\"\\r\\n         style=\\\"fill:#000000;fill-opacity:1\\\"\\r\\n         id=\\\"path13\\\"\\r\\n         d=\\\"m 28.704,29.455 c -0.192,0 -0.384,-0.073 -0.53,-0.22 L 15.002,16.064 c -0.293,-0.293 -0.293,-0.768 0,-1.061 0.293,-0.293 0.768,-0.293 1.061,0 l 13.171,13.171 c 0.293,0.293 0.293,0.769 0,1.062 -0.146,0.146 -0.338,0.219 -0.53,0.219 z\\\" /></g><path\\r\\n       inkscape:connector-curvature=\\\"0\\\"\\r\\n       style=\\\"fill:#ff0000;fill-opacity:1\\\"\\r\\n       id=\\\"path15\\\"\\r\\n       d=\\\"M 22.119,44.237 C 9.922,44.237 0,34.315 0,22.12 0,9.924 9.922,0.001 22.119,0.001 c 12.197,0 22.119,9.922 22.119,22.119 0,12.197 -9.924,22.117 -22.119,22.117 z m 0,-42.736 C 10.75,1.501 1.5,10.751 1.5,22.12 c 0,11.369 9.25,20.619 20.619,20.619 11.369,0 20.619,-9.25 20.619,-20.619 0,-11.369 -9.25,-20.619 -20.619,-20.619 z\\\" /></g><g\\r\\n     id=\\\"g17\\\" /><g\\r\\n     id=\\\"g19\\\" /><g\\r\\n     id=\\\"g21\\\" /><g\\r\\n     id=\\\"g23\\\" /><g\\r\\n     id=\\\"g25\\\" /><g\\r\\n     id=\\\"g27\\\" /><g\\r\\n     id=\\\"g29\\\" /><g\\r\\n     id=\\\"g31\\\" /><g\\r\\n     id=\\\"g33\\\" /><g\\r\\n     id=\\\"g35\\\" /><g\\r\\n     id=\\\"g37\\\" /><g\\r\\n     id=\\\"g39\\\" /><g\\r\\n     id=\\\"g41\\\" /><g\\r\\n     id=\\\"g43\\\" /><g\\r\\n     id=\\\"g45\\\" /></svg>\\r\\n\";\n\n},{}],4:[function(require,module,exports){\nmodule.exports = \"<svg\\r\\n   xmlns:dc=\\\"http://purl.org/dc/elements/1.1/\\\"\\r\\n   xmlns:cc=\\\"http://creativecommons.org/ns#\\\"\\r\\n   xmlns:rdf=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\r\\n   xmlns:svg=\\\"http://www.w3.org/2000/svg\\\"\\r\\n   xmlns=\\\"http://www.w3.org/2000/svg\\\"\\r\\n   xmlns:sodipodi=\\\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\\\"\\r\\n   xmlns:inkscape=\\\"http://www.inkscape.org/namespaces/inkscape\\\"\\r\\n   class=\\\"detail convertSvgInline replaced-svg\\\"\\r\\n   id=\\\"imgView\\\"\\r\\n   fill=\\\"#000000\\\"\\r\\n   viewBox=\\\"0 0 44.236 44.236\\\"\\r\\n   x=\\\"0px\\\"\\r\\n   y=\\\"0px\\\"\\r\\n   width=\\\"256\\\"\\r\\n   height=\\\"256\\\"\\r\\n   version=\\\"1.1\\\"\\r\\n   data-kw=\\\"configuration12\\\"\\r\\n   data-id=\\\"51874\\\"\\r\\n   xml:space=\\\"preserve\\\"\\r\\n   inkscape:version=\\\"0.91 r13725\\\"\\r\\n   sodipodi:docname=\\\"edit.svg\\\"><metadata\\r\\n     id=\\\"metadata53\\\"><rdf:RDF><cc:Work\\r\\n         rdf:about=\\\"\\\"><dc:format>image/svg+xml</dc:format><dc:type\\r\\n           rdf:resource=\\\"http://purl.org/dc/dcmitype/StillImage\\\" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs\\r\\n     id=\\\"defs51\\\" /><sodipodi:namedview\\r\\n     pagecolor=\\\"#ffffff\\\"\\r\\n     bordercolor=\\\"#666666\\\"\\r\\n     borderopacity=\\\"1\\\"\\r\\n     objecttolerance=\\\"10\\\"\\r\\n     gridtolerance=\\\"10\\\"\\r\\n     guidetolerance=\\\"10\\\"\\r\\n     inkscape:pageopacity=\\\"0\\\"\\r\\n     inkscape:pageshadow=\\\"2\\\"\\r\\n     inkscape:window-width=\\\"1920\\\"\\r\\n     inkscape:window-height=\\\"1017\\\"\\r\\n     id=\\\"namedview49\\\"\\r\\n     showgrid=\\\"false\\\"\\r\\n     inkscape:zoom=\\\"2.6074563\\\"\\r\\n     inkscape:cx=\\\"221.70951\\\"\\r\\n     inkscape:cy=\\\"106.74523\\\"\\r\\n     inkscape:window-x=\\\"-8\\\"\\r\\n     inkscape:window-y=\\\"-8\\\"\\r\\n     inkscape:window-maximized=\\\"1\\\"\\r\\n     inkscape:current-layer=\\\"imgView\\\" /><circle\\r\\n     style=\\\"color:#000000;display:inline;overflow:visible;visibility:visible;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:0.03455937;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:0;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;marker:none;enable-background:accumulate\\\"\\r\\n     id=\\\"path4181\\\"\\r\\n     cx=\\\"22.118\\\"\\r\\n     cy=\\\"22.118\\\"\\r\\n     r=\\\"21.254015\\\" /><g\\r\\n     id=\\\"g3\\\"><g\\r\\n       id=\\\"g5\\\"><path\\r\\n         fill=\\\"\\\"\\r\\n         d=\\\"M 22.118 44.236 C 9.922 44.236 0 34.314 0 22.119 C 0 9.923 9.922 0 22.118 0 s 22.118 9.923 22.118 22.119 C 44.236 34.314 34.314 44.236 22.118 44.236 Z M 22.118 1.5 C 10.75 1.5 1.5 10.75 1.5 22.119 s 9.25 20.617 20.618 20.617 s 20.618 -9.248 20.618 -20.617 S 33.486 1.5 22.118 1.5 Z\\\"\\r\\n         id=\\\"path7\\\" /><g\\r\\n         id=\\\"g9\\\"><circle\\r\\n           fill=\\\"\\\"\\r\\n           cx=\\\"22.118\\\"\\r\\n           cy=\\\"22.438\\\"\\r\\n           r=\\\"1.41\\\"\\r\\n           id=\\\"circle11\\\" /><path\\r\\n           fill=\\\"\\\"\\r\\n           d=\\\"M 22.118 24.098 c -0.916 0 -1.66 -0.744 -1.66 -1.66 c 0 -0.915 0.745 -1.66 1.66 -1.66 s 1.659 0.745 1.659 1.66 C 23.777 23.354 23.034 24.098 22.118 24.098 Z M 22.118 21.277 c -0.64 0 -1.16 0.521 -1.16 1.16 s 0.521 1.161 1.16 1.161 c 0.639 0 1.159 -0.521 1.159 -1.161 S 22.758 21.277 22.118 21.277 Z\\\"\\r\\n           id=\\\"path13\\\" /></g><g\\r\\n         id=\\\"g15\\\"><path\\r\\n           fill=\\\"\\\"\\r\\n           d=\\\"M 22.118 32.42 c -0.6 0 -1.208 -0.061 -1.86 -0.182 c -0.446 -0.062 -0.83 -0.444 -0.898 -0.926 l -0.357 -1.838 c -0.461 -0.207 -0.896 -0.459 -1.287 -0.744 l -1.798 0.623 c -0.087 0.041 -0.233 0.07 -0.381 0.07 c -0.317 0 -0.622 -0.146 -0.837 -0.398 c -0.836 -0.952 -1.482 -2.074 -1.862 -3.233 c -0.183 -0.418 -0.023 -0.974 0.403 -1.257 l 1.358 -1.186 c -0.023 -0.23 -0.035 -0.479 -0.035 -0.752 c 0 -0.271 0.011 -0.52 0.035 -0.75 l -1.435 -1.245 c -0.35 -0.226 -0.51 -0.78 -0.303 -1.262 c 0.356 -1.098 1.003 -2.219 1.847 -3.181 c 0.299 -0.355 0.822 -0.488 1.261 -0.298 l 1.746 0.603 c 0.39 -0.284 0.825 -0.537 1.287 -0.745 l 0.364 -1.874 c 0.063 -0.447 0.449 -0.83 0.932 -0.894 c 1.125 -0.234 2.465 -0.243 3.693 0.009 c 0.432 0.055 0.817 0.438 0.886 0.921 l 0.357 1.838 c 0.447 0.204 0.875 0.453 1.283 0.746 l 1.803 -0.624 c 0.087 -0.04 0.232 -0.07 0.381 -0.07 c 0.318 0 0.624 0.146 0.838 0.401 c 0.834 0.949 1.48 2.07 1.861 3.23 c 0.183 0.419 0.022 0.974 -0.403 1.258 l -1.358 1.185 c 0.022 0.232 0.034 0.48 0.034 0.752 s -0.011 0.52 -0.034 0.75 l 1.434 1.245 c 0.351 0.226 0.511 0.78 0.304 1.261 c -0.356 1.098 -1.002 2.22 -1.847 3.182 c -0.303 0.357 -0.825 0.486 -1.262 0.299 l -1.75 -0.604 c -0.406 0.293 -0.836 0.541 -1.281 0.746 l -0.364 1.873 c -0.062 0.444 -0.446 0.827 -0.927 0.896 C 23.327 32.359 22.718 32.42 22.118 32.42 Z M 20.789 30.809 c 0.96 0.152 1.738 0.146 2.66 0 l 0.39 -2.012 c 0.05 -0.254 0.226 -0.464 0.466 -0.557 c 0.57 -0.221 1.111 -0.535 1.607 -0.936 c 0.201 -0.162 0.472 -0.207 0.716 -0.125 l 1.938 0.672 c 0.58 -0.705 1.033 -1.49 1.33 -2.301 l -1.549 -1.337 c -0.201 -0.174 -0.295 -0.442 -0.246 -0.703 c 0.047 -0.259 0.07 -0.558 0.07 -0.914 s -0.023 -0.654 -0.07 -0.913 c -0.05 -0.261 0.045 -0.529 0.246 -0.703 l 1.547 -1.342 c -0.313 -0.838 -0.764 -1.611 -1.33 -2.297 l -1.938 0.673 c -0.244 0.083 -0.516 0.036 -0.717 -0.125 c -0.495 -0.4 -1.035 -0.715 -1.605 -0.936 c -0.242 -0.093 -0.418 -0.303 -0.467 -0.557 l -0.391 -2.014 c -0.926 -0.156 -1.792 -0.148 -2.659 0 l -0.39 2.014 c -0.049 0.254 -0.225 0.464 -0.466 0.557 c -0.598 0.231 -1.149 0.552 -1.595 0.926 c -0.202 0.17 -0.478 0.22 -0.728 0.135 l -1.938 -0.672 c -0.581 0.707 -1.034 1.491 -1.33 2.301 l 1.549 1.337 c 0.201 0.175 0.294 0.442 0.246 0.705 c -0.048 0.255 -0.071 0.553 -0.071 0.911 s 0.023 0.657 0.071 0.912 c 0.049 0.263 -0.044 0.53 -0.246 0.705 l -1.547 1.343 c 0.313 0.836 0.763 1.609 1.329 2.297 l 1.938 -0.674 c 0.251 -0.084 0.526 -0.033 0.728 0.135 c 0.446 0.375 0.998 0.693 1.595 0.926 c 0.241 0.093 0.417 0.303 0.466 0.557 L 20.789 30.809 Z\\\"\\r\\n           id=\\\"path17\\\" /></g></g></g><g\\r\\n     id=\\\"g19\\\" /><g\\r\\n     id=\\\"g21\\\" /><g\\r\\n     id=\\\"g23\\\" /><g\\r\\n     id=\\\"g25\\\" /><g\\r\\n     id=\\\"g27\\\" /><g\\r\\n     id=\\\"g29\\\" /><g\\r\\n     id=\\\"g31\\\" /><g\\r\\n     id=\\\"g33\\\" /><g\\r\\n     id=\\\"g35\\\" /><g\\r\\n     id=\\\"g37\\\" /><g\\r\\n     id=\\\"g39\\\" /><g\\r\\n     id=\\\"g41\\\" /><g\\r\\n     id=\\\"g43\\\" /><g\\r\\n     id=\\\"g45\\\" /><g\\r\\n     id=\\\"g47\\\" /></svg>\\r\\n\";\n\n},{}],5:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null),\r\n    $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null);\r\n\r\nfunction ElementsMenu(options) {\r\n    if (!(this instanceof ElementsMenu)) { return new ElementsMenu(options); }\r\n    options = options || {};\r\n\r\n    if (!options.container) { throw new Error('container option is mandatory'); }\r\n    if ($(options.container).length === 0) { throw new Error('invalid container option'); }\r\n    if (!options.template) { throw new Error('template option is mandatory'); }\r\n    if (typeof options.template !== 'string') { throw new Error('invalid template option'); }\r\n    if ($(options.template).length === 0) { throw new Error('invalid template option'); }\r\n    if (!Array.isArray(options.builders)) { throw new Error('builders options is mandatory'); }\r\n    if (!options.createItemDragger) { throw new Error('createItemDragger option is Mandatory'); }\r\n    if (typeof options.createItemDragger !== 'function') { throw new Error('invalid createItemDragger option'); }\r\n    if (typeof options.width !== 'number') { throw new Error('width option is mandatory and has to be a number'); }\r\n    if (options.minHeight !== undefined && typeof options.minHeight !== 'number') { throw new Error('width option is mandatory and has to be a number'); }\r\n    if (options.padding !== undefined && typeof options.padding !== 'number') { throw new Error('width option is mandatory and has to be a number'); }\r\n\r\n    var container = $(_.head($(options.container))),\r\n        builders = options.builders,\r\n        createItemDragger = options.createItemDragger,\r\n        template = $(options.template),\r\n        width = options.width,\r\n        minHeight = options.minHeight || 50,\r\n        padding = options.padding || 0;\r\n\r\n    if (padding < 0) { throw new Error('padding cannot be less than zero'); }\r\n    if (width < 2 * padding) { throw new Error('width cannot be less than zero (or 2 time padding)'); }\r\n    if (minHeight < 2 * padding) { throw new Error('minHeight cannot be less than zero (or 2 time padding)'); }\r\n\r\n    _.each(builders, function (builder) {\r\n        var item = template.clone();\r\n        container.append(item);\r\n        if (!item.hasClass('almost-place-holder')) {\r\n            item = item.find('.almost-place-holder');\r\n        }\r\n        createItemDragger({el: item, createElements: builder, width: width, minHeight: minHeight, padding: padding});\r\n    });\r\n}\r\n\r\nexports.ElementsMenu = ElementsMenu;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{}],6:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null),\r\n    $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null),\r\n    createResizeReactor = require('./resizereactor').ResizeReactor;\r\n\r\nfunction EmbeddingReactor(options) {\r\n    if (!(this instanceof EmbeddingReactor)) { return new EmbeddingReactor(options); }\r\n    options = options || {};\r\n\r\n    if (!options.paper || typeof options.paper !== 'object' || !(options.paper instanceof joint.dia.Paper)) { throw new Error('paper option is mandatory'); }\r\n    if (!options.model || typeof options.model !== 'object') { throw new Error('model option is mandatory'); }\r\n    if (!options.isValidParent || typeof options.isValidParent !== 'function') { throw new Error('isValidParent option is mandatory'); }\r\n    if (!options.undoReactor || typeof options.undoReactor !== 'object') { throw new Error('undoReactor option is mandatory'); }\r\n\r\n    var paper = options.paper,\r\n        model = options.model,\r\n        isValidParent = options.isValidParent,\r\n        undoReactor = options.undoReactor,\r\n        startPosition;\r\n\r\n    paper.on('cell:pointerdown', function (cellView, evt, x, y) {\r\n        _.noop(evt, x, y);\r\n        var element = cellView.model;\r\n\r\n        if (element.isLink()) { return; }\r\n\r\n        startPosition = element.position();\r\n        undoReactor.start();\r\n\r\n        element.toFront({deep: true});\r\n\r\n        model.startBatch('to-front');\r\n        _.invoke(model.getLinks(), 'toFront');\r\n        model.stopBatch('to-front');\r\n    });\r\n\r\n    function getParent(cellView) {\r\n        var element = cellView.model,\r\n            elementsBelow = model.findModelsInArea(element.getBBox({useModelGeometry: true}));\r\n\r\n        if (elementsBelow.length) {\r\n            return _.chain(elementsBelow)\r\n                .map(function (parent) {\r\n                    return paper.findViewByModel(parent);\r\n                })\r\n                .filter(function (parentCellView) {\r\n                    return isValidParent(cellView, parentCellView);\r\n                })\r\n                .sortBy(_.method('get', 'z'))\r\n                .last()\r\n                .value();\r\n        }\r\n    }\r\n\r\n    paper.on('cell:pointerup', function (cellView, evt, x, y) {\r\n        _.noop(evt, x, y);\r\n        var element = cellView.model,\r\n            newPosition,\r\n            oldparent,\r\n            newparent;\r\n\r\n        if (element.isLink()) { return; }\r\n\r\n        newPosition = element.position();\r\n\r\n        function end() {\r\n            undoReactor.stop();\r\n        }\r\n\r\n        function abort() {\r\n            if (undoReactor.stop()) {\r\n                model.startBatch('to-back');\r\n                undoReactor.undo(false);\r\n                model.stopBatch('to-back');\r\n            }\r\n        }\r\n\r\n        if (newPosition.x === startPosition.x && newPosition.y === startPosition.y) {\r\n            abort();\r\n            return;\r\n        }\r\n\r\n        function reparent() {\r\n            _.each(\r\n                model.getConnectedLinks(element, {deep: true}),\r\n                function (link) { link.reparent(); }\r\n            );\r\n            undoReactor.stop();\r\n        }\r\n\r\n        newparent = getParent(cellView);\r\n        newparent = newparent && newparent.model;\r\n        if (!newparent && !isValidParent(cellView, undefined)) {\r\n            abort();\r\n            return;\r\n        }\r\n\r\n        oldparent = model.getCell(element.get('parent'));\r\n\r\n        if (newparent) {\r\n            if (oldparent) {\r\n                oldparent.unembed(element, {reparenting: true});\r\n                newparent.embed(element);\r\n                reparent();\r\n            } else {\r\n                newparent.embed(element);\r\n                reparent();\r\n            }\r\n        } else {\r\n            if (oldparent) {\r\n                oldparent.unembed(element);\r\n                reparent();\r\n            } else {\r\n                end();\r\n            }\r\n        }\r\n    });\r\n\r\n    model.on('add', function (cell) {\r\n        if (cell.isLink()) { return cell.get('parent') || cell.reparent(); }\r\n        var element = cell,\r\n            cellView = paper.findViewByModel(element),\r\n            parent;\r\n        if (element.get('parent')) {\r\n            parent = model.getCell(element.get('parent'));\r\n            parent.unembed(element, {reparenting: true});\r\n            parent.embed(element);\r\n            return;\r\n        }\r\n        parent = getParent(cellView);\r\n        parent = parent && parent.model;\r\n        if (parent) {\r\n            parent.embed(element);\r\n        } else {\r\n            if (!isValidParent(cellView, undefined)) {\r\n                _.defer(function () { element.remove(); });\r\n            } else {\r\n                element.set('parent');\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nexports.EmbeddingReactor = EmbeddingReactor;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./resizereactor\":24}],7:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null),\r\n    $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null),\r\n    backbone = (typeof window !== \"undefined\" ? window['Backbone'] : typeof global !== \"undefined\" ? global['Backbone'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null),\r\n    window = (typeof window !== \"undefined\" ? window['window'] : typeof global !== \"undefined\" ? global['window'] : null),\r\n    createMap = require('./map').Map,\r\n    createItemDragger = require('./itemdragger').ItemDragger,\r\n    createPanReactor = require('./panreactor').PanReactor,\r\n    createZoomReactor = require('./zoomreactor').ZoomReactor,\r\n    createManipulationReactor = require('./manipulationreactor').ManipulationReactor,\r\n    createEmbeddingReactor = require('./embeddingreactor').EmbeddingReactor,\r\n    createUndoReactor = require('./undoreactor').UndoReactor,\r\n    createElementsMenu = require('./elementsmenu').ElementsMenu,\r\n    linkConnectionPoint = require('./linkconnectionpoint').linkConnectionPoint,\r\n    validateConnection = require('./validateconnection').validateConnection;\r\n\r\nfunction defaultIsValidParent(cellView, parentCellView) {\r\n    if (!cellView) {\r\n        return false;\r\n    }\r\n    if (!parentCellView) {\r\n        return true;\r\n    }\r\n    return cellView.model.id !== parentCellView.model.id;\r\n}\r\n\r\nfunction Board(options) {\r\n    if (!(this instanceof Board)) { return new Board(options); }\r\n    _.extend(this, backbone.Events);\r\n    options = options || {};\r\n\r\n    if (!options.model || typeof options.model !== 'object') { throw new Error('model option is mandatory'); }\r\n    if (options.actions && !Array.isArray(options.actions)) { throw new Error('actions option should be an Array'); }\r\n    if (options.defaultLink && typeof options.defaultLink !== 'function') { throw new Error('defaultLink option must be a function'); }\r\n    if (options.isValidParent && typeof options.isValidParent !== 'function') { throw new Error('isValidParent option must be a function'); }\r\n    if (!options.el) { throw new Error('el option is mandatory'); }\r\n    if ($(options.el).length === 0) { throw new Error('invalid el option'); }\r\n\r\n    var self = this,\r\n        el = $($(options.el).addClass('almost-joint-paper')[0]),\r\n        model = options.model,\r\n        gridSize = 10,\r\n        defaultLink = options.defaultLink || _.noop,\r\n        isValidParent = options.isValidParent || defaultIsValidParent,\r\n        paper = new joint.dia.Paper({\r\n            el: el,\r\n            width: el.width(),\r\n            height: el.height(),\r\n            model: model,\r\n            gridSize: gridSize,\r\n            defaultLink: defaultLink,\r\n            multiLinks: false,\r\n            linkConnectionPoint: linkConnectionPoint,\r\n            linkPinning: false,\r\n            validateConnection: validateConnection,\r\n            interactive: !options.readonly,\r\n        }),\r\n        map = createMap({\r\n            paper: paper,\r\n            el: el,\r\n            model: model,\r\n            linkConnectionPoint: linkConnectionPoint\r\n        }),\r\n        undoReactor = createUndoReactor({\r\n            el: el,\r\n            model: model\r\n        }),\r\n        zoomReactor = createZoomReactor({\r\n            paper: paper,\r\n            el: el,\r\n            model: model,\r\n            minScale: options.minScale || 0.01,\r\n            maxScale: options.maxScale || 2\r\n        }),\r\n        manipulationReactor = createManipulationReactor({\r\n            paper: paper,\r\n            el: el,\r\n            model: model,\r\n            gridSize: gridSize,\r\n            actions: options.actions,\r\n            resize: options.resize,\r\n            rotate: options.rotate,\r\n            magnetize: options.magnetize,\r\n            undoReactor: undoReactor\r\n        }),\r\n        embeddingReactor = createEmbeddingReactor({\r\n            paper: paper,\r\n            model: model,\r\n            isValidParent: isValidParent,\r\n            undoReactor: undoReactor\r\n        });\r\n\r\n\r\n\r\n    _.noop(embeddingReactor);\r\n\r\n    el[0].addEventListener('mousedown', function (evt) {\r\n        if ($(evt.target).hasClass('almost-joint-no-grip')) {\r\n            evt.stopPropagation();\r\n            var p = paper.snapToGrid({x: evt.clientX, y: evt.clientY});\r\n            createPanReactor({paper: paper, el: el, x: p.x, y: p.y});\r\n        }\r\n    }, true);\r\n\r\n    manipulationReactor.on('all', this.trigger, this);\r\n\r\n    paper.on('all', this.trigger, this);\r\n\r\n    paper.on('blank:pointerdown', function (evt, x, y) {\r\n        _.noop(evt);\r\n        createPanReactor({paper: paper, el: el, x: x, y: y});\r\n    });\r\n\r\n    function updateViewport() {\r\n        var left = el.offset().left,\r\n            top = el.offset().top,\r\n            width = el.width(),\r\n            height = el.height(),\r\n            topLeft = joint.g.point(left, top),\r\n            bottomRight = joint.g.point(left + width, top + height),\r\n            min = paper.clientToLocalPoint(topLeft),\r\n            max = paper.clientToLocalPoint(bottomRight);\r\n        map.setViewport({x: min.x, y: min.y, width: max.x - min.x, height: max.y - min.y});\r\n    }\r\n\r\n    $(window).resize(function () {\r\n        el.css('width', '').css('height', '');\r\n        paper.setDimensions(el.width(), el.height());\r\n        updateViewport();\r\n    });\r\n\r\n    paper.on('translate', updateViewport);\r\n    paper.on('scale', updateViewport);\r\n    model.once('add', updateViewport);\r\n\r\n    self.zoomE = function () {\r\n        zoomReactor.zoomE();\r\n    };\r\n\r\n    self.paper = function () {\r\n        return paper;\r\n    };\r\n\r\n    self.download = function () {\r\n        map.download();\r\n    };\r\n\r\n    self.clearHistory = function () {\r\n        undoReactor.clear();\r\n    };\r\n\r\n    self.startUndoSequence = function () {\r\n        return undoReactor.start();\r\n    };\r\n\r\n    self.stopUndoSequence = function () {\r\n        return undoReactor.stop();\r\n    };\r\n\r\n    self.createItemDragger = function (options) {\r\n        options = options || {};\r\n        return createItemDragger({\r\n            paper: paper,\r\n            el: options.el,\r\n            model: model,\r\n            gridSize: gridSize,\r\n            createElements: options.createElements,\r\n            width: options.width,\r\n            minHeight: options.minHeight,\r\n            linkConnectionPoint: linkConnectionPoint,\r\n            undoReactor: undoReactor\r\n        });\r\n    };\r\n\r\n    self.createElementsMenu = function (options) {\r\n        options = options || {};\r\n        return createElementsMenu({\r\n            container: options.container,\r\n            template: options.template,\r\n            builders: options.builders,\r\n            createItemDragger: self.createItemDragger,\r\n            width: options.width,\r\n            minHeight: options.minHeight\r\n        });\r\n    };\r\n}\r\n\r\nexports.Board = Board;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./elementsmenu\":5,\"./embeddingreactor\":6,\"./itemdragger\":9,\"./linkconnectionpoint\":12,\"./manipulationreactor\":13,\"./map\":15,\"./panreactor\":23,\"./undoreactor\":28,\"./validateconnection\":30,\"./zoomreactor\":31}],8:[function(require,module,exports){\nmodule.exports = \"<div class=\\\"almost-joint-item-dragger\\\"></div>\\r\\n\";\n\n},{}],9:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null),\r\n    _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null),\r\n    backbone = (typeof window !== \"undefined\" ? window['Backbone'] : typeof global !== \"undefined\" ? global['Backbone'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null),\r\n    document = (typeof window !== \"undefined\" ? window['document'] : typeof global !== \"undefined\" ? global['document'] : null);\r\n\r\nfunction clone(model, items) {\r\n    var mapping = model.cloneCells(items);\r\n    return _.map(items, function (i) { return mapping[i.id]; });\r\n}\r\n\r\nfunction wrapItems(paper, elements, size, minHeight, gridSize) {\r\n    var bbox = _(elements).map(function (cell) {\r\n            return paper.findViewByModel(cell).getBBox();\r\n        }).reduce(function (memo, bbox) {\r\n            return memo.union(bbox);\r\n        }),\r\n        maxsize = Math.max(bbox.width, bbox.height) + gridSize * 2,\r\n        scale = Math.max(1, maxsize / size),\r\n        actualwidth = size * scale,\r\n        actualheight = Math.max(bbox.height + gridSize * 2, minHeight * scale),\r\n        left = (actualwidth - bbox.width) / 2,\r\n        top = (actualheight - bbox.height) / 2,\r\n        position = joint.g.point(joint.g.snapToGrid(bbox.x - left, gridSize), joint.g.snapToGrid(bbox.y - top, gridSize)),\r\n        containerItem = new joint.shapes.basic.Rect({\r\n            position: position,\r\n            size: { width: actualwidth, height: actualheight},\r\n            attrs: { rect: { fill: 'transparent', stroke: 'transparent' } }\r\n        });\r\n\r\n    return containerItem;\r\n}\r\n\r\nfunction removeHandlers(paper, items) {\r\n    _.each(items, function (item) {\r\n        paper.findViewByModel(item).$el.css('pointer-events', 'none');\r\n    });\r\n}\r\n\r\nfunction ItemDragger(options) {\r\n    if (!(this instanceof ItemDragger)) { return new ItemDragger(options); }\r\n    _.extend(this, backbone.Events);\r\n\r\n    options = options || {};\r\n\r\n    if (!options.model || typeof options.model !== 'object') { throw new Error('model option is mandatory'); }\r\n    if (!options.paper || typeof options.paper !== 'object') { throw new Error('paper option is mandatory'); }\r\n    if (!options.createElements || typeof options.createElements !== 'function') { throw new Error('createElements option is mandatory'); }\r\n    if (!options.linkConnectionPoint || typeof options.linkConnectionPoint !== 'function') { throw new Error('linkConnectionPoint option is mandatory'); }\r\n    if (!options.el) { throw new Error('el option is mandatory'); }\r\n    if ($(options.el).length === 0) { throw new Error('invalid el options'); }\r\n    if (typeof options.gridSize !== 'number') { throw new Error('gridSize option is mandatory and has to be a number'); }\r\n    if (options.gridSize < 0) { throw new Error('gridSize cannot be less than zero'); }\r\n    if (typeof options.width !== 'number') { throw new Error('width option is mandatory and has to be a number'); }\r\n    if (options.width < 0) { throw new Error('width cannot be less than zero'); }\r\n    if (options.minHeight < 0) { throw new Error('minHeight cannot be less than zero'); }\r\n    if (!options.undoReactor || typeof options.undoReactor !== 'object') { throw new Error('model option is mandatory'); }\r\n\r\n    var self = this,\r\n        gridSize = options.gridSize,\r\n        createElements = options.createElements,\r\n        linkConnectionPoint = options.linkConnectionPoint,\r\n        el = $($(options.el)[0]),\r\n        paper = options.paper,\r\n        model = options.model,\r\n        minHeight = options.minHeight,\r\n        paperWidth = options.width - gridSize * 2,\r\n        undoReactor = options.undoReactor,\r\n        overlayitems = createElements(),\r\n        mainitem,\r\n        mainposition,\r\n        size,\r\n        preview = (function () {\r\n            var container = $(require('./dragger.html'));\r\n            $(document.body).append(container);\r\n            return container;\r\n        }()),\r\n        baseScale,\r\n        paperHeight,\r\n        overlaymodel = new joint.dia.Graph(),\r\n        overlaypaper = new joint.dia.Paper({\r\n            el: preview,\r\n            width: paperWidth,\r\n            model: overlaymodel,\r\n            linkConnectionPoint: linkConnectionPoint,\r\n            gridSize: gridSize\r\n        });\r\n    //add elements\r\n    overlaymodel.addCells(overlayitems);\r\n    //compute bbox\r\n    mainitem = wrapItems(overlaypaper, overlayitems, paperWidth, minHeight, gridSize);\r\n    overlaymodel.addCell(mainitem);\r\n    //resize paper\r\n    mainposition = mainitem.position();\r\n    size = mainitem.get('size');\r\n    baseScale = paperWidth / size.width;\r\n    paperHeight = size.height * baseScale;\r\n    overlaypaper.scale(baseScale, baseScale);\r\n    overlaypaper.setDimensions(paperWidth, paperHeight);\r\n    //for rendering\r\n    el.append(preview);\r\n    //remove handlers\r\n    removeHandlers(overlaypaper, overlayitems);\r\n    _.each(overlayitems, function (item) {\r\n        if (item.get('parent')) { return; }\r\n        mainitem.embed(item);\r\n    });\r\n    mainitem.translate(-mainposition.x, -mainposition.y);\r\n\r\n    overlaypaper.on('cell:pointerdown', function (cellView, e, x, y) {\r\n        _.noop(cellView);\r\n        var overlay = $(require('./overlay.html')),\r\n            container = $(paper.el),\r\n            spacer = $('<div></div>').css('height', preview.height() + 2 * gridSize),\r\n            left = container.offset().left,\r\n            top = container.offset().top,\r\n            width = container.width(),\r\n            height = container.height(),\r\n            topLeft = joint.g.point(left, top),\r\n            bottomRight = joint.g.point(left + width, top + height),\r\n            current = joint.g.point(e.clientX, e.clientY),\r\n            minLocal = paper.clientToLocalPoint(topLeft),\r\n            maxLocal = paper.clientToLocalPoint(bottomRight),\r\n            startPoint = paper.clientToLocalPoint(current),\r\n            scale = joint.g.point(width / (maxLocal.x - minLocal.x), height / (maxLocal.y - minLocal.y)),\r\n            startPosition = joint.g.point(joint.g.snapToGrid(startPoint.x - x, gridSize), joint.g.snapToGrid(startPoint.y - y, gridSize));\r\n\r\n        container.append(overlay);\r\n        overlay.append(preview);\r\n        el.append(spacer);\r\n\r\n        overlaypaper.setDimensions(width, height);\r\n        overlaypaper.scale(scale.x, scale.y);\r\n        overlaypaper.setOrigin(-minLocal.x * scale.x, -minLocal.y * scale.y);\r\n        mainitem.translate(startPosition.x, startPosition.y);\r\n\r\n        function pointermove() {\r\n            mainitem.translate(-startPosition.x, -startPosition.y);\r\n        }\r\n\r\n        overlaypaper.once('cell:pointermove', pointermove);\r\n\r\n        overlaypaper.on('cell:pointerup', function pointerup(cellView, e, x, y) {\r\n            _.noop(cellView, e);\r\n            overlaypaper.off('cell:pointermove', pointermove);\r\n            var position = mainitem.position(),\r\n                paperBBox = joint.g.rect(0, 0, paper.options.width, paper.options.height),\r\n                releasePoint = paper.localToPaperPoint(paper.clientToLocalPoint(overlaypaper.localToClientPoint(joint.g.point(x, y)))),\r\n                items,\r\n                overlaytopitems;\r\n            if (paperBBox.containsPoint(releasePoint)) {\r\n                overlaytopitems = _.filter(overlayitems, function (i) { return i.get('parent') === mainitem.id; });\r\n                _.each(overlaytopitems, function (item) { mainitem.unembed(item); });\r\n                items = clone(overlaymodel, overlayitems);\r\n                _.each(items, function (item) { item.unset('z'); });\r\n                undoReactor.start();\r\n                model.addCells(items);\r\n                undoReactor.stop();\r\n                _.each(overlaytopitems, function (item) { mainitem.embed(item); });\r\n            }\r\n            spacer.remove();\r\n            el.append(preview);\r\n            overlay.remove();\r\n\r\n            mainitem.translate(-position.x, -position.y);\r\n            overlaypaper.setDimensions(paperWidth, paperHeight);\r\n            overlaypaper.scale(baseScale, baseScale);\r\n            overlaypaper.setOrigin(0, 0);\r\n\r\n            overlaypaper.off('cell:pointerup', pointerup);\r\n            self.trigger('drag:end');\r\n        });\r\n\r\n        self.trigger('drag:start');\r\n    });\r\n}\r\n\r\nItemDragger.prototype = Object.create(ItemDragger.prototype);\r\n\r\nexports.ItemDragger = ItemDragger;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./dragger.html\":8,\"./overlay.html\":10}],10:[function(require,module,exports){\nmodule.exports = \"<div class=\\\"almost-join-item-dragger-overlay\\\"></div>\\r\\n\";\n\n},{}],11:[function(require,module,exports){\nmodule.exports = \"<svg\\r\\n   xmlns:dc=\\\"http://purl.org/dc/elements/1.1/\\\"\\r\\n   xmlns:cc=\\\"http://creativecommons.org/ns#\\\"\\r\\n   xmlns:rdf=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\r\\n   xmlns:svg=\\\"http://www.w3.org/2000/svg\\\"\\r\\n   xmlns=\\\"http://www.w3.org/2000/svg\\\"\\r\\n   xml:space=\\\"preserve\\\"\\r\\n   viewBox=\\\"0 0 44.236 44.236\\\"\\r\\n   height=\\\"44.236\\\"\\r\\n   width=\\\"44.236\\\"\\r\\n   y=\\\"0px\\\"\\r\\n   x=\\\"0px\\\"\\r\\n   id=\\\"Capa_1\\\"\\r\\n   version=\\\"1.1\\\"><metadata\\r\\n     id=\\\"metadata53\\\"><rdf:RDF><cc:Work\\r\\n         rdf:about=\\\"\\\"><dc:format>image/svg+xml</dc:format><dc:type\\r\\n           rdf:resource=\\\"http://purl.org/dc/dcmitype/StillImage\\\" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs\\r\\n     id=\\\"defs51\\\" /><circle\\r\\n     r=\\\"22.118\\\"\\r\\n     cy=\\\"22.118\\\"\\r\\n     cx=\\\"22.118\\\"\\r\\n     id=\\\"path4181\\\"\\r\\n     style=\\\"color:#000000;display:inline;overflow:visible;visibility:visible;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:0.40000001;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker:none;enable-background:accumulate\\\" /><path\\r\\n     id=\\\"path7\\\"\\r\\n     d=\\\"M 22.118,44.236 C 9.922,44.236 0,34.314 0,22.119 0,9.923 9.922,0 22.118,0 c 12.196,0 22.118,9.923 22.118,22.119 0,12.195 -9.922,22.117 -22.118,22.117 z m 0,-42.736 C 10.75,1.5 1.5,10.75 1.5,22.119 c 0,11.369 9.25,20.617 20.618,20.617 11.368,0 20.618,-9.248 20.618,-20.617 C 42.736,10.75 33.486,1.5 22.118,1.5 Z\\\" /><g\\r\\n     id=\\\"g19\\\" /><g\\r\\n     id=\\\"g21\\\" /><g\\r\\n     id=\\\"g23\\\" /><g\\r\\n     id=\\\"g25\\\" /><g\\r\\n     id=\\\"g27\\\" /><g\\r\\n     id=\\\"g29\\\" /><g\\r\\n     id=\\\"g31\\\" /><g\\r\\n     id=\\\"g33\\\" /><g\\r\\n     id=\\\"g35\\\" /><g\\r\\n     id=\\\"g37\\\" /><g\\r\\n     id=\\\"g39\\\" /><g\\r\\n     id=\\\"g41\\\" /><g\\r\\n     id=\\\"g43\\\" /><g\\r\\n     id=\\\"g45\\\" /><g\\r\\n     id=\\\"g47\\\" /><g\\r\\n     id=\\\"g3\\\"\\r\\n     transform=\\\"matrix(0.07890863,-0.07890863,0.07890863,0.07890863,0.90476107,22.118124)\\\"><path\\r\\n       id=\\\"path5\\\"\\r\\n       d=\\\"m 265.171,125.577 -80,-80 c -4.881,-4.881 -12.797,-4.881 -17.678,0 -4.882,4.882 -4.882,12.796 0,17.678 l 58.661,58.661 -213.654,0 c -6.903,0 -12.5,5.597 -12.5,12.5 0,6.902 5.597,12.5 12.5,12.5 l 213.654,0 -58.659,58.661 c -4.882,4.882 -4.882,12.796 0,17.678 2.44,2.439 5.64,3.661 8.839,3.661 3.199,0 6.398,-1.222 8.839,-3.661 l 79.998,-80 c 4.882,-4.882 4.882,-12.796 0,-17.678 z\\\" /></g></svg>\\r\\n\";\n\n},{}],12:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null);\r\n\r\nvar allBorders = {top: true, left: true, bottom: true, right: true};\r\n\r\nfunction fixBorders(borders) {\r\n    if (!borders) { return allBorders; }\r\n    if (borders.top || borders.left || borders.bottom || borders.right) { return borders; }\r\n    return allBorders;\r\n}\r\n\r\nfunction nearestPointOnBorder(me, other, borders) {\r\n    borders = fixBorders(borders);\r\n    var left =   borders.left   ? Math.abs(me.origin().x - other.origin().x) : Infinity,\r\n        top =    borders.top    ? Math.abs(me.origin().y - other.origin().y) : Infinity,\r\n        right =  borders.right  ? Math.abs(me.corner().x - other.corner().x) : Infinity,\r\n        bottom = borders.bottom ? Math.abs(me.corner().y - other.corner().y) : Infinity,\r\n        min = Math.min(left, top, right, bottom),\r\n        center = me.containsRect(other) ? other.center() : me.center();\r\n    if (min === top) {    return joint.g.point(center.x,      me.origin().y); }\r\n    if (min === left) {   return joint.g.point(me.origin().x, center.y); }\r\n    if (min === bottom) { return joint.g.point(center.x,      me.corner().y); }\r\n    return joint.g.point(me.corner().x, center.y);\r\n}\r\n\r\nfunction perpendicular(me, other) {\r\n    if (me.intersect(other)) { return false; }\r\n    var minX = Math.max(me.origin().x, other.origin().x),\r\n        maxX = Math.min(me.corner().x, other.corner().x),\r\n        minY = Math.max(me.origin().y, other.origin().y),\r\n        maxY = Math.min(me.corner().y, other.corner().y);\r\n    if (minX <= maxX) {\r\n        return me.pointNearestToPoint(joint.g.point((minX + maxX) / 2, other.center().y));\r\n    }\r\n    if (minY <= maxY) {\r\n        return me.pointNearestToPoint(joint.g.point(other.center().x, (minY + maxY) / 2));\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction fixPointByAngle(bbox, angle, point) {\r\n    if (!point) { return; }\r\n    angle = joint.g.normalizeAngle(angle);\r\n    if (angle % 90 === 0) { return point; }\r\n    var rbbox = bbox.bbox(angle),\r\n        center = bbox.center(),\r\n        rorigin = bbox.origin().rotate(center, angle),\r\n        rtopRight = bbox.topRight().rotate(center, angle),\r\n        rcorner = bbox.corner().rotate(center, angle),\r\n        rbottomLeft = bbox.bottomLeft().rotate(center, angle),\r\n        leftLine = joint.g.line(rorigin, rbottomLeft),\r\n        topLine = joint.g.line(rtopRight, rorigin),\r\n        bottomtLine = joint.g.line(rcorner, rbottomLeft),\r\n        rightLine = joint.g.line(rtopRight, rcorner),\r\n        intersectionLine;\r\n    switch (rbbox.sideNearestToPoint(point)) {\r\n    case \"top\":\r\n        intersectionLine = joint.g.line(point, joint.g.point(point.x, rbbox.corner().y));\r\n        break;\r\n    case \"left\":\r\n        intersectionLine = joint.g.line(point, joint.g.point(rbbox.origin().x, point.y));\r\n        break;\r\n    case \"right\":\r\n        intersectionLine = joint.g.line(point, joint.g.point(rbbox.corner().x, point.y));\r\n        break;\r\n    case \"bottom\":\r\n        intersectionLine = joint.g.line(point, joint.g.point(point.x, rbbox.origin().y));\r\n        break;\r\n    }\r\n    return _.chain([leftLine, topLine, bottomtLine, rightLine])\r\n        .map(_.bind(intersectionLine.intersection, intersectionLine))\r\n        .reduce(function (previousValue, currentValue) {\r\n            if (!currentValue) { return previousValue; }\r\n            if (!previousValue) { return currentValue; }\r\n            if (point.distance(previousValue) > point.distance(currentValue)) { return currentValue; }\r\n            return previousValue;\r\n        }).value();\r\n}\r\n\r\nfunction linkConnectionPoint(linkView, view, magnet, reference) {\r\n    var element = view.model,\r\n        dTargetBorders,\r\n        dTargetAngle = 0,\r\n        dTargetBBox = (function () {\r\n            var link = linkView.model,\r\n                other,\r\n                vertices = link.get('vertices'),\r\n                source = link.get('source').id,\r\n                target = link.get('target').id;\r\n            if (source === element.id) {\r\n                if (vertices && vertices.length > 0) {\r\n                    return joint.g.rect(vertices[0].x, vertices[0].y, 0, 0);\r\n                }\r\n                if (target) {\r\n                    other = link.getTargetElement();\r\n                    dTargetAngle = other.get('angle');\r\n                    dTargetBorders = other.get('borders');\r\n                    return other.getBBox({useModelGeometry: true});\r\n                }\r\n            } else {\r\n                if (vertices && vertices.length > 0) {\r\n                    return joint.g.rect(vertices[vertices.length - 1].x, vertices[vertices.length - 1].y, 0, 0);\r\n                }\r\n                if (source) {\r\n                    other = link.getSourceElement();\r\n                    dTargetAngle = other.get('angle');\r\n                    dTargetBorders = other.get('borders');\r\n                    return other.getBBox({useModelGeometry: true});\r\n                }\r\n            }\r\n            return joint.g.rect(reference.x, reference.y, 0, 0);\r\n        }());\r\n    function defaultConnectionPoint(bbox, targetBBox, angle, targetAngle) {\r\n        targetBBox = targetBBox || dTargetBBox;\r\n        targetAngle = targetAngle || dTargetAngle;\r\n        angle = angle || element.get('angle');\r\n        bbox = bbox || element.getBBox({useModelGeometry: true});\r\n        var rbbox = bbox.bbox(angle),\r\n            rTargetBBox = targetBBox;\r\n        if (rbbox.containsRect(rTargetBBox)) {\r\n            return fixPointByAngle(bbox, angle, nearestPointOnBorder(rbbox, rTargetBBox, dTargetBorders));\r\n        }\r\n        if (rTargetBBox.containsRect(rbbox)) {\r\n            return fixPointByAngle(bbox, angle, nearestPointOnBorder(rbbox, rTargetBBox, element.get('borders')));\r\n        }\r\n        return fixPointByAngle(bbox, angle, perpendicular(rbbox, rTargetBBox)) ||\r\n                bbox.intersectionWithLineFromCenterToPoint(targetBBox.center(), angle) ||\r\n                fixPointByAngle(bbox, angle, rbbox.pointNearestToPoint(targetBBox.center()));\r\n    }\r\n    if (view.model.linkConnectionPoint) {\r\n        return view.model.linkConnectionPoint(linkView, view, magnet, reference, dTargetBBox, dTargetAngle, defaultConnectionPoint);\r\n    }\r\n    return defaultConnectionPoint();\r\n}\r\n\r\nexports.linkConnectionPoint = linkConnectionPoint;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{}],13:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null),\r\n    $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null),\r\n    backbone = (typeof window !== \"undefined\" ? window['Backbone'] : typeof global !== \"undefined\" ? global['Backbone'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null),\r\n    mousetrap = require('mousetrap'),\r\n    navigator = (typeof window !== \"undefined\" ? window['navigator'] : typeof global !== \"undefined\" ? global['navigator'] : null),\r\n    createResizeReactor = require('./resizereactor').ResizeReactor,\r\n    createRotateReactor = require('./rotatereactor').RotateReactor;\r\n\r\nfunction propertyChecker(property, defaultValue) {\r\n    return function (model) {\r\n        if (model[property] === undefined) { return defaultValue; }\r\n        if (typeof model[property] === 'function') { return model[property](); }\r\n        return model[property];\r\n    };\r\n}\r\n\r\nfunction isMultiselect(e) {\r\n    if (navigator.platform.substr(0, 3).toLowerCase() === 'mac') { return e.metaKey; }\r\n    return e.ctrlKey;\r\n}\r\n\r\nvar canResize = propertyChecker('resizable', false),\r\n    canRotate = propertyChecker('rotatable', false);\r\n\r\nfunction ManipulationReactor(options) {\r\n    if (!(this instanceof ManipulationReactor)) { return new ManipulationReactor(options); }\r\n    _.extend(this, backbone.Events);\r\n    options = options || {};\r\n\r\n    if (!options.paper || typeof options.paper !== 'object' || !(options.paper instanceof joint.dia.Paper)) { throw new Error('paper option is mandatory'); }\r\n    if (!options.model || typeof options.model !== 'object') { throw new Error('model option is mandatory'); }\r\n    if (options.actions && !Array.isArray(options.actions)) { throw new Error('actions option should be an array'); }\r\n    if (!options.el) { throw new Error('el option is mandatory'); }\r\n    if ($(options.el).length === 0) { throw new Error('invalid el option'); }\r\n    if (typeof options.gridSize !== 'number') { throw new Error('gridSize option is mandatory and has to be a number'); }\r\n    if (options.gridSize < 0) { throw new Error('gridSize cannot be less than zero'); }\r\n    if (!options.undoReactor || typeof options.undoReactor !== 'object') { throw new Error('undoReactor option is mandatory'); }\r\n\r\n    var self = this,\r\n        el = $($(options.el)[0]),\r\n        paper = options.paper,\r\n        model = options.model,\r\n        gridSize = options.gridSize,\r\n        actions = options.actions || [exports.edit, exports.delete],\r\n        resize = options.resize === undefined ? true : !!options.resize,\r\n        rotate = options.resize === undefined ? true : !!options.rotate,\r\n        magnetize = options.magnetize === undefined ? true : !!options.magnetize,\r\n        selectedViews = {},\r\n        undoReactor = options.undoReactor;\r\n\r\n    el.attr('tabindex', 1);\r\n\r\n    function updateManipulator(element) {\r\n        if (element.isLink()) { return; }\r\n        var bundle = selectedViews[element.id],\r\n            bbox,\r\n            angle;\r\n        if (!bundle) { return; }\r\n        bbox = bundle.view.getBBox({useModelGeometry: true});\r\n        bundle.el\r\n            .css('left', bbox.x - gridSize)\r\n            .css('top', bbox.y - gridSize)\r\n            .css('width', bbox.width + 2 * gridSize)\r\n            .css('height', bbox.height + 2 * gridSize);\r\n        angle = element.get('angle');\r\n        $(bundle.el.find('.almost-joint-marker-rotate'))\r\n            .css('left', (bbox.width + 94) / 2 * (1 + Math.cos(joint.g.toRad(angle))) - 36)\r\n            .css('top', (bbox.height + 94) / 2 * (1 + Math.sin(joint.g.toRad(angle))) - 36);\r\n    }\r\n\r\n    function updateManipulators() {\r\n        _.map(selectedViews, function (bundle) {\r\n            updateManipulator(bundle.view.model);\r\n        });\r\n    }\r\n\r\n    function closeManipulator(element) {\r\n        var bundle = selectedViews[element.id];\r\n        if (!bundle) { return; }\r\n        if (bundle.view.model.demagnetize) { bundle.view.model.demagnetize(); }\r\n        bundle.el.remove();\r\n        bundle.view.off('change:position change:size', updateManipulator);\r\n        delete selectedViews[element.id];\r\n    }\r\n\r\n    function closeManipulators(currentid) {\r\n        _.map(selectedViews, function (bundle, id) {\r\n            if (id === currentid) { return; }\r\n            closeManipulator(bundle.view.model);\r\n        });\r\n    }\r\n\r\n    function toggleManipulator(cellView, evt) {\r\n        if (cellView.model.isLink()) { return; }\r\n        if (!isMultiselect(evt)) { closeManipulators(cellView.model.id); }\r\n        var id = cellView.model.id,\r\n            bundle = selectedViews[id],\r\n            tab;\r\n        if (!bundle) {\r\n            bundle = selectedViews[cellView.model.id] = {\r\n                el: (function () {var manipulator = $(require('./manipulator.html')); el.append(manipulator); return manipulator; }()),\r\n                view: cellView,\r\n            };\r\n            bundle.view.model.on('change:position change:size change:angle', updateManipulator);\r\n            bundle.view.model.on('change:id', function () {\r\n                delete selectedViews[id];\r\n                id = this.id;\r\n                selectedViews[this.id] = bundle;\r\n            });\r\n            tab = $(bundle.el.find('.almost-joint-marker-tab'));\r\n            bundle.context = {\r\n                undoReactor: undoReactor,\r\n                close: function () {\r\n                    closeManipulator(bundle.view.model);\r\n                }\r\n            };\r\n            if (magnetize && bundle.view.model.magnetize && bundle.view.model.demagnetize) {\r\n                (function () {\r\n                    var linkmarker = $(_.first($(require('./link.svg')))),\r\n                        movemarker = $(_.first($(require('./move.svg'))));\r\n                    linkmarker.on('click', function () {\r\n                        var res = bundle.view.model.magnetize();\r\n                        if (res === undefined || res) {\r\n                            linkmarker.after(movemarker);\r\n                            linkmarker.detach();\r\n                        }\r\n                    });\r\n                    movemarker.on('click', function () {\r\n                        bundle.view.model.demagnetize();\r\n                        movemarker.after(linkmarker);\r\n                        movemarker.detach();\r\n                    });\r\n                    bundle.magnetizeCycle = function () {\r\n                        if (movemarker.parent().length) {\r\n                            movemarker.click();\r\n                            linkmarker.click();\r\n                        }\r\n                    };\r\n                    tab.append(linkmarker);\r\n                }());\r\n            }\r\n            _.forEach(actions, function (action) {\r\n                if (action.checker(cellView.model)) {\r\n                    if (action.click) {\r\n                        (function () {\r\n                            function click() {\r\n                                action.click.call(bundle.context, bundle.view);\r\n                            }\r\n                            tab.append($(action.marker).clone().on('click', click));\r\n                        }());\r\n                    }\r\n                    if (action.event) {\r\n                        (function () {\r\n                            var trigger = function () {\r\n                                self.trigger('cell:' + action.event, bundle.view);\r\n                            };\r\n                            tab.append($(action.marker).clone().on('click', trigger));\r\n                        }());\r\n                    }\r\n                }\r\n            });\r\n            if (resize && canResize(cellView.model)) {\r\n                bundle.el.addClass('almost-joint-resizable');\r\n                ['n', 'ne', 'e', 'se', 's', 'sw', 'w', 'nw'].forEach(function (direction) {\r\n                    bundle.el.find('.almost-joint-marker-' + direction).on('mousedown', function () {\r\n                        createResizeReactor({view: bundle.view, paper: paper, model: model, el: el, direction: direction, gridSize: gridSize, undoReactor: undoReactor});\r\n                    });\r\n                });\r\n            }\r\n            if (rotate && canRotate(cellView.model)) {\r\n                bundle.el.addClass('almost-joint-rotatable');\r\n                bundle.el.find('.almost-joint-marker-rotate').on('mousedown', function () {\r\n                    createRotateReactor({view: bundle.view, paper: paper, model: model, el: el, angleStep: 15, undoReactor: undoReactor});\r\n                });\r\n            }\r\n            updateManipulator(cellView.model);\r\n        }\r\n    }\r\n\r\n    function mouseover() {\r\n        el.focus();\r\n    }\r\n\r\n    paper.on('cell:pointerdown', toggleManipulator);\r\n    paper.on('scale translate', updateManipulators);\r\n    paper.on('cell:pointermove', function (cellView) { updateManipulator(cellView.model); });\r\n    model.on('change:target', function (link) {\r\n        var bundle = selectedViews[link.get('source').id];\r\n        link.toFront();\r\n        if (!bundle || !bundle.view.model.magnetize || !bundle.view.model.demagnetize) { return; }\r\n        bundle.magnetizeCycle();\r\n    });\r\n    model.on('remove', function (element) {\r\n        closeManipulator(element);\r\n    });\r\n    el.mouseover(mouseover);\r\n\r\n    mousetrap(el[0]).bind('esc', _.ary(closeManipulators, 0));\r\n    paper.on('blank:pointerdown', _.ary(closeManipulators, 0));\r\n    _.forEach(actions, function (action) {\r\n        if (action.shortcut) {\r\n            mousetrap(el[0]).bind(action.shortcut, function () {\r\n                _.forEach(selectedViews, function (bundle) {\r\n                    if (action.checker(bundle.view.model)) {\r\n                        if (action.click) {\r\n                            action.click.call(bundle.context, bundle.view);\r\n                        }\r\n                        if (action.event) {\r\n                            self.trigger('cell:' + action.event, bundle.view);\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\nexports.ManipulationReactor = ManipulationReactor;\r\n\r\n\r\nexports.delete = {\r\n    marker: require('./delete.svg'),\r\n    checker: propertyChecker('deletable', true),\r\n    click: function (view) {\r\n        this.undoReactor.start();\r\n        view.model.remove();\r\n        this.undoReactor.stop();\r\n        this.close();\r\n    },\r\n    shortcut: 'del'\r\n};\r\nexports.edit = {\r\n    marker: require('./edit.svg'),\r\n    checker: propertyChecker('editable', false),\r\n    event: 'edit'\r\n};\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./delete.svg\":3,\"./edit.svg\":4,\"./link.svg\":11,\"./manipulator.html\":14,\"./move.svg\":22,\"./resizereactor\":24,\"./rotatereactor\":25,\"mousetrap\":36}],14:[function(require,module,exports){\nmodule.exports = \"<div class=\\\"almost-joint-manipulator\\\">\\r\\n    <div class=\\\"almost-joint-marker-tab\\\"></div>\\r\\n    <div class=\\\"almost-joint-marker-ne\\\"></div>\\r\\n    <div class=\\\"almost-joint-marker-e\\\"></div>\\r\\n    <div class=\\\"almost-joint-marker-se\\\"></div>\\r\\n    <div class=\\\"almost-joint-marker-s\\\"></div>\\r\\n    <div class=\\\"almost-joint-marker-sw\\\"></div>\\r\\n    <div class=\\\"almost-joint-marker-w\\\"></div>\\r\\n    <div class=\\\"almost-joint-marker-nw\\\"></div>\\r\\n    <div class=\\\"almost-joint-marker-n\\\"></div>\\r\\n    <div class=\\\"almost-joint-marker-rotate\\\"></div>\\r\\n</div>\\r\\n\";\n\n},{}],15:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null),\r\n    $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null),\r\n    createPreview = require('./preview').Preview,\r\n    createViewport = require('./viewport').Viewport;\r\n\r\nfunction Map(options) {\r\n    if (!(this instanceof Map)) { return new Map(options); }\r\n    options = options || {};\r\n\r\n    if (!options.model || typeof options.model !== 'object') { throw new Error('model option is Mandatory'); }\r\n    if (!options.paper || typeof options.paper !== 'object' || !(options.paper instanceof joint.dia.Paper)) { throw new Error('paper option is Mandatory'); }\r\n    if (!options.linkConnectionPoint || typeof options.linkConnectionPoint !== 'function') { throw new Error('linkConnectionPoint option is Mandatory'); }\r\n    if (!options.el) { throw new Error('el option is Mandatory'); }\r\n    if ($(options.el).length === 0) { throw new Error('invalid el option'); }\r\n\r\n    var self = this,\r\n        el = $($(options.el)[0]),\r\n        paper = options.paper,\r\n        linkConnectionPoint = options.linkConnectionPoint,\r\n        mapContainer = (function () {var container = $(require('./preview.html')); el.append(container); return container; }()),\r\n        viewportContainer = (function () {var container = $(require('./viewport.html')); el.append(container); return container; }()),\r\n        model = options.model,\r\n        preview = createPreview({el: mapContainer, model: model, linkConnectionPoint: linkConnectionPoint}),\r\n        viewport = createViewport({el: viewportContainer}),\r\n        autoRefreshEnabled = true;\r\n\r\n    model.on('change:position change:size change:angle change:parent add remove', function (element) {\r\n        if (model.hasActiveBatch('add') || model.hasActiveBatch('clear')) { return; }\r\n        if (!autoRefreshEnabled) { return; }\r\n        if (element.isLink()) { return; }\r\n        if (element.get('parent')) { return; }\r\n        _.defer(function () { self.refresh(); });\r\n    });\r\n    model.on('batch:stop', function (e) {\r\n        if ((e.batchName !== 'add' && e.batchName !== 'clear') || model.hasActiveBatch('add') || model.hasActiveBatch('clear')) { return; }\r\n        _.defer(function () { self.refresh(); });\r\n    });\r\n\r\n    self.refresh = function () {\r\n        var bbox,\r\n            width,\r\n            height,\r\n            minLocal,\r\n            maxLocal;\r\n        if (model.getElements().length === 0) {\r\n            width = el.width();\r\n            height = el.height();\r\n            minLocal = paper.clientToLocalPoint(joint.g.point(0, 0));\r\n            maxLocal = paper.clientToLocalPoint(joint.g.point(width, height));\r\n            bbox = joint.g.rect(minLocal.x, minLocal.y, maxLocal.x - minLocal.x, maxLocal.y - minLocal.y);\r\n        } else {\r\n            bbox = model.getBBox(model.getElements(), {useModelGeometry: true});\r\n            bbox = joint.g.rect(bbox.x - 10, bbox.y - 10, bbox.width + 20, bbox.height + 20);\r\n        }\r\n        preview.setBBox(bbox);\r\n        viewport.setBBox(bbox);\r\n    };\r\n\r\n    self.disableAutorefresh = function () {\r\n        autoRefreshEnabled = false;\r\n    };\r\n\r\n    self.enableAutorefresh = function () {\r\n        autoRefreshEnabled = true;\r\n    };\r\n\r\n    self.setViewport = function (bbox) {\r\n        viewport.setViewport(bbox);\r\n    };\r\n\r\n    self.download = function () {\r\n        preview.download();\r\n    };\r\n\r\n    self.refresh();\r\n}\r\n\r\nexports.Map = Map;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./preview\":17,\"./preview.html\":16,\"./viewport\":19,\"./viewport.html\":18}],16:[function(require,module,exports){\nmodule.exports = \"<div class='almost-joint-map'></div>\\r\\n\";\n\n},{}],17:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true */\r\n\"use strict\";\r\n\r\nvar $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null),\r\n    atob = (typeof window !== \"undefined\" ? window['atob'] : typeof global !== \"undefined\" ? global['atob'] : null),\r\n    Uint8Array = (typeof window !== \"undefined\" ? window['Uint8Array'] : typeof global !== \"undefined\" ? global['Uint8Array'] : null),\r\n    Blob = (typeof window !== \"undefined\" ? window['Blob'] : typeof global !== \"undefined\" ? global['Blob'] : null),\r\n    saveAs = (typeof window !== \"undefined\" ? window['saveAs'] : typeof global !== \"undefined\" ? global['saveAs'] : null),\r\n    svg2png = require('save-svg-as-png');\r\n\r\nfunction uriToBlob(uri) {\r\n    var delimiter = 'base64,',\r\n        index = uri.indexOf(delimiter),\r\n        b64Data = uri.substr(index + delimiter.length),\r\n        contentType = uri.substr(0, uri.indexOf(';')),\r\n        sliceSize = 512,\r\n        byteCharacters = atob(b64Data),\r\n        byteArrays = [],\r\n        offset,\r\n        slice,\r\n        byteNumbers,\r\n        i,\r\n        byteArray;\r\n\r\n    for (offset = 0; offset < byteCharacters.length; offset += sliceSize) {\r\n        slice = byteCharacters.slice(offset, offset + sliceSize);\r\n\r\n        byteNumbers = [];\r\n        for (i = 0; i < slice.length; i += 1) {\r\n            byteNumbers[i] = slice.charCodeAt(i);\r\n        }\r\n\r\n        byteArray = new Uint8Array(byteNumbers);\r\n\r\n        byteArrays.push(byteArray);\r\n    }\r\n\r\n    return new Blob(byteArrays, {type: contentType});\r\n}\r\n\r\nfunction Preview(options) {\r\n    if (!(this instanceof Preview)) { return new Preview(options); }\r\n    options = options || {};\r\n\r\n    if (!options.model || typeof options.model !== 'object') { throw new Error('model option is Mandatory'); }\r\n    if (!options.linkConnectionPoint || typeof options.linkConnectionPoint !== 'function') { throw new Error('linkConnectionPoint option is Mandatory'); }\r\n    if (!options.el) { throw new Error('el option is Mandatory'); }\r\n    if ($(options.el).length === 0) { throw new Error('invalid el option'); }\r\n\r\n    var self = this,\r\n        el = $($(options.el)[0]),\r\n        model = options.model,\r\n        lastScale = 1,\r\n        linkConnectionPoint = options.linkConnectionPoint,\r\n        paper = new joint.dia.Paper({\r\n            el: el,\r\n            width: el.width(),\r\n            height: el.height(),\r\n            model: model,\r\n            linkConnectionPoint: linkConnectionPoint,\r\n            interactive: false\r\n        });\r\n\r\n    self.setBBox = function (bbox) {\r\n        // it is similar to paper.scaleContentToFit(); but i require to do it manually to change even the origin\r\n        var width = el.width(),\r\n            height = el.height(),\r\n            scaleX = width / bbox.width,\r\n            scaleY = height / bbox.height,\r\n            scale = Math.min(scaleX, scaleY),\r\n            ox = (width - bbox.width * scale) / 2 - bbox.x * scale,\r\n            oy = (height - bbox.height * scale) / 2 - bbox.y * scale;\r\n\r\n        lastScale = scale;\r\n        paper.scale(scale, scale);\r\n        paper.setOrigin(ox, oy);\r\n    };\r\n\r\n    self.download = function () {\r\n        svg2png.svgAsPngUri(paper.svg, {scale: 3 / lastScale}, function (uri) {\r\n            saveAs(uriToBlob(uri), \"model.png\");\r\n        });\r\n    };\r\n}\r\n\r\nexports.Preview = Preview;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"save-svg-as-png\":37}],18:[function(require,module,exports){\nmodule.exports = \"<div class='almost-joint-map-viewport'></div>\\r\\n\";\n\n},{}],19:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true */\r\n\"use strict\";\r\n\r\nvar $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null),\r\n    ViewportOutline = require('./viewportoutline').ViewportOutline;\r\n\r\nfunction Viewport(options) {\r\n    if (!(this instanceof Viewport)) { return new Viewport(options); }\r\n    options = options || {};\r\n\r\n    if (!options.el) { throw new Error('el options is Mandatory'); }\r\n    if ($(options.el).length === 0) { throw new Error('invalid el options'); }\r\n\r\n    var self = this,\r\n        el = $($(options.el)[0]),\r\n        model = new joint.dia.Graph(),\r\n        paper = new joint.dia.Paper({\r\n            el: el,\r\n            width: el.width(),\r\n            height: el.height(),\r\n            model: model,\r\n            interactive: false\r\n        }),\r\n        viewport = new ViewportOutline({\r\n            position: joint.g.point(0, 0),\r\n            size: { width: 1, height: 1 }\r\n        });\r\n\r\n    model.addCells([viewport]);\r\n\r\n    self.setBBox = function (bbox) {\r\n        // it is similar to paper.scaleContentToFit(); but i require to do it manually to change even the origin\r\n        var width = el.width(),\r\n            height = el.height(),\r\n            scaleX = width / bbox.width,\r\n            scaleY = height / bbox.height,\r\n            scale = Math.min(scaleX, scaleY),\r\n            ox = (width - bbox.width * scale) / 2 - bbox.x * scale,\r\n            oy = (height - bbox.height * scale) / 2 - bbox.y * scale;\r\n\r\n        paper.scale(scale, scale);\r\n        paper.setOrigin(ox, oy);\r\n    };\r\n\r\n    self.setViewport = function (bbox) {\r\n        viewport.position(bbox.x, bbox.y);\r\n        viewport.resize(bbox.width, bbox.height);\r\n    };\r\n}\r\n\r\nexports.Viewport = Viewport;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./viewportoutline\":20}],20:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null);\r\n\r\nexports.ViewportOutline = joint.shapes.basic.Generic.extend({\r\n    markup: require('./markup.svg'),\r\n\r\n    defaults: joint.util.deepSupplement({\r\n        type: 'map.ViewportOutline',\r\n        size: {width: 1, height: 1},\r\n        attrs: {\r\n            '.almost-joint-viewport-bg-rect' : {'follow-scale': 'auto'},\r\n            '.almost-joint-viewport-outer-rect': {\r\n                'ref-x': 0,\r\n                'ref-y': 0,\r\n                'ref-width': 1,\r\n                'ref-height': 1,\r\n                ref: '.almost-joint-viewport-bg-rect'\r\n            }\r\n        }\r\n    }, joint.shapes.basic.Generic.prototype.defaults)\r\n});\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./markup.svg\":21}],21:[function(require,module,exports){\nmodule.exports = \"<g class=\\\"scalable\\\">\\r\\n    <rect class=\\\"almost-joint-viewport-bg-rect\\\" width=\\\"1\\\" height=\\\"1\\\" fill=\\\"transparent\\\" />\\r\\n</g>\\r\\n<rect class=\\\"almost-joint-viewport-outer-rect\\\" fill=\\\"transparent\\\" stroke=\\\"blue\\\" stroke-width=\\\"1\\\" />\\r\\n\";\n\n},{}],22:[function(require,module,exports){\nmodule.exports = \"<svg\\r\\n   xmlns:dc=\\\"http://purl.org/dc/elements/1.1/\\\"\\r\\n   xmlns:cc=\\\"http://creativecommons.org/ns#\\\"\\r\\n   xmlns:rdf=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\r\\n   xmlns:svg=\\\"http://www.w3.org/2000/svg\\\"\\r\\n   xmlns=\\\"http://www.w3.org/2000/svg\\\"\\r\\n   xmlns:sodipodi=\\\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\\\"\\r\\n   xmlns:inkscape=\\\"http://www.inkscape.org/namespaces/inkscape\\\"\\r\\n   version=\\\"1.1\\\"\\r\\n   id=\\\"Capa_1\\\"\\r\\n   x=\\\"0px\\\"\\r\\n   y=\\\"0px\\\"\\r\\n   width=\\\"44.236\\\"\\r\\n   height=\\\"44.236\\\"\\r\\n   viewBox=\\\"0 0 44.236 44.236\\\"\\r\\n   xml:space=\\\"preserve\\\"\\r\\n   inkscape:version=\\\"0.91 r13725\\\"\\r\\n   sodipodi:docname=\\\"move.svg\\\"><metadata\\r\\n     id=\\\"metadata53\\\"><rdf:RDF><cc:Work\\r\\n         rdf:about=\\\"\\\"><dc:format>image/svg+xml</dc:format><dc:type\\r\\n           rdf:resource=\\\"http://purl.org/dc/dcmitype/StillImage\\\" /><dc:title /></cc:Work></rdf:RDF></metadata><defs\\r\\n     id=\\\"defs51\\\" /><sodipodi:namedview\\r\\n     pagecolor=\\\"#ffffff\\\"\\r\\n     bordercolor=\\\"#666666\\\"\\r\\n     borderopacity=\\\"1\\\"\\r\\n     objecttolerance=\\\"10\\\"\\r\\n     gridtolerance=\\\"10\\\"\\r\\n     guidetolerance=\\\"10\\\"\\r\\n     inkscape:pageopacity=\\\"0\\\"\\r\\n     inkscape:pageshadow=\\\"2\\\"\\r\\n     inkscape:window-width=\\\"1600\\\"\\r\\n     inkscape:window-height=\\\"837\\\"\\r\\n     id=\\\"namedview49\\\"\\r\\n     showgrid=\\\"false\\\"\\r\\n     inkscape:zoom=\\\"7.5448594\\\"\\r\\n     inkscape:cx=\\\"28.520049\\\"\\r\\n     inkscape:cy=\\\"32.284412\\\"\\r\\n     inkscape:window-x=\\\"-8\\\"\\r\\n     inkscape:window-y=\\\"-8\\\"\\r\\n     inkscape:window-maximized=\\\"1\\\"\\r\\n     inkscape:current-layer=\\\"Capa_1\\\" /><g\\r\\n     id=\\\"g19\\\" /><g\\r\\n     id=\\\"g21\\\" /><g\\r\\n     id=\\\"g23\\\" /><g\\r\\n     id=\\\"g25\\\" /><g\\r\\n     id=\\\"g27\\\" /><g\\r\\n     id=\\\"g29\\\" /><g\\r\\n     id=\\\"g31\\\" /><g\\r\\n     id=\\\"g33\\\" /><g\\r\\n     id=\\\"g35\\\" /><g\\r\\n     id=\\\"g37\\\" /><g\\r\\n     id=\\\"g39\\\" /><g\\r\\n     id=\\\"g41\\\" /><g\\r\\n     id=\\\"g43\\\" /><g\\r\\n     id=\\\"g45\\\" /><g\\r\\n     id=\\\"g47\\\" /><g\\r\\n     id=\\\"g4177\\\"><circle\\r\\n       r=\\\"22.118\\\"\\r\\n       cy=\\\"22.118\\\"\\r\\n       cx=\\\"22.118\\\"\\r\\n       id=\\\"path4181\\\"\\r\\n       style=\\\"color:#000000;display:inline;overflow:visible;visibility:visible;fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:0.40000001;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker:none;enable-background:accumulate\\\" /><path\\r\\n       inkscape:connector-curvature=\\\"0\\\"\\r\\n       id=\\\"path7\\\"\\r\\n       d=\\\"M 22.118,44.236 C 9.922,44.236 0,34.314 0,22.119 0,9.923 9.922,0 22.118,0 c 12.196,0 22.118,9.923 22.118,22.119 0,12.195 -9.922,22.117 -22.118,22.117 z m 0,-42.736 C 10.75,1.5 1.5,10.75 1.5,22.119 c 0,11.369 9.25,20.617 20.618,20.617 11.368,0 20.618,-9.248 20.618,-20.617 C 42.736,10.75 33.486,1.5 22.118,1.5 Z\\\" /><g\\r\\n       id=\\\"g9\\\"><circle\\r\\n         id=\\\"circle11\\\"\\r\\n         r=\\\"1.41\\\"\\r\\n         cy=\\\"22.438\\\"\\r\\n         cx=\\\"22.118\\\" /><path\\r\\n         inkscape:connector-curvature=\\\"0\\\"\\r\\n         id=\\\"path13\\\"\\r\\n         d=\\\"m 22.118,24.098 c -0.916,0 -1.66,-0.744 -1.66,-1.66 0,-0.915 0.745,-1.66 1.66,-1.66 0.915,0 1.659,0.745 1.659,1.66 0,0.916 -0.743,1.66 -1.659,1.66 z m 0,-2.821 c -0.64,0 -1.16,0.521 -1.16,1.16 0,0.639 0.521,1.161 1.16,1.161 0.639,0 1.159,-0.521 1.159,-1.161 0,-0.64 -0.519,-1.16 -1.159,-1.16 z\\\" /></g><path\\r\\n       id=\\\"path7-2\\\"\\r\\n       d=\\\"m 37.039974,21.736127 -0.214021,-0.324019 -4.000025,-4.000045 c -0.390033,-0.390026 -1.025986,-0.390026 -1.414002,0 -0.390025,0.390034 -0.390025,1.024038 0,1.414005 l 2.292035,2.292038 -10.586092,0 0,-10.586064 2.292034,2.292038 c 0.388016,0.390034 1.024029,0.390034 1.413994,0 0.388016,-0.390026 0.388016,-1.02403 0,-1.413997 l -4.000031,-4.000112 -0.01,-0.006 -0.314013,-0.207977 -0.38197,-0.07803 -0.0038,0 -0.378011,0.07803 -0.314013,0.207977 -0.012,0.006 -4.000031,4.000045 c -0.390026,0.390034 -0.390026,1.024038 0,1.414004 0.390026,0.389966 1.024029,0.390026 1.413994,0 l 2.294052,-2.292045 0,10.586131 -10.586032,0 2.292034,-2.292038 c 0.390026,-0.390034 0.390026,-1.024038 0,-1.414005 -0.390033,-0.389966 -1.024036,-0.390026 -1.414002,0 l -4.000092,4.000045 -0.006,0.01 -0.207976,0.314013 -0.07803,0.382039 0,0.0038 0.07803,0.378011 0.207976,0.312003 0.006,0.012 4.000032,4.000045 c 0.390026,0.390034 1.024029,0.390034 1.413995,0 0.390033,-0.388016 0.390033,-1.02403 0,-1.414004 l -2.291967,-2.292098 10.586092,0 0,10.586131 -2.292034,-2.292046 c -0.390026,-0.388016 -1.024029,-0.388016 -1.413995,0 -0.390033,0.390034 -0.390033,1.025988 0,1.414005 l 4.000032,4.000045 0.324018,0.215964 0.378003,0.07602 0.0038,0 0.381978,-0.07803 0.324018,-0.214022 4.000031,-4.000045 c 0.388008,-0.390026 0.388008,-1.02598 0,-1.413997 -0.390033,-0.390033 -1.025986,-0.390033 -1.414002,0 l -2.292027,2.292038 0,-10.586063 10.586092,0 -2.292034,2.292038 c -0.388016,0.388016 -0.388016,1.024038 0,1.414004 0.390026,0.388016 1.025979,0.388016 1.413995,0 l 4.000031,-4.000045 0.215964,-0.324018 0.07602,-0.378011 0,-0.0038 -0.07803,-0.381979 z\\\"\\r\\n       style=\\\"fill:#010002\\\"\\r\\n       inkscape:connector-curvature=\\\"0\\\" /></g></svg>\\r\\n\";\n\n},{}],23:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true */\r\n\"use strict\";\r\n\r\nvar $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null);\r\n\r\nfunction PanReactor(options) {\r\n    if (!(this instanceof PanReactor)) { return new PanReactor(options); }\r\n    options = options || {};\r\n\r\n    if (!options.paper || typeof options.paper !== 'object' || !(options.paper instanceof joint.dia.Paper)) { throw new Error('paper option is mandatory'); }\r\n    if (typeof options.x !== 'number') { throw new Error('x option is mandatory and has to be a number'); }\r\n    if (typeof options.y !== 'number') { throw new Error('y option is mandatory and has to be a number'); }\r\n    if (!options.el) { throw new Error('el option is mandatory'); }\r\n    if ($(options.el).length === 0) { throw new Error('invalid el option'); }\r\n\r\n    var el = $($(options.el)[0]),\r\n        paper = options.paper,\r\n        startLocal = {x: options.x, y: options.y},\r\n        mouseout;\r\n\r\n    function mousemove(e) {\r\n        var left = el.offset().left,\r\n            top = el.offset().top,\r\n            width = el.width(),\r\n            height = el.height(),\r\n            topLeft = joint.g.point(left, top),\r\n            bottomRight = joint.g.point(left + width, top + height),\r\n            minLocal = paper.clientToLocalPoint(topLeft),\r\n            maxLocal = paper.clientToLocalPoint(bottomRight),\r\n            scale = joint.g.point(width / (maxLocal.x - minLocal.x), height / (maxLocal.y - minLocal.y)),\r\n            offsetClient = joint.g.point(startLocal.x * scale.x + left, startLocal.y * scale.y + top),\r\n            origin = joint.g.point(e.clientX - offsetClient.x, e.clientY - offsetClient.y);\r\n\r\n        paper.setOrigin(origin.x, origin.y);\r\n    }\r\n\r\n    function terminate() {\r\n        el.off('mouseup', terminate);\r\n        el.off('mouseout', mouseout);\r\n        el.off('mousemove touchmove', mousemove);\r\n        el.removeClass('almost-joint-manipulating');\r\n    }\r\n\r\n    mouseout = function (e) {\r\n        if (e.target === el.get(0)) {\r\n            terminate();\r\n        }\r\n    };\r\n\r\n    el.on('mouseup', terminate);\r\n    el.on('mouseout', mouseout);\r\n    el.on('mousemove touchmove', mousemove);\r\n    el.addClass('almost-joint-manipulating');\r\n}\r\n\r\nexports.PanReactor = PanReactor;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{}],24:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null),\r\n    $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null);\r\n\r\nfunction normalizeDirection(direction) {\r\n    if (2 === direction.length) { return {v: direction.substr(0, 1), h: direction.substr(-1)}; }\r\n    switch (direction) {\r\n    case 'n':\r\n    case 's':\r\n        return {v: direction};\r\n    case 'w':\r\n    case 'e':\r\n        return {h: direction};\r\n    }\r\n}\r\n\r\nfunction ResizeReactor(options) {\r\n    if (!(this instanceof ResizeReactor)) { return new ResizeReactor(options); }\r\n    options = options || {};\r\n\r\n    if (!options.paper || typeof options.paper !== 'object' || !(options.paper instanceof joint.dia.Paper)) { throw new Error('paper option is mandatory'); }\r\n    if (!options.view || typeof options.view !== 'object') { throw new Error('view option is mandatory'); }\r\n    if (!options.model || typeof options.model !== 'object') { throw new Error('model option is mandatory'); }\r\n    if (!options.el) { throw new Error('el option is mandatory'); }\r\n    if ($(options.el).length === 0) { throw new Error('invalid el option'); }\r\n    if (!options.direction) { throw new Error('direction option is mandatory'); }\r\n    if (-1 === ['ne', 'e', 'se', 's', 'sw', 'w', 'nw', 'n'].indexOf(options.direction)) { throw new Error('invalid direction option'); }\r\n    if (typeof options.gridSize !== 'number') { throw new Error('gridSize option is mandatory and has to be a number'); }\r\n    if (options.gridSize < 0) { throw new Error('gridSize cannot be less than zero'); }\r\n    if (!options.undoReactor || typeof options.undoReactor !== 'object') { throw new Error('undoReactor option is mandatory'); }\r\n\r\n    var el = $($(options.el)[0]),\r\n        paper = options.paper,\r\n        model = options.model,\r\n        gridSize = options.gridSize,\r\n        element = options.view.model,\r\n        undoReactor = options.undoReactor,\r\n        direction = normalizeDirection(options.direction),\r\n        minsize = (function () {\r\n            var msize = element.minsize,\r\n                padding,\r\n                embeds = _.filter(element.getEmbeddedCells(), function (element) { return element.isContraint; }),\r\n                bbox,\r\n                embedsbbox,\r\n                minwidth = msize.width,\r\n                minheight = msize.height;\r\n            if (embeds.length) {\r\n                embedsbbox = model.getBBox(embeds, {useModelGeometry: true});\r\n                bbox = element.getBBox({useModelGeometry: true});\r\n                padding = element.padding;\r\n                switch (direction.h) {\r\n                case 'e':\r\n                    minwidth = embedsbbox.corner().x - bbox.origin().x + padding.right;\r\n                    break;\r\n                case 'w':\r\n                    minwidth = bbox.corner().x - embedsbbox.origin().x + padding.left;\r\n                    break;\r\n                }\r\n                switch (direction.v) {\r\n                case 's':\r\n                    minheight = embedsbbox.corner().y - bbox.origin().y + padding.bottom;\r\n                    break;\r\n                case 'n':\r\n                    minheight = bbox.corner().y - embedsbbox.origin().y + padding.top;\r\n                    break;\r\n                }\r\n                return {width: Math.max(minwidth, msize.width), height: Math.max(minheight, msize.height)};\r\n            }\r\n            return msize;\r\n        }()),\r\n        mouseenter;\r\n\r\n    undoReactor.start();\r\n\r\n    function fixPoint(point, direction) {\r\n        var x = point.x,\r\n            y = point.y;\r\n        switch (direction.h) {\r\n        case 'e':\r\n            x -= gridSize;\r\n            break;\r\n        case 'w':\r\n            x += gridSize;\r\n            break;\r\n        }\r\n        switch (direction.v) {\r\n        case 's':\r\n            y -= gridSize;\r\n            break;\r\n        case 'n':\r\n            y += gridSize;\r\n            break;\r\n        }\r\n        return joint.g.point(x, y);\r\n    }\r\n\r\n    function constrain(point) {\r\n        var parent = element.get('parent'),\r\n            bbox,\r\n            padding;\r\n        point = joint.g.point(joint.g.snapToGrid(point.x, gridSize), joint.g.snapToGrid(point.y, gridSize));\r\n        if (parent) {\r\n            parent = model.getCell(parent);\r\n            bbox = parent.getBBox({useModelGeometry: true});\r\n            padding = parent.padding;\r\n            point = joint.g.point(\r\n                Math.max(Math.min(point.x, bbox.corner().x - padding.right), bbox.x + padding.left),\r\n                Math.max(Math.min(point.y, bbox.corner().y - padding.bottom), bbox.y + padding.top)\r\n            );\r\n        }\r\n        return point;\r\n    }\r\n\r\n    function mousemove(e) {\r\n        var client = constrain(fixPoint(paper.clientToLocalPoint({x: e.clientX, y: e.clientY}), direction)),\r\n            position = element.get('position'),\r\n            size = element.get('size'),\r\n            width,\r\n            height,\r\n            px,\r\n            py;\r\n        switch (direction.h) {\r\n        case 'e':\r\n            width = Math.max(client.x - position.x, minsize.width);\r\n            px = position.x;\r\n            break;\r\n        case 'w':\r\n            width = Math.max(size.width - client.x + position.x, minsize.width);\r\n            px = position.x + size.width - width;\r\n            break;\r\n        default:\r\n            width = size.width;\r\n            px = position.x;\r\n        }\r\n        switch (direction.v) {\r\n        case 's':\r\n            height = Math.max(client.y - position.y, minsize.height);\r\n            py = position.y;\r\n            break;\r\n        case 'n':\r\n            height = Math.max(size.height - client.y + position.y, minsize.height);\r\n            py = position.y + size.height - height;\r\n            break;\r\n        default:\r\n            height = size.height;\r\n            py = position.y;\r\n        }\r\n        element.position(px, py);\r\n        element.resize(width, height);\r\n    }\r\n\r\n    function mouseleave(e) {\r\n        var point = joint.g.point(e.clientX, e.clientY),\r\n            bbox = joint.g.rect(el.offset().left, el.offset().top, el.width(), el.height());\r\n        point = bbox.pointNearestToPoint(point);\r\n        e.clientX = point.x;\r\n        e.clientY = point.y;\r\n        return mousemove(e);\r\n    }\r\n\r\n    function terminate() {\r\n        el.off('mouseup', terminate);\r\n        el.off('mouseenter', mouseenter);\r\n        el.off('mousemove', mousemove);\r\n        el.off('mouseleave', mouseleave);\r\n        el.removeClass('almost-joint-manipulating');\r\n        el.removeClass('almost-joint-resizing-' + options.direction);\r\n        undoReactor.stop();\r\n    }\r\n\r\n    mouseenter = function (e) {\r\n        if (e.buttons === 0) {\r\n            terminate();\r\n        }\r\n    };\r\n\r\n    el.on('mouseup', terminate);\r\n    el.on('mouseenter', mouseenter);\r\n    el.on('mousemove', mousemove);\r\n    el.on('mouseleave', mouseleave);\r\n\r\n    el.addClass('almost-joint-manipulating');\r\n    el.addClass('almost-joint-resizing-' + options.direction);\r\n}\r\n\r\nexports.ResizeReactor = ResizeReactor;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{}],25:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null),\r\n    $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null);\r\n\r\nfunction RotateReactor(options) {\r\n    if (!(this instanceof RotateReactor)) { return new RotateReactor(options); }\r\n    options = options || {};\r\n\r\n    if (!options.paper || typeof options.paper !== 'object' || !(options.paper instanceof joint.dia.Paper)) { throw new Error('paper option is mandatory'); }\r\n    if (!options.view || typeof options.view !== 'object') { throw new Error('view option is mandatory'); }\r\n    if (!options.el) { throw new Error('el option is mandatory'); }\r\n    if ($(options.el).length === 0) { throw new Error('invalid el option'); }\r\n    if (typeof options.angleStep !== 'number') { throw new Error('angleStep option is mandatory and has to be a number'); }\r\n    if (options.angleStep < 0) { throw new Error('angleStep cannot be less than zero'); }\r\n    if (!options.undoReactor || typeof options.undoReactor !== 'object') { throw new Error('undoReactor option is mandatory'); }\r\n\r\n    var el = $($(options.el)[0]),\r\n        paper = options.paper,\r\n        element = options.view.model,\r\n        angleStep = options.angleStep,\r\n        undoReactor = options.undoReactor,\r\n        mouseout;\r\n\r\n    undoReactor.start();\r\n\r\n    function mousemove(e) {\r\n        var client = paper.clientToLocalPoint({x: e.clientX, y: e.clientY}),\r\n            bbox = element.getBBox({useModelGeometry: true}),\r\n            center = bbox.center(),\r\n            rad = Math.atan2(client.y - center.y, client.x - center.x);\r\n        element.rotate(Math.round(joint.g.toDeg(rad) / angleStep) * angleStep, true);\r\n    }\r\n\r\n    function terminate() {\r\n        el.off('mouseup', terminate);\r\n        el.off('mouseout', mouseout);\r\n        el.off('mousemove', mousemove);\r\n        el.removeClass('almost-joint-manipulating');\r\n        undoReactor.stop();\r\n    }\r\n\r\n    mouseout = function (e) {\r\n        if (e.target === el.get(0)) {\r\n            terminate();\r\n        }\r\n    };\r\n\r\n    el.on('mouseup', terminate);\r\n    el.on('mouseout', mouseout);\r\n    el.on('mousemove', mousemove);\r\n\r\n    el.addClass('almost-joint-manipulating');\r\n}\r\n\r\nexports.RotateReactor = RotateReactor;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{}],26:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2018, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null),\r\n    hasEffect = require('./haseffect');\r\n\r\nfunction shouldMergeHistory(last, entry, opt) {\r\n    if (last === undefined || _.isArray(last)) {\r\n        return false;\r\n    }\r\n    if (!opt.ui) {\r\n        return false;\r\n    }\r\n    if (last.model !== entry.model) {\r\n        return false;\r\n    }\r\n    if (!last.delta || !entry.delta) {\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction mergeHistory(last, entry) {\r\n    last.delta = _.assign(entry.delta, last.delta);\r\n    if (entry.id) {\r\n        last.id = entry.id;\r\n    }\r\n}\r\n\r\nfunction addToHistory(history, entry, opt) {\r\n    var last = _.last(history);\r\n    if (shouldMergeHistory(last, entry, opt)) {\r\n        mergeHistory(last, entry);\r\n        if (!hasEffect(last)) {\r\n            history.pop();\r\n        }\r\n    } else {\r\n        history.push(entry);\r\n    }\r\n}\r\n\r\nmodule.exports = addToHistory;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./haseffect\":27}],27:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2018, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null);\r\n\r\nfunction hasEffect(entry) {\r\n    if (!entry.delta || entry.id) {\r\n        return true;\r\n    }\r\n    var result = _.every(entry.delta, function (value, key) {\r\n        return !_.isEqual(value, entry.model.get(key));\r\n    });\r\n    return result;\r\n}\r\n\r\nmodule.exports = hasEffect;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{}],28:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null),\r\n    $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null),\r\n    navigator = (typeof window !== \"undefined\" ? window['navigator'] : typeof global !== \"undefined\" ? global['navigator'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null),\r\n    mousetrap = require('mousetrap'),\r\n    addToHistory = require('./addtohistory'),\r\n    optimizeHistory = require('./optimizehistory'),\r\n    utils = require('../../utils');\r\n\r\nfunction UndoReactor(options) {\r\n    if (!(this instanceof UndoReactor)) { return new UndoReactor(options); }\r\n    options = options || {};\r\n\r\n    if (!options.model || typeof options.model !== 'object' || !(options.model instanceof joint.dia.Graph)) { throw new Error('model option is mandatory'); }\r\n    if (!options.el) { throw new Error('el option is mandatory'); }\r\n    if ($(options.el).length === 0) { throw new Error('invalid el option'); }\r\n\r\n    var self = this,\r\n        el = $(options.el)[0],\r\n        model = options.model,\r\n        undoing = false,\r\n        redoing = false,\r\n        record = true,\r\n        environments = [],\r\n        changes = {\r\n            history: [],\r\n            future: []\r\n        };\r\n\r\n    function currentChangesStack() {\r\n        if (!record) {\r\n            return [];\r\n        }\r\n        if (undoing) {\r\n            return changes.future;\r\n        }\r\n        if (redoing) {\r\n            return changes.history;\r\n        }\r\n        changes.future.length = 0;\r\n        return changes.history;\r\n    }\r\n\r\n    function reapply(history) {\r\n        _([history]).flattenDeep()\r\n            .forEachRight(function (step) {\r\n                if (step.id) {\r\n                    utils.changeId(step.model, step.id);\r\n                }\r\n                if (step.delta) {\r\n                    step.model.set(step.delta, {undo: true});\r\n                }\r\n                if (step.add) {\r\n                    step.model.remove();\r\n                }\r\n                if (step.remove) {\r\n                    model.addCell(step.model);\r\n                }\r\n            }).commit();\r\n    }\r\n\r\n    model.on('add', function (elem) {\r\n        var stack,\r\n            target;\r\n        if (elem.isLink() && !(undoing || redoing)) {\r\n            target = elem.get('target');\r\n            if (!(target && target.id)) {\r\n                self.start();\r\n            }\r\n        }\r\n        stack = currentChangesStack();\r\n        stack.push({\r\n            model: elem,\r\n            add: true\r\n        });\r\n    });\r\n\r\n    function shouldStart(elem, changedAttributes) {\r\n        var endpoint;\r\n        if (undoing || redoing) {\r\n            return false;\r\n        }\r\n        if (elem.isLink()) {\r\n            if (changedAttributes.source) {\r\n                endpoint = elem.previous('source');\r\n                if (endpoint && endpoint.id) {\r\n                    endpoint = elem.get('source');\r\n                    if (!(endpoint && endpoint.id)) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n            if (changedAttributes.target) {\r\n                endpoint = elem.previous('target');\r\n                if (endpoint && endpoint.id) {\r\n                    endpoint = elem.get('target');\r\n                    if (!(endpoint && endpoint.id)) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function shouldStop(elem, changedAttributes) {\r\n        var endpoint;\r\n        if (undoing || redoing) {\r\n            return false;\r\n        }\r\n        if (elem.isLink()) {\r\n            if (changedAttributes.source) {\r\n                endpoint = elem.get('source');\r\n                if (endpoint && endpoint.id) {\r\n                    endpoint = elem.previous('source');\r\n                    if (!(endpoint && endpoint.id)) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n            if (changedAttributes.target) {\r\n                endpoint = elem.get('target');\r\n                if (endpoint && endpoint.id) {\r\n                    endpoint = elem.previous('target');\r\n                    if (!(endpoint && endpoint.id)) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    model.on('change', function (elem, opt) {\r\n        var stack,\r\n            changedAttributes = elem.changedAttributes(),\r\n            entry;\r\n        delete changedAttributes.attrs;\r\n        if (!_.keys(changedAttributes).length) {\r\n            return;\r\n        }\r\n        if (shouldStart(elem, changedAttributes)) {\r\n            self.start();\r\n        }\r\n        stack = currentChangesStack();\r\n        entry = {\r\n            model: elem,\r\n            delta: _.mapValues(changedAttributes, function (value, key) {\r\n                _.noop(value);\r\n                return elem.previous(key);\r\n            })\r\n        };\r\n        if (entry.delta.id) {\r\n            entry.id = entry.delta.id;\r\n            delete entry.delta.id;\r\n        }\r\n        addToHistory(stack, entry, opt);\r\n        if (shouldStop(elem, changedAttributes)) {\r\n            self.stop();\r\n        }\r\n    });\r\n    model.on('remove', function (elem) {\r\n        var stack = currentChangesStack();\r\n        stack.push({\r\n            model: elem,\r\n            remove: true\r\n        });\r\n    });\r\n\r\n    self.start = function () {\r\n        changes.future.length = 0;\r\n        environments.push(changes);\r\n        changes = {\r\n            history: [],\r\n            future: []\r\n        };\r\n    };\r\n\r\n    self.stop = function () {\r\n        if (!environments.length) {\r\n            return;\r\n        }\r\n        var history = optimizeHistory(changes.history);\r\n        changes = environments.pop();\r\n        if (history.length) {\r\n            if (history.length === 1) {\r\n                history = _.head(history);\r\n            }\r\n            changes.history.push(history);\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    self.undo = function (save) {\r\n        if (arguments.length < 1) {\r\n            save = true;\r\n        }\r\n        if (!changes.history.length) {\r\n            return;\r\n        }\r\n        undoing = true;\r\n        record = save;\r\n        var step = changes.history.pop(),\r\n            future = changes.future.slice();\r\n        self.start();\r\n        reapply(step);\r\n        future.push(_.flattenDeep(changes.future));\r\n        self.stop();\r\n        changes.future = future;\r\n        undoing = false;\r\n        record = true;\r\n    };\r\n\r\n    self.redo = function () {\r\n        if (!changes.future.length) {\r\n            return;\r\n        }\r\n        redoing = true;\r\n        var step = changes.future.pop(),\r\n            future = changes.future.slice();\r\n        self.start();\r\n        reapply(step);\r\n        self.stop();\r\n        changes.future = future;\r\n        redoing = false;\r\n    };\r\n\r\n    self.clear = function () {\r\n        environments = [];\r\n        changes = {\r\n            history: [],\r\n            future: []\r\n        };\r\n    };\r\n\r\n    mousetrap(el).bind('mod+z', function () {\r\n        self.undo();\r\n        return false;\r\n    });\r\n    mousetrap(el).bind(/Mac|iPod|iPhone|iPad/.test(navigator.platform) ? 'mod+shift+z' : 'mod+y', function () {\r\n        self.redo();\r\n        return false;\r\n    });\r\n}\r\n\r\nexports.UndoReactor = UndoReactor;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"../../utils\":33,\"./addtohistory\":26,\"./optimizehistory\":29,\"mousetrap\":36}],29:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2018, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null),\r\n    hasEffect = require('./haseffect');\r\n\r\nfunction compressSequences(history) {\r\n    var optimized = [],\r\n        last = null;\r\n    _.forEachRight(history, function (current) {\r\n        var id;\r\n        if (current.delta) {\r\n            if (last && last.model === current.model) {\r\n                id = last.id || current.id;\r\n                if (id) {\r\n                    last.id = id;\r\n                }\r\n                last.delta = _.assign(last.delta, current.delta);\r\n            } else {\r\n                last = current;\r\n                optimized.unshift(current);\r\n            }\r\n        } else {\r\n            optimized.unshift(current);\r\n        }\r\n    });\r\n    return optimized;\r\n}\r\n\r\nfunction removeUnnecessaryTail(history) {\r\n    var remove = _.takeRightWhile(history, function (current) {\r\n        if (current.delta) {\r\n            if (current.id) {\r\n                return false;\r\n            }\r\n            return !hasEffect(current);\r\n        }\r\n        return false;\r\n    });\r\n    return _.difference(history, remove);\r\n}\r\n\r\nvar optimizeHistory = _.flow(\r\n    _.flattenDeep,\r\n    compressSequences,\r\n    removeUnnecessaryTail\r\n);\r\n\r\nmodule.exports = optimizeHistory;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./haseffect\":27}],30:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true */\r\n\"use strict\";\r\n\r\nvar joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null);\r\n\r\nfunction ignore() { return undefined; }\r\n\r\nexports.validateConnection = function (cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\r\n    ignore(magnetS, magnetT);\r\n    if (cellViewS === cellViewT) { return false; }\r\n    if (linkView.model.validateConnection) {\r\n        return linkView.model.validateConnection(cellViewS, magnetS, cellViewT, magnetT, end, linkView);\r\n    }\r\n    if (end === 'source') {\r\n        return -1 !== linkView.model.validSources.indexOf(cellViewS.model.get('type'));\r\n    }\r\n    return -1 !== linkView.model.validTargets.indexOf(cellViewT.model.get('type'));\r\n};\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{}],31:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true */\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null),\r\n    $ = (typeof window !== \"undefined\" ? window['$'] : typeof global !== \"undefined\" ? global['$'] : null),\r\n    joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null);\r\n\r\nfunction ZoomReactor(options) {\r\n    if (!(this instanceof ZoomReactor)) { return new ZoomReactor(options); }\r\n    options = options || {};\r\n\r\n    if (!options.paper || typeof options.paper !== 'object' || !(options.paper instanceof joint.dia.Paper)) { throw new Error('paper option is mandatory'); }\r\n    if (!options.model || typeof options.model !== 'object') { throw new Error('model option is mandatory'); }\r\n    if (!options.el) { throw new Error('el option is mandatory'); }\r\n    if ($(options.el).length === 0) { throw new Error('invalid el option'); }\r\n    if (typeof options.minScale !== 'number') { throw new Error('minScale option is mandatory and has to be a number'); }\r\n    if (typeof options.maxScale !== 'number') { throw new Error('maxScale option is mandatory and has to be a number'); }\r\n    if (options.minScale < 0) { throw new Error('minScale cannot be less than zero'); }\r\n    if (options.minScale > options.maxScale) { throw new Error('maxScale cannot be less the minScale'); }\r\n\r\n    var self = this,\r\n        el = $($(options.el)[0]),\r\n        paper = options.paper,\r\n        model = options.model,\r\n        minScale = options.minScale,\r\n        maxScale = options.maxScale,\r\n        paddingZoomE = {width: 50, height: 50};\r\n\r\n    function normalizeScale(scale) {\r\n        return Math.min(Math.max(scale, minScale), maxScale);\r\n    }\r\n\r\n    function mousewheel(e, delta) {\r\n        var x = e.clientX,\r\n            y = e.clientY,\r\n            left = el.offset().left,\r\n            top = el.offset().top,\r\n            width = el.width(),\r\n            height = el.height(),\r\n            topLeft = joint.g.point(left, top),\r\n            bottomRight = joint.g.point(left + width, top + height),\r\n            current = joint.g.point(x, y),\r\n            minLocal = paper.clientToLocalPoint(topLeft),\r\n            maxLocal = paper.clientToLocalPoint(bottomRight),\r\n            startLocal = paper.clientToLocalPoint(current),\r\n            scale = {x: width / (maxLocal.x - minLocal.x), y: height / (maxLocal.y - minLocal.y)},\r\n            offsetClient,\r\n            origin;\r\n        scale = normalizeScale(scale.x * Math.pow(1.1, delta));\r\n        paper.scale(scale, scale);\r\n        minLocal = paper.clientToLocalPoint(topLeft);\r\n        maxLocal = paper.clientToLocalPoint(bottomRight);\r\n        scale = joint.g.point(width / (maxLocal.x - minLocal.x), height / (maxLocal.y - minLocal.y));\r\n        offsetClient = joint.g.point(startLocal.x * scale.x, startLocal.y * scale.y);\r\n        origin = joint.g.point(x - offsetClient.x, y - offsetClient.y);\r\n\r\n        paper.setOrigin(origin.x - left, origin.y - top);\r\n\r\n        e.preventDefault();\r\n    }\r\n\r\n    function pointerdblclick() {\r\n        if (model.getElements().length === 0) { return; }\r\n        // it is similar to paper.scaleContentToFit(); but i require to do it manually to change even the origin\r\n        var width = el.width() - paddingZoomE.width * 2,\r\n            height = el.height() - paddingZoomE.height * 2,\r\n            bbox = model.getBBox(model.getElements(), {useModelGeometry: true}),\r\n            scaleX = width / bbox.width,\r\n            scaleY = height / bbox.height,\r\n            scale = Math.max(Math.min(scaleX, scaleY, maxScale), minScale),\r\n            ox = (width - bbox.width * scale) / 2 - bbox.x * scale,\r\n            oy = (height - bbox.height * scale) / 2 - bbox.y * scale;\r\n\r\n        paper.scale(scale, scale);\r\n        paper.setOrigin(ox + paddingZoomE.width, oy + paddingZoomE.height);\r\n    }\r\n\r\n    paper.on('blank:pointerdblclick', pointerdblclick);\r\n    paper.on('blank:mousewheel', _.rearg(mousewheel, 0, 3));\r\n    paper.on('cell:mousewheel', _.rearg(mousewheel, 1, 4));\r\n\r\n    self.zoomE = function () {\r\n        pointerdblclick();\r\n    };\r\n}\r\n\r\nexports.ZoomReactor = ZoomReactor;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{}],32:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2018, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true*/\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null);\r\n\r\nfunction changeId(cell, newId) {\r\n    var oldId = cell.get('id'),\r\n        graph = cell.graph,\r\n        cells,\r\n        inboundLinks,\r\n        outboundLinks,\r\n        parent,\r\n        embeds;\r\n\r\n    if (oldId === newId) {\r\n        return true;\r\n    }\r\n\r\n    if (!graph) {\r\n        cell.set('id', newId);\r\n        return true;\r\n    }\r\n\r\n    if (graph.getCell(newId)) {\r\n        return false;\r\n    }\r\n\r\n    cells = graph.getCells();\r\n    inboundLinks = graph.getConnectedLinks(cell, { inbound: true });\r\n    outboundLinks = graph.getConnectedLinks(cell, { outbound: true });\r\n    parent = graph.getCell(cell.get('parent'));\r\n    embeds = cell.getEmbeddedCells();\r\n\r\n    cell.set('id', newId, {silent: true});\r\n    _.forEach(embeds, function (cell) {\r\n        cell.set('parent', newId, {silent: true});\r\n    });\r\n    if (parent) {\r\n        embeds = parent.get('embeds');\r\n        embeds[embeds.indexOf(oldId)] = newId;\r\n        parent.set('embeds', embeds, {silent: true});\r\n    }\r\n    _.forEach(inboundLinks, function (link) {\r\n        link.prop('target/id', newId, {silent: true});\r\n    });\r\n    _.forEach(outboundLinks, function (link) {\r\n        link.prop('source/id', newId, {silent: true});\r\n    });\r\n    graph.resetCells(cells);\r\n    cell.set('id', oldId, {silent: true});\r\n    cell.set('id', newId);\r\n\r\n    return true;\r\n}\r\n\r\nexports.changeId = changeId;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{}],33:[function(require,module,exports){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true*/\r\n\"use strict\";\r\n\r\nexports.sortCells = require('./sortcells').sortCells;\r\nexports.changeId = require('./changeid').changeId;\r\nexports.isFullyContained = require('./isfullycontained').isFullyContained;\r\n\n},{\"./changeid\":32,\"./isfullycontained\":34,\"./sortcells\":35}],34:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2018, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true*/\r\n\"use strict\";\r\n\r\nvar joint = (typeof window !== \"undefined\" ? window['joint'] : typeof global !== \"undefined\" ? global['joint'] : null);\r\n\r\nfunction isFullyContained(element, parent) {\r\n    if (parent.id === element.id) {\r\n        return false;\r\n    }\r\n    var bbox = element.getBBox({useModelGeometry: true}),\r\n        padding = parent.padding,\r\n        pbbox = parent.getBBox({useModelGeometry: true}),\r\n        pinternal = joint.g.rect(\r\n            pbbox.x + padding.left,\r\n            pbbox.y + padding.top,\r\n            pbbox.width - padding.left - padding.right,\r\n            pbbox.height - padding.top - padding.bottom\r\n        );\r\n    return pinternal.containsRect(bbox);\r\n}\r\n\r\nexports.isFullyContained = isFullyContained;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{}],35:[function(require,module,exports){\n(function (global){\n// Copyright (c) 2016, the ALMOsT project authors. Please see the\r\n// AUTHORS file for details. All rights reserved. Use of this source code is\r\n// governed by the MIT license that can be found in the LICENSE file.\r\n/*jslint node: true, nomen: true*/\r\n\"use strict\";\r\n\r\nvar _ = (typeof window !== \"undefined\" ? window['_'] : typeof global !== \"undefined\" ? global['_'] : null);\r\n\r\nfunction computeAncestors(id, lookup) {\r\n    if (!id) { return _([]); }\r\n    return computeAncestors(lookup[id].get('parent'), lookup).concat(id);\r\n}\r\n\r\nfunction sortCells(cells) {\r\n    var lookup = _.zipObject(_.map(cells, function (cell) { return [cell.id, cell]; })),\r\n        ancestors = _.zipObject(_.map(cells, function (cell) { return [cell.id, computeAncestors(cell.id, lookup).value()]; }));\r\n    function compareRelatives(cell1, cell2) {\r\n        var parent = lookup[cell1.get('parent')],\r\n            embeds;\r\n        if (parent) {\r\n            embeds = parent.get('embeds');\r\n            return embeds.indexOf(cell1.id) - embeds.indexOf(cell2.id);\r\n        }\r\n        return cell1.id < cell2.id ? -1 : 1;\r\n    }\r\n    return cells.sort(function (cell1, cell2) {\r\n        if (cell1.isLink() !== cell2.isLink()) {\r\n            return cell2.isLink() ? -1 : 1;\r\n        }\r\n        if (cell1.isLink()) {\r\n            return cell1.id < cell2.id ? -1 : 1;\r\n        }\r\n        var ancestors1 = ancestors[cell1.id],\r\n            ancestors2 = ancestors[cell2.id],\r\n            commonUncestors;\r\n        if (ancestors1.length < ancestors2.length) {\r\n            return -1;\r\n        }\r\n        if (ancestors1.length > ancestors2.length) {\r\n            return 1;\r\n        }\r\n        commonUncestors = _.intersection(ancestors1, ancestors2);\r\n        ancestors1 = ancestors1.slice(commonUncestors.length);\r\n        ancestors2 = ancestors2.slice(commonUncestors.length);\r\n        if (ancestors1.length === 0) {\r\n            return compareRelatives(cell1, cell2);\r\n        }\r\n        return compareRelatives(lookup[ancestors1[0]], lookup[ancestors2[0]]);\r\n    });\r\n}\r\n\r\nexports.sortCells = sortCells;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{}],36:[function(require,module,exports){\n/*global define:false */\n/**\n * Copyright 2012-2017 Craig Campbell\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * Mousetrap is a simple keyboard shortcut library for Javascript with\n * no external dependencies\n *\n * @version 1.6.5\n * @url craig.is/killing/mice\n */\n(function(window, document, undefined) {\n\n    // Check if mousetrap is used inside browser, if not, return\n    if (!window) {\n        return;\n    }\n\n    /**\n     * mapping of special keycodes to their corresponding keys\n     *\n     * everything in this dictionary cannot use keypress events\n     * so it has to be here to map to the correct keycodes for\n     * keyup/keydown events\n     *\n     * @type {Object}\n     */\n    var _MAP = {\n        8: 'backspace',\n        9: 'tab',\n        13: 'enter',\n        16: 'shift',\n        17: 'ctrl',\n        18: 'alt',\n        20: 'capslock',\n        27: 'esc',\n        32: 'space',\n        33: 'pageup',\n        34: 'pagedown',\n        35: 'end',\n        36: 'home',\n        37: 'left',\n        38: 'up',\n        39: 'right',\n        40: 'down',\n        45: 'ins',\n        46: 'del',\n        91: 'meta',\n        93: 'meta',\n        224: 'meta'\n    };\n\n    /**\n     * mapping for special characters so they can support\n     *\n     * this dictionary is only used incase you want to bind a\n     * keyup or keydown event to one of these keys\n     *\n     * @type {Object}\n     */\n    var _KEYCODE_MAP = {\n        106: '*',\n        107: '+',\n        109: '-',\n        110: '.',\n        111 : '/',\n        186: ';',\n        187: '=',\n        188: ',',\n        189: '-',\n        190: '.',\n        191: '/',\n        192: '`',\n        219: '[',\n        220: '\\\\',\n        221: ']',\n        222: '\\''\n    };\n\n    /**\n     * this is a mapping of keys that require shift on a US keypad\n     * back to the non shift equivelents\n     *\n     * this is so you can use keyup events with these keys\n     *\n     * note that this will only work reliably on US keyboards\n     *\n     * @type {Object}\n     */\n    var _SHIFT_MAP = {\n        '~': '`',\n        '!': '1',\n        '@': '2',\n        '#': '3',\n        '$': '4',\n        '%': '5',\n        '^': '6',\n        '&': '7',\n        '*': '8',\n        '(': '9',\n        ')': '0',\n        '_': '-',\n        '+': '=',\n        ':': ';',\n        '\\\"': '\\'',\n        '<': ',',\n        '>': '.',\n        '?': '/',\n        '|': '\\\\'\n    };\n\n    /**\n     * this is a list of special strings you can use to map\n     * to modifier keys when you specify your keyboard shortcuts\n     *\n     * @type {Object}\n     */\n    var _SPECIAL_ALIASES = {\n        'option': 'alt',\n        'command': 'meta',\n        'return': 'enter',\n        'escape': 'esc',\n        'plus': '+',\n        'mod': /Mac|iPod|iPhone|iPad/.test(navigator.platform) ? 'meta' : 'ctrl'\n    };\n\n    /**\n     * variable to store the flipped version of _MAP from above\n     * needed to check if we should use keypress or not when no action\n     * is specified\n     *\n     * @type {Object|undefined}\n     */\n    var _REVERSE_MAP;\n\n    /**\n     * loop through the f keys, f1 to f19 and add them to the map\n     * programatically\n     */\n    for (var i = 1; i < 20; ++i) {\n        _MAP[111 + i] = 'f' + i;\n    }\n\n    /**\n     * loop through to map numbers on the numeric keypad\n     */\n    for (i = 0; i <= 9; ++i) {\n\n        // This needs to use a string cause otherwise since 0 is falsey\n        // mousetrap will never fire for numpad 0 pressed as part of a keydown\n        // event.\n        //\n        // @see https://github.com/ccampbell/mousetrap/pull/258\n        _MAP[i + 96] = i.toString();\n    }\n\n    /**\n     * cross browser add event method\n     *\n     * @param {Element|HTMLDocument} object\n     * @param {string} type\n     * @param {Function} callback\n     * @returns void\n     */\n    function _addEvent(object, type, callback) {\n        if (object.addEventListener) {\n            object.addEventListener(type, callback, false);\n            return;\n        }\n\n        object.attachEvent('on' + type, callback);\n    }\n\n    /**\n     * takes the event and returns the key character\n     *\n     * @param {Event} e\n     * @return {string}\n     */\n    function _characterFromEvent(e) {\n\n        // for keypress events we should return the character as is\n        if (e.type == 'keypress') {\n            var character = String.fromCharCode(e.which);\n\n            // if the shift key is not pressed then it is safe to assume\n            // that we want the character to be lowercase.  this means if\n            // you accidentally have caps lock on then your key bindings\n            // will continue to work\n            //\n            // the only side effect that might not be desired is if you\n            // bind something like 'A' cause you want to trigger an\n            // event when capital A is pressed caps lock will no longer\n            // trigger the event.  shift+a will though.\n            if (!e.shiftKey) {\n                character = character.toLowerCase();\n            }\n\n            return character;\n        }\n\n        // for non keypress events the special maps are needed\n        if (_MAP[e.which]) {\n            return _MAP[e.which];\n        }\n\n        if (_KEYCODE_MAP[e.which]) {\n            return _KEYCODE_MAP[e.which];\n        }\n\n        // if it is not in the special map\n\n        // with keydown and keyup events the character seems to always\n        // come in as an uppercase character whether you are pressing shift\n        // or not.  we should make sure it is always lowercase for comparisons\n        return String.fromCharCode(e.which).toLowerCase();\n    }\n\n    /**\n     * checks if two arrays are equal\n     *\n     * @param {Array} modifiers1\n     * @param {Array} modifiers2\n     * @returns {boolean}\n     */\n    function _modifiersMatch(modifiers1, modifiers2) {\n        return modifiers1.sort().join(',') === modifiers2.sort().join(',');\n    }\n\n    /**\n     * takes a key event and figures out what the modifiers are\n     *\n     * @param {Event} e\n     * @returns {Array}\n     */\n    function _eventModifiers(e) {\n        var modifiers = [];\n\n        if (e.shiftKey) {\n            modifiers.push('shift');\n        }\n\n        if (e.altKey) {\n            modifiers.push('alt');\n        }\n\n        if (e.ctrlKey) {\n            modifiers.push('ctrl');\n        }\n\n        if (e.metaKey) {\n            modifiers.push('meta');\n        }\n\n        return modifiers;\n    }\n\n    /**\n     * prevents default for this event\n     *\n     * @param {Event} e\n     * @returns void\n     */\n    function _preventDefault(e) {\n        if (e.preventDefault) {\n            e.preventDefault();\n            return;\n        }\n\n        e.returnValue = false;\n    }\n\n    /**\n     * stops propogation for this event\n     *\n     * @param {Event} e\n     * @returns void\n     */\n    function _stopPropagation(e) {\n        if (e.stopPropagation) {\n            e.stopPropagation();\n            return;\n        }\n\n        e.cancelBubble = true;\n    }\n\n    /**\n     * determines if the keycode specified is a modifier key or not\n     *\n     * @param {string} key\n     * @returns {boolean}\n     */\n    function _isModifier(key) {\n        return key == 'shift' || key == 'ctrl' || key == 'alt' || key == 'meta';\n    }\n\n    /**\n     * reverses the map lookup so that we can look for specific keys\n     * to see what can and can't use keypress\n     *\n     * @return {Object}\n     */\n    function _getReverseMap() {\n        if (!_REVERSE_MAP) {\n            _REVERSE_MAP = {};\n            for (var key in _MAP) {\n\n                // pull out the numeric keypad from here cause keypress should\n                // be able to detect the keys from the character\n                if (key > 95 && key < 112) {\n                    continue;\n                }\n\n                if (_MAP.hasOwnProperty(key)) {\n                    _REVERSE_MAP[_MAP[key]] = key;\n                }\n            }\n        }\n        return _REVERSE_MAP;\n    }\n\n    /**\n     * picks the best action based on the key combination\n     *\n     * @param {string} key - character for key\n     * @param {Array} modifiers\n     * @param {string=} action passed in\n     */\n    function _pickBestAction(key, modifiers, action) {\n\n        // if no action was picked in we should try to pick the one\n        // that we think would work best for this key\n        if (!action) {\n            action = _getReverseMap()[key] ? 'keydown' : 'keypress';\n        }\n\n        // modifier keys don't work as expected with keypress,\n        // switch to keydown\n        if (action == 'keypress' && modifiers.length) {\n            action = 'keydown';\n        }\n\n        return action;\n    }\n\n    /**\n     * Converts from a string key combination to an array\n     *\n     * @param  {string} combination like \"command+shift+l\"\n     * @return {Array}\n     */\n    function _keysFromString(combination) {\n        if (combination === '+') {\n            return ['+'];\n        }\n\n        combination = combination.replace(/\\+{2}/g, '+plus');\n        return combination.split('+');\n    }\n\n    /**\n     * Gets info for a specific key combination\n     *\n     * @param  {string} combination key combination (\"command+s\" or \"a\" or \"*\")\n     * @param  {string=} action\n     * @returns {Object}\n     */\n    function _getKeyInfo(combination, action) {\n        var keys;\n        var key;\n        var i;\n        var modifiers = [];\n\n        // take the keys from this pattern and figure out what the actual\n        // pattern is all about\n        keys = _keysFromString(combination);\n\n        for (i = 0; i < keys.length; ++i) {\n            key = keys[i];\n\n            // normalize key names\n            if (_SPECIAL_ALIASES[key]) {\n                key = _SPECIAL_ALIASES[key];\n            }\n\n            // if this is not a keypress event then we should\n            // be smart about using shift keys\n            // this will only work for US keyboards however\n            if (action && action != 'keypress' && _SHIFT_MAP[key]) {\n                key = _SHIFT_MAP[key];\n                modifiers.push('shift');\n            }\n\n            // if this key is a modifier then add it to the list of modifiers\n            if (_isModifier(key)) {\n                modifiers.push(key);\n            }\n        }\n\n        // depending on what the key combination is\n        // we will try to pick the best event for it\n        action = _pickBestAction(key, modifiers, action);\n\n        return {\n            key: key,\n            modifiers: modifiers,\n            action: action\n        };\n    }\n\n    function _belongsTo(element, ancestor) {\n        if (element === null || element === document) {\n            return false;\n        }\n\n        if (element === ancestor) {\n            return true;\n        }\n\n        return _belongsTo(element.parentNode, ancestor);\n    }\n\n    function Mousetrap(targetElement) {\n        var self = this;\n\n        targetElement = targetElement || document;\n\n        if (!(self instanceof Mousetrap)) {\n            return new Mousetrap(targetElement);\n        }\n\n        /**\n         * element to attach key events to\n         *\n         * @type {Element}\n         */\n        self.target = targetElement;\n\n        /**\n         * a list of all the callbacks setup via Mousetrap.bind()\n         *\n         * @type {Object}\n         */\n        self._callbacks = {};\n\n        /**\n         * direct map of string combinations to callbacks used for trigger()\n         *\n         * @type {Object}\n         */\n        self._directMap = {};\n\n        /**\n         * keeps track of what level each sequence is at since multiple\n         * sequences can start out with the same sequence\n         *\n         * @type {Object}\n         */\n        var _sequenceLevels = {};\n\n        /**\n         * variable to store the setTimeout call\n         *\n         * @type {null|number}\n         */\n        var _resetTimer;\n\n        /**\n         * temporary state where we will ignore the next keyup\n         *\n         * @type {boolean|string}\n         */\n        var _ignoreNextKeyup = false;\n\n        /**\n         * temporary state where we will ignore the next keypress\n         *\n         * @type {boolean}\n         */\n        var _ignoreNextKeypress = false;\n\n        /**\n         * are we currently inside of a sequence?\n         * type of action (\"keyup\" or \"keydown\" or \"keypress\") or false\n         *\n         * @type {boolean|string}\n         */\n        var _nextExpectedAction = false;\n\n        /**\n         * resets all sequence counters except for the ones passed in\n         *\n         * @param {Object} doNotReset\n         * @returns void\n         */\n        function _resetSequences(doNotReset) {\n            doNotReset = doNotReset || {};\n\n            var activeSequences = false,\n                key;\n\n            for (key in _sequenceLevels) {\n                if (doNotReset[key]) {\n                    activeSequences = true;\n                    continue;\n                }\n                _sequenceLevels[key] = 0;\n            }\n\n            if (!activeSequences) {\n                _nextExpectedAction = false;\n            }\n        }\n\n        /**\n         * finds all callbacks that match based on the keycode, modifiers,\n         * and action\n         *\n         * @param {string} character\n         * @param {Array} modifiers\n         * @param {Event|Object} e\n         * @param {string=} sequenceName - name of the sequence we are looking for\n         * @param {string=} combination\n         * @param {number=} level\n         * @returns {Array}\n         */\n        function _getMatches(character, modifiers, e, sequenceName, combination, level) {\n            var i;\n            var callback;\n            var matches = [];\n            var action = e.type;\n\n            // if there are no events related to this keycode\n            if (!self._callbacks[character]) {\n                return [];\n            }\n\n            // if a modifier key is coming up on its own we should allow it\n            if (action == 'keyup' && _isModifier(character)) {\n                modifiers = [character];\n            }\n\n            // loop through all callbacks for the key that was pressed\n            // and see if any of them match\n            for (i = 0; i < self._callbacks[character].length; ++i) {\n                callback = self._callbacks[character][i];\n\n                // if a sequence name is not specified, but this is a sequence at\n                // the wrong level then move onto the next match\n                if (!sequenceName && callback.seq && _sequenceLevels[callback.seq] != callback.level) {\n                    continue;\n                }\n\n                // if the action we are looking for doesn't match the action we got\n                // then we should keep going\n                if (action != callback.action) {\n                    continue;\n                }\n\n                // if this is a keypress event and the meta key and control key\n                // are not pressed that means that we need to only look at the\n                // character, otherwise check the modifiers as well\n                //\n                // chrome will not fire a keypress if meta or control is down\n                // safari will fire a keypress if meta or meta+shift is down\n                // firefox will fire a keypress if meta or control is down\n                if ((action == 'keypress' && !e.metaKey && !e.ctrlKey) || _modifiersMatch(modifiers, callback.modifiers)) {\n\n                    // when you bind a combination or sequence a second time it\n                    // should overwrite the first one.  if a sequenceName or\n                    // combination is specified in this call it does just that\n                    //\n                    // @todo make deleting its own method?\n                    var deleteCombo = !sequenceName && callback.combo == combination;\n                    var deleteSequence = sequenceName && callback.seq == sequenceName && callback.level == level;\n                    if (deleteCombo || deleteSequence) {\n                        self._callbacks[character].splice(i, 1);\n                    }\n\n                    matches.push(callback);\n                }\n            }\n\n            return matches;\n        }\n\n        /**\n         * actually calls the callback function\n         *\n         * if your callback function returns false this will use the jquery\n         * convention - prevent default and stop propogation on the event\n         *\n         * @param {Function} callback\n         * @param {Event} e\n         * @returns void\n         */\n        function _fireCallback(callback, e, combo, sequence) {\n\n            // if this event should not happen stop here\n            if (self.stopCallback(e, e.target || e.srcElement, combo, sequence)) {\n                return;\n            }\n\n            if (callback(e, combo) === false) {\n                _preventDefault(e);\n                _stopPropagation(e);\n            }\n        }\n\n        /**\n         * handles a character key event\n         *\n         * @param {string} character\n         * @param {Array} modifiers\n         * @param {Event} e\n         * @returns void\n         */\n        self._handleKey = function(character, modifiers, e) {\n            var callbacks = _getMatches(character, modifiers, e);\n            var i;\n            var doNotReset = {};\n            var maxLevel = 0;\n            var processedSequenceCallback = false;\n\n            // Calculate the maxLevel for sequences so we can only execute the longest callback sequence\n            for (i = 0; i < callbacks.length; ++i) {\n                if (callbacks[i].seq) {\n                    maxLevel = Math.max(maxLevel, callbacks[i].level);\n                }\n            }\n\n            // loop through matching callbacks for this key event\n            for (i = 0; i < callbacks.length; ++i) {\n\n                // fire for all sequence callbacks\n                // this is because if for example you have multiple sequences\n                // bound such as \"g i\" and \"g t\" they both need to fire the\n                // callback for matching g cause otherwise you can only ever\n                // match the first one\n                if (callbacks[i].seq) {\n\n                    // only fire callbacks for the maxLevel to prevent\n                    // subsequences from also firing\n                    //\n                    // for example 'a option b' should not cause 'option b' to fire\n                    // even though 'option b' is part of the other sequence\n                    //\n                    // any sequences that do not match here will be discarded\n                    // below by the _resetSequences call\n                    if (callbacks[i].level != maxLevel) {\n                        continue;\n                    }\n\n                    processedSequenceCallback = true;\n\n                    // keep a list of which sequences were matches for later\n                    doNotReset[callbacks[i].seq] = 1;\n                    _fireCallback(callbacks[i].callback, e, callbacks[i].combo, callbacks[i].seq);\n                    continue;\n                }\n\n                // if there were no sequence matches but we are still here\n                // that means this is a regular match so we should fire that\n                if (!processedSequenceCallback) {\n                    _fireCallback(callbacks[i].callback, e, callbacks[i].combo);\n                }\n            }\n\n            // if the key you pressed matches the type of sequence without\n            // being a modifier (ie \"keyup\" or \"keypress\") then we should\n            // reset all sequences that were not matched by this event\n            //\n            // this is so, for example, if you have the sequence \"h a t\" and you\n            // type \"h e a r t\" it does not match.  in this case the \"e\" will\n            // cause the sequence to reset\n            //\n            // modifier keys are ignored because you can have a sequence\n            // that contains modifiers such as \"enter ctrl+space\" and in most\n            // cases the modifier key will be pressed before the next key\n            //\n            // also if you have a sequence such as \"ctrl+b a\" then pressing the\n            // \"b\" key will trigger a \"keypress\" and a \"keydown\"\n            //\n            // the \"keydown\" is expected when there is a modifier, but the\n            // \"keypress\" ends up matching the _nextExpectedAction since it occurs\n            // after and that causes the sequence to reset\n            //\n            // we ignore keypresses in a sequence that directly follow a keydown\n            // for the same character\n            var ignoreThisKeypress = e.type == 'keypress' && _ignoreNextKeypress;\n            if (e.type == _nextExpectedAction && !_isModifier(character) && !ignoreThisKeypress) {\n                _resetSequences(doNotReset);\n            }\n\n            _ignoreNextKeypress = processedSequenceCallback && e.type == 'keydown';\n        };\n\n        /**\n         * handles a keydown event\n         *\n         * @param {Event} e\n         * @returns void\n         */\n        function _handleKeyEvent(e) {\n\n            // normalize e.which for key events\n            // @see http://stackoverflow.com/questions/4285627/javascript-keycode-vs-charcode-utter-confusion\n            if (typeof e.which !== 'number') {\n                e.which = e.keyCode;\n            }\n\n            var character = _characterFromEvent(e);\n\n            // no character found then stop\n            if (!character) {\n                return;\n            }\n\n            // need to use === for the character check because the character can be 0\n            if (e.type == 'keyup' && _ignoreNextKeyup === character) {\n                _ignoreNextKeyup = false;\n                return;\n            }\n\n            self.handleKey(character, _eventModifiers(e), e);\n        }\n\n        /**\n         * called to set a 1 second timeout on the specified sequence\n         *\n         * this is so after each key press in the sequence you have 1 second\n         * to press the next key before you have to start over\n         *\n         * @returns void\n         */\n        function _resetSequenceTimer() {\n            clearTimeout(_resetTimer);\n            _resetTimer = setTimeout(_resetSequences, 1000);\n        }\n\n        /**\n         * binds a key sequence to an event\n         *\n         * @param {string} combo - combo specified in bind call\n         * @param {Array} keys\n         * @param {Function} callback\n         * @param {string=} action\n         * @returns void\n         */\n        function _bindSequence(combo, keys, callback, action) {\n\n            // start off by adding a sequence level record for this combination\n            // and setting the level to 0\n            _sequenceLevels[combo] = 0;\n\n            /**\n             * callback to increase the sequence level for this sequence and reset\n             * all other sequences that were active\n             *\n             * @param {string} nextAction\n             * @returns {Function}\n             */\n            function _increaseSequence(nextAction) {\n                return function() {\n                    _nextExpectedAction = nextAction;\n                    ++_sequenceLevels[combo];\n                    _resetSequenceTimer();\n                };\n            }\n\n            /**\n             * wraps the specified callback inside of another function in order\n             * to reset all sequence counters as soon as this sequence is done\n             *\n             * @param {Event} e\n             * @returns void\n             */\n            function _callbackAndReset(e) {\n                _fireCallback(callback, e, combo);\n\n                // we should ignore the next key up if the action is key down\n                // or keypress.  this is so if you finish a sequence and\n                // release the key the final key will not trigger a keyup\n                if (action !== 'keyup') {\n                    _ignoreNextKeyup = _characterFromEvent(e);\n                }\n\n                // weird race condition if a sequence ends with the key\n                // another sequence begins with\n                setTimeout(_resetSequences, 10);\n            }\n\n            // loop through keys one at a time and bind the appropriate callback\n            // function.  for any key leading up to the final one it should\n            // increase the sequence. after the final, it should reset all sequences\n            //\n            // if an action is specified in the original bind call then that will\n            // be used throughout.  otherwise we will pass the action that the\n            // next key in the sequence should match.  this allows a sequence\n            // to mix and match keypress and keydown events depending on which\n            // ones are better suited to the key provided\n            for (var i = 0; i < keys.length; ++i) {\n                var isFinal = i + 1 === keys.length;\n                var wrappedCallback = isFinal ? _callbackAndReset : _increaseSequence(action || _getKeyInfo(keys[i + 1]).action);\n                _bindSingle(keys[i], wrappedCallback, action, combo, i);\n            }\n        }\n\n        /**\n         * binds a single keyboard combination\n         *\n         * @param {string} combination\n         * @param {Function} callback\n         * @param {string=} action\n         * @param {string=} sequenceName - name of sequence if part of sequence\n         * @param {number=} level - what part of the sequence the command is\n         * @returns void\n         */\n        function _bindSingle(combination, callback, action, sequenceName, level) {\n\n            // store a direct mapped reference for use with Mousetrap.trigger\n            self._directMap[combination + ':' + action] = callback;\n\n            // make sure multiple spaces in a row become a single space\n            combination = combination.replace(/\\s+/g, ' ');\n\n            var sequence = combination.split(' ');\n            var info;\n\n            // if this pattern is a sequence of keys then run through this method\n            // to reprocess each pattern one key at a time\n            if (sequence.length > 1) {\n                _bindSequence(combination, sequence, callback, action);\n                return;\n            }\n\n            info = _getKeyInfo(combination, action);\n\n            // make sure to initialize array if this is the first time\n            // a callback is added for this key\n            self._callbacks[info.key] = self._callbacks[info.key] || [];\n\n            // remove an existing match if there is one\n            _getMatches(info.key, info.modifiers, {type: info.action}, sequenceName, combination, level);\n\n            // add this call back to the array\n            // if it is a sequence put it at the beginning\n            // if not put it at the end\n            //\n            // this is important because the way these are processed expects\n            // the sequence ones to come first\n            self._callbacks[info.key][sequenceName ? 'unshift' : 'push']({\n                callback: callback,\n                modifiers: info.modifiers,\n                action: info.action,\n                seq: sequenceName,\n                level: level,\n                combo: combination\n            });\n        }\n\n        /**\n         * binds multiple combinations to the same callback\n         *\n         * @param {Array} combinations\n         * @param {Function} callback\n         * @param {string|undefined} action\n         * @returns void\n         */\n        self._bindMultiple = function(combinations, callback, action) {\n            for (var i = 0; i < combinations.length; ++i) {\n                _bindSingle(combinations[i], callback, action);\n            }\n        };\n\n        // start!\n        _addEvent(targetElement, 'keypress', _handleKeyEvent);\n        _addEvent(targetElement, 'keydown', _handleKeyEvent);\n        _addEvent(targetElement, 'keyup', _handleKeyEvent);\n    }\n\n    /**\n     * binds an event to mousetrap\n     *\n     * can be a single key, a combination of keys separated with +,\n     * an array of keys, or a sequence of keys separated by spaces\n     *\n     * be sure to list the modifier keys first to make sure that the\n     * correct key ends up getting bound (the last key in the pattern)\n     *\n     * @param {string|Array} keys\n     * @param {Function} callback\n     * @param {string=} action - 'keypress', 'keydown', or 'keyup'\n     * @returns void\n     */\n    Mousetrap.prototype.bind = function(keys, callback, action) {\n        var self = this;\n        keys = keys instanceof Array ? keys : [keys];\n        self._bindMultiple.call(self, keys, callback, action);\n        return self;\n    };\n\n    /**\n     * unbinds an event to mousetrap\n     *\n     * the unbinding sets the callback function of the specified key combo\n     * to an empty function and deletes the corresponding key in the\n     * _directMap dict.\n     *\n     * TODO: actually remove this from the _callbacks dictionary instead\n     * of binding an empty function\n     *\n     * the keycombo+action has to be exactly the same as\n     * it was defined in the bind method\n     *\n     * @param {string|Array} keys\n     * @param {string} action\n     * @returns void\n     */\n    Mousetrap.prototype.unbind = function(keys, action) {\n        var self = this;\n        return self.bind.call(self, keys, function() {}, action);\n    };\n\n    /**\n     * triggers an event that has already been bound\n     *\n     * @param {string} keys\n     * @param {string=} action\n     * @returns void\n     */\n    Mousetrap.prototype.trigger = function(keys, action) {\n        var self = this;\n        if (self._directMap[keys + ':' + action]) {\n            self._directMap[keys + ':' + action]({}, keys);\n        }\n        return self;\n    };\n\n    /**\n     * resets the library back to its initial state.  this is useful\n     * if you want to clear out the current keyboard shortcuts and bind\n     * new ones - for example if you switch to another page\n     *\n     * @returns void\n     */\n    Mousetrap.prototype.reset = function() {\n        var self = this;\n        self._callbacks = {};\n        self._directMap = {};\n        return self;\n    };\n\n    /**\n     * should we stop this event before firing off callbacks\n     *\n     * @param {Event} e\n     * @param {Element} element\n     * @return {boolean}\n     */\n    Mousetrap.prototype.stopCallback = function(e, element) {\n        var self = this;\n\n        // if the element has the class \"mousetrap\" then no need to stop\n        if ((' ' + element.className + ' ').indexOf(' mousetrap ') > -1) {\n            return false;\n        }\n\n        if (_belongsTo(element, self.target)) {\n            return false;\n        }\n\n        // Events originating from a shadow DOM are re-targetted and `e.target` is the shadow host,\n        // not the initial event target in the shadow tree. Note that not all events cross the\n        // shadow boundary.\n        // For shadow trees with `mode: 'open'`, the initial event target is the first element in\n        // the events composed path. For shadow trees with `mode: 'closed'`, the initial event\n        // target cannot be obtained.\n        if ('composedPath' in e && typeof e.composedPath === 'function') {\n            // For open shadow trees, update `element` so that the following check works.\n            var initialEventTarget = e.composedPath()[0];\n            if (initialEventTarget !== e.target) {\n                element = initialEventTarget;\n            }\n        }\n\n        // stop for input, select, and textarea\n        return element.tagName == 'INPUT' || element.tagName == 'SELECT' || element.tagName == 'TEXTAREA' || element.isContentEditable;\n    };\n\n    /**\n     * exposes _handleKey publicly so it can be overwritten by extensions\n     */\n    Mousetrap.prototype.handleKey = function() {\n        var self = this;\n        return self._handleKey.apply(self, arguments);\n    };\n\n    /**\n     * allow custom key mappings\n     */\n    Mousetrap.addKeycodes = function(object) {\n        for (var key in object) {\n            if (object.hasOwnProperty(key)) {\n                _MAP[key] = object[key];\n            }\n        }\n        _REVERSE_MAP = null;\n    };\n\n    /**\n     * Init the global mousetrap functions\n     *\n     * This method is needed to allow the global mousetrap functions to work\n     * now that mousetrap is a constructor function.\n     */\n    Mousetrap.init = function() {\n        var documentMousetrap = Mousetrap(document);\n        for (var method in documentMousetrap) {\n            if (method.charAt(0) !== '_') {\n                Mousetrap[method] = (function(method) {\n                    return function() {\n                        return documentMousetrap[method].apply(documentMousetrap, arguments);\n                    };\n                } (method));\n            }\n        }\n    };\n\n    Mousetrap.init();\n\n    // expose mousetrap to the global object\n    window.Mousetrap = Mousetrap;\n\n    // expose as a common js module\n    if (typeof module !== 'undefined' && module.exports) {\n        module.exports = Mousetrap;\n    }\n\n    // expose mousetrap as an AMD module\n    if (typeof define === 'function' && define.amd) {\n        define(function() {\n            return Mousetrap;\n        });\n    }\n}) (typeof window !== 'undefined' ? window : null, typeof  window !== 'undefined' ? document : null);\n\n},{}],37:[function(require,module,exports){\n'use strict';\n\n(function () {\n  var out$ = typeof exports != 'undefined' && exports || typeof define != 'undefined' && {} || this || window;\n  if (typeof define !== 'undefined') define('save-svg-as-png', [], function () {\n    return out$;\n  });\n  out$.default = out$;\n\n  var xmlNs = 'http://www.w3.org/2000/xmlns/';\n  var xhtmlNs = 'http://www.w3.org/1999/xhtml';\n  var svgNs = 'http://www.w3.org/2000/svg';\n  var doctype = '<?xml version=\"1.0\" standalone=\"no\"?><!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" [<!ENTITY nbsp \"&#160;\">]>';\n  var urlRegex = /url\\([\"']?(.+?)[\"']?\\)/;\n  var fontFormats = {\n    woff2: 'font/woff2',\n    woff: 'font/woff',\n    otf: 'application/x-font-opentype',\n    ttf: 'application/x-font-ttf',\n    eot: 'application/vnd.ms-fontobject',\n    sfnt: 'application/font-sfnt',\n    svg: 'image/svg+xml'\n  };\n\n  var isElement = function isElement(obj) {\n    return obj instanceof HTMLElement || obj instanceof SVGElement;\n  };\n  var requireDomNode = function requireDomNode(el) {\n    if (!isElement(el)) throw new Error('an HTMLElement or SVGElement is required; got ' + el);\n  };\n  var requireDomNodePromise = function requireDomNodePromise(el) {\n    return new Promise(function (resolve, reject) {\n      if (isElement(el)) resolve(el);else reject(new Error('an HTMLElement or SVGElement is required; got ' + el));\n    });\n  };\n  var isExternal = function isExternal(url) {\n    return url && url.lastIndexOf('http', 0) === 0 && url.lastIndexOf(window.location.host) === -1;\n  };\n\n  var getFontMimeTypeFromUrl = function getFontMimeTypeFromUrl(fontUrl) {\n    var formats = Object.keys(fontFormats).filter(function (extension) {\n      return fontUrl.indexOf('.' + extension) > 0;\n    }).map(function (extension) {\n      return fontFormats[extension];\n    });\n    if (formats) return formats[0];\n    console.error('Unknown font format for ' + fontUrl + '. Fonts may not be working correctly.');\n    return 'application/octet-stream';\n  };\n\n  var arrayBufferToBase64 = function arrayBufferToBase64(buffer) {\n    var binary = '';\n    var bytes = new Uint8Array(buffer);\n    for (var i = 0; i < bytes.byteLength; i++) {\n      binary += String.fromCharCode(bytes[i]);\n    }return window.btoa(binary);\n  };\n\n  var getDimension = function getDimension(el, clone, dim) {\n    var v = el.viewBox && el.viewBox.baseVal && el.viewBox.baseVal[dim] || clone.getAttribute(dim) !== null && !clone.getAttribute(dim).match(/%$/) && parseInt(clone.getAttribute(dim)) || el.getBoundingClientRect()[dim] || parseInt(clone.style[dim]) || parseInt(window.getComputedStyle(el).getPropertyValue(dim));\n    return typeof v === 'undefined' || v === null || isNaN(parseFloat(v)) ? 0 : v;\n  };\n\n  var getDimensions = function getDimensions(el, clone, width, height) {\n    if (el.tagName === 'svg') return {\n      width: width || getDimension(el, clone, 'width'),\n      height: height || getDimension(el, clone, 'height')\n    };else if (el.getBBox) {\n      var _el$getBBox = el.getBBox(),\n          x = _el$getBBox.x,\n          y = _el$getBBox.y,\n          _width = _el$getBBox.width,\n          _height = _el$getBBox.height;\n\n      return {\n        width: x + _width,\n        height: y + _height\n      };\n    }\n  };\n\n  var reEncode = function reEncode(data) {\n    return decodeURIComponent(encodeURIComponent(data).replace(/%([0-9A-F]{2})/g, function (match, p1) {\n      var c = String.fromCharCode('0x' + p1);\n      return c === '%' ? '%25' : c;\n    }));\n  };\n\n  var uriToBlob = function uriToBlob(uri) {\n    var byteString = window.atob(uri.split(',')[1]);\n    var mimeString = uri.split(',')[0].split(':')[1].split(';')[0];\n    var buffer = new ArrayBuffer(byteString.length);\n    var intArray = new Uint8Array(buffer);\n    for (var i = 0; i < byteString.length; i++) {\n      intArray[i] = byteString.charCodeAt(i);\n    }\n    return new Blob([buffer], { type: mimeString });\n  };\n\n  var query = function query(el, selector) {\n    if (!selector) return;\n    try {\n      return el.querySelector(selector) || el.parentNode && el.parentNode.querySelector(selector);\n    } catch (err) {\n      console.warn('Invalid CSS selector \"' + selector + '\"', err);\n    }\n  };\n\n  var detectCssFont = function detectCssFont(rule, href) {\n    // Match CSS font-face rules to external links.\n    // @font-face {\n    //   src: local('Abel'), url(https://fonts.gstatic.com/s/abel/v6/UzN-iejR1VoXU2Oc-7LsbvesZW2xOQ-xsNqO47m55DA.woff2);\n    // }\n    var match = rule.cssText.match(urlRegex);\n    var url = match && match[1] || '';\n    if (!url || url.match(/^data:/) || url === 'about:blank') return;\n    var fullUrl = url.startsWith('../') ? href + '/../' + url : url.startsWith('./') ? href + '/.' + url : url;\n    return {\n      text: rule.cssText,\n      format: getFontMimeTypeFromUrl(fullUrl),\n      url: fullUrl\n    };\n  };\n\n  var inlineImages = function inlineImages(el) {\n    return Promise.all(Array.from(el.querySelectorAll('image')).map(function (image) {\n      var href = image.getAttributeNS('http://www.w3.org/1999/xlink', 'href') || image.getAttribute('href');\n      if (!href) return Promise.resolve(null);\n      if (isExternal(href)) {\n        href += (href.indexOf('?') === -1 ? '?' : '&') + 't=' + new Date().valueOf();\n      }\n      return new Promise(function (resolve, reject) {\n        var canvas = document.createElement('canvas');\n        var img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.src = href;\n        img.onerror = function () {\n          return reject(new Error('Could not load ' + href));\n        };\n        img.onload = function () {\n          canvas.width = img.width;\n          canvas.height = img.height;\n          canvas.getContext('2d').drawImage(img, 0, 0);\n          image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', canvas.toDataURL('image/png'));\n          resolve(true);\n        };\n      });\n    }));\n  };\n\n  var cachedFonts = {};\n  var inlineFonts = function inlineFonts(fonts) {\n    return Promise.all(fonts.map(function (font) {\n      return new Promise(function (resolve, reject) {\n        if (cachedFonts[font.url]) return resolve(cachedFonts[font.url]);\n\n        var req = new XMLHttpRequest();\n        req.addEventListener('load', function () {\n          // TODO: it may also be worth it to wait until fonts are fully loaded before\n          // attempting to rasterize them. (e.g. use https://developer.mozilla.org/en-US/docs/Web/API/FontFaceSet)\n          var fontInBase64 = arrayBufferToBase64(req.response);\n          var fontUri = font.text.replace(urlRegex, 'url(\"data:' + font.format + ';base64,' + fontInBase64 + '\")') + '\\n';\n          cachedFonts[font.url] = fontUri;\n          resolve(fontUri);\n        });\n        req.addEventListener('error', function (e) {\n          console.warn('Failed to load font from: ' + font.url, e);\n          cachedFonts[font.url] = null;\n          resolve(null);\n        });\n        req.addEventListener('abort', function (e) {\n          console.warn('Aborted loading font from: ' + font.url, e);\n          resolve(null);\n        });\n        req.open('GET', font.url);\n        req.responseType = 'arraybuffer';\n        req.send();\n      });\n    })).then(function (fontCss) {\n      return fontCss.filter(function (x) {\n        return x;\n      }).join('');\n    });\n  };\n\n  var cachedRules = null;\n  var styleSheetRules = function styleSheetRules() {\n    if (cachedRules) return cachedRules;\n    return cachedRules = Array.from(document.styleSheets).map(function (sheet) {\n      try {\n        return { rules: sheet.cssRules, href: sheet.href };\n      } catch (e) {\n        console.warn('Stylesheet could not be loaded: ' + sheet.href, e);\n        return {};\n      }\n    });\n  };\n\n  var inlineCss = function inlineCss(el, options) {\n    var _ref = options || {},\n        selectorRemap = _ref.selectorRemap,\n        modifyStyle = _ref.modifyStyle,\n        modifyCss = _ref.modifyCss,\n        fonts = _ref.fonts,\n        excludeUnusedCss = _ref.excludeUnusedCss;\n\n    var generateCss = modifyCss || function (selector, properties) {\n      var sel = selectorRemap ? selectorRemap(selector) : selector;\n      var props = modifyStyle ? modifyStyle(properties) : properties;\n      return sel + '{' + props + '}\\n';\n    };\n    var css = [];\n    var detectFonts = typeof fonts === 'undefined';\n    var fontList = fonts || [];\n    styleSheetRules().forEach(function (_ref2) {\n      var rules = _ref2.rules,\n          href = _ref2.href;\n\n      if (!rules) return;\n      Array.from(rules).forEach(function (rule) {\n        if (typeof rule.style != 'undefined') {\n          if (query(el, rule.selectorText)) css.push(generateCss(rule.selectorText, rule.style.cssText));else if (detectFonts && rule.cssText.match(/^@font-face/)) {\n            var font = detectCssFont(rule, href);\n            if (font) fontList.push(font);\n          } else if (!excludeUnusedCss) {\n            css.push(rule.cssText);\n          }\n        }\n      });\n    });\n\n    return inlineFonts(fontList).then(function (fontCss) {\n      return css.join('\\n') + fontCss;\n    });\n  };\n\n  var downloadOptions = function downloadOptions() {\n    if (!navigator.msSaveOrOpenBlob && !('download' in document.createElement('a'))) {\n      return { popup: window.open() };\n    }\n  };\n\n  out$.prepareSvg = function (el, options, done) {\n    requireDomNode(el);\n\n    var _ref3 = options || {},\n        _ref3$left = _ref3.left,\n        left = _ref3$left === undefined ? 0 : _ref3$left,\n        _ref3$top = _ref3.top,\n        top = _ref3$top === undefined ? 0 : _ref3$top,\n        w = _ref3.width,\n        h = _ref3.height,\n        _ref3$scale = _ref3.scale,\n        scale = _ref3$scale === undefined ? 1 : _ref3$scale,\n        _ref3$responsive = _ref3.responsive,\n        responsive = _ref3$responsive === undefined ? false : _ref3$responsive,\n        _ref3$excludeCss = _ref3.excludeCss,\n        excludeCss = _ref3$excludeCss === undefined ? false : _ref3$excludeCss;\n\n    return inlineImages(el).then(function () {\n      var clone = el.cloneNode(true);\n      clone.style.backgroundColor = (options || {}).backgroundColor || el.style.backgroundColor;\n\n      var _getDimensions = getDimensions(el, clone, w, h),\n          width = _getDimensions.width,\n          height = _getDimensions.height;\n\n      if (el.tagName !== 'svg') {\n        if (el.getBBox) {\n          if (clone.getAttribute('transform') != null) {\n            clone.setAttribute('transform', clone.getAttribute('transform').replace(/translate\\(.*?\\)/, ''));\n          }\n          var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n          svg.appendChild(clone);\n          clone = svg;\n        } else {\n          console.error('Attempted to render non-SVG element', el);\n          return;\n        }\n      }\n\n      clone.setAttribute('version', '1.1');\n      clone.setAttribute('viewBox', [left, top, width, height].join(' '));\n      if (!clone.getAttribute('xmlns')) clone.setAttributeNS(xmlNs, 'xmlns', svgNs);\n      if (!clone.getAttribute('xmlns:xlink')) clone.setAttributeNS(xmlNs, 'xmlns:xlink', 'http://www.w3.org/1999/xlink');\n\n      if (responsive) {\n        clone.removeAttribute('width');\n        clone.removeAttribute('height');\n        clone.setAttribute('preserveAspectRatio', 'xMinYMin meet');\n      } else {\n        clone.setAttribute('width', width * scale);\n        clone.setAttribute('height', height * scale);\n      }\n\n      Array.from(clone.querySelectorAll('foreignObject > *')).forEach(function (foreignObject) {\n        foreignObject.setAttributeNS(xmlNs, 'xmlns', foreignObject.tagName === 'svg' ? svgNs : xhtmlNs);\n      });\n\n      if (excludeCss) {\n        var outer = document.createElement('div');\n        outer.appendChild(clone);\n        var src = outer.innerHTML;\n        if (typeof done === 'function') done(src, width, height);else return { src: src, width: width, height: height };\n      } else {\n        return inlineCss(el, options).then(function (css) {\n          var style = document.createElement('style');\n          style.setAttribute('type', 'text/css');\n          style.innerHTML = '<![CDATA[\\n' + css + '\\n]]>';\n\n          var defs = document.createElement('defs');\n          defs.appendChild(style);\n          clone.insertBefore(defs, clone.firstChild);\n\n          var outer = document.createElement('div');\n          outer.appendChild(clone);\n          var src = outer.innerHTML.replace(/NS\\d+:href/gi, 'xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href');\n\n          if (typeof done === 'function') done(src, width, height);else return { src: src, width: width, height: height };\n        });\n      }\n    });\n  };\n\n  out$.svgAsDataUri = function (el, options, done) {\n    requireDomNode(el);\n    return out$.prepareSvg(el, options).then(function (_ref4) {\n      var src = _ref4.src,\n          width = _ref4.width,\n          height = _ref4.height;\n\n      var svgXml = 'data:image/svg+xml;base64,' + window.btoa(reEncode(doctype + src));\n      if (typeof done === 'function') {\n        done(svgXml, width, height);\n      }\n      return svgXml;\n    });\n  };\n\n  out$.svgAsPngUri = function (el, options, done) {\n    requireDomNode(el);\n\n    var _ref5 = options || {},\n        _ref5$encoderType = _ref5.encoderType,\n        encoderType = _ref5$encoderType === undefined ? 'image/png' : _ref5$encoderType,\n        _ref5$encoderOptions = _ref5.encoderOptions,\n        encoderOptions = _ref5$encoderOptions === undefined ? 0.8 : _ref5$encoderOptions,\n        canvg = _ref5.canvg;\n\n    var convertToPng = function convertToPng(_ref6) {\n      var src = _ref6.src,\n          width = _ref6.width,\n          height = _ref6.height;\n\n      var canvas = document.createElement('canvas');\n      var context = canvas.getContext('2d');\n      var pixelRatio = window.devicePixelRatio || 1;\n\n      canvas.width = width * pixelRatio;\n      canvas.height = height * pixelRatio;\n      canvas.style.width = canvas.width + 'px';\n      canvas.style.height = canvas.height + 'px';\n      context.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n\n      if (canvg) canvg(canvas, src);else context.drawImage(src, 0, 0);\n\n      var png = void 0;\n      try {\n        png = canvas.toDataURL(encoderType, encoderOptions);\n      } catch (e) {\n        if (typeof SecurityError !== 'undefined' && e instanceof SecurityError || e.name === 'SecurityError') {\n          console.error('Rendered SVG images cannot be downloaded in this browser.');\n          return;\n        } else throw e;\n      }\n      if (typeof done === 'function') done(png, canvas.width, canvas.height);\n      return Promise.resolve(png);\n    };\n\n    if (canvg) return out$.prepareSvg(el, options).then(convertToPng);else return out$.svgAsDataUri(el, options).then(function (uri) {\n      return new Promise(function (resolve, reject) {\n        var image = new Image();\n        image.onload = function () {\n          return resolve(convertToPng({\n            src: image,\n            width: image.width,\n            height: image.height\n          }));\n        };\n        image.onerror = function () {\n          reject('There was an error loading the data URI as an image on the following SVG\\n' + window.atob(uri.slice(26)) + 'Open the following link to see browser\\'s diagnosis\\n' + uri);\n        };\n        image.src = uri;\n      });\n    });\n  };\n\n  out$.download = function (name, uri, options) {\n    if (navigator.msSaveOrOpenBlob) navigator.msSaveOrOpenBlob(uriToBlob(uri), name);else {\n      var saveLink = document.createElement('a');\n      if ('download' in saveLink) {\n        saveLink.download = name;\n        saveLink.style.display = 'none';\n        document.body.appendChild(saveLink);\n        try {\n          var blob = uriToBlob(uri);\n          var url = URL.createObjectURL(blob);\n          saveLink.href = url;\n          saveLink.onclick = function () {\n            return requestAnimationFrame(function () {\n              return URL.revokeObjectURL(url);\n            });\n          };\n        } catch (e) {\n          console.error(e);\n          console.warn('Error while getting object URL. Falling back to string URL.');\n          saveLink.href = uri;\n        }\n        saveLink.click();\n        document.body.removeChild(saveLink);\n      } else if (options && options.popup) {\n        options.popup.document.title = name;\n        options.popup.location.replace(uri);\n      }\n    }\n  };\n\n  out$.saveSvg = function (el, name, options) {\n    var downloadOpts = downloadOptions(); // don't inline, can't be async\n    return requireDomNodePromise(el).then(function (el) {\n      return out$.svgAsDataUri(el, options || {});\n    }).then(function (uri) {\n      return out$.download(name, uri, downloadOpts);\n    });\n  };\n\n  out$.saveSvgAsPng = function (el, name, options) {\n    var downloadOpts = downloadOptions(); // don't inline, can't be async\n    return requireDomNodePromise(el).then(function (el) {\n      return out$.svgAsPngUri(el, options || {});\n    }).then(function (uri) {\n      return out$.download(name, uri, downloadOpts);\n    });\n  };\n})();\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJnbG9iYWwuanMiLCJpbmRleC5qcyIsImxpYi9ib2FyZC9kZWxldGUuc3ZnIiwibGliL2JvYXJkL2VkaXQuc3ZnIiwibGliL2JvYXJkL2VsZW1lbnRzbWVudS9pbmRleC5qcyIsImxpYi9ib2FyZC9lbWJlZGRpbmdyZWFjdG9yLmpzIiwibGliL2JvYXJkL2luZGV4LmpzIiwibGliL2JvYXJkL2l0ZW1kcmFnZ2VyL2RyYWdnZXIuaHRtbCIsImxpYi9ib2FyZC9pdGVtZHJhZ2dlci9pbmRleC5qcyIsImxpYi9ib2FyZC9pdGVtZHJhZ2dlci9vdmVybGF5Lmh0bWwiLCJsaWIvYm9hcmQvbGluay5zdmciLCJsaWIvYm9hcmQvbGlua2Nvbm5lY3Rpb25wb2ludC5qcyIsImxpYi9ib2FyZC9tYW5pcHVsYXRpb25yZWFjdG9yLmpzIiwibGliL2JvYXJkL21hbmlwdWxhdG9yLmh0bWwiLCJsaWIvYm9hcmQvbWFwL2luZGV4LmpzIiwibGliL2JvYXJkL21hcC9wcmV2aWV3Lmh0bWwiLCJsaWIvYm9hcmQvbWFwL3ByZXZpZXcuanMiLCJsaWIvYm9hcmQvbWFwL3ZpZXdwb3J0Lmh0bWwiLCJsaWIvYm9hcmQvbWFwL3ZpZXdwb3J0LmpzIiwibGliL2JvYXJkL21hcC92aWV3cG9ydG91dGxpbmUvaW5kZXguanMiLCJsaWIvYm9hcmQvbWFwL3ZpZXdwb3J0b3V0bGluZS9tYXJrdXAuc3ZnIiwibGliL2JvYXJkL21vdmUuc3ZnIiwibGliL2JvYXJkL3BhbnJlYWN0b3IuanMiLCJsaWIvYm9hcmQvcmVzaXplcmVhY3Rvci5qcyIsImxpYi9ib2FyZC9yb3RhdGVyZWFjdG9yLmpzIiwibGliL2JvYXJkL3VuZG9yZWFjdG9yL2FkZHRvaGlzdG9yeS5qcyIsImxpYi9ib2FyZC91bmRvcmVhY3Rvci9oYXNlZmZlY3QuanMiLCJsaWIvYm9hcmQvdW5kb3JlYWN0b3IvaW5kZXguanMiLCJsaWIvYm9hcmQvdW5kb3JlYWN0b3Ivb3B0aW1pemVoaXN0b3J5LmpzIiwibGliL2JvYXJkL3ZhbGlkYXRlY29ubmVjdGlvbi5qcyIsImxpYi9ib2FyZC96b29tcmVhY3Rvci5qcyIsImxpYi91dGlscy9jaGFuZ2VpZC5qcyIsImxpYi91dGlscy9pbmRleC5qcyIsImxpYi91dGlscy9pc2Z1bGx5Y29udGFpbmVkLmpzIiwibGliL3V0aWxzL3NvcnRjZWxscy5qcyIsIm5vZGVfbW9kdWxlcy9tb3VzZXRyYXAvbW91c2V0cmFwLmpzIiwibm9kZV9tb2R1bGVzL3NhdmUtc3ZnLWFzLXBuZy9saWIvc2F2ZVN2Z0FzUG5nLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQkE7QUFDQTs7QUNEQTtBQUNBOzs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNoREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDdEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ2xNQTtBQUNBOzs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQzFMQTtBQUNBOztBQ0RBO0FBQ0E7OztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDOUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDblBBO0FBQ0E7OztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNyRkE7QUFDQTs7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUMxRkE7QUFDQTs7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUMzQkE7QUFDQTs7QUNEQTtBQUNBOzs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM1REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDaE1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzdQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDMUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUN6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbGlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIi8vIENvcHlyaWdodCAoYykgMjAxNiwgdGhlIEFMTU9zVCBwcm9qZWN0IGF1dGhvcnMuIFBsZWFzZSBzZWUgdGhlXHJcbi8vIEFVVEhPUlMgZmlsZSBmb3IgZGV0YWlscy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXNcclxuLy8gZ292ZXJuZWQgYnkgdGhlIE1JVCBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuXHJcbi8qanNsaW50IG5vZGU6IHRydWUqL1xyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbnZhciB3aW5kb3cgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snd2luZG93J10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWyd3aW5kb3cnXSA6IG51bGwpO1xyXG5cclxuaWYgKCF3aW5kb3cuYWxtb3N0KSB7XHJcbiAgICB3aW5kb3cuYWxtb3N0ID0ge1xyXG4gICAgICAgIHBsdWdpbnM6IHt9XHJcbiAgICB9O1xyXG59XHJcbndpbmRvdy5hbG1vc3QucGx1Z2lucy5qb2ludCA9IHJlcXVpcmUoJy4vJyk7XHJcbiIsIi8vIENvcHlyaWdodCAoYykgMjAxNiwgdGhlIEFMTU9zVCBwcm9qZWN0IGF1dGhvcnMuIFBsZWFzZSBzZWUgdGhlXHJcbi8vIEFVVEhPUlMgZmlsZSBmb3IgZGV0YWlscy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXNcclxuLy8gZ292ZXJuZWQgYnkgdGhlIE1JVCBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuXHJcbi8qanNsaW50IG5vZGU6IHRydWUqL1xyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbnZhciBCb2FyZCA9IHJlcXVpcmUoJy4vbGliL2JvYXJkJykuQm9hcmQsXHJcbiAgICB1dGlscyA9IHJlcXVpcmUoJy4vbGliL3V0aWxzJyk7XHJcblxyXG4vLyBDb25zdHJ1Y3RvcnNcclxuZXhwb3J0cy5Cb2FyZCA9IEJvYXJkO1xyXG5cclxuLy8gTWFrZXIgRnVuY3Rpb25zXHJcbmV4cG9ydHMuY3JlYXRlQm9hcmQgPSBCb2FyZDtcclxuXHJcbi8vIHV0aWxzXHJcbmV4cG9ydHMudXRpbHMgPSB1dGlscztcclxuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxzdmdcXHJcXG4gICB4bWxuczpkYz1cXFwiaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS9cXFwiXFxyXFxuICAgeG1sbnM6Y2M9XFxcImh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zI1xcXCJcXHJcXG4gICB4bWxuczpyZGY9XFxcImh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyNcXFwiXFxyXFxuICAgeG1sbnM6c3ZnPVxcXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1xcXCJcXHJcXG4gICB4bWxucz1cXFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcXFwiXFxyXFxuICAgeG1sbnM6c29kaXBvZGk9XFxcImh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkXFxcIlxcclxcbiAgIHhtbG5zOmlua3NjYXBlPVxcXCJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlXFxcIlxcclxcbiAgIHZlcnNpb249XFxcIjEuMVxcXCJcXHJcXG4gICBpZD1cXFwiQ2FwYV8xXFxcIlxcclxcbiAgIHg9XFxcIjBweFxcXCJcXHJcXG4gICB5PVxcXCIwcHhcXFwiXFxyXFxuICAgd2lkdGg9XFxcIjQ0LjIzOHB4XFxcIlxcclxcbiAgIGhlaWdodD1cXFwiNDQuMjM4cHhcXFwiXFxyXFxuICAgdmlld0JveD1cXFwiMCAwIDQ0LjIzOCA0NC4yMzhcXFwiXFxyXFxuICAgeG1sOnNwYWNlPVxcXCJwcmVzZXJ2ZVxcXCJcXHJcXG4gICBpbmtzY2FwZTp2ZXJzaW9uPVxcXCIwLjkxIHIxMzcyNVxcXCJcXHJcXG4gICBzb2RpcG9kaTpkb2NuYW1lPVxcXCJkZWxldGUuc3ZnXFxcIlxcclxcbiAgIHN0eWxlPVxcXCJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ0LjIzOCA0NC4yMzg7XFxcIj48bWV0YWRhdGFcXHJcXG4gICAgIGlkPVxcXCJtZXRhZGF0YTUxXFxcIj48cmRmOlJERj48Y2M6V29ya1xcclxcbiAgICAgICAgIHJkZjphYm91dD1cXFwiXFxcIj48ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD48ZGM6dHlwZVxcclxcbiAgICAgICAgICAgcmRmOnJlc291cmNlPVxcXCJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZVxcXCIgLz48ZGM6dGl0bGU+PC9kYzp0aXRsZT48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnNcXHJcXG4gICAgIGlkPVxcXCJkZWZzNDlcXFwiIC8+PHNvZGlwb2RpOm5hbWVkdmlld1xcclxcbiAgICAgcGFnZWNvbG9yPVxcXCIjZmZmZmZmXFxcIlxcclxcbiAgICAgYm9yZGVyY29sb3I9XFxcIiM2NjY2NjZcXFwiXFxyXFxuICAgICBib3JkZXJvcGFjaXR5PVxcXCIxXFxcIlxcclxcbiAgICAgb2JqZWN0dG9sZXJhbmNlPVxcXCIxMFxcXCJcXHJcXG4gICAgIGdyaWR0b2xlcmFuY2U9XFxcIjEwXFxcIlxcclxcbiAgICAgZ3VpZGV0b2xlcmFuY2U9XFxcIjEwXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9XFxcIjBcXFwiXFxyXFxuICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PVxcXCIyXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPVxcXCIxNjAwXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD1cXFwiODM3XFxcIlxcclxcbiAgICAgaWQ9XFxcIm5hbWVkdmlldzQ3XFxcIlxcclxcbiAgICAgc2hvd2dyaWQ9XFxcImZhbHNlXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6em9vbT1cXFwiNS4zMzQ3ODAyXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6Y3g9XFxcIjY4Ljg3NDM4N1xcXCJcXHJcXG4gICAgIGlua3NjYXBlOmN5PVxcXCIyMi4xMTg5OTlcXFwiXFxyXFxuICAgICBpbmtzY2FwZTp3aW5kb3cteD1cXFwiLThcXFwiXFxyXFxuICAgICBpbmtzY2FwZTp3aW5kb3cteT1cXFwiLThcXFwiXFxyXFxuICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPVxcXCIxXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj1cXFwiQ2FwYV8xXFxcIlxcclxcbiAgICAgc2hvd2d1aWRlcz1cXFwidHJ1ZVxcXCJcXHJcXG4gICAgIGlua3NjYXBlOmd1aWRlLWJib3g9XFxcInRydWVcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnNDIzMFxcXCI+PGNpcmNsZVxcclxcbiAgICAgICByPVxcXCIyMVxcXCJcXHJcXG4gICAgICAgY3k9XFxcIjIyLjIzNzk5OVxcXCJcXHJcXG4gICAgICAgY3g9XFxcIjIyXFxcIlxcclxcbiAgICAgICBpZD1cXFwicGF0aDQyMDhcXFwiXFxyXFxuICAgICAgIHN0eWxlPVxcXCJjb2xvcjojMDAwMDAwO2Rpc3BsYXk6aW5saW5lO292ZXJmbG93OnZpc2libGU7dmlzaWJpbGl0eTp2aXNpYmxlO2ZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC40MDAwMDAwMTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MTttYXJrZXI6bm9uZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlXFxcIiAvPjxnXFxyXFxuICAgICAgIHN0eWxlPVxcXCJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjFcXFwiXFxyXFxuICAgICAgIGlkPVxcXCJnN1xcXCI+PHBhdGhcXHJcXG4gICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPVxcXCIwXFxcIlxcclxcbiAgICAgICAgIHN0eWxlPVxcXCJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjFcXFwiXFxyXFxuICAgICAgICAgaWQ9XFxcInBhdGg5XFxcIlxcclxcbiAgICAgICAgIGQ9XFxcIm0gMTUuNTMzLDI5LjQ1NSBjIC0wLjE5MiwwIC0wLjM4NCwtMC4wNzMgLTAuNTMsLTAuMjIgLTAuMjkzLC0wLjI5MyAtMC4yOTMsLTAuNzY5IDAsLTEuMDYyIEwgMjguMTc0LDE1LjAwMiBjIDAuMjkzLC0wLjI5MyAwLjc2OCwtMC4yOTMgMS4wNjEsMCAwLjI5MywwLjI5MyAwLjI5MywwLjc2OCAwLDEuMDYxIEwgMTYuMDYzLDI5LjIzNSBjIC0wLjE0NiwwLjE0NyAtMC4zMzgsMC4yMiAtMC41MywwLjIyIHpcXFwiIC8+PC9nPjxnXFxyXFxuICAgICAgIHN0eWxlPVxcXCJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjFcXFwiXFxyXFxuICAgICAgIGlkPVxcXCJnMTFcXFwiPjxwYXRoXFxyXFxuICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT1cXFwiMFxcXCJcXHJcXG4gICAgICAgICBzdHlsZT1cXFwiZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxXFxcIlxcclxcbiAgICAgICAgIGlkPVxcXCJwYXRoMTNcXFwiXFxyXFxuICAgICAgICAgZD1cXFwibSAyOC43MDQsMjkuNDU1IGMgLTAuMTkyLDAgLTAuMzg0LC0wLjA3MyAtMC41MywtMC4yMiBMIDE1LjAwMiwxNi4wNjQgYyAtMC4yOTMsLTAuMjkzIC0wLjI5MywtMC43NjggMCwtMS4wNjEgMC4yOTMsLTAuMjkzIDAuNzY4LC0wLjI5MyAxLjA2MSwwIGwgMTMuMTcxLDEzLjE3MSBjIDAuMjkzLDAuMjkzIDAuMjkzLDAuNzY5IDAsMS4wNjIgLTAuMTQ2LDAuMTQ2IC0wLjMzOCwwLjIxOSAtMC41MywwLjIxOSB6XFxcIiAvPjwvZz48cGF0aFxcclxcbiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPVxcXCIwXFxcIlxcclxcbiAgICAgICBzdHlsZT1cXFwiZmlsbDojZmYwMDAwO2ZpbGwtb3BhY2l0eToxXFxcIlxcclxcbiAgICAgICBpZD1cXFwicGF0aDE1XFxcIlxcclxcbiAgICAgICBkPVxcXCJNIDIyLjExOSw0NC4yMzcgQyA5LjkyMiw0NC4yMzcgMCwzNC4zMTUgMCwyMi4xMiAwLDkuOTI0IDkuOTIyLDAuMDAxIDIyLjExOSwwLjAwMSBjIDEyLjE5NywwIDIyLjExOSw5LjkyMiAyMi4xMTksMjIuMTE5IDAsMTIuMTk3IC05LjkyNCwyMi4xMTcgLTIyLjExOSwyMi4xMTcgeiBtIDAsLTQyLjczNiBDIDEwLjc1LDEuNTAxIDEuNSwxMC43NTEgMS41LDIyLjEyIGMgMCwxMS4zNjkgOS4yNSwyMC42MTkgMjAuNjE5LDIwLjYxOSAxMS4zNjksMCAyMC42MTksLTkuMjUgMjAuNjE5LC0yMC42MTkgMCwtMTEuMzY5IC05LjI1LC0yMC42MTkgLTIwLjYxOSwtMjAuNjE5IHpcXFwiIC8+PC9nPjxnXFxyXFxuICAgICBpZD1cXFwiZzE3XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzE5XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzIxXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzIzXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzI1XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzI3XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzI5XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzMxXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzMzXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzM1XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzM3XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzM5XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzQxXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzQzXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzQ1XFxcIiAvPjwvc3ZnPlxcclxcblwiO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxzdmdcXHJcXG4gICB4bWxuczpkYz1cXFwiaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS9cXFwiXFxyXFxuICAgeG1sbnM6Y2M9XFxcImh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zI1xcXCJcXHJcXG4gICB4bWxuczpyZGY9XFxcImh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyNcXFwiXFxyXFxuICAgeG1sbnM6c3ZnPVxcXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1xcXCJcXHJcXG4gICB4bWxucz1cXFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcXFwiXFxyXFxuICAgeG1sbnM6c29kaXBvZGk9XFxcImh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkXFxcIlxcclxcbiAgIHhtbG5zOmlua3NjYXBlPVxcXCJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlXFxcIlxcclxcbiAgIGNsYXNzPVxcXCJkZXRhaWwgY29udmVydFN2Z0lubGluZSByZXBsYWNlZC1zdmdcXFwiXFxyXFxuICAgaWQ9XFxcImltZ1ZpZXdcXFwiXFxyXFxuICAgZmlsbD1cXFwiIzAwMDAwMFxcXCJcXHJcXG4gICB2aWV3Qm94PVxcXCIwIDAgNDQuMjM2IDQ0LjIzNlxcXCJcXHJcXG4gICB4PVxcXCIwcHhcXFwiXFxyXFxuICAgeT1cXFwiMHB4XFxcIlxcclxcbiAgIHdpZHRoPVxcXCIyNTZcXFwiXFxyXFxuICAgaGVpZ2h0PVxcXCIyNTZcXFwiXFxyXFxuICAgdmVyc2lvbj1cXFwiMS4xXFxcIlxcclxcbiAgIGRhdGEta3c9XFxcImNvbmZpZ3VyYXRpb24xMlxcXCJcXHJcXG4gICBkYXRhLWlkPVxcXCI1MTg3NFxcXCJcXHJcXG4gICB4bWw6c3BhY2U9XFxcInByZXNlcnZlXFxcIlxcclxcbiAgIGlua3NjYXBlOnZlcnNpb249XFxcIjAuOTEgcjEzNzI1XFxcIlxcclxcbiAgIHNvZGlwb2RpOmRvY25hbWU9XFxcImVkaXQuc3ZnXFxcIj48bWV0YWRhdGFcXHJcXG4gICAgIGlkPVxcXCJtZXRhZGF0YTUzXFxcIj48cmRmOlJERj48Y2M6V29ya1xcclxcbiAgICAgICAgIHJkZjphYm91dD1cXFwiXFxcIj48ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD48ZGM6dHlwZVxcclxcbiAgICAgICAgICAgcmRmOnJlc291cmNlPVxcXCJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZVxcXCIgLz48ZGM6dGl0bGU+PC9kYzp0aXRsZT48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnNcXHJcXG4gICAgIGlkPVxcXCJkZWZzNTFcXFwiIC8+PHNvZGlwb2RpOm5hbWVkdmlld1xcclxcbiAgICAgcGFnZWNvbG9yPVxcXCIjZmZmZmZmXFxcIlxcclxcbiAgICAgYm9yZGVyY29sb3I9XFxcIiM2NjY2NjZcXFwiXFxyXFxuICAgICBib3JkZXJvcGFjaXR5PVxcXCIxXFxcIlxcclxcbiAgICAgb2JqZWN0dG9sZXJhbmNlPVxcXCIxMFxcXCJcXHJcXG4gICAgIGdyaWR0b2xlcmFuY2U9XFxcIjEwXFxcIlxcclxcbiAgICAgZ3VpZGV0b2xlcmFuY2U9XFxcIjEwXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9XFxcIjBcXFwiXFxyXFxuICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PVxcXCIyXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPVxcXCIxOTIwXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD1cXFwiMTAxN1xcXCJcXHJcXG4gICAgIGlkPVxcXCJuYW1lZHZpZXc0OVxcXCJcXHJcXG4gICAgIHNob3dncmlkPVxcXCJmYWxzZVxcXCJcXHJcXG4gICAgIGlua3NjYXBlOnpvb209XFxcIjIuNjA3NDU2M1xcXCJcXHJcXG4gICAgIGlua3NjYXBlOmN4PVxcXCIyMjEuNzA5NTFcXFwiXFxyXFxuICAgICBpbmtzY2FwZTpjeT1cXFwiMTA2Ljc0NTIzXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6d2luZG93LXg9XFxcIi04XFxcIlxcclxcbiAgICAgaW5rc2NhcGU6d2luZG93LXk9XFxcIi04XFxcIlxcclxcbiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD1cXFwiMVxcXCJcXHJcXG4gICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9XFxcImltZ1ZpZXdcXFwiIC8+PGNpcmNsZVxcclxcbiAgICAgc3R5bGU9XFxcImNvbG9yOiMwMDAwMDA7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTt2aXNpYmlsaXR5OnZpc2libGU7ZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjAzNDU1OTM3O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjA7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MTttYXJrZXI6bm9uZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlXFxcIlxcclxcbiAgICAgaWQ9XFxcInBhdGg0MTgxXFxcIlxcclxcbiAgICAgY3g9XFxcIjIyLjExOFxcXCJcXHJcXG4gICAgIGN5PVxcXCIyMi4xMThcXFwiXFxyXFxuICAgICByPVxcXCIyMS4yNTQwMTVcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnM1xcXCI+PGdcXHJcXG4gICAgICAgaWQ9XFxcImc1XFxcIj48cGF0aFxcclxcbiAgICAgICAgIGZpbGw9XFxcIlxcXCJcXHJcXG4gICAgICAgICBkPVxcXCJNIDIyLjExOCA0NC4yMzYgQyA5LjkyMiA0NC4yMzYgMCAzNC4zMTQgMCAyMi4xMTkgQyAwIDkuOTIzIDkuOTIyIDAgMjIuMTE4IDAgcyAyMi4xMTggOS45MjMgMjIuMTE4IDIyLjExOSBDIDQ0LjIzNiAzNC4zMTQgMzQuMzE0IDQ0LjIzNiAyMi4xMTggNDQuMjM2IFogTSAyMi4xMTggMS41IEMgMTAuNzUgMS41IDEuNSAxMC43NSAxLjUgMjIuMTE5IHMgOS4yNSAyMC42MTcgMjAuNjE4IDIwLjYxNyBzIDIwLjYxOCAtOS4yNDggMjAuNjE4IC0yMC42MTcgUyAzMy40ODYgMS41IDIyLjExOCAxLjUgWlxcXCJcXHJcXG4gICAgICAgICBpZD1cXFwicGF0aDdcXFwiIC8+PGdcXHJcXG4gICAgICAgICBpZD1cXFwiZzlcXFwiPjxjaXJjbGVcXHJcXG4gICAgICAgICAgIGZpbGw9XFxcIlxcXCJcXHJcXG4gICAgICAgICAgIGN4PVxcXCIyMi4xMThcXFwiXFxyXFxuICAgICAgICAgICBjeT1cXFwiMjIuNDM4XFxcIlxcclxcbiAgICAgICAgICAgcj1cXFwiMS40MVxcXCJcXHJcXG4gICAgICAgICAgIGlkPVxcXCJjaXJjbGUxMVxcXCIgLz48cGF0aFxcclxcbiAgICAgICAgICAgZmlsbD1cXFwiXFxcIlxcclxcbiAgICAgICAgICAgZD1cXFwiTSAyMi4xMTggMjQuMDk4IGMgLTAuOTE2IDAgLTEuNjYgLTAuNzQ0IC0xLjY2IC0xLjY2IGMgMCAtMC45MTUgMC43NDUgLTEuNjYgMS42NiAtMS42NiBzIDEuNjU5IDAuNzQ1IDEuNjU5IDEuNjYgQyAyMy43NzcgMjMuMzU0IDIzLjAzNCAyNC4wOTggMjIuMTE4IDI0LjA5OCBaIE0gMjIuMTE4IDIxLjI3NyBjIC0wLjY0IDAgLTEuMTYgMC41MjEgLTEuMTYgMS4xNiBzIDAuNTIxIDEuMTYxIDEuMTYgMS4xNjEgYyAwLjYzOSAwIDEuMTU5IC0wLjUyMSAxLjE1OSAtMS4xNjEgUyAyMi43NTggMjEuMjc3IDIyLjExOCAyMS4yNzcgWlxcXCJcXHJcXG4gICAgICAgICAgIGlkPVxcXCJwYXRoMTNcXFwiIC8+PC9nPjxnXFxyXFxuICAgICAgICAgaWQ9XFxcImcxNVxcXCI+PHBhdGhcXHJcXG4gICAgICAgICAgIGZpbGw9XFxcIlxcXCJcXHJcXG4gICAgICAgICAgIGQ9XFxcIk0gMjIuMTE4IDMyLjQyIGMgLTAuNiAwIC0xLjIwOCAtMC4wNjEgLTEuODYgLTAuMTgyIGMgLTAuNDQ2IC0wLjA2MiAtMC44MyAtMC40NDQgLTAuODk4IC0wLjkyNiBsIC0wLjM1NyAtMS44MzggYyAtMC40NjEgLTAuMjA3IC0wLjg5NiAtMC40NTkgLTEuMjg3IC0wLjc0NCBsIC0xLjc5OCAwLjYyMyBjIC0wLjA4NyAwLjA0MSAtMC4yMzMgMC4wNyAtMC4zODEgMC4wNyBjIC0wLjMxNyAwIC0wLjYyMiAtMC4xNDYgLTAuODM3IC0wLjM5OCBjIC0wLjgzNiAtMC45NTIgLTEuNDgyIC0yLjA3NCAtMS44NjIgLTMuMjMzIGMgLTAuMTgzIC0wLjQxOCAtMC4wMjMgLTAuOTc0IDAuNDAzIC0xLjI1NyBsIDEuMzU4IC0xLjE4NiBjIC0wLjAyMyAtMC4yMyAtMC4wMzUgLTAuNDc5IC0wLjAzNSAtMC43NTIgYyAwIC0wLjI3MSAwLjAxMSAtMC41MiAwLjAzNSAtMC43NSBsIC0xLjQzNSAtMS4yNDUgYyAtMC4zNSAtMC4yMjYgLTAuNTEgLTAuNzggLTAuMzAzIC0xLjI2MiBjIDAuMzU2IC0xLjA5OCAxLjAwMyAtMi4yMTkgMS44NDcgLTMuMTgxIGMgMC4yOTkgLTAuMzU1IDAuODIyIC0wLjQ4OCAxLjI2MSAtMC4yOTggbCAxLjc0NiAwLjYwMyBjIDAuMzkgLTAuMjg0IDAuODI1IC0wLjUzNyAxLjI4NyAtMC43NDUgbCAwLjM2NCAtMS44NzQgYyAwLjA2MyAtMC40NDcgMC40NDkgLTAuODMgMC45MzIgLTAuODk0IGMgMS4xMjUgLTAuMjM0IDIuNDY1IC0wLjI0MyAzLjY5MyAwLjAwOSBjIDAuNDMyIDAuMDU1IDAuODE3IDAuNDM4IDAuODg2IDAuOTIxIGwgMC4zNTcgMS44MzggYyAwLjQ0NyAwLjIwNCAwLjg3NSAwLjQ1MyAxLjI4MyAwLjc0NiBsIDEuODAzIC0wLjYyNCBjIDAuMDg3IC0wLjA0IDAuMjMyIC0wLjA3IDAuMzgxIC0wLjA3IGMgMC4zMTggMCAwLjYyNCAwLjE0NiAwLjgzOCAwLjQwMSBjIDAuODM0IDAuOTQ5IDEuNDggMi4wNyAxLjg2MSAzLjIzIGMgMC4xODMgMC40MTkgMC4wMjIgMC45NzQgLTAuNDAzIDEuMjU4IGwgLTEuMzU4IDEuMTg1IGMgMC4wMjIgMC4yMzIgMC4wMzQgMC40OCAwLjAzNCAwLjc1MiBzIC0wLjAxMSAwLjUyIC0wLjAzNCAwLjc1IGwgMS40MzQgMS4yNDUgYyAwLjM1MSAwLjIyNiAwLjUxMSAwLjc4IDAuMzA0IDEuMjYxIGMgLTAuMzU2IDEuMDk4IC0xLjAwMiAyLjIyIC0xLjg0NyAzLjE4MiBjIC0wLjMwMyAwLjM1NyAtMC44MjUgMC40ODYgLTEuMjYyIDAuMjk5IGwgLTEuNzUgLTAuNjA0IGMgLTAuNDA2IDAuMjkzIC0wLjgzNiAwLjU0MSAtMS4yODEgMC43NDYgbCAtMC4zNjQgMS44NzMgYyAtMC4wNjIgMC40NDQgLTAuNDQ2IDAuODI3IC0wLjkyNyAwLjg5NiBDIDIzLjMyNyAzMi4zNTkgMjIuNzE4IDMyLjQyIDIyLjExOCAzMi40MiBaIE0gMjAuNzg5IDMwLjgwOSBjIDAuOTYgMC4xNTIgMS43MzggMC4xNDYgMi42NiAwIGwgMC4zOSAtMi4wMTIgYyAwLjA1IC0wLjI1NCAwLjIyNiAtMC40NjQgMC40NjYgLTAuNTU3IGMgMC41NyAtMC4yMjEgMS4xMTEgLTAuNTM1IDEuNjA3IC0wLjkzNiBjIDAuMjAxIC0wLjE2MiAwLjQ3MiAtMC4yMDcgMC43MTYgLTAuMTI1IGwgMS45MzggMC42NzIgYyAwLjU4IC0wLjcwNSAxLjAzMyAtMS40OSAxLjMzIC0yLjMwMSBsIC0xLjU0OSAtMS4zMzcgYyAtMC4yMDEgLTAuMTc0IC0wLjI5NSAtMC40NDIgLTAuMjQ2IC0wLjcwMyBjIDAuMDQ3IC0wLjI1OSAwLjA3IC0wLjU1OCAwLjA3IC0wLjkxNCBzIC0wLjAyMyAtMC42NTQgLTAuMDcgLTAuOTEzIGMgLTAuMDUgLTAuMjYxIDAuMDQ1IC0wLjUyOSAwLjI0NiAtMC43MDMgbCAxLjU0NyAtMS4zNDIgYyAtMC4zMTMgLTAuODM4IC0wLjc2NCAtMS42MTEgLTEuMzMgLTIuMjk3IGwgLTEuOTM4IDAuNjczIGMgLTAuMjQ0IDAuMDgzIC0wLjUxNiAwLjAzNiAtMC43MTcgLTAuMTI1IGMgLTAuNDk1IC0wLjQgLTEuMDM1IC0wLjcxNSAtMS42MDUgLTAuOTM2IGMgLTAuMjQyIC0wLjA5MyAtMC40MTggLTAuMzAzIC0wLjQ2NyAtMC41NTcgbCAtMC4zOTEgLTIuMDE0IGMgLTAuOTI2IC0wLjE1NiAtMS43OTIgLTAuMTQ4IC0yLjY1OSAwIGwgLTAuMzkgMi4wMTQgYyAtMC4wNDkgMC4yNTQgLTAuMjI1IDAuNDY0IC0wLjQ2NiAwLjU1NyBjIC0wLjU5OCAwLjIzMSAtMS4xNDkgMC41NTIgLTEuNTk1IDAuOTI2IGMgLTAuMjAyIDAuMTcgLTAuNDc4IDAuMjIgLTAuNzI4IDAuMTM1IGwgLTEuOTM4IC0wLjY3MiBjIC0wLjU4MSAwLjcwNyAtMS4wMzQgMS40OTEgLTEuMzMgMi4zMDEgbCAxLjU0OSAxLjMzNyBjIDAuMjAxIDAuMTc1IDAuMjk0IDAuNDQyIDAuMjQ2IDAuNzA1IGMgLTAuMDQ4IDAuMjU1IC0wLjA3MSAwLjU1MyAtMC4wNzEgMC45MTEgcyAwLjAyMyAwLjY1NyAwLjA3MSAwLjkxMiBjIDAuMDQ5IDAuMjYzIC0wLjA0NCAwLjUzIC0wLjI0NiAwLjcwNSBsIC0xLjU0NyAxLjM0MyBjIDAuMzEzIDAuODM2IDAuNzYzIDEuNjA5IDEuMzI5IDIuMjk3IGwgMS45MzggLTAuNjc0IGMgMC4yNTEgLTAuMDg0IDAuNTI2IC0wLjAzMyAwLjcyOCAwLjEzNSBjIDAuNDQ2IDAuMzc1IDAuOTk4IDAuNjkzIDEuNTk1IDAuOTI2IGMgMC4yNDEgMC4wOTMgMC40MTcgMC4zMDMgMC40NjYgMC41NTcgTCAyMC43ODkgMzAuODA5IFpcXFwiXFxyXFxuICAgICAgICAgICBpZD1cXFwicGF0aDE3XFxcIiAvPjwvZz48L2c+PC9nPjxnXFxyXFxuICAgICBpZD1cXFwiZzE5XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzIxXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzIzXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzI1XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzI3XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzI5XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzMxXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzMzXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzM1XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzM3XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzM5XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzQxXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzQzXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzQ1XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzQ3XFxcIiAvPjwvc3ZnPlxcclxcblwiO1xuIiwiLy8gQ29weXJpZ2h0IChjKSAyMDE2LCB0aGUgQUxNT3NUIHByb2plY3QgYXV0aG9ycy4gUGxlYXNlIHNlZSB0aGVcclxuLy8gQVVUSE9SUyBmaWxlIGZvciBkZXRhaWxzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpc1xyXG4vLyBnb3Zlcm5lZCBieSB0aGUgTUlUIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS5cclxuLypqc2xpbnQgbm9kZTogdHJ1ZSwgbm9tZW46IHRydWUgKi9cclxuXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKSxcclxuICAgICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCk7XHJcblxyXG5mdW5jdGlvbiBFbGVtZW50c01lbnUob3B0aW9ucykge1xyXG4gICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEVsZW1lbnRzTWVudSkpIHsgcmV0dXJuIG5ldyBFbGVtZW50c01lbnUob3B0aW9ucyk7IH1cclxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG5cclxuICAgIGlmICghb3B0aW9ucy5jb250YWluZXIpIHsgdGhyb3cgbmV3IEVycm9yKCdjb250YWluZXIgb3B0aW9uIGlzIG1hbmRhdG9yeScpOyB9XHJcbiAgICBpZiAoJChvcHRpb25zLmNvbnRhaW5lcikubGVuZ3RoID09PSAwKSB7IHRocm93IG5ldyBFcnJvcignaW52YWxpZCBjb250YWluZXIgb3B0aW9uJyk7IH1cclxuICAgIGlmICghb3B0aW9ucy50ZW1wbGF0ZSkgeyB0aHJvdyBuZXcgRXJyb3IoJ3RlbXBsYXRlIG9wdGlvbiBpcyBtYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLnRlbXBsYXRlICE9PSAnc3RyaW5nJykgeyB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgdGVtcGxhdGUgb3B0aW9uJyk7IH1cclxuICAgIGlmICgkKG9wdGlvbnMudGVtcGxhdGUpLmxlbmd0aCA9PT0gMCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgdGVtcGxhdGUgb3B0aW9uJyk7IH1cclxuICAgIGlmICghQXJyYXkuaXNBcnJheShvcHRpb25zLmJ1aWxkZXJzKSkgeyB0aHJvdyBuZXcgRXJyb3IoJ2J1aWxkZXJzIG9wdGlvbnMgaXMgbWFuZGF0b3J5Jyk7IH1cclxuICAgIGlmICghb3B0aW9ucy5jcmVhdGVJdGVtRHJhZ2dlcikgeyB0aHJvdyBuZXcgRXJyb3IoJ2NyZWF0ZUl0ZW1EcmFnZ2VyIG9wdGlvbiBpcyBNYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLmNyZWF0ZUl0ZW1EcmFnZ2VyICE9PSAnZnVuY3Rpb24nKSB7IHRocm93IG5ldyBFcnJvcignaW52YWxpZCBjcmVhdGVJdGVtRHJhZ2dlciBvcHRpb24nKTsgfVxyXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLndpZHRoICE9PSAnbnVtYmVyJykgeyB0aHJvdyBuZXcgRXJyb3IoJ3dpZHRoIG9wdGlvbiBpcyBtYW5kYXRvcnkgYW5kIGhhcyB0byBiZSBhIG51bWJlcicpOyB9XHJcbiAgICBpZiAob3B0aW9ucy5taW5IZWlnaHQgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygb3B0aW9ucy5taW5IZWlnaHQgIT09ICdudW1iZXInKSB7IHRocm93IG5ldyBFcnJvcignd2lkdGggb3B0aW9uIGlzIG1hbmRhdG9yeSBhbmQgaGFzIHRvIGJlIGEgbnVtYmVyJyk7IH1cclxuICAgIGlmIChvcHRpb25zLnBhZGRpbmcgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygb3B0aW9ucy5wYWRkaW5nICE9PSAnbnVtYmVyJykgeyB0aHJvdyBuZXcgRXJyb3IoJ3dpZHRoIG9wdGlvbiBpcyBtYW5kYXRvcnkgYW5kIGhhcyB0byBiZSBhIG51bWJlcicpOyB9XHJcblxyXG4gICAgdmFyIGNvbnRhaW5lciA9ICQoXy5oZWFkKCQob3B0aW9ucy5jb250YWluZXIpKSksXHJcbiAgICAgICAgYnVpbGRlcnMgPSBvcHRpb25zLmJ1aWxkZXJzLFxyXG4gICAgICAgIGNyZWF0ZUl0ZW1EcmFnZ2VyID0gb3B0aW9ucy5jcmVhdGVJdGVtRHJhZ2dlcixcclxuICAgICAgICB0ZW1wbGF0ZSA9ICQob3B0aW9ucy50ZW1wbGF0ZSksXHJcbiAgICAgICAgd2lkdGggPSBvcHRpb25zLndpZHRoLFxyXG4gICAgICAgIG1pbkhlaWdodCA9IG9wdGlvbnMubWluSGVpZ2h0IHx8IDUwLFxyXG4gICAgICAgIHBhZGRpbmcgPSBvcHRpb25zLnBhZGRpbmcgfHwgMDtcclxuXHJcbiAgICBpZiAocGFkZGluZyA8IDApIHsgdGhyb3cgbmV3IEVycm9yKCdwYWRkaW5nIGNhbm5vdCBiZSBsZXNzIHRoYW4gemVybycpOyB9XHJcbiAgICBpZiAod2lkdGggPCAyICogcGFkZGluZykgeyB0aHJvdyBuZXcgRXJyb3IoJ3dpZHRoIGNhbm5vdCBiZSBsZXNzIHRoYW4gemVybyAob3IgMiB0aW1lIHBhZGRpbmcpJyk7IH1cclxuICAgIGlmIChtaW5IZWlnaHQgPCAyICogcGFkZGluZykgeyB0aHJvdyBuZXcgRXJyb3IoJ21pbkhlaWdodCBjYW5ub3QgYmUgbGVzcyB0aGFuIHplcm8gKG9yIDIgdGltZSBwYWRkaW5nKScpOyB9XHJcblxyXG4gICAgXy5lYWNoKGJ1aWxkZXJzLCBmdW5jdGlvbiAoYnVpbGRlcikge1xyXG4gICAgICAgIHZhciBpdGVtID0gdGVtcGxhdGUuY2xvbmUoKTtcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kKGl0ZW0pO1xyXG4gICAgICAgIGlmICghaXRlbS5oYXNDbGFzcygnYWxtb3N0LXBsYWNlLWhvbGRlcicpKSB7XHJcbiAgICAgICAgICAgIGl0ZW0gPSBpdGVtLmZpbmQoJy5hbG1vc3QtcGxhY2UtaG9sZGVyJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNyZWF0ZUl0ZW1EcmFnZ2VyKHtlbDogaXRlbSwgY3JlYXRlRWxlbWVudHM6IGJ1aWxkZXIsIHdpZHRoOiB3aWR0aCwgbWluSGVpZ2h0OiBtaW5IZWlnaHQsIHBhZGRpbmc6IHBhZGRpbmd9KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnRzLkVsZW1lbnRzTWVudSA9IEVsZW1lbnRzTWVudTtcclxuIiwiLy8gQ29weXJpZ2h0IChjKSAyMDE2LCB0aGUgQUxNT3NUIHByb2plY3QgYXV0aG9ycy4gUGxlYXNlIHNlZSB0aGVcclxuLy8gQVVUSE9SUyBmaWxlIGZvciBkZXRhaWxzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpc1xyXG4vLyBnb3Zlcm5lZCBieSB0aGUgTUlUIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS5cclxuLypqc2xpbnQgbm9kZTogdHJ1ZSwgbm9tZW46IHRydWUgKi9cclxuXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKSxcclxuICAgICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCksXHJcbiAgICBqb2ludCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydqb2ludCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnam9pbnQnXSA6IG51bGwpLFxyXG4gICAgY3JlYXRlUmVzaXplUmVhY3RvciA9IHJlcXVpcmUoJy4vcmVzaXplcmVhY3RvcicpLlJlc2l6ZVJlYWN0b3I7XHJcblxyXG5mdW5jdGlvbiBFbWJlZGRpbmdSZWFjdG9yKG9wdGlvbnMpIHtcclxuICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBFbWJlZGRpbmdSZWFjdG9yKSkgeyByZXR1cm4gbmV3IEVtYmVkZGluZ1JlYWN0b3Iob3B0aW9ucyk7IH1cclxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG5cclxuICAgIGlmICghb3B0aW9ucy5wYXBlciB8fCB0eXBlb2Ygb3B0aW9ucy5wYXBlciAhPT0gJ29iamVjdCcgfHwgIShvcHRpb25zLnBhcGVyIGluc3RhbmNlb2Ygam9pbnQuZGlhLlBhcGVyKSkgeyB0aHJvdyBuZXcgRXJyb3IoJ3BhcGVyIG9wdGlvbiBpcyBtYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKCFvcHRpb25zLm1vZGVsIHx8IHR5cGVvZiBvcHRpb25zLm1vZGVsICE9PSAnb2JqZWN0JykgeyB0aHJvdyBuZXcgRXJyb3IoJ21vZGVsIG9wdGlvbiBpcyBtYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKCFvcHRpb25zLmlzVmFsaWRQYXJlbnQgfHwgdHlwZW9mIG9wdGlvbnMuaXNWYWxpZFBhcmVudCAhPT0gJ2Z1bmN0aW9uJykgeyB0aHJvdyBuZXcgRXJyb3IoJ2lzVmFsaWRQYXJlbnQgb3B0aW9uIGlzIG1hbmRhdG9yeScpOyB9XHJcbiAgICBpZiAoIW9wdGlvbnMudW5kb1JlYWN0b3IgfHwgdHlwZW9mIG9wdGlvbnMudW5kb1JlYWN0b3IgIT09ICdvYmplY3QnKSB7IHRocm93IG5ldyBFcnJvcigndW5kb1JlYWN0b3Igb3B0aW9uIGlzIG1hbmRhdG9yeScpOyB9XHJcblxyXG4gICAgdmFyIHBhcGVyID0gb3B0aW9ucy5wYXBlcixcclxuICAgICAgICBtb2RlbCA9IG9wdGlvbnMubW9kZWwsXHJcbiAgICAgICAgaXNWYWxpZFBhcmVudCA9IG9wdGlvbnMuaXNWYWxpZFBhcmVudCxcclxuICAgICAgICB1bmRvUmVhY3RvciA9IG9wdGlvbnMudW5kb1JlYWN0b3IsXHJcbiAgICAgICAgc3RhcnRQb3NpdGlvbjtcclxuXHJcbiAgICBwYXBlci5vbignY2VsbDpwb2ludGVyZG93bicsIGZ1bmN0aW9uIChjZWxsVmlldywgZXZ0LCB4LCB5KSB7XHJcbiAgICAgICAgXy5ub29wKGV2dCwgeCwgeSk7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBjZWxsVmlldy5tb2RlbDtcclxuXHJcbiAgICAgICAgaWYgKGVsZW1lbnQuaXNMaW5rKCkpIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgICAgIHN0YXJ0UG9zaXRpb24gPSBlbGVtZW50LnBvc2l0aW9uKCk7XHJcbiAgICAgICAgdW5kb1JlYWN0b3Iuc3RhcnQoKTtcclxuXHJcbiAgICAgICAgZWxlbWVudC50b0Zyb250KHtkZWVwOiB0cnVlfSk7XHJcblxyXG4gICAgICAgIG1vZGVsLnN0YXJ0QmF0Y2goJ3RvLWZyb250Jyk7XHJcbiAgICAgICAgXy5pbnZva2UobW9kZWwuZ2V0TGlua3MoKSwgJ3RvRnJvbnQnKTtcclxuICAgICAgICBtb2RlbC5zdG9wQmF0Y2goJ3RvLWZyb250Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRQYXJlbnQoY2VsbFZpZXcpIHtcclxuICAgICAgICB2YXIgZWxlbWVudCA9IGNlbGxWaWV3Lm1vZGVsLFxyXG4gICAgICAgICAgICBlbGVtZW50c0JlbG93ID0gbW9kZWwuZmluZE1vZGVsc0luQXJlYShlbGVtZW50LmdldEJCb3goe3VzZU1vZGVsR2VvbWV0cnk6IHRydWV9KSk7XHJcblxyXG4gICAgICAgIGlmIChlbGVtZW50c0JlbG93Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gXy5jaGFpbihlbGVtZW50c0JlbG93KVxyXG4gICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAocGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcGVyLmZpbmRWaWV3QnlNb2RlbChwYXJlbnQpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKHBhcmVudENlbGxWaWV3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzVmFsaWRQYXJlbnQoY2VsbFZpZXcsIHBhcmVudENlbGxWaWV3KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuc29ydEJ5KF8ubWV0aG9kKCdnZXQnLCAneicpKVxyXG4gICAgICAgICAgICAgICAgLmxhc3QoKVxyXG4gICAgICAgICAgICAgICAgLnZhbHVlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHBhcGVyLm9uKCdjZWxsOnBvaW50ZXJ1cCcsIGZ1bmN0aW9uIChjZWxsVmlldywgZXZ0LCB4LCB5KSB7XHJcbiAgICAgICAgXy5ub29wKGV2dCwgeCwgeSk7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBjZWxsVmlldy5tb2RlbCxcclxuICAgICAgICAgICAgbmV3UG9zaXRpb24sXHJcbiAgICAgICAgICAgIG9sZHBhcmVudCxcclxuICAgICAgICAgICAgbmV3cGFyZW50O1xyXG5cclxuICAgICAgICBpZiAoZWxlbWVudC5pc0xpbmsoKSkgeyByZXR1cm47IH1cclxuXHJcbiAgICAgICAgbmV3UG9zaXRpb24gPSBlbGVtZW50LnBvc2l0aW9uKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVuZCgpIHtcclxuICAgICAgICAgICAgdW5kb1JlYWN0b3Iuc3RvcCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWJvcnQoKSB7XHJcbiAgICAgICAgICAgIGlmICh1bmRvUmVhY3Rvci5zdG9wKCkpIHtcclxuICAgICAgICAgICAgICAgIG1vZGVsLnN0YXJ0QmF0Y2goJ3RvLWJhY2snKTtcclxuICAgICAgICAgICAgICAgIHVuZG9SZWFjdG9yLnVuZG8oZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgbW9kZWwuc3RvcEJhdGNoKCd0by1iYWNrJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChuZXdQb3NpdGlvbi54ID09PSBzdGFydFBvc2l0aW9uLnggJiYgbmV3UG9zaXRpb24ueSA9PT0gc3RhcnRQb3NpdGlvbi55KSB7XHJcbiAgICAgICAgICAgIGFib3J0KCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlcGFyZW50KCkge1xyXG4gICAgICAgICAgICBfLmVhY2goXHJcbiAgICAgICAgICAgICAgICBtb2RlbC5nZXRDb25uZWN0ZWRMaW5rcyhlbGVtZW50LCB7ZGVlcDogdHJ1ZX0pLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKGxpbmspIHsgbGluay5yZXBhcmVudCgpOyB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHVuZG9SZWFjdG9yLnN0b3AoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG5ld3BhcmVudCA9IGdldFBhcmVudChjZWxsVmlldyk7XHJcbiAgICAgICAgbmV3cGFyZW50ID0gbmV3cGFyZW50ICYmIG5ld3BhcmVudC5tb2RlbDtcclxuICAgICAgICBpZiAoIW5ld3BhcmVudCAmJiAhaXNWYWxpZFBhcmVudChjZWxsVmlldywgdW5kZWZpbmVkKSkge1xyXG4gICAgICAgICAgICBhYm9ydCgpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvbGRwYXJlbnQgPSBtb2RlbC5nZXRDZWxsKGVsZW1lbnQuZ2V0KCdwYXJlbnQnKSk7XHJcblxyXG4gICAgICAgIGlmIChuZXdwYXJlbnQpIHtcclxuICAgICAgICAgICAgaWYgKG9sZHBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgb2xkcGFyZW50LnVuZW1iZWQoZWxlbWVudCwge3JlcGFyZW50aW5nOiB0cnVlfSk7XHJcbiAgICAgICAgICAgICAgICBuZXdwYXJlbnQuZW1iZWQoZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICByZXBhcmVudCgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbmV3cGFyZW50LmVtYmVkKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgcmVwYXJlbnQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChvbGRwYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgIG9sZHBhcmVudC51bmVtYmVkKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgcmVwYXJlbnQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGVuZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgbW9kZWwub24oJ2FkZCcsIGZ1bmN0aW9uIChjZWxsKSB7XHJcbiAgICAgICAgaWYgKGNlbGwuaXNMaW5rKCkpIHsgcmV0dXJuIGNlbGwuZ2V0KCdwYXJlbnQnKSB8fCBjZWxsLnJlcGFyZW50KCk7IH1cclxuICAgICAgICB2YXIgZWxlbWVudCA9IGNlbGwsXHJcbiAgICAgICAgICAgIGNlbGxWaWV3ID0gcGFwZXIuZmluZFZpZXdCeU1vZGVsKGVsZW1lbnQpLFxyXG4gICAgICAgICAgICBwYXJlbnQ7XHJcbiAgICAgICAgaWYgKGVsZW1lbnQuZ2V0KCdwYXJlbnQnKSkge1xyXG4gICAgICAgICAgICBwYXJlbnQgPSBtb2RlbC5nZXRDZWxsKGVsZW1lbnQuZ2V0KCdwYXJlbnQnKSk7XHJcbiAgICAgICAgICAgIHBhcmVudC51bmVtYmVkKGVsZW1lbnQsIHtyZXBhcmVudGluZzogdHJ1ZX0pO1xyXG4gICAgICAgICAgICBwYXJlbnQuZW1iZWQoZWxlbWVudCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcGFyZW50ID0gZ2V0UGFyZW50KGNlbGxWaWV3KTtcclxuICAgICAgICBwYXJlbnQgPSBwYXJlbnQgJiYgcGFyZW50Lm1vZGVsO1xyXG4gICAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICAgICAgcGFyZW50LmVtYmVkKGVsZW1lbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghaXNWYWxpZFBhcmVudChjZWxsVmlldywgdW5kZWZpbmVkKSkge1xyXG4gICAgICAgICAgICAgICAgXy5kZWZlcihmdW5jdGlvbiAoKSB7IGVsZW1lbnQucmVtb3ZlKCk7IH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5zZXQoJ3BhcmVudCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydHMuRW1iZWRkaW5nUmVhY3RvciA9IEVtYmVkZGluZ1JlYWN0b3I7XHJcbiIsIi8vIENvcHlyaWdodCAoYykgMjAxNiwgdGhlIEFMTU9zVCBwcm9qZWN0IGF1dGhvcnMuIFBsZWFzZSBzZWUgdGhlXHJcbi8vIEFVVEhPUlMgZmlsZSBmb3IgZGV0YWlscy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXNcclxuLy8gZ292ZXJuZWQgYnkgdGhlIE1JVCBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuXHJcbi8qanNsaW50IG5vZGU6IHRydWUsIG5vbWVuOiB0cnVlICovXHJcblwidXNlIHN0cmljdFwiO1xyXG5cclxudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCksXHJcbiAgICAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpLFxyXG4gICAgYmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKSxcclxuICAgIGpvaW50ID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2pvaW50J10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydqb2ludCddIDogbnVsbCksXHJcbiAgICB3aW5kb3cgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snd2luZG93J10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWyd3aW5kb3cnXSA6IG51bGwpLFxyXG4gICAgY3JlYXRlTWFwID0gcmVxdWlyZSgnLi9tYXAnKS5NYXAsXHJcbiAgICBjcmVhdGVJdGVtRHJhZ2dlciA9IHJlcXVpcmUoJy4vaXRlbWRyYWdnZXInKS5JdGVtRHJhZ2dlcixcclxuICAgIGNyZWF0ZVBhblJlYWN0b3IgPSByZXF1aXJlKCcuL3BhbnJlYWN0b3InKS5QYW5SZWFjdG9yLFxyXG4gICAgY3JlYXRlWm9vbVJlYWN0b3IgPSByZXF1aXJlKCcuL3pvb21yZWFjdG9yJykuWm9vbVJlYWN0b3IsXHJcbiAgICBjcmVhdGVNYW5pcHVsYXRpb25SZWFjdG9yID0gcmVxdWlyZSgnLi9tYW5pcHVsYXRpb25yZWFjdG9yJykuTWFuaXB1bGF0aW9uUmVhY3RvcixcclxuICAgIGNyZWF0ZUVtYmVkZGluZ1JlYWN0b3IgPSByZXF1aXJlKCcuL2VtYmVkZGluZ3JlYWN0b3InKS5FbWJlZGRpbmdSZWFjdG9yLFxyXG4gICAgY3JlYXRlVW5kb1JlYWN0b3IgPSByZXF1aXJlKCcuL3VuZG9yZWFjdG9yJykuVW5kb1JlYWN0b3IsXHJcbiAgICBjcmVhdGVFbGVtZW50c01lbnUgPSByZXF1aXJlKCcuL2VsZW1lbnRzbWVudScpLkVsZW1lbnRzTWVudSxcclxuICAgIGxpbmtDb25uZWN0aW9uUG9pbnQgPSByZXF1aXJlKCcuL2xpbmtjb25uZWN0aW9ucG9pbnQnKS5saW5rQ29ubmVjdGlvblBvaW50LFxyXG4gICAgdmFsaWRhdGVDb25uZWN0aW9uID0gcmVxdWlyZSgnLi92YWxpZGF0ZWNvbm5lY3Rpb24nKS52YWxpZGF0ZUNvbm5lY3Rpb247XHJcblxyXG5mdW5jdGlvbiBkZWZhdWx0SXNWYWxpZFBhcmVudChjZWxsVmlldywgcGFyZW50Q2VsbFZpZXcpIHtcclxuICAgIGlmICghY2VsbFZpZXcpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoIXBhcmVudENlbGxWaWV3KSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY2VsbFZpZXcubW9kZWwuaWQgIT09IHBhcmVudENlbGxWaWV3Lm1vZGVsLmlkO1xyXG59XHJcblxyXG5mdW5jdGlvbiBCb2FyZChvcHRpb25zKSB7XHJcbiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgQm9hcmQpKSB7IHJldHVybiBuZXcgQm9hcmQob3B0aW9ucyk7IH1cclxuICAgIF8uZXh0ZW5kKHRoaXMsIGJhY2tib25lLkV2ZW50cyk7XHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuXHJcbiAgICBpZiAoIW9wdGlvbnMubW9kZWwgfHwgdHlwZW9mIG9wdGlvbnMubW9kZWwgIT09ICdvYmplY3QnKSB7IHRocm93IG5ldyBFcnJvcignbW9kZWwgb3B0aW9uIGlzIG1hbmRhdG9yeScpOyB9XHJcbiAgICBpZiAob3B0aW9ucy5hY3Rpb25zICYmICFBcnJheS5pc0FycmF5KG9wdGlvbnMuYWN0aW9ucykpIHsgdGhyb3cgbmV3IEVycm9yKCdhY3Rpb25zIG9wdGlvbiBzaG91bGQgYmUgYW4gQXJyYXknKTsgfVxyXG4gICAgaWYgKG9wdGlvbnMuZGVmYXVsdExpbmsgJiYgdHlwZW9mIG9wdGlvbnMuZGVmYXVsdExpbmsgIT09ICdmdW5jdGlvbicpIHsgdGhyb3cgbmV3IEVycm9yKCdkZWZhdWx0TGluayBvcHRpb24gbXVzdCBiZSBhIGZ1bmN0aW9uJyk7IH1cclxuICAgIGlmIChvcHRpb25zLmlzVmFsaWRQYXJlbnQgJiYgdHlwZW9mIG9wdGlvbnMuaXNWYWxpZFBhcmVudCAhPT0gJ2Z1bmN0aW9uJykgeyB0aHJvdyBuZXcgRXJyb3IoJ2lzVmFsaWRQYXJlbnQgb3B0aW9uIG11c3QgYmUgYSBmdW5jdGlvbicpOyB9XHJcbiAgICBpZiAoIW9wdGlvbnMuZWwpIHsgdGhyb3cgbmV3IEVycm9yKCdlbCBvcHRpb24gaXMgbWFuZGF0b3J5Jyk7IH1cclxuICAgIGlmICgkKG9wdGlvbnMuZWwpLmxlbmd0aCA9PT0gMCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgZWwgb3B0aW9uJyk7IH1cclxuXHJcbiAgICB2YXIgc2VsZiA9IHRoaXMsXHJcbiAgICAgICAgZWwgPSAkKCQob3B0aW9ucy5lbCkuYWRkQ2xhc3MoJ2FsbW9zdC1qb2ludC1wYXBlcicpWzBdKSxcclxuICAgICAgICBtb2RlbCA9IG9wdGlvbnMubW9kZWwsXHJcbiAgICAgICAgZ3JpZFNpemUgPSAxMCxcclxuICAgICAgICBkZWZhdWx0TGluayA9IG9wdGlvbnMuZGVmYXVsdExpbmsgfHwgXy5ub29wLFxyXG4gICAgICAgIGlzVmFsaWRQYXJlbnQgPSBvcHRpb25zLmlzVmFsaWRQYXJlbnQgfHwgZGVmYXVsdElzVmFsaWRQYXJlbnQsXHJcbiAgICAgICAgcGFwZXIgPSBuZXcgam9pbnQuZGlhLlBhcGVyKHtcclxuICAgICAgICAgICAgZWw6IGVsLFxyXG4gICAgICAgICAgICB3aWR0aDogZWwud2lkdGgoKSxcclxuICAgICAgICAgICAgaGVpZ2h0OiBlbC5oZWlnaHQoKSxcclxuICAgICAgICAgICAgbW9kZWw6IG1vZGVsLFxyXG4gICAgICAgICAgICBncmlkU2l6ZTogZ3JpZFNpemUsXHJcbiAgICAgICAgICAgIGRlZmF1bHRMaW5rOiBkZWZhdWx0TGluayxcclxuICAgICAgICAgICAgbXVsdGlMaW5rczogZmFsc2UsXHJcbiAgICAgICAgICAgIGxpbmtDb25uZWN0aW9uUG9pbnQ6IGxpbmtDb25uZWN0aW9uUG9pbnQsXHJcbiAgICAgICAgICAgIGxpbmtQaW5uaW5nOiBmYWxzZSxcclxuICAgICAgICAgICAgdmFsaWRhdGVDb25uZWN0aW9uOiB2YWxpZGF0ZUNvbm5lY3Rpb24sXHJcbiAgICAgICAgICAgIGludGVyYWN0aXZlOiAhb3B0aW9ucy5yZWFkb25seSxcclxuICAgICAgICB9KSxcclxuICAgICAgICBtYXAgPSBjcmVhdGVNYXAoe1xyXG4gICAgICAgICAgICBwYXBlcjogcGFwZXIsXHJcbiAgICAgICAgICAgIGVsOiBlbCxcclxuICAgICAgICAgICAgbW9kZWw6IG1vZGVsLFxyXG4gICAgICAgICAgICBsaW5rQ29ubmVjdGlvblBvaW50OiBsaW5rQ29ubmVjdGlvblBvaW50XHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgdW5kb1JlYWN0b3IgPSBjcmVhdGVVbmRvUmVhY3Rvcih7XHJcbiAgICAgICAgICAgIGVsOiBlbCxcclxuICAgICAgICAgICAgbW9kZWw6IG1vZGVsXHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgem9vbVJlYWN0b3IgPSBjcmVhdGVab29tUmVhY3Rvcih7XHJcbiAgICAgICAgICAgIHBhcGVyOiBwYXBlcixcclxuICAgICAgICAgICAgZWw6IGVsLFxyXG4gICAgICAgICAgICBtb2RlbDogbW9kZWwsXHJcbiAgICAgICAgICAgIG1pblNjYWxlOiBvcHRpb25zLm1pblNjYWxlIHx8IDAuMDEsXHJcbiAgICAgICAgICAgIG1heFNjYWxlOiBvcHRpb25zLm1heFNjYWxlIHx8IDJcclxuICAgICAgICB9KSxcclxuICAgICAgICBtYW5pcHVsYXRpb25SZWFjdG9yID0gY3JlYXRlTWFuaXB1bGF0aW9uUmVhY3Rvcih7XHJcbiAgICAgICAgICAgIHBhcGVyOiBwYXBlcixcclxuICAgICAgICAgICAgZWw6IGVsLFxyXG4gICAgICAgICAgICBtb2RlbDogbW9kZWwsXHJcbiAgICAgICAgICAgIGdyaWRTaXplOiBncmlkU2l6ZSxcclxuICAgICAgICAgICAgYWN0aW9uczogb3B0aW9ucy5hY3Rpb25zLFxyXG4gICAgICAgICAgICByZXNpemU6IG9wdGlvbnMucmVzaXplLFxyXG4gICAgICAgICAgICByb3RhdGU6IG9wdGlvbnMucm90YXRlLFxyXG4gICAgICAgICAgICBtYWduZXRpemU6IG9wdGlvbnMubWFnbmV0aXplLFxyXG4gICAgICAgICAgICB1bmRvUmVhY3RvcjogdW5kb1JlYWN0b3JcclxuICAgICAgICB9KSxcclxuICAgICAgICBlbWJlZGRpbmdSZWFjdG9yID0gY3JlYXRlRW1iZWRkaW5nUmVhY3Rvcih7XHJcbiAgICAgICAgICAgIHBhcGVyOiBwYXBlcixcclxuICAgICAgICAgICAgbW9kZWw6IG1vZGVsLFxyXG4gICAgICAgICAgICBpc1ZhbGlkUGFyZW50OiBpc1ZhbGlkUGFyZW50LFxyXG4gICAgICAgICAgICB1bmRvUmVhY3RvcjogdW5kb1JlYWN0b3JcclxuICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuICAgIF8ubm9vcChlbWJlZGRpbmdSZWFjdG9yKTtcclxuXHJcbiAgICBlbFswXS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgICAgaWYgKCQoZXZ0LnRhcmdldCkuaGFzQ2xhc3MoJ2FsbW9zdC1qb2ludC1uby1ncmlwJykpIHtcclxuICAgICAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICB2YXIgcCA9IHBhcGVyLnNuYXBUb0dyaWQoe3g6IGV2dC5jbGllbnRYLCB5OiBldnQuY2xpZW50WX0pO1xyXG4gICAgICAgICAgICBjcmVhdGVQYW5SZWFjdG9yKHtwYXBlcjogcGFwZXIsIGVsOiBlbCwgeDogcC54LCB5OiBwLnl9KTtcclxuICAgICAgICB9XHJcbiAgICB9LCB0cnVlKTtcclxuXHJcbiAgICBtYW5pcHVsYXRpb25SZWFjdG9yLm9uKCdhbGwnLCB0aGlzLnRyaWdnZXIsIHRoaXMpO1xyXG5cclxuICAgIHBhcGVyLm9uKCdhbGwnLCB0aGlzLnRyaWdnZXIsIHRoaXMpO1xyXG5cclxuICAgIHBhcGVyLm9uKCdibGFuazpwb2ludGVyZG93bicsIGZ1bmN0aW9uIChldnQsIHgsIHkpIHtcclxuICAgICAgICBfLm5vb3AoZXZ0KTtcclxuICAgICAgICBjcmVhdGVQYW5SZWFjdG9yKHtwYXBlcjogcGFwZXIsIGVsOiBlbCwgeDogeCwgeTogeX0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZnVuY3Rpb24gdXBkYXRlVmlld3BvcnQoKSB7XHJcbiAgICAgICAgdmFyIGxlZnQgPSBlbC5vZmZzZXQoKS5sZWZ0LFxyXG4gICAgICAgICAgICB0b3AgPSBlbC5vZmZzZXQoKS50b3AsXHJcbiAgICAgICAgICAgIHdpZHRoID0gZWwud2lkdGgoKSxcclxuICAgICAgICAgICAgaGVpZ2h0ID0gZWwuaGVpZ2h0KCksXHJcbiAgICAgICAgICAgIHRvcExlZnQgPSBqb2ludC5nLnBvaW50KGxlZnQsIHRvcCksXHJcbiAgICAgICAgICAgIGJvdHRvbVJpZ2h0ID0gam9pbnQuZy5wb2ludChsZWZ0ICsgd2lkdGgsIHRvcCArIGhlaWdodCksXHJcbiAgICAgICAgICAgIG1pbiA9IHBhcGVyLmNsaWVudFRvTG9jYWxQb2ludCh0b3BMZWZ0KSxcclxuICAgICAgICAgICAgbWF4ID0gcGFwZXIuY2xpZW50VG9Mb2NhbFBvaW50KGJvdHRvbVJpZ2h0KTtcclxuICAgICAgICBtYXAuc2V0Vmlld3BvcnQoe3g6IG1pbi54LCB5OiBtaW4ueSwgd2lkdGg6IG1heC54IC0gbWluLngsIGhlaWdodDogbWF4LnkgLSBtaW4ueX0pO1xyXG4gICAgfVxyXG5cclxuICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGVsLmNzcygnd2lkdGgnLCAnJykuY3NzKCdoZWlnaHQnLCAnJyk7XHJcbiAgICAgICAgcGFwZXIuc2V0RGltZW5zaW9ucyhlbC53aWR0aCgpLCBlbC5oZWlnaHQoKSk7XHJcbiAgICAgICAgdXBkYXRlVmlld3BvcnQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHBhcGVyLm9uKCd0cmFuc2xhdGUnLCB1cGRhdGVWaWV3cG9ydCk7XHJcbiAgICBwYXBlci5vbignc2NhbGUnLCB1cGRhdGVWaWV3cG9ydCk7XHJcbiAgICBtb2RlbC5vbmNlKCdhZGQnLCB1cGRhdGVWaWV3cG9ydCk7XHJcblxyXG4gICAgc2VsZi56b29tRSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB6b29tUmVhY3Rvci56b29tRSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBzZWxmLnBhcGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBwYXBlcjtcclxuICAgIH07XHJcblxyXG4gICAgc2VsZi5kb3dubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBtYXAuZG93bmxvYWQoKTtcclxuICAgIH07XHJcblxyXG4gICAgc2VsZi5jbGVhckhpc3RvcnkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdW5kb1JlYWN0b3IuY2xlYXIoKTtcclxuICAgIH07XHJcblxyXG4gICAgc2VsZi5zdGFydFVuZG9TZXF1ZW5jZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdW5kb1JlYWN0b3Iuc3RhcnQoKTtcclxuICAgIH07XHJcblxyXG4gICAgc2VsZi5zdG9wVW5kb1NlcXVlbmNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB1bmRvUmVhY3Rvci5zdG9wKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHNlbGYuY3JlYXRlSXRlbURyYWdnZXIgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG4gICAgICAgIHJldHVybiBjcmVhdGVJdGVtRHJhZ2dlcih7XHJcbiAgICAgICAgICAgIHBhcGVyOiBwYXBlcixcclxuICAgICAgICAgICAgZWw6IG9wdGlvbnMuZWwsXHJcbiAgICAgICAgICAgIG1vZGVsOiBtb2RlbCxcclxuICAgICAgICAgICAgZ3JpZFNpemU6IGdyaWRTaXplLFxyXG4gICAgICAgICAgICBjcmVhdGVFbGVtZW50czogb3B0aW9ucy5jcmVhdGVFbGVtZW50cyxcclxuICAgICAgICAgICAgd2lkdGg6IG9wdGlvbnMud2lkdGgsXHJcbiAgICAgICAgICAgIG1pbkhlaWdodDogb3B0aW9ucy5taW5IZWlnaHQsXHJcbiAgICAgICAgICAgIGxpbmtDb25uZWN0aW9uUG9pbnQ6IGxpbmtDb25uZWN0aW9uUG9pbnQsXHJcbiAgICAgICAgICAgIHVuZG9SZWFjdG9yOiB1bmRvUmVhY3RvclxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBzZWxmLmNyZWF0ZUVsZW1lbnRzTWVudSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcbiAgICAgICAgcmV0dXJuIGNyZWF0ZUVsZW1lbnRzTWVudSh7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lcjogb3B0aW9ucy5jb250YWluZXIsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiBvcHRpb25zLnRlbXBsYXRlLFxyXG4gICAgICAgICAgICBidWlsZGVyczogb3B0aW9ucy5idWlsZGVycyxcclxuICAgICAgICAgICAgY3JlYXRlSXRlbURyYWdnZXI6IHNlbGYuY3JlYXRlSXRlbURyYWdnZXIsXHJcbiAgICAgICAgICAgIHdpZHRoOiBvcHRpb25zLndpZHRoLFxyXG4gICAgICAgICAgICBtaW5IZWlnaHQ6IG9wdGlvbnMubWluSGVpZ2h0XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG59XHJcblxyXG5leHBvcnRzLkJvYXJkID0gQm9hcmQ7XHJcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2IGNsYXNzPVxcXCJhbG1vc3Qtam9pbnQtaXRlbS1kcmFnZ2VyXFxcIj48L2Rpdj5cXHJcXG5cIjtcbiIsIi8vIENvcHlyaWdodCAoYykgMjAxNiwgdGhlIEFMTU9zVCBwcm9qZWN0IGF1dGhvcnMuIFBsZWFzZSBzZWUgdGhlXHJcbi8vIEFVVEhPUlMgZmlsZSBmb3IgZGV0YWlscy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXNcclxuLy8gZ292ZXJuZWQgYnkgdGhlIE1JVCBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuXHJcbi8qanNsaW50IG5vZGU6IHRydWUsIG5vbWVuOiB0cnVlICovXHJcblwidXNlIHN0cmljdFwiO1xyXG5cclxudmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCksXHJcbiAgICBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpLFxyXG4gICAgYmFja2JvbmUgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snQmFja2JvbmUnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ0JhY2tib25lJ10gOiBudWxsKSxcclxuICAgIGpvaW50ID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2pvaW50J10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydqb2ludCddIDogbnVsbCksXHJcbiAgICBkb2N1bWVudCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydkb2N1bWVudCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnZG9jdW1lbnQnXSA6IG51bGwpO1xyXG5cclxuZnVuY3Rpb24gY2xvbmUobW9kZWwsIGl0ZW1zKSB7XHJcbiAgICB2YXIgbWFwcGluZyA9IG1vZGVsLmNsb25lQ2VsbHMoaXRlbXMpO1xyXG4gICAgcmV0dXJuIF8ubWFwKGl0ZW1zLCBmdW5jdGlvbiAoaSkgeyByZXR1cm4gbWFwcGluZ1tpLmlkXTsgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHdyYXBJdGVtcyhwYXBlciwgZWxlbWVudHMsIHNpemUsIG1pbkhlaWdodCwgZ3JpZFNpemUpIHtcclxuICAgIHZhciBiYm94ID0gXyhlbGVtZW50cykubWFwKGZ1bmN0aW9uIChjZWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXBlci5maW5kVmlld0J5TW9kZWwoY2VsbCkuZ2V0QkJveCgpO1xyXG4gICAgICAgIH0pLnJlZHVjZShmdW5jdGlvbiAobWVtbywgYmJveCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbWVtby51bmlvbihiYm94KTtcclxuICAgICAgICB9KSxcclxuICAgICAgICBtYXhzaXplID0gTWF0aC5tYXgoYmJveC53aWR0aCwgYmJveC5oZWlnaHQpICsgZ3JpZFNpemUgKiAyLFxyXG4gICAgICAgIHNjYWxlID0gTWF0aC5tYXgoMSwgbWF4c2l6ZSAvIHNpemUpLFxyXG4gICAgICAgIGFjdHVhbHdpZHRoID0gc2l6ZSAqIHNjYWxlLFxyXG4gICAgICAgIGFjdHVhbGhlaWdodCA9IE1hdGgubWF4KGJib3guaGVpZ2h0ICsgZ3JpZFNpemUgKiAyLCBtaW5IZWlnaHQgKiBzY2FsZSksXHJcbiAgICAgICAgbGVmdCA9IChhY3R1YWx3aWR0aCAtIGJib3gud2lkdGgpIC8gMixcclxuICAgICAgICB0b3AgPSAoYWN0dWFsaGVpZ2h0IC0gYmJveC5oZWlnaHQpIC8gMixcclxuICAgICAgICBwb3NpdGlvbiA9IGpvaW50LmcucG9pbnQoam9pbnQuZy5zbmFwVG9HcmlkKGJib3gueCAtIGxlZnQsIGdyaWRTaXplKSwgam9pbnQuZy5zbmFwVG9HcmlkKGJib3gueSAtIHRvcCwgZ3JpZFNpemUpKSxcclxuICAgICAgICBjb250YWluZXJJdGVtID0gbmV3IGpvaW50LnNoYXBlcy5iYXNpYy5SZWN0KHtcclxuICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxyXG4gICAgICAgICAgICBzaXplOiB7IHdpZHRoOiBhY3R1YWx3aWR0aCwgaGVpZ2h0OiBhY3R1YWxoZWlnaHR9LFxyXG4gICAgICAgICAgICBhdHRyczogeyByZWN0OiB7IGZpbGw6ICd0cmFuc3BhcmVudCcsIHN0cm9rZTogJ3RyYW5zcGFyZW50JyB9IH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gY29udGFpbmVySXRlbTtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVtb3ZlSGFuZGxlcnMocGFwZXIsIGl0ZW1zKSB7XHJcbiAgICBfLmVhY2goaXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgcGFwZXIuZmluZFZpZXdCeU1vZGVsKGl0ZW0pLiRlbC5jc3MoJ3BvaW50ZXItZXZlbnRzJywgJ25vbmUnKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBJdGVtRHJhZ2dlcihvcHRpb25zKSB7XHJcbiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgSXRlbURyYWdnZXIpKSB7IHJldHVybiBuZXcgSXRlbURyYWdnZXIob3B0aW9ucyk7IH1cclxuICAgIF8uZXh0ZW5kKHRoaXMsIGJhY2tib25lLkV2ZW50cyk7XHJcblxyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblxyXG4gICAgaWYgKCFvcHRpb25zLm1vZGVsIHx8IHR5cGVvZiBvcHRpb25zLm1vZGVsICE9PSAnb2JqZWN0JykgeyB0aHJvdyBuZXcgRXJyb3IoJ21vZGVsIG9wdGlvbiBpcyBtYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKCFvcHRpb25zLnBhcGVyIHx8IHR5cGVvZiBvcHRpb25zLnBhcGVyICE9PSAnb2JqZWN0JykgeyB0aHJvdyBuZXcgRXJyb3IoJ3BhcGVyIG9wdGlvbiBpcyBtYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKCFvcHRpb25zLmNyZWF0ZUVsZW1lbnRzIHx8IHR5cGVvZiBvcHRpb25zLmNyZWF0ZUVsZW1lbnRzICE9PSAnZnVuY3Rpb24nKSB7IHRocm93IG5ldyBFcnJvcignY3JlYXRlRWxlbWVudHMgb3B0aW9uIGlzIG1hbmRhdG9yeScpOyB9XHJcbiAgICBpZiAoIW9wdGlvbnMubGlua0Nvbm5lY3Rpb25Qb2ludCB8fCB0eXBlb2Ygb3B0aW9ucy5saW5rQ29ubmVjdGlvblBvaW50ICE9PSAnZnVuY3Rpb24nKSB7IHRocm93IG5ldyBFcnJvcignbGlua0Nvbm5lY3Rpb25Qb2ludCBvcHRpb24gaXMgbWFuZGF0b3J5Jyk7IH1cclxuICAgIGlmICghb3B0aW9ucy5lbCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2VsIG9wdGlvbiBpcyBtYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKCQob3B0aW9ucy5lbCkubGVuZ3RoID09PSAwKSB7IHRocm93IG5ldyBFcnJvcignaW52YWxpZCBlbCBvcHRpb25zJyk7IH1cclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5ncmlkU2l6ZSAhPT0gJ251bWJlcicpIHsgdGhyb3cgbmV3IEVycm9yKCdncmlkU2l6ZSBvcHRpb24gaXMgbWFuZGF0b3J5IGFuZCBoYXMgdG8gYmUgYSBudW1iZXInKTsgfVxyXG4gICAgaWYgKG9wdGlvbnMuZ3JpZFNpemUgPCAwKSB7IHRocm93IG5ldyBFcnJvcignZ3JpZFNpemUgY2Fubm90IGJlIGxlc3MgdGhhbiB6ZXJvJyk7IH1cclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy53aWR0aCAhPT0gJ251bWJlcicpIHsgdGhyb3cgbmV3IEVycm9yKCd3aWR0aCBvcHRpb24gaXMgbWFuZGF0b3J5IGFuZCBoYXMgdG8gYmUgYSBudW1iZXInKTsgfVxyXG4gICAgaWYgKG9wdGlvbnMud2lkdGggPCAwKSB7IHRocm93IG5ldyBFcnJvcignd2lkdGggY2Fubm90IGJlIGxlc3MgdGhhbiB6ZXJvJyk7IH1cclxuICAgIGlmIChvcHRpb25zLm1pbkhlaWdodCA8IDApIHsgdGhyb3cgbmV3IEVycm9yKCdtaW5IZWlnaHQgY2Fubm90IGJlIGxlc3MgdGhhbiB6ZXJvJyk7IH1cclxuICAgIGlmICghb3B0aW9ucy51bmRvUmVhY3RvciB8fCB0eXBlb2Ygb3B0aW9ucy51bmRvUmVhY3RvciAhPT0gJ29iamVjdCcpIHsgdGhyb3cgbmV3IEVycm9yKCdtb2RlbCBvcHRpb24gaXMgbWFuZGF0b3J5Jyk7IH1cclxuXHJcbiAgICB2YXIgc2VsZiA9IHRoaXMsXHJcbiAgICAgICAgZ3JpZFNpemUgPSBvcHRpb25zLmdyaWRTaXplLFxyXG4gICAgICAgIGNyZWF0ZUVsZW1lbnRzID0gb3B0aW9ucy5jcmVhdGVFbGVtZW50cyxcclxuICAgICAgICBsaW5rQ29ubmVjdGlvblBvaW50ID0gb3B0aW9ucy5saW5rQ29ubmVjdGlvblBvaW50LFxyXG4gICAgICAgIGVsID0gJCgkKG9wdGlvbnMuZWwpWzBdKSxcclxuICAgICAgICBwYXBlciA9IG9wdGlvbnMucGFwZXIsXHJcbiAgICAgICAgbW9kZWwgPSBvcHRpb25zLm1vZGVsLFxyXG4gICAgICAgIG1pbkhlaWdodCA9IG9wdGlvbnMubWluSGVpZ2h0LFxyXG4gICAgICAgIHBhcGVyV2lkdGggPSBvcHRpb25zLndpZHRoIC0gZ3JpZFNpemUgKiAyLFxyXG4gICAgICAgIHVuZG9SZWFjdG9yID0gb3B0aW9ucy51bmRvUmVhY3RvcixcclxuICAgICAgICBvdmVybGF5aXRlbXMgPSBjcmVhdGVFbGVtZW50cygpLFxyXG4gICAgICAgIG1haW5pdGVtLFxyXG4gICAgICAgIG1haW5wb3NpdGlvbixcclxuICAgICAgICBzaXplLFxyXG4gICAgICAgIHByZXZpZXcgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gJChyZXF1aXJlKCcuL2RyYWdnZXIuaHRtbCcpKTtcclxuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5KS5hcHBlbmQoY29udGFpbmVyKTtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcclxuICAgICAgICB9KCkpLFxyXG4gICAgICAgIGJhc2VTY2FsZSxcclxuICAgICAgICBwYXBlckhlaWdodCxcclxuICAgICAgICBvdmVybGF5bW9kZWwgPSBuZXcgam9pbnQuZGlhLkdyYXBoKCksXHJcbiAgICAgICAgb3ZlcmxheXBhcGVyID0gbmV3IGpvaW50LmRpYS5QYXBlcih7XHJcbiAgICAgICAgICAgIGVsOiBwcmV2aWV3LFxyXG4gICAgICAgICAgICB3aWR0aDogcGFwZXJXaWR0aCxcclxuICAgICAgICAgICAgbW9kZWw6IG92ZXJsYXltb2RlbCxcclxuICAgICAgICAgICAgbGlua0Nvbm5lY3Rpb25Qb2ludDogbGlua0Nvbm5lY3Rpb25Qb2ludCxcclxuICAgICAgICAgICAgZ3JpZFNpemU6IGdyaWRTaXplXHJcbiAgICAgICAgfSk7XHJcbiAgICAvL2FkZCBlbGVtZW50c1xyXG4gICAgb3ZlcmxheW1vZGVsLmFkZENlbGxzKG92ZXJsYXlpdGVtcyk7XHJcbiAgICAvL2NvbXB1dGUgYmJveFxyXG4gICAgbWFpbml0ZW0gPSB3cmFwSXRlbXMob3ZlcmxheXBhcGVyLCBvdmVybGF5aXRlbXMsIHBhcGVyV2lkdGgsIG1pbkhlaWdodCwgZ3JpZFNpemUpO1xyXG4gICAgb3ZlcmxheW1vZGVsLmFkZENlbGwobWFpbml0ZW0pO1xyXG4gICAgLy9yZXNpemUgcGFwZXJcclxuICAgIG1haW5wb3NpdGlvbiA9IG1haW5pdGVtLnBvc2l0aW9uKCk7XHJcbiAgICBzaXplID0gbWFpbml0ZW0uZ2V0KCdzaXplJyk7XHJcbiAgICBiYXNlU2NhbGUgPSBwYXBlcldpZHRoIC8gc2l6ZS53aWR0aDtcclxuICAgIHBhcGVySGVpZ2h0ID0gc2l6ZS5oZWlnaHQgKiBiYXNlU2NhbGU7XHJcbiAgICBvdmVybGF5cGFwZXIuc2NhbGUoYmFzZVNjYWxlLCBiYXNlU2NhbGUpO1xyXG4gICAgb3ZlcmxheXBhcGVyLnNldERpbWVuc2lvbnMocGFwZXJXaWR0aCwgcGFwZXJIZWlnaHQpO1xyXG4gICAgLy9mb3IgcmVuZGVyaW5nXHJcbiAgICBlbC5hcHBlbmQocHJldmlldyk7XHJcbiAgICAvL3JlbW92ZSBoYW5kbGVyc1xyXG4gICAgcmVtb3ZlSGFuZGxlcnMob3ZlcmxheXBhcGVyLCBvdmVybGF5aXRlbXMpO1xyXG4gICAgXy5lYWNoKG92ZXJsYXlpdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICBpZiAoaXRlbS5nZXQoJ3BhcmVudCcpKSB7IHJldHVybjsgfVxyXG4gICAgICAgIG1haW5pdGVtLmVtYmVkKGl0ZW0pO1xyXG4gICAgfSk7XHJcbiAgICBtYWluaXRlbS50cmFuc2xhdGUoLW1haW5wb3NpdGlvbi54LCAtbWFpbnBvc2l0aW9uLnkpO1xyXG5cclxuICAgIG92ZXJsYXlwYXBlci5vbignY2VsbDpwb2ludGVyZG93bicsIGZ1bmN0aW9uIChjZWxsVmlldywgZSwgeCwgeSkge1xyXG4gICAgICAgIF8ubm9vcChjZWxsVmlldyk7XHJcbiAgICAgICAgdmFyIG92ZXJsYXkgPSAkKHJlcXVpcmUoJy4vb3ZlcmxheS5odG1sJykpLFxyXG4gICAgICAgICAgICBjb250YWluZXIgPSAkKHBhcGVyLmVsKSxcclxuICAgICAgICAgICAgc3BhY2VyID0gJCgnPGRpdj48L2Rpdj4nKS5jc3MoJ2hlaWdodCcsIHByZXZpZXcuaGVpZ2h0KCkgKyAyICogZ3JpZFNpemUpLFxyXG4gICAgICAgICAgICBsZWZ0ID0gY29udGFpbmVyLm9mZnNldCgpLmxlZnQsXHJcbiAgICAgICAgICAgIHRvcCA9IGNvbnRhaW5lci5vZmZzZXQoKS50b3AsXHJcbiAgICAgICAgICAgIHdpZHRoID0gY29udGFpbmVyLndpZHRoKCksXHJcbiAgICAgICAgICAgIGhlaWdodCA9IGNvbnRhaW5lci5oZWlnaHQoKSxcclxuICAgICAgICAgICAgdG9wTGVmdCA9IGpvaW50LmcucG9pbnQobGVmdCwgdG9wKSxcclxuICAgICAgICAgICAgYm90dG9tUmlnaHQgPSBqb2ludC5nLnBvaW50KGxlZnQgKyB3aWR0aCwgdG9wICsgaGVpZ2h0KSxcclxuICAgICAgICAgICAgY3VycmVudCA9IGpvaW50LmcucG9pbnQoZS5jbGllbnRYLCBlLmNsaWVudFkpLFxyXG4gICAgICAgICAgICBtaW5Mb2NhbCA9IHBhcGVyLmNsaWVudFRvTG9jYWxQb2ludCh0b3BMZWZ0KSxcclxuICAgICAgICAgICAgbWF4TG9jYWwgPSBwYXBlci5jbGllbnRUb0xvY2FsUG9pbnQoYm90dG9tUmlnaHQpLFxyXG4gICAgICAgICAgICBzdGFydFBvaW50ID0gcGFwZXIuY2xpZW50VG9Mb2NhbFBvaW50KGN1cnJlbnQpLFxyXG4gICAgICAgICAgICBzY2FsZSA9IGpvaW50LmcucG9pbnQod2lkdGggLyAobWF4TG9jYWwueCAtIG1pbkxvY2FsLngpLCBoZWlnaHQgLyAobWF4TG9jYWwueSAtIG1pbkxvY2FsLnkpKSxcclxuICAgICAgICAgICAgc3RhcnRQb3NpdGlvbiA9IGpvaW50LmcucG9pbnQoam9pbnQuZy5zbmFwVG9HcmlkKHN0YXJ0UG9pbnQueCAtIHgsIGdyaWRTaXplKSwgam9pbnQuZy5zbmFwVG9HcmlkKHN0YXJ0UG9pbnQueSAtIHksIGdyaWRTaXplKSk7XHJcblxyXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmQob3ZlcmxheSk7XHJcbiAgICAgICAgb3ZlcmxheS5hcHBlbmQocHJldmlldyk7XHJcbiAgICAgICAgZWwuYXBwZW5kKHNwYWNlcik7XHJcblxyXG4gICAgICAgIG92ZXJsYXlwYXBlci5zZXREaW1lbnNpb25zKHdpZHRoLCBoZWlnaHQpO1xyXG4gICAgICAgIG92ZXJsYXlwYXBlci5zY2FsZShzY2FsZS54LCBzY2FsZS55KTtcclxuICAgICAgICBvdmVybGF5cGFwZXIuc2V0T3JpZ2luKC1taW5Mb2NhbC54ICogc2NhbGUueCwgLW1pbkxvY2FsLnkgKiBzY2FsZS55KTtcclxuICAgICAgICBtYWluaXRlbS50cmFuc2xhdGUoc3RhcnRQb3NpdGlvbi54LCBzdGFydFBvc2l0aW9uLnkpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBwb2ludGVybW92ZSgpIHtcclxuICAgICAgICAgICAgbWFpbml0ZW0udHJhbnNsYXRlKC1zdGFydFBvc2l0aW9uLngsIC1zdGFydFBvc2l0aW9uLnkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb3ZlcmxheXBhcGVyLm9uY2UoJ2NlbGw6cG9pbnRlcm1vdmUnLCBwb2ludGVybW92ZSk7XHJcblxyXG4gICAgICAgIG92ZXJsYXlwYXBlci5vbignY2VsbDpwb2ludGVydXAnLCBmdW5jdGlvbiBwb2ludGVydXAoY2VsbFZpZXcsIGUsIHgsIHkpIHtcclxuICAgICAgICAgICAgXy5ub29wKGNlbGxWaWV3LCBlKTtcclxuICAgICAgICAgICAgb3ZlcmxheXBhcGVyLm9mZignY2VsbDpwb2ludGVybW92ZScsIHBvaW50ZXJtb3ZlKTtcclxuICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gbWFpbml0ZW0ucG9zaXRpb24oKSxcclxuICAgICAgICAgICAgICAgIHBhcGVyQkJveCA9IGpvaW50LmcucmVjdCgwLCAwLCBwYXBlci5vcHRpb25zLndpZHRoLCBwYXBlci5vcHRpb25zLmhlaWdodCksXHJcbiAgICAgICAgICAgICAgICByZWxlYXNlUG9pbnQgPSBwYXBlci5sb2NhbFRvUGFwZXJQb2ludChwYXBlci5jbGllbnRUb0xvY2FsUG9pbnQob3ZlcmxheXBhcGVyLmxvY2FsVG9DbGllbnRQb2ludChqb2ludC5nLnBvaW50KHgsIHkpKSkpLFxyXG4gICAgICAgICAgICAgICAgaXRlbXMsXHJcbiAgICAgICAgICAgICAgICBvdmVybGF5dG9waXRlbXM7XHJcbiAgICAgICAgICAgIGlmIChwYXBlckJCb3guY29udGFpbnNQb2ludChyZWxlYXNlUG9pbnQpKSB7XHJcbiAgICAgICAgICAgICAgICBvdmVybGF5dG9waXRlbXMgPSBfLmZpbHRlcihvdmVybGF5aXRlbXMsIGZ1bmN0aW9uIChpKSB7IHJldHVybiBpLmdldCgncGFyZW50JykgPT09IG1haW5pdGVtLmlkOyB9KTtcclxuICAgICAgICAgICAgICAgIF8uZWFjaChvdmVybGF5dG9waXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7IG1haW5pdGVtLnVuZW1iZWQoaXRlbSk7IH0pO1xyXG4gICAgICAgICAgICAgICAgaXRlbXMgPSBjbG9uZShvdmVybGF5bW9kZWwsIG92ZXJsYXlpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICBfLmVhY2goaXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7IGl0ZW0udW5zZXQoJ3onKTsgfSk7XHJcbiAgICAgICAgICAgICAgICB1bmRvUmVhY3Rvci5zdGFydCgpO1xyXG4gICAgICAgICAgICAgICAgbW9kZWwuYWRkQ2VsbHMoaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgdW5kb1JlYWN0b3Iuc3RvcCgpO1xyXG4gICAgICAgICAgICAgICAgXy5lYWNoKG92ZXJsYXl0b3BpdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsgbWFpbml0ZW0uZW1iZWQoaXRlbSk7IH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNwYWNlci5yZW1vdmUoKTtcclxuICAgICAgICAgICAgZWwuYXBwZW5kKHByZXZpZXcpO1xyXG4gICAgICAgICAgICBvdmVybGF5LnJlbW92ZSgpO1xyXG5cclxuICAgICAgICAgICAgbWFpbml0ZW0udHJhbnNsYXRlKC1wb3NpdGlvbi54LCAtcG9zaXRpb24ueSk7XHJcbiAgICAgICAgICAgIG92ZXJsYXlwYXBlci5zZXREaW1lbnNpb25zKHBhcGVyV2lkdGgsIHBhcGVySGVpZ2h0KTtcclxuICAgICAgICAgICAgb3ZlcmxheXBhcGVyLnNjYWxlKGJhc2VTY2FsZSwgYmFzZVNjYWxlKTtcclxuICAgICAgICAgICAgb3ZlcmxheXBhcGVyLnNldE9yaWdpbigwLCAwKTtcclxuXHJcbiAgICAgICAgICAgIG92ZXJsYXlwYXBlci5vZmYoJ2NlbGw6cG9pbnRlcnVwJywgcG9pbnRlcnVwKTtcclxuICAgICAgICAgICAgc2VsZi50cmlnZ2VyKCdkcmFnOmVuZCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzZWxmLnRyaWdnZXIoJ2RyYWc6c3RhcnQnKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5JdGVtRHJhZ2dlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEl0ZW1EcmFnZ2VyLnByb3RvdHlwZSk7XHJcblxyXG5leHBvcnRzLkl0ZW1EcmFnZ2VyID0gSXRlbURyYWdnZXI7XHJcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2IGNsYXNzPVxcXCJhbG1vc3Qtam9pbi1pdGVtLWRyYWdnZXItb3ZlcmxheVxcXCI+PC9kaXY+XFxyXFxuXCI7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPHN2Z1xcclxcbiAgIHhtbG5zOmRjPVxcXCJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xL1xcXCJcXHJcXG4gICB4bWxuczpjYz1cXFwiaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjXFxcIlxcclxcbiAgIHhtbG5zOnJkZj1cXFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zI1xcXCJcXHJcXG4gICB4bWxuczpzdmc9XFxcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXFxcIlxcclxcbiAgIHhtbG5zPVxcXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1xcXCJcXHJcXG4gICB4bWw6c3BhY2U9XFxcInByZXNlcnZlXFxcIlxcclxcbiAgIHZpZXdCb3g9XFxcIjAgMCA0NC4yMzYgNDQuMjM2XFxcIlxcclxcbiAgIGhlaWdodD1cXFwiNDQuMjM2XFxcIlxcclxcbiAgIHdpZHRoPVxcXCI0NC4yMzZcXFwiXFxyXFxuICAgeT1cXFwiMHB4XFxcIlxcclxcbiAgIHg9XFxcIjBweFxcXCJcXHJcXG4gICBpZD1cXFwiQ2FwYV8xXFxcIlxcclxcbiAgIHZlcnNpb249XFxcIjEuMVxcXCI+PG1ldGFkYXRhXFxyXFxuICAgICBpZD1cXFwibWV0YWRhdGE1M1xcXCI+PHJkZjpSREY+PGNjOldvcmtcXHJcXG4gICAgICAgICByZGY6YWJvdXQ9XFxcIlxcXCI+PGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+PGRjOnR5cGVcXHJcXG4gICAgICAgICAgIHJkZjpyZXNvdXJjZT1cXFwiaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2VcXFwiIC8+PGRjOnRpdGxlPjwvZGM6dGl0bGU+PC9jYzpXb3JrPjwvcmRmOlJERj48L21ldGFkYXRhPjxkZWZzXFxyXFxuICAgICBpZD1cXFwiZGVmczUxXFxcIiAvPjxjaXJjbGVcXHJcXG4gICAgIHI9XFxcIjIyLjExOFxcXCJcXHJcXG4gICAgIGN5PVxcXCIyMi4xMThcXFwiXFxyXFxuICAgICBjeD1cXFwiMjIuMTE4XFxcIlxcclxcbiAgICAgaWQ9XFxcInBhdGg0MTgxXFxcIlxcclxcbiAgICAgc3R5bGU9XFxcImNvbG9yOiMwMDAwMDA7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTt2aXNpYmlsaXR5OnZpc2libGU7ZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjQwMDAwMDAxO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxO21hcmtlcjpub25lO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGVcXFwiIC8+PHBhdGhcXHJcXG4gICAgIGlkPVxcXCJwYXRoN1xcXCJcXHJcXG4gICAgIGQ9XFxcIk0gMjIuMTE4LDQ0LjIzNiBDIDkuOTIyLDQ0LjIzNiAwLDM0LjMxNCAwLDIyLjExOSAwLDkuOTIzIDkuOTIyLDAgMjIuMTE4LDAgYyAxMi4xOTYsMCAyMi4xMTgsOS45MjMgMjIuMTE4LDIyLjExOSAwLDEyLjE5NSAtOS45MjIsMjIuMTE3IC0yMi4xMTgsMjIuMTE3IHogbSAwLC00Mi43MzYgQyAxMC43NSwxLjUgMS41LDEwLjc1IDEuNSwyMi4xMTkgYyAwLDExLjM2OSA5LjI1LDIwLjYxNyAyMC42MTgsMjAuNjE3IDExLjM2OCwwIDIwLjYxOCwtOS4yNDggMjAuNjE4LC0yMC42MTcgQyA0Mi43MzYsMTAuNzUgMzMuNDg2LDEuNSAyMi4xMTgsMS41IFpcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnMTlcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnMjFcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnMjNcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnMjVcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnMjdcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnMjlcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnMzFcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnMzNcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnMzVcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnMzdcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnMzlcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnNDFcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnNDNcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnNDVcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnNDdcXFwiIC8+PGdcXHJcXG4gICAgIGlkPVxcXCJnM1xcXCJcXHJcXG4gICAgIHRyYW5zZm9ybT1cXFwibWF0cml4KDAuMDc4OTA4NjMsLTAuMDc4OTA4NjMsMC4wNzg5MDg2MywwLjA3ODkwODYzLDAuOTA0NzYxMDcsMjIuMTE4MTI0KVxcXCI+PHBhdGhcXHJcXG4gICAgICAgaWQ9XFxcInBhdGg1XFxcIlxcclxcbiAgICAgICBkPVxcXCJtIDI2NS4xNzEsMTI1LjU3NyAtODAsLTgwIGMgLTQuODgxLC00Ljg4MSAtMTIuNzk3LC00Ljg4MSAtMTcuNjc4LDAgLTQuODgyLDQuODgyIC00Ljg4MiwxMi43OTYgMCwxNy42NzggbCA1OC42NjEsNTguNjYxIC0yMTMuNjU0LDAgYyAtNi45MDMsMCAtMTIuNSw1LjU5NyAtMTIuNSwxMi41IDAsNi45MDIgNS41OTcsMTIuNSAxMi41LDEyLjUgbCAyMTMuNjU0LDAgLTU4LjY1OSw1OC42NjEgYyAtNC44ODIsNC44ODIgLTQuODgyLDEyLjc5NiAwLDE3LjY3OCAyLjQ0LDIuNDM5IDUuNjQsMy42NjEgOC44MzksMy42NjEgMy4xOTksMCA2LjM5OCwtMS4yMjIgOC44MzksLTMuNjYxIGwgNzkuOTk4LC04MCBjIDQuODgyLC00Ljg4MiA0Ljg4MiwtMTIuNzk2IDAsLTE3LjY3OCB6XFxcIiAvPjwvZz48L3N2Zz5cXHJcXG5cIjtcbiIsIi8vIENvcHlyaWdodCAoYykgMjAxNiwgdGhlIEFMTU9zVCBwcm9qZWN0IGF1dGhvcnMuIFBsZWFzZSBzZWUgdGhlXHJcbi8vIEFVVEhPUlMgZmlsZSBmb3IgZGV0YWlscy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXNcclxuLy8gZ292ZXJuZWQgYnkgdGhlIE1JVCBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuXHJcbi8qanNsaW50IG5vZGU6IHRydWUsIG5vbWVuOiB0cnVlICovXHJcblwidXNlIHN0cmljdFwiO1xyXG5cclxudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCksXHJcbiAgICBqb2ludCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydqb2ludCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnam9pbnQnXSA6IG51bGwpO1xyXG5cclxudmFyIGFsbEJvcmRlcnMgPSB7dG9wOiB0cnVlLCBsZWZ0OiB0cnVlLCBib3R0b206IHRydWUsIHJpZ2h0OiB0cnVlfTtcclxuXHJcbmZ1bmN0aW9uIGZpeEJvcmRlcnMoYm9yZGVycykge1xyXG4gICAgaWYgKCFib3JkZXJzKSB7IHJldHVybiBhbGxCb3JkZXJzOyB9XHJcbiAgICBpZiAoYm9yZGVycy50b3AgfHwgYm9yZGVycy5sZWZ0IHx8IGJvcmRlcnMuYm90dG9tIHx8IGJvcmRlcnMucmlnaHQpIHsgcmV0dXJuIGJvcmRlcnM7IH1cclxuICAgIHJldHVybiBhbGxCb3JkZXJzO1xyXG59XHJcblxyXG5mdW5jdGlvbiBuZWFyZXN0UG9pbnRPbkJvcmRlcihtZSwgb3RoZXIsIGJvcmRlcnMpIHtcclxuICAgIGJvcmRlcnMgPSBmaXhCb3JkZXJzKGJvcmRlcnMpO1xyXG4gICAgdmFyIGxlZnQgPSAgIGJvcmRlcnMubGVmdCAgID8gTWF0aC5hYnMobWUub3JpZ2luKCkueCAtIG90aGVyLm9yaWdpbigpLngpIDogSW5maW5pdHksXHJcbiAgICAgICAgdG9wID0gICAgYm9yZGVycy50b3AgICAgPyBNYXRoLmFicyhtZS5vcmlnaW4oKS55IC0gb3RoZXIub3JpZ2luKCkueSkgOiBJbmZpbml0eSxcclxuICAgICAgICByaWdodCA9ICBib3JkZXJzLnJpZ2h0ICA/IE1hdGguYWJzKG1lLmNvcm5lcigpLnggLSBvdGhlci5jb3JuZXIoKS54KSA6IEluZmluaXR5LFxyXG4gICAgICAgIGJvdHRvbSA9IGJvcmRlcnMuYm90dG9tID8gTWF0aC5hYnMobWUuY29ybmVyKCkueSAtIG90aGVyLmNvcm5lcigpLnkpIDogSW5maW5pdHksXHJcbiAgICAgICAgbWluID0gTWF0aC5taW4obGVmdCwgdG9wLCByaWdodCwgYm90dG9tKSxcclxuICAgICAgICBjZW50ZXIgPSBtZS5jb250YWluc1JlY3Qob3RoZXIpID8gb3RoZXIuY2VudGVyKCkgOiBtZS5jZW50ZXIoKTtcclxuICAgIGlmIChtaW4gPT09IHRvcCkgeyAgICByZXR1cm4gam9pbnQuZy5wb2ludChjZW50ZXIueCwgICAgICBtZS5vcmlnaW4oKS55KTsgfVxyXG4gICAgaWYgKG1pbiA9PT0gbGVmdCkgeyAgIHJldHVybiBqb2ludC5nLnBvaW50KG1lLm9yaWdpbigpLngsIGNlbnRlci55KTsgfVxyXG4gICAgaWYgKG1pbiA9PT0gYm90dG9tKSB7IHJldHVybiBqb2ludC5nLnBvaW50KGNlbnRlci54LCAgICAgIG1lLmNvcm5lcigpLnkpOyB9XHJcbiAgICByZXR1cm4gam9pbnQuZy5wb2ludChtZS5jb3JuZXIoKS54LCBjZW50ZXIueSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBlcnBlbmRpY3VsYXIobWUsIG90aGVyKSB7XHJcbiAgICBpZiAobWUuaW50ZXJzZWN0KG90aGVyKSkgeyByZXR1cm4gZmFsc2U7IH1cclxuICAgIHZhciBtaW5YID0gTWF0aC5tYXgobWUub3JpZ2luKCkueCwgb3RoZXIub3JpZ2luKCkueCksXHJcbiAgICAgICAgbWF4WCA9IE1hdGgubWluKG1lLmNvcm5lcigpLngsIG90aGVyLmNvcm5lcigpLngpLFxyXG4gICAgICAgIG1pblkgPSBNYXRoLm1heChtZS5vcmlnaW4oKS55LCBvdGhlci5vcmlnaW4oKS55KSxcclxuICAgICAgICBtYXhZID0gTWF0aC5taW4obWUuY29ybmVyKCkueSwgb3RoZXIuY29ybmVyKCkueSk7XHJcbiAgICBpZiAobWluWCA8PSBtYXhYKSB7XHJcbiAgICAgICAgcmV0dXJuIG1lLnBvaW50TmVhcmVzdFRvUG9pbnQoam9pbnQuZy5wb2ludCgobWluWCArIG1heFgpIC8gMiwgb3RoZXIuY2VudGVyKCkueSkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG1pblkgPD0gbWF4WSkge1xyXG4gICAgICAgIHJldHVybiBtZS5wb2ludE5lYXJlc3RUb1BvaW50KGpvaW50LmcucG9pbnQob3RoZXIuY2VudGVyKCkueCwgKG1pblkgKyBtYXhZKSAvIDIpKTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxufVxyXG5cclxuZnVuY3Rpb24gZml4UG9pbnRCeUFuZ2xlKGJib3gsIGFuZ2xlLCBwb2ludCkge1xyXG4gICAgaWYgKCFwb2ludCkgeyByZXR1cm47IH1cclxuICAgIGFuZ2xlID0gam9pbnQuZy5ub3JtYWxpemVBbmdsZShhbmdsZSk7XHJcbiAgICBpZiAoYW5nbGUgJSA5MCA9PT0gMCkgeyByZXR1cm4gcG9pbnQ7IH1cclxuICAgIHZhciByYmJveCA9IGJib3guYmJveChhbmdsZSksXHJcbiAgICAgICAgY2VudGVyID0gYmJveC5jZW50ZXIoKSxcclxuICAgICAgICByb3JpZ2luID0gYmJveC5vcmlnaW4oKS5yb3RhdGUoY2VudGVyLCBhbmdsZSksXHJcbiAgICAgICAgcnRvcFJpZ2h0ID0gYmJveC50b3BSaWdodCgpLnJvdGF0ZShjZW50ZXIsIGFuZ2xlKSxcclxuICAgICAgICByY29ybmVyID0gYmJveC5jb3JuZXIoKS5yb3RhdGUoY2VudGVyLCBhbmdsZSksXHJcbiAgICAgICAgcmJvdHRvbUxlZnQgPSBiYm94LmJvdHRvbUxlZnQoKS5yb3RhdGUoY2VudGVyLCBhbmdsZSksXHJcbiAgICAgICAgbGVmdExpbmUgPSBqb2ludC5nLmxpbmUocm9yaWdpbiwgcmJvdHRvbUxlZnQpLFxyXG4gICAgICAgIHRvcExpbmUgPSBqb2ludC5nLmxpbmUocnRvcFJpZ2h0LCByb3JpZ2luKSxcclxuICAgICAgICBib3R0b210TGluZSA9IGpvaW50LmcubGluZShyY29ybmVyLCByYm90dG9tTGVmdCksXHJcbiAgICAgICAgcmlnaHRMaW5lID0gam9pbnQuZy5saW5lKHJ0b3BSaWdodCwgcmNvcm5lciksXHJcbiAgICAgICAgaW50ZXJzZWN0aW9uTGluZTtcclxuICAgIHN3aXRjaCAocmJib3guc2lkZU5lYXJlc3RUb1BvaW50KHBvaW50KSkge1xyXG4gICAgY2FzZSBcInRvcFwiOlxyXG4gICAgICAgIGludGVyc2VjdGlvbkxpbmUgPSBqb2ludC5nLmxpbmUocG9pbnQsIGpvaW50LmcucG9pbnQocG9pbnQueCwgcmJib3guY29ybmVyKCkueSkpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSBcImxlZnRcIjpcclxuICAgICAgICBpbnRlcnNlY3Rpb25MaW5lID0gam9pbnQuZy5saW5lKHBvaW50LCBqb2ludC5nLnBvaW50KHJiYm94Lm9yaWdpbigpLngsIHBvaW50LnkpKTtcclxuICAgICAgICBicmVhaztcclxuICAgIGNhc2UgXCJyaWdodFwiOlxyXG4gICAgICAgIGludGVyc2VjdGlvbkxpbmUgPSBqb2ludC5nLmxpbmUocG9pbnQsIGpvaW50LmcucG9pbnQocmJib3guY29ybmVyKCkueCwgcG9pbnQueSkpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSBcImJvdHRvbVwiOlxyXG4gICAgICAgIGludGVyc2VjdGlvbkxpbmUgPSBqb2ludC5nLmxpbmUocG9pbnQsIGpvaW50LmcucG9pbnQocG9pbnQueCwgcmJib3gub3JpZ2luKCkueSkpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF8uY2hhaW4oW2xlZnRMaW5lLCB0b3BMaW5lLCBib3R0b210TGluZSwgcmlnaHRMaW5lXSlcclxuICAgICAgICAubWFwKF8uYmluZChpbnRlcnNlY3Rpb25MaW5lLmludGVyc2VjdGlvbiwgaW50ZXJzZWN0aW9uTGluZSkpXHJcbiAgICAgICAgLnJlZHVjZShmdW5jdGlvbiAocHJldmlvdXNWYWx1ZSwgY3VycmVudFZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmICghY3VycmVudFZhbHVlKSB7IHJldHVybiBwcmV2aW91c1ZhbHVlOyB9XHJcbiAgICAgICAgICAgIGlmICghcHJldmlvdXNWYWx1ZSkgeyByZXR1cm4gY3VycmVudFZhbHVlOyB9XHJcbiAgICAgICAgICAgIGlmIChwb2ludC5kaXN0YW5jZShwcmV2aW91c1ZhbHVlKSA+IHBvaW50LmRpc3RhbmNlKGN1cnJlbnRWYWx1ZSkpIHsgcmV0dXJuIGN1cnJlbnRWYWx1ZTsgfVxyXG4gICAgICAgICAgICByZXR1cm4gcHJldmlvdXNWYWx1ZTtcclxuICAgICAgICB9KS52YWx1ZSgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBsaW5rQ29ubmVjdGlvblBvaW50KGxpbmtWaWV3LCB2aWV3LCBtYWduZXQsIHJlZmVyZW5jZSkge1xyXG4gICAgdmFyIGVsZW1lbnQgPSB2aWV3Lm1vZGVsLFxyXG4gICAgICAgIGRUYXJnZXRCb3JkZXJzLFxyXG4gICAgICAgIGRUYXJnZXRBbmdsZSA9IDAsXHJcbiAgICAgICAgZFRhcmdldEJCb3ggPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgbGluayA9IGxpbmtWaWV3Lm1vZGVsLFxyXG4gICAgICAgICAgICAgICAgb3RoZXIsXHJcbiAgICAgICAgICAgICAgICB2ZXJ0aWNlcyA9IGxpbmsuZ2V0KCd2ZXJ0aWNlcycpLFxyXG4gICAgICAgICAgICAgICAgc291cmNlID0gbGluay5nZXQoJ3NvdXJjZScpLmlkLFxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gbGluay5nZXQoJ3RhcmdldCcpLmlkO1xyXG4gICAgICAgICAgICBpZiAoc291cmNlID09PSBlbGVtZW50LmlkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmVydGljZXMgJiYgdmVydGljZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBqb2ludC5nLnJlY3QodmVydGljZXNbMF0ueCwgdmVydGljZXNbMF0ueSwgMCwgMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3RoZXIgPSBsaW5rLmdldFRhcmdldEVsZW1lbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICBkVGFyZ2V0QW5nbGUgPSBvdGhlci5nZXQoJ2FuZ2xlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZFRhcmdldEJvcmRlcnMgPSBvdGhlci5nZXQoJ2JvcmRlcnMnKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3RoZXIuZ2V0QkJveCh7dXNlTW9kZWxHZW9tZXRyeTogdHJ1ZX0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZlcnRpY2VzICYmIHZlcnRpY2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gam9pbnQuZy5yZWN0KHZlcnRpY2VzW3ZlcnRpY2VzLmxlbmd0aCAtIDFdLngsIHZlcnRpY2VzW3ZlcnRpY2VzLmxlbmd0aCAtIDFdLnksIDAsIDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG90aGVyID0gbGluay5nZXRTb3VyY2VFbGVtZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZFRhcmdldEFuZ2xlID0gb3RoZXIuZ2V0KCdhbmdsZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRUYXJnZXRCb3JkZXJzID0gb3RoZXIuZ2V0KCdib3JkZXJzJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG90aGVyLmdldEJCb3goe3VzZU1vZGVsR2VvbWV0cnk6IHRydWV9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gam9pbnQuZy5yZWN0KHJlZmVyZW5jZS54LCByZWZlcmVuY2UueSwgMCwgMCk7XHJcbiAgICAgICAgfSgpKTtcclxuICAgIGZ1bmN0aW9uIGRlZmF1bHRDb25uZWN0aW9uUG9pbnQoYmJveCwgdGFyZ2V0QkJveCwgYW5nbGUsIHRhcmdldEFuZ2xlKSB7XHJcbiAgICAgICAgdGFyZ2V0QkJveCA9IHRhcmdldEJCb3ggfHwgZFRhcmdldEJCb3g7XHJcbiAgICAgICAgdGFyZ2V0QW5nbGUgPSB0YXJnZXRBbmdsZSB8fCBkVGFyZ2V0QW5nbGU7XHJcbiAgICAgICAgYW5nbGUgPSBhbmdsZSB8fCBlbGVtZW50LmdldCgnYW5nbGUnKTtcclxuICAgICAgICBiYm94ID0gYmJveCB8fCBlbGVtZW50LmdldEJCb3goe3VzZU1vZGVsR2VvbWV0cnk6IHRydWV9KTtcclxuICAgICAgICB2YXIgcmJib3ggPSBiYm94LmJib3goYW5nbGUpLFxyXG4gICAgICAgICAgICByVGFyZ2V0QkJveCA9IHRhcmdldEJCb3g7XHJcbiAgICAgICAgaWYgKHJiYm94LmNvbnRhaW5zUmVjdChyVGFyZ2V0QkJveCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZpeFBvaW50QnlBbmdsZShiYm94LCBhbmdsZSwgbmVhcmVzdFBvaW50T25Cb3JkZXIocmJib3gsIHJUYXJnZXRCQm94LCBkVGFyZ2V0Qm9yZGVycykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoclRhcmdldEJCb3guY29udGFpbnNSZWN0KHJiYm94KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZml4UG9pbnRCeUFuZ2xlKGJib3gsIGFuZ2xlLCBuZWFyZXN0UG9pbnRPbkJvcmRlcihyYmJveCwgclRhcmdldEJCb3gsIGVsZW1lbnQuZ2V0KCdib3JkZXJzJykpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZpeFBvaW50QnlBbmdsZShiYm94LCBhbmdsZSwgcGVycGVuZGljdWxhcihyYmJveCwgclRhcmdldEJCb3gpKSB8fFxyXG4gICAgICAgICAgICAgICAgYmJveC5pbnRlcnNlY3Rpb25XaXRoTGluZUZyb21DZW50ZXJUb1BvaW50KHRhcmdldEJCb3guY2VudGVyKCksIGFuZ2xlKSB8fFxyXG4gICAgICAgICAgICAgICAgZml4UG9pbnRCeUFuZ2xlKGJib3gsIGFuZ2xlLCByYmJveC5wb2ludE5lYXJlc3RUb1BvaW50KHRhcmdldEJCb3guY2VudGVyKCkpKTtcclxuICAgIH1cclxuICAgIGlmICh2aWV3Lm1vZGVsLmxpbmtDb25uZWN0aW9uUG9pbnQpIHtcclxuICAgICAgICByZXR1cm4gdmlldy5tb2RlbC5saW5rQ29ubmVjdGlvblBvaW50KGxpbmtWaWV3LCB2aWV3LCBtYWduZXQsIHJlZmVyZW5jZSwgZFRhcmdldEJCb3gsIGRUYXJnZXRBbmdsZSwgZGVmYXVsdENvbm5lY3Rpb25Qb2ludCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGVmYXVsdENvbm5lY3Rpb25Qb2ludCgpO1xyXG59XHJcblxyXG5leHBvcnRzLmxpbmtDb25uZWN0aW9uUG9pbnQgPSBsaW5rQ29ubmVjdGlvblBvaW50O1xyXG4iLCIvLyBDb3B5cmlnaHQgKGMpIDIwMTYsIHRoZSBBTE1Pc1QgcHJvamVjdCBhdXRob3JzLiBQbGVhc2Ugc2VlIHRoZVxyXG4vLyBBVVRIT1JTIGZpbGUgZm9yIGRldGFpbHMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzXHJcbi8vIGdvdmVybmVkIGJ5IHRoZSBNSVQgbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLlxyXG4vKmpzbGludCBub2RlOiB0cnVlLCBub21lbjogdHJ1ZSAqL1xyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpLFxyXG4gICAgJCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WyckJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWyckJ10gOiBudWxsKSxcclxuICAgIGJhY2tib25lID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ0JhY2tib25lJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydCYWNrYm9uZSddIDogbnVsbCksXHJcbiAgICBqb2ludCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydqb2ludCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnam9pbnQnXSA6IG51bGwpLFxyXG4gICAgbW91c2V0cmFwID0gcmVxdWlyZSgnbW91c2V0cmFwJyksXHJcbiAgICBuYXZpZ2F0b3IgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snbmF2aWdhdG9yJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWyduYXZpZ2F0b3InXSA6IG51bGwpLFxyXG4gICAgY3JlYXRlUmVzaXplUmVhY3RvciA9IHJlcXVpcmUoJy4vcmVzaXplcmVhY3RvcicpLlJlc2l6ZVJlYWN0b3IsXHJcbiAgICBjcmVhdGVSb3RhdGVSZWFjdG9yID0gcmVxdWlyZSgnLi9yb3RhdGVyZWFjdG9yJykuUm90YXRlUmVhY3RvcjtcclxuXHJcbmZ1bmN0aW9uIHByb3BlcnR5Q2hlY2tlcihwcm9wZXJ0eSwgZGVmYXVsdFZhbHVlKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKG1vZGVsKSB7XHJcbiAgICAgICAgaWYgKG1vZGVsW3Byb3BlcnR5XSA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiBkZWZhdWx0VmFsdWU7IH1cclxuICAgICAgICBpZiAodHlwZW9mIG1vZGVsW3Byb3BlcnR5XSA9PT0gJ2Z1bmN0aW9uJykgeyByZXR1cm4gbW9kZWxbcHJvcGVydHldKCk7IH1cclxuICAgICAgICByZXR1cm4gbW9kZWxbcHJvcGVydHldO1xyXG4gICAgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNNdWx0aXNlbGVjdChlKSB7XHJcbiAgICBpZiAobmF2aWdhdG9yLnBsYXRmb3JtLnN1YnN0cigwLCAzKS50b0xvd2VyQ2FzZSgpID09PSAnbWFjJykgeyByZXR1cm4gZS5tZXRhS2V5OyB9XHJcbiAgICByZXR1cm4gZS5jdHJsS2V5O1xyXG59XHJcblxyXG52YXIgY2FuUmVzaXplID0gcHJvcGVydHlDaGVja2VyKCdyZXNpemFibGUnLCBmYWxzZSksXHJcbiAgICBjYW5Sb3RhdGUgPSBwcm9wZXJ0eUNoZWNrZXIoJ3JvdGF0YWJsZScsIGZhbHNlKTtcclxuXHJcbmZ1bmN0aW9uIE1hbmlwdWxhdGlvblJlYWN0b3Iob3B0aW9ucykge1xyXG4gICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIE1hbmlwdWxhdGlvblJlYWN0b3IpKSB7IHJldHVybiBuZXcgTWFuaXB1bGF0aW9uUmVhY3RvcihvcHRpb25zKTsgfVxyXG4gICAgXy5leHRlbmQodGhpcywgYmFja2JvbmUuRXZlbnRzKTtcclxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG5cclxuICAgIGlmICghb3B0aW9ucy5wYXBlciB8fCB0eXBlb2Ygb3B0aW9ucy5wYXBlciAhPT0gJ29iamVjdCcgfHwgIShvcHRpb25zLnBhcGVyIGluc3RhbmNlb2Ygam9pbnQuZGlhLlBhcGVyKSkgeyB0aHJvdyBuZXcgRXJyb3IoJ3BhcGVyIG9wdGlvbiBpcyBtYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKCFvcHRpb25zLm1vZGVsIHx8IHR5cGVvZiBvcHRpb25zLm1vZGVsICE9PSAnb2JqZWN0JykgeyB0aHJvdyBuZXcgRXJyb3IoJ21vZGVsIG9wdGlvbiBpcyBtYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKG9wdGlvbnMuYWN0aW9ucyAmJiAhQXJyYXkuaXNBcnJheShvcHRpb25zLmFjdGlvbnMpKSB7IHRocm93IG5ldyBFcnJvcignYWN0aW9ucyBvcHRpb24gc2hvdWxkIGJlIGFuIGFycmF5Jyk7IH1cclxuICAgIGlmICghb3B0aW9ucy5lbCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2VsIG9wdGlvbiBpcyBtYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKCQob3B0aW9ucy5lbCkubGVuZ3RoID09PSAwKSB7IHRocm93IG5ldyBFcnJvcignaW52YWxpZCBlbCBvcHRpb24nKTsgfVxyXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLmdyaWRTaXplICE9PSAnbnVtYmVyJykgeyB0aHJvdyBuZXcgRXJyb3IoJ2dyaWRTaXplIG9wdGlvbiBpcyBtYW5kYXRvcnkgYW5kIGhhcyB0byBiZSBhIG51bWJlcicpOyB9XHJcbiAgICBpZiAob3B0aW9ucy5ncmlkU2l6ZSA8IDApIHsgdGhyb3cgbmV3IEVycm9yKCdncmlkU2l6ZSBjYW5ub3QgYmUgbGVzcyB0aGFuIHplcm8nKTsgfVxyXG4gICAgaWYgKCFvcHRpb25zLnVuZG9SZWFjdG9yIHx8IHR5cGVvZiBvcHRpb25zLnVuZG9SZWFjdG9yICE9PSAnb2JqZWN0JykgeyB0aHJvdyBuZXcgRXJyb3IoJ3VuZG9SZWFjdG9yIG9wdGlvbiBpcyBtYW5kYXRvcnknKTsgfVxyXG5cclxuICAgIHZhciBzZWxmID0gdGhpcyxcclxuICAgICAgICBlbCA9ICQoJChvcHRpb25zLmVsKVswXSksXHJcbiAgICAgICAgcGFwZXIgPSBvcHRpb25zLnBhcGVyLFxyXG4gICAgICAgIG1vZGVsID0gb3B0aW9ucy5tb2RlbCxcclxuICAgICAgICBncmlkU2l6ZSA9IG9wdGlvbnMuZ3JpZFNpemUsXHJcbiAgICAgICAgYWN0aW9ucyA9IG9wdGlvbnMuYWN0aW9ucyB8fCBbZXhwb3J0cy5lZGl0LCBleHBvcnRzLmRlbGV0ZV0sXHJcbiAgICAgICAgcmVzaXplID0gb3B0aW9ucy5yZXNpemUgPT09IHVuZGVmaW5lZCA/IHRydWUgOiAhIW9wdGlvbnMucmVzaXplLFxyXG4gICAgICAgIHJvdGF0ZSA9IG9wdGlvbnMucmVzaXplID09PSB1bmRlZmluZWQgPyB0cnVlIDogISFvcHRpb25zLnJvdGF0ZSxcclxuICAgICAgICBtYWduZXRpemUgPSBvcHRpb25zLm1hZ25ldGl6ZSA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6ICEhb3B0aW9ucy5tYWduZXRpemUsXHJcbiAgICAgICAgc2VsZWN0ZWRWaWV3cyA9IHt9LFxyXG4gICAgICAgIHVuZG9SZWFjdG9yID0gb3B0aW9ucy51bmRvUmVhY3RvcjtcclxuXHJcbiAgICBlbC5hdHRyKCd0YWJpbmRleCcsIDEpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHVwZGF0ZU1hbmlwdWxhdG9yKGVsZW1lbnQpIHtcclxuICAgICAgICBpZiAoZWxlbWVudC5pc0xpbmsoKSkgeyByZXR1cm47IH1cclxuICAgICAgICB2YXIgYnVuZGxlID0gc2VsZWN0ZWRWaWV3c1tlbGVtZW50LmlkXSxcclxuICAgICAgICAgICAgYmJveCxcclxuICAgICAgICAgICAgYW5nbGU7XHJcbiAgICAgICAgaWYgKCFidW5kbGUpIHsgcmV0dXJuOyB9XHJcbiAgICAgICAgYmJveCA9IGJ1bmRsZS52aWV3LmdldEJCb3goe3VzZU1vZGVsR2VvbWV0cnk6IHRydWV9KTtcclxuICAgICAgICBidW5kbGUuZWxcclxuICAgICAgICAgICAgLmNzcygnbGVmdCcsIGJib3gueCAtIGdyaWRTaXplKVxyXG4gICAgICAgICAgICAuY3NzKCd0b3AnLCBiYm94LnkgLSBncmlkU2l6ZSlcclxuICAgICAgICAgICAgLmNzcygnd2lkdGgnLCBiYm94LndpZHRoICsgMiAqIGdyaWRTaXplKVxyXG4gICAgICAgICAgICAuY3NzKCdoZWlnaHQnLCBiYm94LmhlaWdodCArIDIgKiBncmlkU2l6ZSk7XHJcbiAgICAgICAgYW5nbGUgPSBlbGVtZW50LmdldCgnYW5nbGUnKTtcclxuICAgICAgICAkKGJ1bmRsZS5lbC5maW5kKCcuYWxtb3N0LWpvaW50LW1hcmtlci1yb3RhdGUnKSlcclxuICAgICAgICAgICAgLmNzcygnbGVmdCcsIChiYm94LndpZHRoICsgOTQpIC8gMiAqICgxICsgTWF0aC5jb3Moam9pbnQuZy50b1JhZChhbmdsZSkpKSAtIDM2KVxyXG4gICAgICAgICAgICAuY3NzKCd0b3AnLCAoYmJveC5oZWlnaHQgKyA5NCkgLyAyICogKDEgKyBNYXRoLnNpbihqb2ludC5nLnRvUmFkKGFuZ2xlKSkpIC0gMzYpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHVwZGF0ZU1hbmlwdWxhdG9ycygpIHtcclxuICAgICAgICBfLm1hcChzZWxlY3RlZFZpZXdzLCBmdW5jdGlvbiAoYnVuZGxlKSB7XHJcbiAgICAgICAgICAgIHVwZGF0ZU1hbmlwdWxhdG9yKGJ1bmRsZS52aWV3Lm1vZGVsKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjbG9zZU1hbmlwdWxhdG9yKGVsZW1lbnQpIHtcclxuICAgICAgICB2YXIgYnVuZGxlID0gc2VsZWN0ZWRWaWV3c1tlbGVtZW50LmlkXTtcclxuICAgICAgICBpZiAoIWJ1bmRsZSkgeyByZXR1cm47IH1cclxuICAgICAgICBpZiAoYnVuZGxlLnZpZXcubW9kZWwuZGVtYWduZXRpemUpIHsgYnVuZGxlLnZpZXcubW9kZWwuZGVtYWduZXRpemUoKTsgfVxyXG4gICAgICAgIGJ1bmRsZS5lbC5yZW1vdmUoKTtcclxuICAgICAgICBidW5kbGUudmlldy5vZmYoJ2NoYW5nZTpwb3NpdGlvbiBjaGFuZ2U6c2l6ZScsIHVwZGF0ZU1hbmlwdWxhdG9yKTtcclxuICAgICAgICBkZWxldGUgc2VsZWN0ZWRWaWV3c1tlbGVtZW50LmlkXTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjbG9zZU1hbmlwdWxhdG9ycyhjdXJyZW50aWQpIHtcclxuICAgICAgICBfLm1hcChzZWxlY3RlZFZpZXdzLCBmdW5jdGlvbiAoYnVuZGxlLCBpZCkge1xyXG4gICAgICAgICAgICBpZiAoaWQgPT09IGN1cnJlbnRpZCkgeyByZXR1cm47IH1cclxuICAgICAgICAgICAgY2xvc2VNYW5pcHVsYXRvcihidW5kbGUudmlldy5tb2RlbCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdG9nZ2xlTWFuaXB1bGF0b3IoY2VsbFZpZXcsIGV2dCkge1xyXG4gICAgICAgIGlmIChjZWxsVmlldy5tb2RlbC5pc0xpbmsoKSkgeyByZXR1cm47IH1cclxuICAgICAgICBpZiAoIWlzTXVsdGlzZWxlY3QoZXZ0KSkgeyBjbG9zZU1hbmlwdWxhdG9ycyhjZWxsVmlldy5tb2RlbC5pZCk7IH1cclxuICAgICAgICB2YXIgaWQgPSBjZWxsVmlldy5tb2RlbC5pZCxcclxuICAgICAgICAgICAgYnVuZGxlID0gc2VsZWN0ZWRWaWV3c1tpZF0sXHJcbiAgICAgICAgICAgIHRhYjtcclxuICAgICAgICBpZiAoIWJ1bmRsZSkge1xyXG4gICAgICAgICAgICBidW5kbGUgPSBzZWxlY3RlZFZpZXdzW2NlbGxWaWV3Lm1vZGVsLmlkXSA9IHtcclxuICAgICAgICAgICAgICAgIGVsOiAoZnVuY3Rpb24gKCkge3ZhciBtYW5pcHVsYXRvciA9ICQocmVxdWlyZSgnLi9tYW5pcHVsYXRvci5odG1sJykpOyBlbC5hcHBlbmQobWFuaXB1bGF0b3IpOyByZXR1cm4gbWFuaXB1bGF0b3I7IH0oKSksXHJcbiAgICAgICAgICAgICAgICB2aWV3OiBjZWxsVmlldyxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgYnVuZGxlLnZpZXcubW9kZWwub24oJ2NoYW5nZTpwb3NpdGlvbiBjaGFuZ2U6c2l6ZSBjaGFuZ2U6YW5nbGUnLCB1cGRhdGVNYW5pcHVsYXRvcik7XHJcbiAgICAgICAgICAgIGJ1bmRsZS52aWV3Lm1vZGVsLm9uKCdjaGFuZ2U6aWQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgc2VsZWN0ZWRWaWV3c1tpZF07XHJcbiAgICAgICAgICAgICAgICBpZCA9IHRoaXMuaWQ7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZFZpZXdzW3RoaXMuaWRdID0gYnVuZGxlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGFiID0gJChidW5kbGUuZWwuZmluZCgnLmFsbW9zdC1qb2ludC1tYXJrZXItdGFiJykpO1xyXG4gICAgICAgICAgICBidW5kbGUuY29udGV4dCA9IHtcclxuICAgICAgICAgICAgICAgIHVuZG9SZWFjdG9yOiB1bmRvUmVhY3RvcixcclxuICAgICAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xvc2VNYW5pcHVsYXRvcihidW5kbGUudmlldy5tb2RlbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGlmIChtYWduZXRpemUgJiYgYnVuZGxlLnZpZXcubW9kZWwubWFnbmV0aXplICYmIGJ1bmRsZS52aWV3Lm1vZGVsLmRlbWFnbmV0aXplKSB7XHJcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsaW5rbWFya2VyID0gJChfLmZpcnN0KCQocmVxdWlyZSgnLi9saW5rLnN2ZycpKSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb3ZlbWFya2VyID0gJChfLmZpcnN0KCQocmVxdWlyZSgnLi9tb3ZlLnN2ZycpKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxpbmttYXJrZXIub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzID0gYnVuZGxlLnZpZXcubW9kZWwubWFnbmV0aXplKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMgPT09IHVuZGVmaW5lZCB8fCByZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmttYXJrZXIuYWZ0ZXIobW92ZW1hcmtlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rbWFya2VyLmRldGFjaCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbW92ZW1hcmtlci5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1bmRsZS52aWV3Lm1vZGVsLmRlbWFnbmV0aXplKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVtYXJrZXIuYWZ0ZXIobGlua21hcmtlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVtYXJrZXIuZGV0YWNoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVuZGxlLm1hZ25ldGl6ZUN5Y2xlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobW92ZW1hcmtlci5wYXJlbnQoKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVtYXJrZXIuY2xpY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmttYXJrZXIuY2xpY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdGFiLmFwcGVuZChsaW5rbWFya2VyKTtcclxuICAgICAgICAgICAgICAgIH0oKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXy5mb3JFYWNoKGFjdGlvbnMsIGZ1bmN0aW9uIChhY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChhY3Rpb24uY2hlY2tlcihjZWxsVmlldy5tb2RlbCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLmNsaWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBjbGljaygpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24uY2xpY2suY2FsbChidW5kbGUuY29udGV4dCwgYnVuZGxlLnZpZXcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFiLmFwcGVuZCgkKGFjdGlvbi5tYXJrZXIpLmNsb25lKCkub24oJ2NsaWNrJywgY2xpY2spKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSgpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbi5ldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRyaWdnZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50cmlnZ2VyKCdjZWxsOicgKyBhY3Rpb24uZXZlbnQsIGJ1bmRsZS52aWV3KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWIuYXBwZW5kKCQoYWN0aW9uLm1hcmtlcikuY2xvbmUoKS5vbignY2xpY2snLCB0cmlnZ2VyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0oKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKHJlc2l6ZSAmJiBjYW5SZXNpemUoY2VsbFZpZXcubW9kZWwpKSB7XHJcbiAgICAgICAgICAgICAgICBidW5kbGUuZWwuYWRkQ2xhc3MoJ2FsbW9zdC1qb2ludC1yZXNpemFibGUnKTtcclxuICAgICAgICAgICAgICAgIFsnbicsICduZScsICdlJywgJ3NlJywgJ3MnLCAnc3cnLCAndycsICdudyddLmZvckVhY2goZnVuY3Rpb24gKGRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGJ1bmRsZS5lbC5maW5kKCcuYWxtb3N0LWpvaW50LW1hcmtlci0nICsgZGlyZWN0aW9uKS5vbignbW91c2Vkb3duJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVSZXNpemVSZWFjdG9yKHt2aWV3OiBidW5kbGUudmlldywgcGFwZXI6IHBhcGVyLCBtb2RlbDogbW9kZWwsIGVsOiBlbCwgZGlyZWN0aW9uOiBkaXJlY3Rpb24sIGdyaWRTaXplOiBncmlkU2l6ZSwgdW5kb1JlYWN0b3I6IHVuZG9SZWFjdG9yfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocm90YXRlICYmIGNhblJvdGF0ZShjZWxsVmlldy5tb2RlbCkpIHtcclxuICAgICAgICAgICAgICAgIGJ1bmRsZS5lbC5hZGRDbGFzcygnYWxtb3N0LWpvaW50LXJvdGF0YWJsZScpO1xyXG4gICAgICAgICAgICAgICAgYnVuZGxlLmVsLmZpbmQoJy5hbG1vc3Qtam9pbnQtbWFya2VyLXJvdGF0ZScpLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlUm90YXRlUmVhY3Rvcih7dmlldzogYnVuZGxlLnZpZXcsIHBhcGVyOiBwYXBlciwgbW9kZWw6IG1vZGVsLCBlbDogZWwsIGFuZ2xlU3RlcDogMTUsIHVuZG9SZWFjdG9yOiB1bmRvUmVhY3Rvcn0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdXBkYXRlTWFuaXB1bGF0b3IoY2VsbFZpZXcubW9kZWwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBtb3VzZW92ZXIoKSB7XHJcbiAgICAgICAgZWwuZm9jdXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBwYXBlci5vbignY2VsbDpwb2ludGVyZG93bicsIHRvZ2dsZU1hbmlwdWxhdG9yKTtcclxuICAgIHBhcGVyLm9uKCdzY2FsZSB0cmFuc2xhdGUnLCB1cGRhdGVNYW5pcHVsYXRvcnMpO1xyXG4gICAgcGFwZXIub24oJ2NlbGw6cG9pbnRlcm1vdmUnLCBmdW5jdGlvbiAoY2VsbFZpZXcpIHsgdXBkYXRlTWFuaXB1bGF0b3IoY2VsbFZpZXcubW9kZWwpOyB9KTtcclxuICAgIG1vZGVsLm9uKCdjaGFuZ2U6dGFyZ2V0JywgZnVuY3Rpb24gKGxpbmspIHtcclxuICAgICAgICB2YXIgYnVuZGxlID0gc2VsZWN0ZWRWaWV3c1tsaW5rLmdldCgnc291cmNlJykuaWRdO1xyXG4gICAgICAgIGxpbmsudG9Gcm9udCgpO1xyXG4gICAgICAgIGlmICghYnVuZGxlIHx8ICFidW5kbGUudmlldy5tb2RlbC5tYWduZXRpemUgfHwgIWJ1bmRsZS52aWV3Lm1vZGVsLmRlbWFnbmV0aXplKSB7IHJldHVybjsgfVxyXG4gICAgICAgIGJ1bmRsZS5tYWduZXRpemVDeWNsZSgpO1xyXG4gICAgfSk7XHJcbiAgICBtb2RlbC5vbigncmVtb3ZlJywgZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICBjbG9zZU1hbmlwdWxhdG9yKGVsZW1lbnQpO1xyXG4gICAgfSk7XHJcbiAgICBlbC5tb3VzZW92ZXIobW91c2VvdmVyKTtcclxuXHJcbiAgICBtb3VzZXRyYXAoZWxbMF0pLmJpbmQoJ2VzYycsIF8uYXJ5KGNsb3NlTWFuaXB1bGF0b3JzLCAwKSk7XHJcbiAgICBwYXBlci5vbignYmxhbms6cG9pbnRlcmRvd24nLCBfLmFyeShjbG9zZU1hbmlwdWxhdG9ycywgMCkpO1xyXG4gICAgXy5mb3JFYWNoKGFjdGlvbnMsIGZ1bmN0aW9uIChhY3Rpb24pIHtcclxuICAgICAgICBpZiAoYWN0aW9uLnNob3J0Y3V0KSB7XHJcbiAgICAgICAgICAgIG1vdXNldHJhcChlbFswXSkuYmluZChhY3Rpb24uc2hvcnRjdXQsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChzZWxlY3RlZFZpZXdzLCBmdW5jdGlvbiAoYnVuZGxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbi5jaGVja2VyKGJ1bmRsZS52aWV3Lm1vZGVsKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLmNsaWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24uY2xpY2suY2FsbChidW5kbGUuY29udGV4dCwgYnVuZGxlLnZpZXcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpb24uZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHJpZ2dlcignY2VsbDonICsgYWN0aW9uLmV2ZW50LCBidW5kbGUudmlldyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydHMuTWFuaXB1bGF0aW9uUmVhY3RvciA9IE1hbmlwdWxhdGlvblJlYWN0b3I7XHJcblxyXG5cclxuZXhwb3J0cy5kZWxldGUgPSB7XHJcbiAgICBtYXJrZXI6IHJlcXVpcmUoJy4vZGVsZXRlLnN2ZycpLFxyXG4gICAgY2hlY2tlcjogcHJvcGVydHlDaGVja2VyKCdkZWxldGFibGUnLCB0cnVlKSxcclxuICAgIGNsaWNrOiBmdW5jdGlvbiAodmlldykge1xyXG4gICAgICAgIHRoaXMudW5kb1JlYWN0b3Iuc3RhcnQoKTtcclxuICAgICAgICB2aWV3Lm1vZGVsLnJlbW92ZSgpO1xyXG4gICAgICAgIHRoaXMudW5kb1JlYWN0b3Iuc3RvcCgpO1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH0sXHJcbiAgICBzaG9ydGN1dDogJ2RlbCdcclxufTtcclxuZXhwb3J0cy5lZGl0ID0ge1xyXG4gICAgbWFya2VyOiByZXF1aXJlKCcuL2VkaXQuc3ZnJyksXHJcbiAgICBjaGVja2VyOiBwcm9wZXJ0eUNoZWNrZXIoJ2VkaXRhYmxlJywgZmFsc2UpLFxyXG4gICAgZXZlbnQ6ICdlZGl0J1xyXG59O1xyXG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdiBjbGFzcz1cXFwiYWxtb3N0LWpvaW50LW1hbmlwdWxhdG9yXFxcIj5cXHJcXG4gICAgPGRpdiBjbGFzcz1cXFwiYWxtb3N0LWpvaW50LW1hcmtlci10YWJcXFwiPjwvZGl2PlxcclxcbiAgICA8ZGl2IGNsYXNzPVxcXCJhbG1vc3Qtam9pbnQtbWFya2VyLW5lXFxcIj48L2Rpdj5cXHJcXG4gICAgPGRpdiBjbGFzcz1cXFwiYWxtb3N0LWpvaW50LW1hcmtlci1lXFxcIj48L2Rpdj5cXHJcXG4gICAgPGRpdiBjbGFzcz1cXFwiYWxtb3N0LWpvaW50LW1hcmtlci1zZVxcXCI+PC9kaXY+XFxyXFxuICAgIDxkaXYgY2xhc3M9XFxcImFsbW9zdC1qb2ludC1tYXJrZXItc1xcXCI+PC9kaXY+XFxyXFxuICAgIDxkaXYgY2xhc3M9XFxcImFsbW9zdC1qb2ludC1tYXJrZXItc3dcXFwiPjwvZGl2PlxcclxcbiAgICA8ZGl2IGNsYXNzPVxcXCJhbG1vc3Qtam9pbnQtbWFya2VyLXdcXFwiPjwvZGl2PlxcclxcbiAgICA8ZGl2IGNsYXNzPVxcXCJhbG1vc3Qtam9pbnQtbWFya2VyLW53XFxcIj48L2Rpdj5cXHJcXG4gICAgPGRpdiBjbGFzcz1cXFwiYWxtb3N0LWpvaW50LW1hcmtlci1uXFxcIj48L2Rpdj5cXHJcXG4gICAgPGRpdiBjbGFzcz1cXFwiYWxtb3N0LWpvaW50LW1hcmtlci1yb3RhdGVcXFwiPjwvZGl2PlxcclxcbjwvZGl2PlxcclxcblwiO1xuIiwiLy8gQ29weXJpZ2h0IChjKSAyMDE2LCB0aGUgQUxNT3NUIHByb2plY3QgYXV0aG9ycy4gUGxlYXNlIHNlZSB0aGVcclxuLy8gQVVUSE9SUyBmaWxlIGZvciBkZXRhaWxzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpc1xyXG4vLyBnb3Zlcm5lZCBieSB0aGUgTUlUIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS5cclxuLypqc2xpbnQgbm9kZTogdHJ1ZSwgbm9tZW46IHRydWUgKi9cclxuXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKSxcclxuICAgICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCksXHJcbiAgICBqb2ludCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydqb2ludCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnam9pbnQnXSA6IG51bGwpLFxyXG4gICAgY3JlYXRlUHJldmlldyA9IHJlcXVpcmUoJy4vcHJldmlldycpLlByZXZpZXcsXHJcbiAgICBjcmVhdGVWaWV3cG9ydCA9IHJlcXVpcmUoJy4vdmlld3BvcnQnKS5WaWV3cG9ydDtcclxuXHJcbmZ1bmN0aW9uIE1hcChvcHRpb25zKSB7XHJcbiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgTWFwKSkgeyByZXR1cm4gbmV3IE1hcChvcHRpb25zKTsgfVxyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblxyXG4gICAgaWYgKCFvcHRpb25zLm1vZGVsIHx8IHR5cGVvZiBvcHRpb25zLm1vZGVsICE9PSAnb2JqZWN0JykgeyB0aHJvdyBuZXcgRXJyb3IoJ21vZGVsIG9wdGlvbiBpcyBNYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKCFvcHRpb25zLnBhcGVyIHx8IHR5cGVvZiBvcHRpb25zLnBhcGVyICE9PSAnb2JqZWN0JyB8fCAhKG9wdGlvbnMucGFwZXIgaW5zdGFuY2VvZiBqb2ludC5kaWEuUGFwZXIpKSB7IHRocm93IG5ldyBFcnJvcigncGFwZXIgb3B0aW9uIGlzIE1hbmRhdG9yeScpOyB9XHJcbiAgICBpZiAoIW9wdGlvbnMubGlua0Nvbm5lY3Rpb25Qb2ludCB8fCB0eXBlb2Ygb3B0aW9ucy5saW5rQ29ubmVjdGlvblBvaW50ICE9PSAnZnVuY3Rpb24nKSB7IHRocm93IG5ldyBFcnJvcignbGlua0Nvbm5lY3Rpb25Qb2ludCBvcHRpb24gaXMgTWFuZGF0b3J5Jyk7IH1cclxuICAgIGlmICghb3B0aW9ucy5lbCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2VsIG9wdGlvbiBpcyBNYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKCQob3B0aW9ucy5lbCkubGVuZ3RoID09PSAwKSB7IHRocm93IG5ldyBFcnJvcignaW52YWxpZCBlbCBvcHRpb24nKTsgfVxyXG5cclxuICAgIHZhciBzZWxmID0gdGhpcyxcclxuICAgICAgICBlbCA9ICQoJChvcHRpb25zLmVsKVswXSksXHJcbiAgICAgICAgcGFwZXIgPSBvcHRpb25zLnBhcGVyLFxyXG4gICAgICAgIGxpbmtDb25uZWN0aW9uUG9pbnQgPSBvcHRpb25zLmxpbmtDb25uZWN0aW9uUG9pbnQsXHJcbiAgICAgICAgbWFwQ29udGFpbmVyID0gKGZ1bmN0aW9uICgpIHt2YXIgY29udGFpbmVyID0gJChyZXF1aXJlKCcuL3ByZXZpZXcuaHRtbCcpKTsgZWwuYXBwZW5kKGNvbnRhaW5lcik7IHJldHVybiBjb250YWluZXI7IH0oKSksXHJcbiAgICAgICAgdmlld3BvcnRDb250YWluZXIgPSAoZnVuY3Rpb24gKCkge3ZhciBjb250YWluZXIgPSAkKHJlcXVpcmUoJy4vdmlld3BvcnQuaHRtbCcpKTsgZWwuYXBwZW5kKGNvbnRhaW5lcik7IHJldHVybiBjb250YWluZXI7IH0oKSksXHJcbiAgICAgICAgbW9kZWwgPSBvcHRpb25zLm1vZGVsLFxyXG4gICAgICAgIHByZXZpZXcgPSBjcmVhdGVQcmV2aWV3KHtlbDogbWFwQ29udGFpbmVyLCBtb2RlbDogbW9kZWwsIGxpbmtDb25uZWN0aW9uUG9pbnQ6IGxpbmtDb25uZWN0aW9uUG9pbnR9KSxcclxuICAgICAgICB2aWV3cG9ydCA9IGNyZWF0ZVZpZXdwb3J0KHtlbDogdmlld3BvcnRDb250YWluZXJ9KSxcclxuICAgICAgICBhdXRvUmVmcmVzaEVuYWJsZWQgPSB0cnVlO1xyXG5cclxuICAgIG1vZGVsLm9uKCdjaGFuZ2U6cG9zaXRpb24gY2hhbmdlOnNpemUgY2hhbmdlOmFuZ2xlIGNoYW5nZTpwYXJlbnQgYWRkIHJlbW92ZScsIGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgaWYgKG1vZGVsLmhhc0FjdGl2ZUJhdGNoKCdhZGQnKSB8fCBtb2RlbC5oYXNBY3RpdmVCYXRjaCgnY2xlYXInKSkgeyByZXR1cm47IH1cclxuICAgICAgICBpZiAoIWF1dG9SZWZyZXNoRW5hYmxlZCkgeyByZXR1cm47IH1cclxuICAgICAgICBpZiAoZWxlbWVudC5pc0xpbmsoKSkgeyByZXR1cm47IH1cclxuICAgICAgICBpZiAoZWxlbWVudC5nZXQoJ3BhcmVudCcpKSB7IHJldHVybjsgfVxyXG4gICAgICAgIF8uZGVmZXIoZnVuY3Rpb24gKCkgeyBzZWxmLnJlZnJlc2goKTsgfSk7XHJcbiAgICB9KTtcclxuICAgIG1vZGVsLm9uKCdiYXRjaDpzdG9wJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBpZiAoKGUuYmF0Y2hOYW1lICE9PSAnYWRkJyAmJiBlLmJhdGNoTmFtZSAhPT0gJ2NsZWFyJykgfHwgbW9kZWwuaGFzQWN0aXZlQmF0Y2goJ2FkZCcpIHx8IG1vZGVsLmhhc0FjdGl2ZUJhdGNoKCdjbGVhcicpKSB7IHJldHVybjsgfVxyXG4gICAgICAgIF8uZGVmZXIoZnVuY3Rpb24gKCkgeyBzZWxmLnJlZnJlc2goKTsgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBzZWxmLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGJib3gsXHJcbiAgICAgICAgICAgIHdpZHRoLFxyXG4gICAgICAgICAgICBoZWlnaHQsXHJcbiAgICAgICAgICAgIG1pbkxvY2FsLFxyXG4gICAgICAgICAgICBtYXhMb2NhbDtcclxuICAgICAgICBpZiAobW9kZWwuZ2V0RWxlbWVudHMoKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgd2lkdGggPSBlbC53aWR0aCgpO1xyXG4gICAgICAgICAgICBoZWlnaHQgPSBlbC5oZWlnaHQoKTtcclxuICAgICAgICAgICAgbWluTG9jYWwgPSBwYXBlci5jbGllbnRUb0xvY2FsUG9pbnQoam9pbnQuZy5wb2ludCgwLCAwKSk7XHJcbiAgICAgICAgICAgIG1heExvY2FsID0gcGFwZXIuY2xpZW50VG9Mb2NhbFBvaW50KGpvaW50LmcucG9pbnQod2lkdGgsIGhlaWdodCkpO1xyXG4gICAgICAgICAgICBiYm94ID0gam9pbnQuZy5yZWN0KG1pbkxvY2FsLngsIG1pbkxvY2FsLnksIG1heExvY2FsLnggLSBtaW5Mb2NhbC54LCBtYXhMb2NhbC55IC0gbWluTG9jYWwueSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYmJveCA9IG1vZGVsLmdldEJCb3gobW9kZWwuZ2V0RWxlbWVudHMoKSwge3VzZU1vZGVsR2VvbWV0cnk6IHRydWV9KTtcclxuICAgICAgICAgICAgYmJveCA9IGpvaW50LmcucmVjdChiYm94LnggLSAxMCwgYmJveC55IC0gMTAsIGJib3gud2lkdGggKyAyMCwgYmJveC5oZWlnaHQgKyAyMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByZXZpZXcuc2V0QkJveChiYm94KTtcclxuICAgICAgICB2aWV3cG9ydC5zZXRCQm94KGJib3gpO1xyXG4gICAgfTtcclxuXHJcbiAgICBzZWxmLmRpc2FibGVBdXRvcmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBhdXRvUmVmcmVzaEVuYWJsZWQgPSBmYWxzZTtcclxuICAgIH07XHJcblxyXG4gICAgc2VsZi5lbmFibGVBdXRvcmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBhdXRvUmVmcmVzaEVuYWJsZWQgPSB0cnVlO1xyXG4gICAgfTtcclxuXHJcbiAgICBzZWxmLnNldFZpZXdwb3J0ID0gZnVuY3Rpb24gKGJib3gpIHtcclxuICAgICAgICB2aWV3cG9ydC5zZXRWaWV3cG9ydChiYm94KTtcclxuICAgIH07XHJcblxyXG4gICAgc2VsZi5kb3dubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBwcmV2aWV3LmRvd25sb2FkKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHNlbGYucmVmcmVzaCgpO1xyXG59XHJcblxyXG5leHBvcnRzLk1hcCA9IE1hcDtcclxuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxkaXYgY2xhc3M9J2FsbW9zdC1qb2ludC1tYXAnPjwvZGl2PlxcclxcblwiO1xuIiwiLy8gQ29weXJpZ2h0IChjKSAyMDE2LCB0aGUgQUxNT3NUIHByb2plY3QgYXV0aG9ycy4gUGxlYXNlIHNlZSB0aGVcclxuLy8gQVVUSE9SUyBmaWxlIGZvciBkZXRhaWxzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpc1xyXG4vLyBnb3Zlcm5lZCBieSB0aGUgTUlUIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS5cclxuLypqc2xpbnQgbm9kZTogdHJ1ZSAqL1xyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpLFxyXG4gICAgam9pbnQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snam9pbnQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2pvaW50J10gOiBudWxsKSxcclxuICAgIGF0b2IgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snYXRvYiddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnYXRvYiddIDogbnVsbCksXHJcbiAgICBVaW50OEFycmF5ID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ1VpbnQ4QXJyYXknXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ1VpbnQ4QXJyYXknXSA6IG51bGwpLFxyXG4gICAgQmxvYiA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydCbG9iJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydCbG9iJ10gOiBudWxsKSxcclxuICAgIHNhdmVBcyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydzYXZlQXMnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ3NhdmVBcyddIDogbnVsbCksXHJcbiAgICBzdmcycG5nID0gcmVxdWlyZSgnc2F2ZS1zdmctYXMtcG5nJyk7XHJcblxyXG5mdW5jdGlvbiB1cmlUb0Jsb2IodXJpKSB7XHJcbiAgICB2YXIgZGVsaW1pdGVyID0gJ2Jhc2U2NCwnLFxyXG4gICAgICAgIGluZGV4ID0gdXJpLmluZGV4T2YoZGVsaW1pdGVyKSxcclxuICAgICAgICBiNjREYXRhID0gdXJpLnN1YnN0cihpbmRleCArIGRlbGltaXRlci5sZW5ndGgpLFxyXG4gICAgICAgIGNvbnRlbnRUeXBlID0gdXJpLnN1YnN0cigwLCB1cmkuaW5kZXhPZignOycpKSxcclxuICAgICAgICBzbGljZVNpemUgPSA1MTIsXHJcbiAgICAgICAgYnl0ZUNoYXJhY3RlcnMgPSBhdG9iKGI2NERhdGEpLFxyXG4gICAgICAgIGJ5dGVBcnJheXMgPSBbXSxcclxuICAgICAgICBvZmZzZXQsXHJcbiAgICAgICAgc2xpY2UsXHJcbiAgICAgICAgYnl0ZU51bWJlcnMsXHJcbiAgICAgICAgaSxcclxuICAgICAgICBieXRlQXJyYXk7XHJcblxyXG4gICAgZm9yIChvZmZzZXQgPSAwOyBvZmZzZXQgPCBieXRlQ2hhcmFjdGVycy5sZW5ndGg7IG9mZnNldCArPSBzbGljZVNpemUpIHtcclxuICAgICAgICBzbGljZSA9IGJ5dGVDaGFyYWN0ZXJzLnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgc2xpY2VTaXplKTtcclxuXHJcbiAgICAgICAgYnl0ZU51bWJlcnMgPSBbXTtcclxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2xpY2UubGVuZ3RoOyBpICs9IDEpIHtcclxuICAgICAgICAgICAgYnl0ZU51bWJlcnNbaV0gPSBzbGljZS5jaGFyQ29kZUF0KGkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYnl0ZUFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYnl0ZU51bWJlcnMpO1xyXG5cclxuICAgICAgICBieXRlQXJyYXlzLnB1c2goYnl0ZUFycmF5KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbmV3IEJsb2IoYnl0ZUFycmF5cywge3R5cGU6IGNvbnRlbnRUeXBlfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIFByZXZpZXcob3B0aW9ucykge1xyXG4gICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFByZXZpZXcpKSB7IHJldHVybiBuZXcgUHJldmlldyhvcHRpb25zKTsgfVxyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblxyXG4gICAgaWYgKCFvcHRpb25zLm1vZGVsIHx8IHR5cGVvZiBvcHRpb25zLm1vZGVsICE9PSAnb2JqZWN0JykgeyB0aHJvdyBuZXcgRXJyb3IoJ21vZGVsIG9wdGlvbiBpcyBNYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKCFvcHRpb25zLmxpbmtDb25uZWN0aW9uUG9pbnQgfHwgdHlwZW9mIG9wdGlvbnMubGlua0Nvbm5lY3Rpb25Qb2ludCAhPT0gJ2Z1bmN0aW9uJykgeyB0aHJvdyBuZXcgRXJyb3IoJ2xpbmtDb25uZWN0aW9uUG9pbnQgb3B0aW9uIGlzIE1hbmRhdG9yeScpOyB9XHJcbiAgICBpZiAoIW9wdGlvbnMuZWwpIHsgdGhyb3cgbmV3IEVycm9yKCdlbCBvcHRpb24gaXMgTWFuZGF0b3J5Jyk7IH1cclxuICAgIGlmICgkKG9wdGlvbnMuZWwpLmxlbmd0aCA9PT0gMCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgZWwgb3B0aW9uJyk7IH1cclxuXHJcbiAgICB2YXIgc2VsZiA9IHRoaXMsXHJcbiAgICAgICAgZWwgPSAkKCQob3B0aW9ucy5lbClbMF0pLFxyXG4gICAgICAgIG1vZGVsID0gb3B0aW9ucy5tb2RlbCxcclxuICAgICAgICBsYXN0U2NhbGUgPSAxLFxyXG4gICAgICAgIGxpbmtDb25uZWN0aW9uUG9pbnQgPSBvcHRpb25zLmxpbmtDb25uZWN0aW9uUG9pbnQsXHJcbiAgICAgICAgcGFwZXIgPSBuZXcgam9pbnQuZGlhLlBhcGVyKHtcclxuICAgICAgICAgICAgZWw6IGVsLFxyXG4gICAgICAgICAgICB3aWR0aDogZWwud2lkdGgoKSxcclxuICAgICAgICAgICAgaGVpZ2h0OiBlbC5oZWlnaHQoKSxcclxuICAgICAgICAgICAgbW9kZWw6IG1vZGVsLFxyXG4gICAgICAgICAgICBsaW5rQ29ubmVjdGlvblBvaW50OiBsaW5rQ29ubmVjdGlvblBvaW50LFxyXG4gICAgICAgICAgICBpbnRlcmFjdGl2ZTogZmFsc2VcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBzZWxmLnNldEJCb3ggPSBmdW5jdGlvbiAoYmJveCkge1xyXG4gICAgICAgIC8vIGl0IGlzIHNpbWlsYXIgdG8gcGFwZXIuc2NhbGVDb250ZW50VG9GaXQoKTsgYnV0IGkgcmVxdWlyZSB0byBkbyBpdCBtYW51YWxseSB0byBjaGFuZ2UgZXZlbiB0aGUgb3JpZ2luXHJcbiAgICAgICAgdmFyIHdpZHRoID0gZWwud2lkdGgoKSxcclxuICAgICAgICAgICAgaGVpZ2h0ID0gZWwuaGVpZ2h0KCksXHJcbiAgICAgICAgICAgIHNjYWxlWCA9IHdpZHRoIC8gYmJveC53aWR0aCxcclxuICAgICAgICAgICAgc2NhbGVZID0gaGVpZ2h0IC8gYmJveC5oZWlnaHQsXHJcbiAgICAgICAgICAgIHNjYWxlID0gTWF0aC5taW4oc2NhbGVYLCBzY2FsZVkpLFxyXG4gICAgICAgICAgICBveCA9ICh3aWR0aCAtIGJib3gud2lkdGggKiBzY2FsZSkgLyAyIC0gYmJveC54ICogc2NhbGUsXHJcbiAgICAgICAgICAgIG95ID0gKGhlaWdodCAtIGJib3guaGVpZ2h0ICogc2NhbGUpIC8gMiAtIGJib3gueSAqIHNjYWxlO1xyXG5cclxuICAgICAgICBsYXN0U2NhbGUgPSBzY2FsZTtcclxuICAgICAgICBwYXBlci5zY2FsZShzY2FsZSwgc2NhbGUpO1xyXG4gICAgICAgIHBhcGVyLnNldE9yaWdpbihveCwgb3kpO1xyXG4gICAgfTtcclxuXHJcbiAgICBzZWxmLmRvd25sb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHN2ZzJwbmcuc3ZnQXNQbmdVcmkocGFwZXIuc3ZnLCB7c2NhbGU6IDMgLyBsYXN0U2NhbGV9LCBmdW5jdGlvbiAodXJpKSB7XHJcbiAgICAgICAgICAgIHNhdmVBcyh1cmlUb0Jsb2IodXJpKSwgXCJtb2RlbC5wbmdcIik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG59XHJcblxyXG5leHBvcnRzLlByZXZpZXcgPSBQcmV2aWV3O1xyXG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdiBjbGFzcz0nYWxtb3N0LWpvaW50LW1hcC12aWV3cG9ydCc+PC9kaXY+XFxyXFxuXCI7XG4iLCIvLyBDb3B5cmlnaHQgKGMpIDIwMTYsIHRoZSBBTE1Pc1QgcHJvamVjdCBhdXRob3JzLiBQbGVhc2Ugc2VlIHRoZVxyXG4vLyBBVVRIT1JTIGZpbGUgZm9yIGRldGFpbHMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzXHJcbi8vIGdvdmVybmVkIGJ5IHRoZSBNSVQgbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLlxyXG4vKmpzbGludCBub2RlOiB0cnVlICovXHJcblwidXNlIHN0cmljdFwiO1xyXG5cclxudmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCksXHJcbiAgICBqb2ludCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydqb2ludCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnam9pbnQnXSA6IG51bGwpLFxyXG4gICAgVmlld3BvcnRPdXRsaW5lID0gcmVxdWlyZSgnLi92aWV3cG9ydG91dGxpbmUnKS5WaWV3cG9ydE91dGxpbmU7XHJcblxyXG5mdW5jdGlvbiBWaWV3cG9ydChvcHRpb25zKSB7XHJcbiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgVmlld3BvcnQpKSB7IHJldHVybiBuZXcgVmlld3BvcnQob3B0aW9ucyk7IH1cclxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG5cclxuICAgIGlmICghb3B0aW9ucy5lbCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2VsIG9wdGlvbnMgaXMgTWFuZGF0b3J5Jyk7IH1cclxuICAgIGlmICgkKG9wdGlvbnMuZWwpLmxlbmd0aCA9PT0gMCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgZWwgb3B0aW9ucycpOyB9XHJcblxyXG4gICAgdmFyIHNlbGYgPSB0aGlzLFxyXG4gICAgICAgIGVsID0gJCgkKG9wdGlvbnMuZWwpWzBdKSxcclxuICAgICAgICBtb2RlbCA9IG5ldyBqb2ludC5kaWEuR3JhcGgoKSxcclxuICAgICAgICBwYXBlciA9IG5ldyBqb2ludC5kaWEuUGFwZXIoe1xyXG4gICAgICAgICAgICBlbDogZWwsXHJcbiAgICAgICAgICAgIHdpZHRoOiBlbC53aWR0aCgpLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IGVsLmhlaWdodCgpLFxyXG4gICAgICAgICAgICBtb2RlbDogbW9kZWwsXHJcbiAgICAgICAgICAgIGludGVyYWN0aXZlOiBmYWxzZVxyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIHZpZXdwb3J0ID0gbmV3IFZpZXdwb3J0T3V0bGluZSh7XHJcbiAgICAgICAgICAgIHBvc2l0aW9uOiBqb2ludC5nLnBvaW50KDAsIDApLFxyXG4gICAgICAgICAgICBzaXplOiB7IHdpZHRoOiAxLCBoZWlnaHQ6IDEgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIG1vZGVsLmFkZENlbGxzKFt2aWV3cG9ydF0pO1xyXG5cclxuICAgIHNlbGYuc2V0QkJveCA9IGZ1bmN0aW9uIChiYm94KSB7XHJcbiAgICAgICAgLy8gaXQgaXMgc2ltaWxhciB0byBwYXBlci5zY2FsZUNvbnRlbnRUb0ZpdCgpOyBidXQgaSByZXF1aXJlIHRvIGRvIGl0IG1hbnVhbGx5IHRvIGNoYW5nZSBldmVuIHRoZSBvcmlnaW5cclxuICAgICAgICB2YXIgd2lkdGggPSBlbC53aWR0aCgpLFxyXG4gICAgICAgICAgICBoZWlnaHQgPSBlbC5oZWlnaHQoKSxcclxuICAgICAgICAgICAgc2NhbGVYID0gd2lkdGggLyBiYm94LndpZHRoLFxyXG4gICAgICAgICAgICBzY2FsZVkgPSBoZWlnaHQgLyBiYm94LmhlaWdodCxcclxuICAgICAgICAgICAgc2NhbGUgPSBNYXRoLm1pbihzY2FsZVgsIHNjYWxlWSksXHJcbiAgICAgICAgICAgIG94ID0gKHdpZHRoIC0gYmJveC53aWR0aCAqIHNjYWxlKSAvIDIgLSBiYm94LnggKiBzY2FsZSxcclxuICAgICAgICAgICAgb3kgPSAoaGVpZ2h0IC0gYmJveC5oZWlnaHQgKiBzY2FsZSkgLyAyIC0gYmJveC55ICogc2NhbGU7XHJcblxyXG4gICAgICAgIHBhcGVyLnNjYWxlKHNjYWxlLCBzY2FsZSk7XHJcbiAgICAgICAgcGFwZXIuc2V0T3JpZ2luKG94LCBveSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHNlbGYuc2V0Vmlld3BvcnQgPSBmdW5jdGlvbiAoYmJveCkge1xyXG4gICAgICAgIHZpZXdwb3J0LnBvc2l0aW9uKGJib3gueCwgYmJveC55KTtcclxuICAgICAgICB2aWV3cG9ydC5yZXNpemUoYmJveC53aWR0aCwgYmJveC5oZWlnaHQpO1xyXG4gICAgfTtcclxufVxyXG5cclxuZXhwb3J0cy5WaWV3cG9ydCA9IFZpZXdwb3J0O1xyXG4iLCIvLyBDb3B5cmlnaHQgKGMpIDIwMTYsIHRoZSBBTE1Pc1QgcHJvamVjdCBhdXRob3JzLiBQbGVhc2Ugc2VlIHRoZVxyXG4vLyBBVVRIT1JTIGZpbGUgZm9yIGRldGFpbHMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzXHJcbi8vIGdvdmVybmVkIGJ5IHRoZSBNSVQgbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLlxyXG4vKmpzbGludCBub2RlOiB0cnVlLCBub21lbjogdHJ1ZSAqL1xyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbnZhciAkID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJyQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJyQnXSA6IG51bGwpLFxyXG4gICAgam9pbnQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snam9pbnQnXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ2pvaW50J10gOiBudWxsKTtcclxuXHJcbmV4cG9ydHMuVmlld3BvcnRPdXRsaW5lID0gam9pbnQuc2hhcGVzLmJhc2ljLkdlbmVyaWMuZXh0ZW5kKHtcclxuICAgIG1hcmt1cDogcmVxdWlyZSgnLi9tYXJrdXAuc3ZnJyksXHJcblxyXG4gICAgZGVmYXVsdHM6IGpvaW50LnV0aWwuZGVlcFN1cHBsZW1lbnQoe1xyXG4gICAgICAgIHR5cGU6ICdtYXAuVmlld3BvcnRPdXRsaW5lJyxcclxuICAgICAgICBzaXplOiB7d2lkdGg6IDEsIGhlaWdodDogMX0sXHJcbiAgICAgICAgYXR0cnM6IHtcclxuICAgICAgICAgICAgJy5hbG1vc3Qtam9pbnQtdmlld3BvcnQtYmctcmVjdCcgOiB7J2ZvbGxvdy1zY2FsZSc6ICdhdXRvJ30sXHJcbiAgICAgICAgICAgICcuYWxtb3N0LWpvaW50LXZpZXdwb3J0LW91dGVyLXJlY3QnOiB7XHJcbiAgICAgICAgICAgICAgICAncmVmLXgnOiAwLFxyXG4gICAgICAgICAgICAgICAgJ3JlZi15JzogMCxcclxuICAgICAgICAgICAgICAgICdyZWYtd2lkdGgnOiAxLFxyXG4gICAgICAgICAgICAgICAgJ3JlZi1oZWlnaHQnOiAxLFxyXG4gICAgICAgICAgICAgICAgcmVmOiAnLmFsbW9zdC1qb2ludC12aWV3cG9ydC1iZy1yZWN0J1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSwgam9pbnQuc2hhcGVzLmJhc2ljLkdlbmVyaWMucHJvdG90eXBlLmRlZmF1bHRzKVxyXG59KTtcclxuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxnIGNsYXNzPVxcXCJzY2FsYWJsZVxcXCI+XFxyXFxuICAgIDxyZWN0IGNsYXNzPVxcXCJhbG1vc3Qtam9pbnQtdmlld3BvcnQtYmctcmVjdFxcXCIgd2lkdGg9XFxcIjFcXFwiIGhlaWdodD1cXFwiMVxcXCIgZmlsbD1cXFwidHJhbnNwYXJlbnRcXFwiIC8+XFxyXFxuPC9nPlxcclxcbjxyZWN0IGNsYXNzPVxcXCJhbG1vc3Qtam9pbnQtdmlld3BvcnQtb3V0ZXItcmVjdFxcXCIgZmlsbD1cXFwidHJhbnNwYXJlbnRcXFwiIHN0cm9rZT1cXFwiYmx1ZVxcXCIgc3Ryb2tlLXdpZHRoPVxcXCIxXFxcIiAvPlxcclxcblwiO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxzdmdcXHJcXG4gICB4bWxuczpkYz1cXFwiaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS9cXFwiXFxyXFxuICAgeG1sbnM6Y2M9XFxcImh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zI1xcXCJcXHJcXG4gICB4bWxuczpyZGY9XFxcImh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyNcXFwiXFxyXFxuICAgeG1sbnM6c3ZnPVxcXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1xcXCJcXHJcXG4gICB4bWxucz1cXFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcXFwiXFxyXFxuICAgeG1sbnM6c29kaXBvZGk9XFxcImh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkXFxcIlxcclxcbiAgIHhtbG5zOmlua3NjYXBlPVxcXCJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlXFxcIlxcclxcbiAgIHZlcnNpb249XFxcIjEuMVxcXCJcXHJcXG4gICBpZD1cXFwiQ2FwYV8xXFxcIlxcclxcbiAgIHg9XFxcIjBweFxcXCJcXHJcXG4gICB5PVxcXCIwcHhcXFwiXFxyXFxuICAgd2lkdGg9XFxcIjQ0LjIzNlxcXCJcXHJcXG4gICBoZWlnaHQ9XFxcIjQ0LjIzNlxcXCJcXHJcXG4gICB2aWV3Qm94PVxcXCIwIDAgNDQuMjM2IDQ0LjIzNlxcXCJcXHJcXG4gICB4bWw6c3BhY2U9XFxcInByZXNlcnZlXFxcIlxcclxcbiAgIGlua3NjYXBlOnZlcnNpb249XFxcIjAuOTEgcjEzNzI1XFxcIlxcclxcbiAgIHNvZGlwb2RpOmRvY25hbWU9XFxcIm1vdmUuc3ZnXFxcIj48bWV0YWRhdGFcXHJcXG4gICAgIGlkPVxcXCJtZXRhZGF0YTUzXFxcIj48cmRmOlJERj48Y2M6V29ya1xcclxcbiAgICAgICAgIHJkZjphYm91dD1cXFwiXFxcIj48ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD48ZGM6dHlwZVxcclxcbiAgICAgICAgICAgcmRmOnJlc291cmNlPVxcXCJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZVxcXCIgLz48ZGM6dGl0bGUgLz48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnNcXHJcXG4gICAgIGlkPVxcXCJkZWZzNTFcXFwiIC8+PHNvZGlwb2RpOm5hbWVkdmlld1xcclxcbiAgICAgcGFnZWNvbG9yPVxcXCIjZmZmZmZmXFxcIlxcclxcbiAgICAgYm9yZGVyY29sb3I9XFxcIiM2NjY2NjZcXFwiXFxyXFxuICAgICBib3JkZXJvcGFjaXR5PVxcXCIxXFxcIlxcclxcbiAgICAgb2JqZWN0dG9sZXJhbmNlPVxcXCIxMFxcXCJcXHJcXG4gICAgIGdyaWR0b2xlcmFuY2U9XFxcIjEwXFxcIlxcclxcbiAgICAgZ3VpZGV0b2xlcmFuY2U9XFxcIjEwXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9XFxcIjBcXFwiXFxyXFxuICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PVxcXCIyXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPVxcXCIxNjAwXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD1cXFwiODM3XFxcIlxcclxcbiAgICAgaWQ9XFxcIm5hbWVkdmlldzQ5XFxcIlxcclxcbiAgICAgc2hvd2dyaWQ9XFxcImZhbHNlXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6em9vbT1cXFwiNy41NDQ4NTk0XFxcIlxcclxcbiAgICAgaW5rc2NhcGU6Y3g9XFxcIjI4LjUyMDA0OVxcXCJcXHJcXG4gICAgIGlua3NjYXBlOmN5PVxcXCIzMi4yODQ0MTJcXFwiXFxyXFxuICAgICBpbmtzY2FwZTp3aW5kb3cteD1cXFwiLThcXFwiXFxyXFxuICAgICBpbmtzY2FwZTp3aW5kb3cteT1cXFwiLThcXFwiXFxyXFxuICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPVxcXCIxXFxcIlxcclxcbiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj1cXFwiQ2FwYV8xXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzE5XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzIxXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzIzXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzI1XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzI3XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzI5XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzMxXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzMzXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzM1XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzM3XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzM5XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzQxXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzQzXFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzQ1XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzQ3XFxcIiAvPjxnXFxyXFxuICAgICBpZD1cXFwiZzQxNzdcXFwiPjxjaXJjbGVcXHJcXG4gICAgICAgcj1cXFwiMjIuMTE4XFxcIlxcclxcbiAgICAgICBjeT1cXFwiMjIuMTE4XFxcIlxcclxcbiAgICAgICBjeD1cXFwiMjIuMTE4XFxcIlxcclxcbiAgICAgICBpZD1cXFwicGF0aDQxODFcXFwiXFxyXFxuICAgICAgIHN0eWxlPVxcXCJjb2xvcjojMDAwMDAwO2Rpc3BsYXk6aW5saW5lO292ZXJmbG93OnZpc2libGU7dmlzaWJpbGl0eTp2aXNpYmxlO2ZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC40MDAwMDAwMTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MTttYXJrZXI6bm9uZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlXFxcIiAvPjxwYXRoXFxyXFxuICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9XFxcIjBcXFwiXFxyXFxuICAgICAgIGlkPVxcXCJwYXRoN1xcXCJcXHJcXG4gICAgICAgZD1cXFwiTSAyMi4xMTgsNDQuMjM2IEMgOS45MjIsNDQuMjM2IDAsMzQuMzE0IDAsMjIuMTE5IDAsOS45MjMgOS45MjIsMCAyMi4xMTgsMCBjIDEyLjE5NiwwIDIyLjExOCw5LjkyMyAyMi4xMTgsMjIuMTE5IDAsMTIuMTk1IC05LjkyMiwyMi4xMTcgLTIyLjExOCwyMi4xMTcgeiBtIDAsLTQyLjczNiBDIDEwLjc1LDEuNSAxLjUsMTAuNzUgMS41LDIyLjExOSBjIDAsMTEuMzY5IDkuMjUsMjAuNjE3IDIwLjYxOCwyMC42MTcgMTEuMzY4LDAgMjAuNjE4LC05LjI0OCAyMC42MTgsLTIwLjYxNyBDIDQyLjczNiwxMC43NSAzMy40ODYsMS41IDIyLjExOCwxLjUgWlxcXCIgLz48Z1xcclxcbiAgICAgICBpZD1cXFwiZzlcXFwiPjxjaXJjbGVcXHJcXG4gICAgICAgICBpZD1cXFwiY2lyY2xlMTFcXFwiXFxyXFxuICAgICAgICAgcj1cXFwiMS40MVxcXCJcXHJcXG4gICAgICAgICBjeT1cXFwiMjIuNDM4XFxcIlxcclxcbiAgICAgICAgIGN4PVxcXCIyMi4xMThcXFwiIC8+PHBhdGhcXHJcXG4gICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPVxcXCIwXFxcIlxcclxcbiAgICAgICAgIGlkPVxcXCJwYXRoMTNcXFwiXFxyXFxuICAgICAgICAgZD1cXFwibSAyMi4xMTgsMjQuMDk4IGMgLTAuOTE2LDAgLTEuNjYsLTAuNzQ0IC0xLjY2LC0xLjY2IDAsLTAuOTE1IDAuNzQ1LC0xLjY2IDEuNjYsLTEuNjYgMC45MTUsMCAxLjY1OSwwLjc0NSAxLjY1OSwxLjY2IDAsMC45MTYgLTAuNzQzLDEuNjYgLTEuNjU5LDEuNjYgeiBtIDAsLTIuODIxIGMgLTAuNjQsMCAtMS4xNiwwLjUyMSAtMS4xNiwxLjE2IDAsMC42MzkgMC41MjEsMS4xNjEgMS4xNiwxLjE2MSAwLjYzOSwwIDEuMTU5LC0wLjUyMSAxLjE1OSwtMS4xNjEgMCwtMC42NCAtMC41MTksLTEuMTYgLTEuMTU5LC0xLjE2IHpcXFwiIC8+PC9nPjxwYXRoXFxyXFxuICAgICAgIGlkPVxcXCJwYXRoNy0yXFxcIlxcclxcbiAgICAgICBkPVxcXCJtIDM3LjAzOTk3NCwyMS43MzYxMjcgLTAuMjE0MDIxLC0wLjMyNDAxOSAtNC4wMDAwMjUsLTQuMDAwMDQ1IGMgLTAuMzkwMDMzLC0wLjM5MDAyNiAtMS4wMjU5ODYsLTAuMzkwMDI2IC0xLjQxNDAwMiwwIC0wLjM5MDAyNSwwLjM5MDAzNCAtMC4zOTAwMjUsMS4wMjQwMzggMCwxLjQxNDAwNSBsIDIuMjkyMDM1LDIuMjkyMDM4IC0xMC41ODYwOTIsMCAwLC0xMC41ODYwNjQgMi4yOTIwMzQsMi4yOTIwMzggYyAwLjM4ODAxNiwwLjM5MDAzNCAxLjAyNDAyOSwwLjM5MDAzNCAxLjQxMzk5NCwwIDAuMzg4MDE2LC0wLjM5MDAyNiAwLjM4ODAxNiwtMS4wMjQwMyAwLC0xLjQxMzk5NyBsIC00LjAwMDAzMSwtNC4wMDAxMTIgLTAuMDEsLTAuMDA2IC0wLjMxNDAxMywtMC4yMDc5NzcgLTAuMzgxOTcsLTAuMDc4MDMgLTAuMDAzOCwwIC0wLjM3ODAxMSwwLjA3ODAzIC0wLjMxNDAxMywwLjIwNzk3NyAtMC4wMTIsMC4wMDYgLTQuMDAwMDMxLDQuMDAwMDQ1IGMgLTAuMzkwMDI2LDAuMzkwMDM0IC0wLjM5MDAyNiwxLjAyNDAzOCAwLDEuNDE0MDA0IDAuMzkwMDI2LDAuMzg5OTY2IDEuMDI0MDI5LDAuMzkwMDI2IDEuNDEzOTk0LDAgbCAyLjI5NDA1MiwtMi4yOTIwNDUgMCwxMC41ODYxMzEgLTEwLjU4NjAzMiwwIDIuMjkyMDM0LC0yLjI5MjAzOCBjIDAuMzkwMDI2LC0wLjM5MDAzNCAwLjM5MDAyNiwtMS4wMjQwMzggMCwtMS40MTQwMDUgLTAuMzkwMDMzLC0wLjM4OTk2NiAtMS4wMjQwMzYsLTAuMzkwMDI2IC0xLjQxNDAwMiwwIGwgLTQuMDAwMDkyLDQuMDAwMDQ1IC0wLjAwNiwwLjAxIC0wLjIwNzk3NiwwLjMxNDAxMyAtMC4wNzgwMywwLjM4MjAzOSAwLDAuMDAzOCAwLjA3ODAzLDAuMzc4MDExIDAuMjA3OTc2LDAuMzEyMDAzIDAuMDA2LDAuMDEyIDQuMDAwMDMyLDQuMDAwMDQ1IGMgMC4zOTAwMjYsMC4zOTAwMzQgMS4wMjQwMjksMC4zOTAwMzQgMS40MTM5OTUsMCAwLjM5MDAzMywtMC4zODgwMTYgMC4zOTAwMzMsLTEuMDI0MDMgMCwtMS40MTQwMDQgbCAtMi4yOTE5NjcsLTIuMjkyMDk4IDEwLjU4NjA5MiwwIDAsMTAuNTg2MTMxIC0yLjI5MjAzNCwtMi4yOTIwNDYgYyAtMC4zOTAwMjYsLTAuMzg4MDE2IC0xLjAyNDAyOSwtMC4zODgwMTYgLTEuNDEzOTk1LDAgLTAuMzkwMDMzLDAuMzkwMDM0IC0wLjM5MDAzMywxLjAyNTk4OCAwLDEuNDE0MDA1IGwgNC4wMDAwMzIsNC4wMDAwNDUgMC4zMjQwMTgsMC4yMTU5NjQgMC4zNzgwMDMsMC4wNzYwMiAwLjAwMzgsMCAwLjM4MTk3OCwtMC4wNzgwMyAwLjMyNDAxOCwtMC4yMTQwMjIgNC4wMDAwMzEsLTQuMDAwMDQ1IGMgMC4zODgwMDgsLTAuMzkwMDI2IDAuMzg4MDA4LC0xLjAyNTk4IDAsLTEuNDEzOTk3IC0wLjM5MDAzMywtMC4zOTAwMzMgLTEuMDI1OTg2LC0wLjM5MDAzMyAtMS40MTQwMDIsMCBsIC0yLjI5MjAyNywyLjI5MjAzOCAwLC0xMC41ODYwNjMgMTAuNTg2MDkyLDAgLTIuMjkyMDM0LDIuMjkyMDM4IGMgLTAuMzg4MDE2LDAuMzg4MDE2IC0wLjM4ODAxNiwxLjAyNDAzOCAwLDEuNDE0MDA0IDAuMzkwMDI2LDAuMzg4MDE2IDEuMDI1OTc5LDAuMzg4MDE2IDEuNDEzOTk1LDAgbCA0LjAwMDAzMSwtNC4wMDAwNDUgMC4yMTU5NjQsLTAuMzI0MDE4IDAuMDc2MDIsLTAuMzc4MDExIDAsLTAuMDAzOCAtMC4wNzgwMywtMC4zODE5NzkgelxcXCJcXHJcXG4gICAgICAgc3R5bGU9XFxcImZpbGw6IzAxMDAwMlxcXCJcXHJcXG4gICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT1cXFwiMFxcXCIgLz48L2c+PC9zdmc+XFxyXFxuXCI7XG4iLCIvLyBDb3B5cmlnaHQgKGMpIDIwMTYsIHRoZSBBTE1Pc1QgcHJvamVjdCBhdXRob3JzLiBQbGVhc2Ugc2VlIHRoZVxyXG4vLyBBVVRIT1JTIGZpbGUgZm9yIGRldGFpbHMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzXHJcbi8vIGdvdmVybmVkIGJ5IHRoZSBNSVQgbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLlxyXG4vKmpzbGludCBub2RlOiB0cnVlICovXHJcblwidXNlIHN0cmljdFwiO1xyXG5cclxudmFyICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCksXHJcbiAgICBqb2ludCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydqb2ludCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnam9pbnQnXSA6IG51bGwpO1xyXG5cclxuZnVuY3Rpb24gUGFuUmVhY3RvcihvcHRpb25zKSB7XHJcbiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgUGFuUmVhY3RvcikpIHsgcmV0dXJuIG5ldyBQYW5SZWFjdG9yKG9wdGlvbnMpOyB9XHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuXHJcbiAgICBpZiAoIW9wdGlvbnMucGFwZXIgfHwgdHlwZW9mIG9wdGlvbnMucGFwZXIgIT09ICdvYmplY3QnIHx8ICEob3B0aW9ucy5wYXBlciBpbnN0YW5jZW9mIGpvaW50LmRpYS5QYXBlcikpIHsgdGhyb3cgbmV3IEVycm9yKCdwYXBlciBvcHRpb24gaXMgbWFuZGF0b3J5Jyk7IH1cclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy54ICE9PSAnbnVtYmVyJykgeyB0aHJvdyBuZXcgRXJyb3IoJ3ggb3B0aW9uIGlzIG1hbmRhdG9yeSBhbmQgaGFzIHRvIGJlIGEgbnVtYmVyJyk7IH1cclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy55ICE9PSAnbnVtYmVyJykgeyB0aHJvdyBuZXcgRXJyb3IoJ3kgb3B0aW9uIGlzIG1hbmRhdG9yeSBhbmQgaGFzIHRvIGJlIGEgbnVtYmVyJyk7IH1cclxuICAgIGlmICghb3B0aW9ucy5lbCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2VsIG9wdGlvbiBpcyBtYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKCQob3B0aW9ucy5lbCkubGVuZ3RoID09PSAwKSB7IHRocm93IG5ldyBFcnJvcignaW52YWxpZCBlbCBvcHRpb24nKTsgfVxyXG5cclxuICAgIHZhciBlbCA9ICQoJChvcHRpb25zLmVsKVswXSksXHJcbiAgICAgICAgcGFwZXIgPSBvcHRpb25zLnBhcGVyLFxyXG4gICAgICAgIHN0YXJ0TG9jYWwgPSB7eDogb3B0aW9ucy54LCB5OiBvcHRpb25zLnl9LFxyXG4gICAgICAgIG1vdXNlb3V0O1xyXG5cclxuICAgIGZ1bmN0aW9uIG1vdXNlbW92ZShlKSB7XHJcbiAgICAgICAgdmFyIGxlZnQgPSBlbC5vZmZzZXQoKS5sZWZ0LFxyXG4gICAgICAgICAgICB0b3AgPSBlbC5vZmZzZXQoKS50b3AsXHJcbiAgICAgICAgICAgIHdpZHRoID0gZWwud2lkdGgoKSxcclxuICAgICAgICAgICAgaGVpZ2h0ID0gZWwuaGVpZ2h0KCksXHJcbiAgICAgICAgICAgIHRvcExlZnQgPSBqb2ludC5nLnBvaW50KGxlZnQsIHRvcCksXHJcbiAgICAgICAgICAgIGJvdHRvbVJpZ2h0ID0gam9pbnQuZy5wb2ludChsZWZ0ICsgd2lkdGgsIHRvcCArIGhlaWdodCksXHJcbiAgICAgICAgICAgIG1pbkxvY2FsID0gcGFwZXIuY2xpZW50VG9Mb2NhbFBvaW50KHRvcExlZnQpLFxyXG4gICAgICAgICAgICBtYXhMb2NhbCA9IHBhcGVyLmNsaWVudFRvTG9jYWxQb2ludChib3R0b21SaWdodCksXHJcbiAgICAgICAgICAgIHNjYWxlID0gam9pbnQuZy5wb2ludCh3aWR0aCAvIChtYXhMb2NhbC54IC0gbWluTG9jYWwueCksIGhlaWdodCAvIChtYXhMb2NhbC55IC0gbWluTG9jYWwueSkpLFxyXG4gICAgICAgICAgICBvZmZzZXRDbGllbnQgPSBqb2ludC5nLnBvaW50KHN0YXJ0TG9jYWwueCAqIHNjYWxlLnggKyBsZWZ0LCBzdGFydExvY2FsLnkgKiBzY2FsZS55ICsgdG9wKSxcclxuICAgICAgICAgICAgb3JpZ2luID0gam9pbnQuZy5wb2ludChlLmNsaWVudFggLSBvZmZzZXRDbGllbnQueCwgZS5jbGllbnRZIC0gb2Zmc2V0Q2xpZW50LnkpO1xyXG5cclxuICAgICAgICBwYXBlci5zZXRPcmlnaW4ob3JpZ2luLngsIG9yaWdpbi55KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiB0ZXJtaW5hdGUoKSB7XHJcbiAgICAgICAgZWwub2ZmKCdtb3VzZXVwJywgdGVybWluYXRlKTtcclxuICAgICAgICBlbC5vZmYoJ21vdXNlb3V0JywgbW91c2VvdXQpO1xyXG4gICAgICAgIGVsLm9mZignbW91c2Vtb3ZlIHRvdWNobW92ZScsIG1vdXNlbW92ZSk7XHJcbiAgICAgICAgZWwucmVtb3ZlQ2xhc3MoJ2FsbW9zdC1qb2ludC1tYW5pcHVsYXRpbmcnKTtcclxuICAgIH1cclxuXHJcbiAgICBtb3VzZW91dCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgaWYgKGUudGFyZ2V0ID09PSBlbC5nZXQoMCkpIHtcclxuICAgICAgICAgICAgdGVybWluYXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBlbC5vbignbW91c2V1cCcsIHRlcm1pbmF0ZSk7XHJcbiAgICBlbC5vbignbW91c2VvdXQnLCBtb3VzZW91dCk7XHJcbiAgICBlbC5vbignbW91c2Vtb3ZlIHRvdWNobW92ZScsIG1vdXNlbW92ZSk7XHJcbiAgICBlbC5hZGRDbGFzcygnYWxtb3N0LWpvaW50LW1hbmlwdWxhdGluZycpO1xyXG59XHJcblxyXG5leHBvcnRzLlBhblJlYWN0b3IgPSBQYW5SZWFjdG9yO1xyXG4iLCIvLyBDb3B5cmlnaHQgKGMpIDIwMTYsIHRoZSBBTE1Pc1QgcHJvamVjdCBhdXRob3JzLiBQbGVhc2Ugc2VlIHRoZVxyXG4vLyBBVVRIT1JTIGZpbGUgZm9yIGRldGFpbHMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzXHJcbi8vIGdvdmVybmVkIGJ5IHRoZSBNSVQgbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLlxyXG4vKmpzbGludCBub2RlOiB0cnVlLCBub21lbjogdHJ1ZSAqL1xyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpLFxyXG4gICAgJCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WyckJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWyckJ10gOiBudWxsKSxcclxuICAgIGpvaW50ID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2pvaW50J10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydqb2ludCddIDogbnVsbCk7XHJcblxyXG5mdW5jdGlvbiBub3JtYWxpemVEaXJlY3Rpb24oZGlyZWN0aW9uKSB7XHJcbiAgICBpZiAoMiA9PT0gZGlyZWN0aW9uLmxlbmd0aCkgeyByZXR1cm4ge3Y6IGRpcmVjdGlvbi5zdWJzdHIoMCwgMSksIGg6IGRpcmVjdGlvbi5zdWJzdHIoLTEpfTsgfVxyXG4gICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcclxuICAgIGNhc2UgJ24nOlxyXG4gICAgY2FzZSAncyc6XHJcbiAgICAgICAgcmV0dXJuIHt2OiBkaXJlY3Rpb259O1xyXG4gICAgY2FzZSAndyc6XHJcbiAgICBjYXNlICdlJzpcclxuICAgICAgICByZXR1cm4ge2g6IGRpcmVjdGlvbn07XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIFJlc2l6ZVJlYWN0b3Iob3B0aW9ucykge1xyXG4gICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFJlc2l6ZVJlYWN0b3IpKSB7IHJldHVybiBuZXcgUmVzaXplUmVhY3RvcihvcHRpb25zKTsgfVxyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblxyXG4gICAgaWYgKCFvcHRpb25zLnBhcGVyIHx8IHR5cGVvZiBvcHRpb25zLnBhcGVyICE9PSAnb2JqZWN0JyB8fCAhKG9wdGlvbnMucGFwZXIgaW5zdGFuY2VvZiBqb2ludC5kaWEuUGFwZXIpKSB7IHRocm93IG5ldyBFcnJvcigncGFwZXIgb3B0aW9uIGlzIG1hbmRhdG9yeScpOyB9XHJcbiAgICBpZiAoIW9wdGlvbnMudmlldyB8fCB0eXBlb2Ygb3B0aW9ucy52aWV3ICE9PSAnb2JqZWN0JykgeyB0aHJvdyBuZXcgRXJyb3IoJ3ZpZXcgb3B0aW9uIGlzIG1hbmRhdG9yeScpOyB9XHJcbiAgICBpZiAoIW9wdGlvbnMubW9kZWwgfHwgdHlwZW9mIG9wdGlvbnMubW9kZWwgIT09ICdvYmplY3QnKSB7IHRocm93IG5ldyBFcnJvcignbW9kZWwgb3B0aW9uIGlzIG1hbmRhdG9yeScpOyB9XHJcbiAgICBpZiAoIW9wdGlvbnMuZWwpIHsgdGhyb3cgbmV3IEVycm9yKCdlbCBvcHRpb24gaXMgbWFuZGF0b3J5Jyk7IH1cclxuICAgIGlmICgkKG9wdGlvbnMuZWwpLmxlbmd0aCA9PT0gMCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgZWwgb3B0aW9uJyk7IH1cclxuICAgIGlmICghb3B0aW9ucy5kaXJlY3Rpb24pIHsgdGhyb3cgbmV3IEVycm9yKCdkaXJlY3Rpb24gb3B0aW9uIGlzIG1hbmRhdG9yeScpOyB9XHJcbiAgICBpZiAoLTEgPT09IFsnbmUnLCAnZScsICdzZScsICdzJywgJ3N3JywgJ3cnLCAnbncnLCAnbiddLmluZGV4T2Yob3B0aW9ucy5kaXJlY3Rpb24pKSB7IHRocm93IG5ldyBFcnJvcignaW52YWxpZCBkaXJlY3Rpb24gb3B0aW9uJyk7IH1cclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5ncmlkU2l6ZSAhPT0gJ251bWJlcicpIHsgdGhyb3cgbmV3IEVycm9yKCdncmlkU2l6ZSBvcHRpb24gaXMgbWFuZGF0b3J5IGFuZCBoYXMgdG8gYmUgYSBudW1iZXInKTsgfVxyXG4gICAgaWYgKG9wdGlvbnMuZ3JpZFNpemUgPCAwKSB7IHRocm93IG5ldyBFcnJvcignZ3JpZFNpemUgY2Fubm90IGJlIGxlc3MgdGhhbiB6ZXJvJyk7IH1cclxuICAgIGlmICghb3B0aW9ucy51bmRvUmVhY3RvciB8fCB0eXBlb2Ygb3B0aW9ucy51bmRvUmVhY3RvciAhPT0gJ29iamVjdCcpIHsgdGhyb3cgbmV3IEVycm9yKCd1bmRvUmVhY3RvciBvcHRpb24gaXMgbWFuZGF0b3J5Jyk7IH1cclxuXHJcbiAgICB2YXIgZWwgPSAkKCQob3B0aW9ucy5lbClbMF0pLFxyXG4gICAgICAgIHBhcGVyID0gb3B0aW9ucy5wYXBlcixcclxuICAgICAgICBtb2RlbCA9IG9wdGlvbnMubW9kZWwsXHJcbiAgICAgICAgZ3JpZFNpemUgPSBvcHRpb25zLmdyaWRTaXplLFxyXG4gICAgICAgIGVsZW1lbnQgPSBvcHRpb25zLnZpZXcubW9kZWwsXHJcbiAgICAgICAgdW5kb1JlYWN0b3IgPSBvcHRpb25zLnVuZG9SZWFjdG9yLFxyXG4gICAgICAgIGRpcmVjdGlvbiA9IG5vcm1hbGl6ZURpcmVjdGlvbihvcHRpb25zLmRpcmVjdGlvbiksXHJcbiAgICAgICAgbWluc2l6ZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBtc2l6ZSA9IGVsZW1lbnQubWluc2l6ZSxcclxuICAgICAgICAgICAgICAgIHBhZGRpbmcsXHJcbiAgICAgICAgICAgICAgICBlbWJlZHMgPSBfLmZpbHRlcihlbGVtZW50LmdldEVtYmVkZGVkQ2VsbHMoKSwgZnVuY3Rpb24gKGVsZW1lbnQpIHsgcmV0dXJuIGVsZW1lbnQuaXNDb250cmFpbnQ7IH0pLFxyXG4gICAgICAgICAgICAgICAgYmJveCxcclxuICAgICAgICAgICAgICAgIGVtYmVkc2Jib3gsXHJcbiAgICAgICAgICAgICAgICBtaW53aWR0aCA9IG1zaXplLndpZHRoLFxyXG4gICAgICAgICAgICAgICAgbWluaGVpZ2h0ID0gbXNpemUuaGVpZ2h0O1xyXG4gICAgICAgICAgICBpZiAoZW1iZWRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgZW1iZWRzYmJveCA9IG1vZGVsLmdldEJCb3goZW1iZWRzLCB7dXNlTW9kZWxHZW9tZXRyeTogdHJ1ZX0pO1xyXG4gICAgICAgICAgICAgICAgYmJveCA9IGVsZW1lbnQuZ2V0QkJveCh7dXNlTW9kZWxHZW9tZXRyeTogdHJ1ZX0pO1xyXG4gICAgICAgICAgICAgICAgcGFkZGluZyA9IGVsZW1lbnQucGFkZGluZztcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoZGlyZWN0aW9uLmgpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2UnOlxyXG4gICAgICAgICAgICAgICAgICAgIG1pbndpZHRoID0gZW1iZWRzYmJveC5jb3JuZXIoKS54IC0gYmJveC5vcmlnaW4oKS54ICsgcGFkZGluZy5yaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3cnOlxyXG4gICAgICAgICAgICAgICAgICAgIG1pbndpZHRoID0gYmJveC5jb3JuZXIoKS54IC0gZW1iZWRzYmJveC5vcmlnaW4oKS54ICsgcGFkZGluZy5sZWZ0O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChkaXJlY3Rpb24udikge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAncyc6XHJcbiAgICAgICAgICAgICAgICAgICAgbWluaGVpZ2h0ID0gZW1iZWRzYmJveC5jb3JuZXIoKS55IC0gYmJveC5vcmlnaW4oKS55ICsgcGFkZGluZy5ib3R0b207XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICduJzpcclxuICAgICAgICAgICAgICAgICAgICBtaW5oZWlnaHQgPSBiYm94LmNvcm5lcigpLnkgLSBlbWJlZHNiYm94Lm9yaWdpbigpLnkgKyBwYWRkaW5nLnRvcDtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB7d2lkdGg6IE1hdGgubWF4KG1pbndpZHRoLCBtc2l6ZS53aWR0aCksIGhlaWdodDogTWF0aC5tYXgobWluaGVpZ2h0LCBtc2l6ZS5oZWlnaHQpfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbXNpemU7XHJcbiAgICAgICAgfSgpKSxcclxuICAgICAgICBtb3VzZWVudGVyO1xyXG5cclxuICAgIHVuZG9SZWFjdG9yLnN0YXJ0KCk7XHJcblxyXG4gICAgZnVuY3Rpb24gZml4UG9pbnQocG9pbnQsIGRpcmVjdGlvbikge1xyXG4gICAgICAgIHZhciB4ID0gcG9pbnQueCxcclxuICAgICAgICAgICAgeSA9IHBvaW50Lnk7XHJcbiAgICAgICAgc3dpdGNoIChkaXJlY3Rpb24uaCkge1xyXG4gICAgICAgIGNhc2UgJ2UnOlxyXG4gICAgICAgICAgICB4IC09IGdyaWRTaXplO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICd3JzpcclxuICAgICAgICAgICAgeCArPSBncmlkU2l6ZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN3aXRjaCAoZGlyZWN0aW9uLnYpIHtcclxuICAgICAgICBjYXNlICdzJzpcclxuICAgICAgICAgICAgeSAtPSBncmlkU2l6ZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnbic6XHJcbiAgICAgICAgICAgIHkgKz0gZ3JpZFNpemU7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gam9pbnQuZy5wb2ludCh4LCB5KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjb25zdHJhaW4ocG9pbnQpIHtcclxuICAgICAgICB2YXIgcGFyZW50ID0gZWxlbWVudC5nZXQoJ3BhcmVudCcpLFxyXG4gICAgICAgICAgICBiYm94LFxyXG4gICAgICAgICAgICBwYWRkaW5nO1xyXG4gICAgICAgIHBvaW50ID0gam9pbnQuZy5wb2ludChqb2ludC5nLnNuYXBUb0dyaWQocG9pbnQueCwgZ3JpZFNpemUpLCBqb2ludC5nLnNuYXBUb0dyaWQocG9pbnQueSwgZ3JpZFNpemUpKTtcclxuICAgICAgICBpZiAocGFyZW50KSB7XHJcbiAgICAgICAgICAgIHBhcmVudCA9IG1vZGVsLmdldENlbGwocGFyZW50KTtcclxuICAgICAgICAgICAgYmJveCA9IHBhcmVudC5nZXRCQm94KHt1c2VNb2RlbEdlb21ldHJ5OiB0cnVlfSk7XHJcbiAgICAgICAgICAgIHBhZGRpbmcgPSBwYXJlbnQucGFkZGluZztcclxuICAgICAgICAgICAgcG9pbnQgPSBqb2ludC5nLnBvaW50KFxyXG4gICAgICAgICAgICAgICAgTWF0aC5tYXgoTWF0aC5taW4ocG9pbnQueCwgYmJveC5jb3JuZXIoKS54IC0gcGFkZGluZy5yaWdodCksIGJib3gueCArIHBhZGRpbmcubGVmdCksXHJcbiAgICAgICAgICAgICAgICBNYXRoLm1heChNYXRoLm1pbihwb2ludC55LCBiYm94LmNvcm5lcigpLnkgLSBwYWRkaW5nLmJvdHRvbSksIGJib3gueSArIHBhZGRpbmcudG9wKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcG9pbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbW91c2Vtb3ZlKGUpIHtcclxuICAgICAgICB2YXIgY2xpZW50ID0gY29uc3RyYWluKGZpeFBvaW50KHBhcGVyLmNsaWVudFRvTG9jYWxQb2ludCh7eDogZS5jbGllbnRYLCB5OiBlLmNsaWVudFl9KSwgZGlyZWN0aW9uKSksXHJcbiAgICAgICAgICAgIHBvc2l0aW9uID0gZWxlbWVudC5nZXQoJ3Bvc2l0aW9uJyksXHJcbiAgICAgICAgICAgIHNpemUgPSBlbGVtZW50LmdldCgnc2l6ZScpLFxyXG4gICAgICAgICAgICB3aWR0aCxcclxuICAgICAgICAgICAgaGVpZ2h0LFxyXG4gICAgICAgICAgICBweCxcclxuICAgICAgICAgICAgcHk7XHJcbiAgICAgICAgc3dpdGNoIChkaXJlY3Rpb24uaCkge1xyXG4gICAgICAgIGNhc2UgJ2UnOlxyXG4gICAgICAgICAgICB3aWR0aCA9IE1hdGgubWF4KGNsaWVudC54IC0gcG9zaXRpb24ueCwgbWluc2l6ZS53aWR0aCk7XHJcbiAgICAgICAgICAgIHB4ID0gcG9zaXRpb24ueDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAndyc6XHJcbiAgICAgICAgICAgIHdpZHRoID0gTWF0aC5tYXgoc2l6ZS53aWR0aCAtIGNsaWVudC54ICsgcG9zaXRpb24ueCwgbWluc2l6ZS53aWR0aCk7XHJcbiAgICAgICAgICAgIHB4ID0gcG9zaXRpb24ueCArIHNpemUud2lkdGggLSB3aWR0aDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgd2lkdGggPSBzaXplLndpZHRoO1xyXG4gICAgICAgICAgICBweCA9IHBvc2l0aW9uLng7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN3aXRjaCAoZGlyZWN0aW9uLnYpIHtcclxuICAgICAgICBjYXNlICdzJzpcclxuICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5tYXgoY2xpZW50LnkgLSBwb3NpdGlvbi55LCBtaW5zaXplLmhlaWdodCk7XHJcbiAgICAgICAgICAgIHB5ID0gcG9zaXRpb24ueTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnbic6XHJcbiAgICAgICAgICAgIGhlaWdodCA9IE1hdGgubWF4KHNpemUuaGVpZ2h0IC0gY2xpZW50LnkgKyBwb3NpdGlvbi55LCBtaW5zaXplLmhlaWdodCk7XHJcbiAgICAgICAgICAgIHB5ID0gcG9zaXRpb24ueSArIHNpemUuaGVpZ2h0IC0gaGVpZ2h0O1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBoZWlnaHQgPSBzaXplLmhlaWdodDtcclxuICAgICAgICAgICAgcHkgPSBwb3NpdGlvbi55O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbGVtZW50LnBvc2l0aW9uKHB4LCBweSk7XHJcbiAgICAgICAgZWxlbWVudC5yZXNpemUod2lkdGgsIGhlaWdodCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbW91c2VsZWF2ZShlKSB7XHJcbiAgICAgICAgdmFyIHBvaW50ID0gam9pbnQuZy5wb2ludChlLmNsaWVudFgsIGUuY2xpZW50WSksXHJcbiAgICAgICAgICAgIGJib3ggPSBqb2ludC5nLnJlY3QoZWwub2Zmc2V0KCkubGVmdCwgZWwub2Zmc2V0KCkudG9wLCBlbC53aWR0aCgpLCBlbC5oZWlnaHQoKSk7XHJcbiAgICAgICAgcG9pbnQgPSBiYm94LnBvaW50TmVhcmVzdFRvUG9pbnQocG9pbnQpO1xyXG4gICAgICAgIGUuY2xpZW50WCA9IHBvaW50Lng7XHJcbiAgICAgICAgZS5jbGllbnRZID0gcG9pbnQueTtcclxuICAgICAgICByZXR1cm4gbW91c2Vtb3ZlKGUpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHRlcm1pbmF0ZSgpIHtcclxuICAgICAgICBlbC5vZmYoJ21vdXNldXAnLCB0ZXJtaW5hdGUpO1xyXG4gICAgICAgIGVsLm9mZignbW91c2VlbnRlcicsIG1vdXNlZW50ZXIpO1xyXG4gICAgICAgIGVsLm9mZignbW91c2Vtb3ZlJywgbW91c2Vtb3ZlKTtcclxuICAgICAgICBlbC5vZmYoJ21vdXNlbGVhdmUnLCBtb3VzZWxlYXZlKTtcclxuICAgICAgICBlbC5yZW1vdmVDbGFzcygnYWxtb3N0LWpvaW50LW1hbmlwdWxhdGluZycpO1xyXG4gICAgICAgIGVsLnJlbW92ZUNsYXNzKCdhbG1vc3Qtam9pbnQtcmVzaXppbmctJyArIG9wdGlvbnMuZGlyZWN0aW9uKTtcclxuICAgICAgICB1bmRvUmVhY3Rvci5zdG9wKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbW91c2VlbnRlciA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgaWYgKGUuYnV0dG9ucyA9PT0gMCkge1xyXG4gICAgICAgICAgICB0ZXJtaW5hdGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGVsLm9uKCdtb3VzZXVwJywgdGVybWluYXRlKTtcclxuICAgIGVsLm9uKCdtb3VzZWVudGVyJywgbW91c2VlbnRlcik7XHJcbiAgICBlbC5vbignbW91c2Vtb3ZlJywgbW91c2Vtb3ZlKTtcclxuICAgIGVsLm9uKCdtb3VzZWxlYXZlJywgbW91c2VsZWF2ZSk7XHJcblxyXG4gICAgZWwuYWRkQ2xhc3MoJ2FsbW9zdC1qb2ludC1tYW5pcHVsYXRpbmcnKTtcclxuICAgIGVsLmFkZENsYXNzKCdhbG1vc3Qtam9pbnQtcmVzaXppbmctJyArIG9wdGlvbnMuZGlyZWN0aW9uKTtcclxufVxyXG5cclxuZXhwb3J0cy5SZXNpemVSZWFjdG9yID0gUmVzaXplUmVhY3RvcjtcclxuIiwiLy8gQ29weXJpZ2h0IChjKSAyMDE2LCB0aGUgQUxNT3NUIHByb2plY3QgYXV0aG9ycy4gUGxlYXNlIHNlZSB0aGVcclxuLy8gQVVUSE9SUyBmaWxlIGZvciBkZXRhaWxzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpc1xyXG4vLyBnb3Zlcm5lZCBieSB0aGUgTUlUIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS5cclxuLypqc2xpbnQgbm9kZTogdHJ1ZSwgbm9tZW46IHRydWUgKi9cclxuXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKSxcclxuICAgICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCksXHJcbiAgICBqb2ludCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydqb2ludCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnam9pbnQnXSA6IG51bGwpO1xyXG5cclxuZnVuY3Rpb24gUm90YXRlUmVhY3RvcihvcHRpb25zKSB7XHJcbiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgUm90YXRlUmVhY3RvcikpIHsgcmV0dXJuIG5ldyBSb3RhdGVSZWFjdG9yKG9wdGlvbnMpOyB9XHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuXHJcbiAgICBpZiAoIW9wdGlvbnMucGFwZXIgfHwgdHlwZW9mIG9wdGlvbnMucGFwZXIgIT09ICdvYmplY3QnIHx8ICEob3B0aW9ucy5wYXBlciBpbnN0YW5jZW9mIGpvaW50LmRpYS5QYXBlcikpIHsgdGhyb3cgbmV3IEVycm9yKCdwYXBlciBvcHRpb24gaXMgbWFuZGF0b3J5Jyk7IH1cclxuICAgIGlmICghb3B0aW9ucy52aWV3IHx8IHR5cGVvZiBvcHRpb25zLnZpZXcgIT09ICdvYmplY3QnKSB7IHRocm93IG5ldyBFcnJvcigndmlldyBvcHRpb24gaXMgbWFuZGF0b3J5Jyk7IH1cclxuICAgIGlmICghb3B0aW9ucy5lbCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2VsIG9wdGlvbiBpcyBtYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKCQob3B0aW9ucy5lbCkubGVuZ3RoID09PSAwKSB7IHRocm93IG5ldyBFcnJvcignaW52YWxpZCBlbCBvcHRpb24nKTsgfVxyXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLmFuZ2xlU3RlcCAhPT0gJ251bWJlcicpIHsgdGhyb3cgbmV3IEVycm9yKCdhbmdsZVN0ZXAgb3B0aW9uIGlzIG1hbmRhdG9yeSBhbmQgaGFzIHRvIGJlIGEgbnVtYmVyJyk7IH1cclxuICAgIGlmIChvcHRpb25zLmFuZ2xlU3RlcCA8IDApIHsgdGhyb3cgbmV3IEVycm9yKCdhbmdsZVN0ZXAgY2Fubm90IGJlIGxlc3MgdGhhbiB6ZXJvJyk7IH1cclxuICAgIGlmICghb3B0aW9ucy51bmRvUmVhY3RvciB8fCB0eXBlb2Ygb3B0aW9ucy51bmRvUmVhY3RvciAhPT0gJ29iamVjdCcpIHsgdGhyb3cgbmV3IEVycm9yKCd1bmRvUmVhY3RvciBvcHRpb24gaXMgbWFuZGF0b3J5Jyk7IH1cclxuXHJcbiAgICB2YXIgZWwgPSAkKCQob3B0aW9ucy5lbClbMF0pLFxyXG4gICAgICAgIHBhcGVyID0gb3B0aW9ucy5wYXBlcixcclxuICAgICAgICBlbGVtZW50ID0gb3B0aW9ucy52aWV3Lm1vZGVsLFxyXG4gICAgICAgIGFuZ2xlU3RlcCA9IG9wdGlvbnMuYW5nbGVTdGVwLFxyXG4gICAgICAgIHVuZG9SZWFjdG9yID0gb3B0aW9ucy51bmRvUmVhY3RvcixcclxuICAgICAgICBtb3VzZW91dDtcclxuXHJcbiAgICB1bmRvUmVhY3Rvci5zdGFydCgpO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1vdXNlbW92ZShlKSB7XHJcbiAgICAgICAgdmFyIGNsaWVudCA9IHBhcGVyLmNsaWVudFRvTG9jYWxQb2ludCh7eDogZS5jbGllbnRYLCB5OiBlLmNsaWVudFl9KSxcclxuICAgICAgICAgICAgYmJveCA9IGVsZW1lbnQuZ2V0QkJveCh7dXNlTW9kZWxHZW9tZXRyeTogdHJ1ZX0pLFxyXG4gICAgICAgICAgICBjZW50ZXIgPSBiYm94LmNlbnRlcigpLFxyXG4gICAgICAgICAgICByYWQgPSBNYXRoLmF0YW4yKGNsaWVudC55IC0gY2VudGVyLnksIGNsaWVudC54IC0gY2VudGVyLngpO1xyXG4gICAgICAgIGVsZW1lbnQucm90YXRlKE1hdGgucm91bmQoam9pbnQuZy50b0RlZyhyYWQpIC8gYW5nbGVTdGVwKSAqIGFuZ2xlU3RlcCwgdHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdGVybWluYXRlKCkge1xyXG4gICAgICAgIGVsLm9mZignbW91c2V1cCcsIHRlcm1pbmF0ZSk7XHJcbiAgICAgICAgZWwub2ZmKCdtb3VzZW91dCcsIG1vdXNlb3V0KTtcclxuICAgICAgICBlbC5vZmYoJ21vdXNlbW92ZScsIG1vdXNlbW92ZSk7XHJcbiAgICAgICAgZWwucmVtb3ZlQ2xhc3MoJ2FsbW9zdC1qb2ludC1tYW5pcHVsYXRpbmcnKTtcclxuICAgICAgICB1bmRvUmVhY3Rvci5zdG9wKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbW91c2VvdXQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGlmIChlLnRhcmdldCA9PT0gZWwuZ2V0KDApKSB7XHJcbiAgICAgICAgICAgIHRlcm1pbmF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZWwub24oJ21vdXNldXAnLCB0ZXJtaW5hdGUpO1xyXG4gICAgZWwub24oJ21vdXNlb3V0JywgbW91c2VvdXQpO1xyXG4gICAgZWwub24oJ21vdXNlbW92ZScsIG1vdXNlbW92ZSk7XHJcblxyXG4gICAgZWwuYWRkQ2xhc3MoJ2FsbW9zdC1qb2ludC1tYW5pcHVsYXRpbmcnKTtcclxufVxyXG5cclxuZXhwb3J0cy5Sb3RhdGVSZWFjdG9yID0gUm90YXRlUmVhY3RvcjtcclxuIiwiLy8gQ29weXJpZ2h0IChjKSAyMDE4LCB0aGUgQUxNT3NUIHByb2plY3QgYXV0aG9ycy4gUGxlYXNlIHNlZSB0aGVcclxuLy8gQVVUSE9SUyBmaWxlIGZvciBkZXRhaWxzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpc1xyXG4vLyBnb3Zlcm5lZCBieSB0aGUgTUlUIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS5cclxuLypqc2xpbnQgbm9kZTogdHJ1ZSwgbm9tZW46IHRydWUgKi9cclxuXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKSxcclxuICAgIGhhc0VmZmVjdCA9IHJlcXVpcmUoJy4vaGFzZWZmZWN0Jyk7XHJcblxyXG5mdW5jdGlvbiBzaG91bGRNZXJnZUhpc3RvcnkobGFzdCwgZW50cnksIG9wdCkge1xyXG4gICAgaWYgKGxhc3QgPT09IHVuZGVmaW5lZCB8fCBfLmlzQXJyYXkobGFzdCkpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoIW9wdC51aSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmIChsYXN0Lm1vZGVsICE9PSBlbnRyeS5tb2RlbCkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmICghbGFzdC5kZWx0YSB8fCAhZW50cnkuZGVsdGEpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxufVxyXG5cclxuZnVuY3Rpb24gbWVyZ2VIaXN0b3J5KGxhc3QsIGVudHJ5KSB7XHJcbiAgICBsYXN0LmRlbHRhID0gXy5hc3NpZ24oZW50cnkuZGVsdGEsIGxhc3QuZGVsdGEpO1xyXG4gICAgaWYgKGVudHJ5LmlkKSB7XHJcbiAgICAgICAgbGFzdC5pZCA9IGVudHJ5LmlkO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBhZGRUb0hpc3RvcnkoaGlzdG9yeSwgZW50cnksIG9wdCkge1xyXG4gICAgdmFyIGxhc3QgPSBfLmxhc3QoaGlzdG9yeSk7XHJcbiAgICBpZiAoc2hvdWxkTWVyZ2VIaXN0b3J5KGxhc3QsIGVudHJ5LCBvcHQpKSB7XHJcbiAgICAgICAgbWVyZ2VIaXN0b3J5KGxhc3QsIGVudHJ5KTtcclxuICAgICAgICBpZiAoIWhhc0VmZmVjdChsYXN0KSkge1xyXG4gICAgICAgICAgICBoaXN0b3J5LnBvcCgpO1xyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaGlzdG9yeS5wdXNoKGVudHJ5KTtcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBhZGRUb0hpc3Rvcnk7XHJcbiIsIi8vIENvcHlyaWdodCAoYykgMjAxOCwgdGhlIEFMTU9zVCBwcm9qZWN0IGF1dGhvcnMuIFBsZWFzZSBzZWUgdGhlXHJcbi8vIEFVVEhPUlMgZmlsZSBmb3IgZGV0YWlscy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXNcclxuLy8gZ292ZXJuZWQgYnkgdGhlIE1JVCBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuXHJcbi8qanNsaW50IG5vZGU6IHRydWUsIG5vbWVuOiB0cnVlICovXHJcblwidXNlIHN0cmljdFwiO1xyXG5cclxudmFyIF8gPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snXyddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnXyddIDogbnVsbCk7XHJcblxyXG5mdW5jdGlvbiBoYXNFZmZlY3QoZW50cnkpIHtcclxuICAgIGlmICghZW50cnkuZGVsdGEgfHwgZW50cnkuaWQpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHZhciByZXN1bHQgPSBfLmV2ZXJ5KGVudHJ5LmRlbHRhLCBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xyXG4gICAgICAgIHJldHVybiAhXy5pc0VxdWFsKHZhbHVlLCBlbnRyeS5tb2RlbC5nZXQoa2V5KSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gaGFzRWZmZWN0O1xyXG4iLCIvLyBDb3B5cmlnaHQgKGMpIDIwMTYsIHRoZSBBTE1Pc1QgcHJvamVjdCBhdXRob3JzLiBQbGVhc2Ugc2VlIHRoZVxyXG4vLyBBVVRIT1JTIGZpbGUgZm9yIGRldGFpbHMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzXHJcbi8vIGdvdmVybmVkIGJ5IHRoZSBNSVQgbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLlxyXG4vKmpzbGludCBub2RlOiB0cnVlLCBub21lbjogdHJ1ZSAqL1xyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpLFxyXG4gICAgJCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WyckJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWyckJ10gOiBudWxsKSxcclxuICAgIG5hdmlnYXRvciA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WyduYXZpZ2F0b3InXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ25hdmlnYXRvciddIDogbnVsbCksXHJcbiAgICBqb2ludCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydqb2ludCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnam9pbnQnXSA6IG51bGwpLFxyXG4gICAgbW91c2V0cmFwID0gcmVxdWlyZSgnbW91c2V0cmFwJyksXHJcbiAgICBhZGRUb0hpc3RvcnkgPSByZXF1aXJlKCcuL2FkZHRvaGlzdG9yeScpLFxyXG4gICAgb3B0aW1pemVIaXN0b3J5ID0gcmVxdWlyZSgnLi9vcHRpbWl6ZWhpc3RvcnknKSxcclxuICAgIHV0aWxzID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMnKTtcclxuXHJcbmZ1bmN0aW9uIFVuZG9SZWFjdG9yKG9wdGlvbnMpIHtcclxuICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBVbmRvUmVhY3RvcikpIHsgcmV0dXJuIG5ldyBVbmRvUmVhY3RvcihvcHRpb25zKTsgfVxyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblxyXG4gICAgaWYgKCFvcHRpb25zLm1vZGVsIHx8IHR5cGVvZiBvcHRpb25zLm1vZGVsICE9PSAnb2JqZWN0JyB8fCAhKG9wdGlvbnMubW9kZWwgaW5zdGFuY2VvZiBqb2ludC5kaWEuR3JhcGgpKSB7IHRocm93IG5ldyBFcnJvcignbW9kZWwgb3B0aW9uIGlzIG1hbmRhdG9yeScpOyB9XHJcbiAgICBpZiAoIW9wdGlvbnMuZWwpIHsgdGhyb3cgbmV3IEVycm9yKCdlbCBvcHRpb24gaXMgbWFuZGF0b3J5Jyk7IH1cclxuICAgIGlmICgkKG9wdGlvbnMuZWwpLmxlbmd0aCA9PT0gMCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgZWwgb3B0aW9uJyk7IH1cclxuXHJcbiAgICB2YXIgc2VsZiA9IHRoaXMsXHJcbiAgICAgICAgZWwgPSAkKG9wdGlvbnMuZWwpWzBdLFxyXG4gICAgICAgIG1vZGVsID0gb3B0aW9ucy5tb2RlbCxcclxuICAgICAgICB1bmRvaW5nID0gZmFsc2UsXHJcbiAgICAgICAgcmVkb2luZyA9IGZhbHNlLFxyXG4gICAgICAgIHJlY29yZCA9IHRydWUsXHJcbiAgICAgICAgZW52aXJvbm1lbnRzID0gW10sXHJcbiAgICAgICAgY2hhbmdlcyA9IHtcclxuICAgICAgICAgICAgaGlzdG9yeTogW10sXHJcbiAgICAgICAgICAgIGZ1dHVyZTogW11cclxuICAgICAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGN1cnJlbnRDaGFuZ2VzU3RhY2soKSB7XHJcbiAgICAgICAgaWYgKCFyZWNvcmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodW5kb2luZykge1xyXG4gICAgICAgICAgICByZXR1cm4gY2hhbmdlcy5mdXR1cmU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZWRvaW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjaGFuZ2VzLmhpc3Rvcnk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNoYW5nZXMuZnV0dXJlLmxlbmd0aCA9IDA7XHJcbiAgICAgICAgcmV0dXJuIGNoYW5nZXMuaGlzdG9yeTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByZWFwcGx5KGhpc3RvcnkpIHtcclxuICAgICAgICBfKFtoaXN0b3J5XSkuZmxhdHRlbkRlZXAoKVxyXG4gICAgICAgICAgICAuZm9yRWFjaFJpZ2h0KGZ1bmN0aW9uIChzdGVwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RlcC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHV0aWxzLmNoYW5nZUlkKHN0ZXAubW9kZWwsIHN0ZXAuaWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHN0ZXAuZGVsdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGVwLm1vZGVsLnNldChzdGVwLmRlbHRhLCB7dW5kbzogdHJ1ZX0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHN0ZXAuYWRkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RlcC5tb2RlbC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChzdGVwLnJlbW92ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGVsLmFkZENlbGwoc3RlcC5tb2RlbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLmNvbW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG1vZGVsLm9uKCdhZGQnLCBmdW5jdGlvbiAoZWxlbSkge1xyXG4gICAgICAgIHZhciBzdGFjayxcclxuICAgICAgICAgICAgdGFyZ2V0O1xyXG4gICAgICAgIGlmIChlbGVtLmlzTGluaygpICYmICEodW5kb2luZyB8fCByZWRvaW5nKSkge1xyXG4gICAgICAgICAgICB0YXJnZXQgPSBlbGVtLmdldCgndGFyZ2V0Jyk7XHJcbiAgICAgICAgICAgIGlmICghKHRhcmdldCAmJiB0YXJnZXQuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnN0YXJ0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgc3RhY2sgPSBjdXJyZW50Q2hhbmdlc1N0YWNrKCk7XHJcbiAgICAgICAgc3RhY2sucHVzaCh7XHJcbiAgICAgICAgICAgIG1vZGVsOiBlbGVtLFxyXG4gICAgICAgICAgICBhZGQ6IHRydWVcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNob3VsZFN0YXJ0KGVsZW0sIGNoYW5nZWRBdHRyaWJ1dGVzKSB7XHJcbiAgICAgICAgdmFyIGVuZHBvaW50O1xyXG4gICAgICAgIGlmICh1bmRvaW5nIHx8IHJlZG9pbmcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZWxlbS5pc0xpbmsoKSkge1xyXG4gICAgICAgICAgICBpZiAoY2hhbmdlZEF0dHJpYnV0ZXMuc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICBlbmRwb2ludCA9IGVsZW0ucHJldmlvdXMoJ3NvdXJjZScpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVuZHBvaW50ICYmIGVuZHBvaW50LmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQgPSBlbGVtLmdldCgnc291cmNlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEoZW5kcG9pbnQgJiYgZW5kcG9pbnQuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY2hhbmdlZEF0dHJpYnV0ZXMudGFyZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICBlbmRwb2ludCA9IGVsZW0ucHJldmlvdXMoJ3RhcmdldCcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVuZHBvaW50ICYmIGVuZHBvaW50LmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQgPSBlbGVtLmdldCgndGFyZ2V0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEoZW5kcG9pbnQgJiYgZW5kcG9pbnQuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gc2hvdWxkU3RvcChlbGVtLCBjaGFuZ2VkQXR0cmlidXRlcykge1xyXG4gICAgICAgIHZhciBlbmRwb2ludDtcclxuICAgICAgICBpZiAodW5kb2luZyB8fCByZWRvaW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGVsZW0uaXNMaW5rKCkpIHtcclxuICAgICAgICAgICAgaWYgKGNoYW5nZWRBdHRyaWJ1dGVzLnNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgZW5kcG9pbnQgPSBlbGVtLmdldCgnc291cmNlJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZW5kcG9pbnQgJiYgZW5kcG9pbnQuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbmRwb2ludCA9IGVsZW0ucHJldmlvdXMoJ3NvdXJjZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGVuZHBvaW50ICYmIGVuZHBvaW50LmlkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGNoYW5nZWRBdHRyaWJ1dGVzLnRhcmdldCkge1xyXG4gICAgICAgICAgICAgICAgZW5kcG9pbnQgPSBlbGVtLmdldCgndGFyZ2V0Jyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZW5kcG9pbnQgJiYgZW5kcG9pbnQuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbmRwb2ludCA9IGVsZW0ucHJldmlvdXMoJ3RhcmdldCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKGVuZHBvaW50ICYmIGVuZHBvaW50LmlkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIG1vZGVsLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoZWxlbSwgb3B0KSB7XHJcbiAgICAgICAgdmFyIHN0YWNrLFxyXG4gICAgICAgICAgICBjaGFuZ2VkQXR0cmlidXRlcyA9IGVsZW0uY2hhbmdlZEF0dHJpYnV0ZXMoKSxcclxuICAgICAgICAgICAgZW50cnk7XHJcbiAgICAgICAgZGVsZXRlIGNoYW5nZWRBdHRyaWJ1dGVzLmF0dHJzO1xyXG4gICAgICAgIGlmICghXy5rZXlzKGNoYW5nZWRBdHRyaWJ1dGVzKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2hvdWxkU3RhcnQoZWxlbSwgY2hhbmdlZEF0dHJpYnV0ZXMpKSB7XHJcbiAgICAgICAgICAgIHNlbGYuc3RhcnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc3RhY2sgPSBjdXJyZW50Q2hhbmdlc1N0YWNrKCk7XHJcbiAgICAgICAgZW50cnkgPSB7XHJcbiAgICAgICAgICAgIG1vZGVsOiBlbGVtLFxyXG4gICAgICAgICAgICBkZWx0YTogXy5tYXBWYWx1ZXMoY2hhbmdlZEF0dHJpYnV0ZXMsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICBfLm5vb3AodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0ucHJldmlvdXMoa2V5KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChlbnRyeS5kZWx0YS5pZCkge1xyXG4gICAgICAgICAgICBlbnRyeS5pZCA9IGVudHJ5LmRlbHRhLmlkO1xyXG4gICAgICAgICAgICBkZWxldGUgZW50cnkuZGVsdGEuaWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGFkZFRvSGlzdG9yeShzdGFjaywgZW50cnksIG9wdCk7XHJcbiAgICAgICAgaWYgKHNob3VsZFN0b3AoZWxlbSwgY2hhbmdlZEF0dHJpYnV0ZXMpKSB7XHJcbiAgICAgICAgICAgIHNlbGYuc3RvcCgpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgbW9kZWwub24oJ3JlbW92ZScsIGZ1bmN0aW9uIChlbGVtKSB7XHJcbiAgICAgICAgdmFyIHN0YWNrID0gY3VycmVudENoYW5nZXNTdGFjaygpO1xyXG4gICAgICAgIHN0YWNrLnB1c2goe1xyXG4gICAgICAgICAgICBtb2RlbDogZWxlbSxcclxuICAgICAgICAgICAgcmVtb3ZlOiB0cnVlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBzZWxmLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNoYW5nZXMuZnV0dXJlLmxlbmd0aCA9IDA7XHJcbiAgICAgICAgZW52aXJvbm1lbnRzLnB1c2goY2hhbmdlcyk7XHJcbiAgICAgICAgY2hhbmdlcyA9IHtcclxuICAgICAgICAgICAgaGlzdG9yeTogW10sXHJcbiAgICAgICAgICAgIGZ1dHVyZTogW11cclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBzZWxmLnN0b3AgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCFlbnZpcm9ubWVudHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGhpc3RvcnkgPSBvcHRpbWl6ZUhpc3RvcnkoY2hhbmdlcy5oaXN0b3J5KTtcclxuICAgICAgICBjaGFuZ2VzID0gZW52aXJvbm1lbnRzLnBvcCgpO1xyXG4gICAgICAgIGlmIChoaXN0b3J5Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICBpZiAoaGlzdG9yeS5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIGhpc3RvcnkgPSBfLmhlYWQoaGlzdG9yeSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2hhbmdlcy5oaXN0b3J5LnB1c2goaGlzdG9yeSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIHNlbGYudW5kbyA9IGZ1bmN0aW9uIChzYXZlKSB7XHJcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICAgIHNhdmUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWNoYW5nZXMuaGlzdG9yeS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB1bmRvaW5nID0gdHJ1ZTtcclxuICAgICAgICByZWNvcmQgPSBzYXZlO1xyXG4gICAgICAgIHZhciBzdGVwID0gY2hhbmdlcy5oaXN0b3J5LnBvcCgpLFxyXG4gICAgICAgICAgICBmdXR1cmUgPSBjaGFuZ2VzLmZ1dHVyZS5zbGljZSgpO1xyXG4gICAgICAgIHNlbGYuc3RhcnQoKTtcclxuICAgICAgICByZWFwcGx5KHN0ZXApO1xyXG4gICAgICAgIGZ1dHVyZS5wdXNoKF8uZmxhdHRlbkRlZXAoY2hhbmdlcy5mdXR1cmUpKTtcclxuICAgICAgICBzZWxmLnN0b3AoKTtcclxuICAgICAgICBjaGFuZ2VzLmZ1dHVyZSA9IGZ1dHVyZTtcclxuICAgICAgICB1bmRvaW5nID0gZmFsc2U7XHJcbiAgICAgICAgcmVjb3JkID0gdHJ1ZTtcclxuICAgIH07XHJcblxyXG4gICAgc2VsZi5yZWRvID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICghY2hhbmdlcy5mdXR1cmUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVkb2luZyA9IHRydWU7XHJcbiAgICAgICAgdmFyIHN0ZXAgPSBjaGFuZ2VzLmZ1dHVyZS5wb3AoKSxcclxuICAgICAgICAgICAgZnV0dXJlID0gY2hhbmdlcy5mdXR1cmUuc2xpY2UoKTtcclxuICAgICAgICBzZWxmLnN0YXJ0KCk7XHJcbiAgICAgICAgcmVhcHBseShzdGVwKTtcclxuICAgICAgICBzZWxmLnN0b3AoKTtcclxuICAgICAgICBjaGFuZ2VzLmZ1dHVyZSA9IGZ1dHVyZTtcclxuICAgICAgICByZWRvaW5nID0gZmFsc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIHNlbGYuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZW52aXJvbm1lbnRzID0gW107XHJcbiAgICAgICAgY2hhbmdlcyA9IHtcclxuICAgICAgICAgICAgaGlzdG9yeTogW10sXHJcbiAgICAgICAgICAgIGZ1dHVyZTogW11cclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBtb3VzZXRyYXAoZWwpLmJpbmQoJ21vZCt6JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNlbGYudW5kbygpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0pO1xyXG4gICAgbW91c2V0cmFwKGVsKS5iaW5kKC9NYWN8aVBvZHxpUGhvbmV8aVBhZC8udGVzdChuYXZpZ2F0b3IucGxhdGZvcm0pID8gJ21vZCtzaGlmdCt6JyA6ICdtb2QreScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBzZWxmLnJlZG8oKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0cy5VbmRvUmVhY3RvciA9IFVuZG9SZWFjdG9yO1xyXG4iLCIvLyBDb3B5cmlnaHQgKGMpIDIwMTgsIHRoZSBBTE1Pc1QgcHJvamVjdCBhdXRob3JzLiBQbGVhc2Ugc2VlIHRoZVxyXG4vLyBBVVRIT1JTIGZpbGUgZm9yIGRldGFpbHMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzXHJcbi8vIGdvdmVybmVkIGJ5IHRoZSBNSVQgbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLlxyXG4vKmpzbGludCBub2RlOiB0cnVlLCBub21lbjogdHJ1ZSAqL1xyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpLFxyXG4gICAgaGFzRWZmZWN0ID0gcmVxdWlyZSgnLi9oYXNlZmZlY3QnKTtcclxuXHJcbmZ1bmN0aW9uIGNvbXByZXNzU2VxdWVuY2VzKGhpc3RvcnkpIHtcclxuICAgIHZhciBvcHRpbWl6ZWQgPSBbXSxcclxuICAgICAgICBsYXN0ID0gbnVsbDtcclxuICAgIF8uZm9yRWFjaFJpZ2h0KGhpc3RvcnksIGZ1bmN0aW9uIChjdXJyZW50KSB7XHJcbiAgICAgICAgdmFyIGlkO1xyXG4gICAgICAgIGlmIChjdXJyZW50LmRlbHRhKSB7XHJcbiAgICAgICAgICAgIGlmIChsYXN0ICYmIGxhc3QubW9kZWwgPT09IGN1cnJlbnQubW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIGlkID0gbGFzdC5pZCB8fCBjdXJyZW50LmlkO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFzdC5pZCA9IGlkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGFzdC5kZWx0YSA9IF8uYXNzaWduKGxhc3QuZGVsdGEsIGN1cnJlbnQuZGVsdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGFzdCA9IGN1cnJlbnQ7XHJcbiAgICAgICAgICAgICAgICBvcHRpbWl6ZWQudW5zaGlmdChjdXJyZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9wdGltaXplZC51bnNoaWZ0KGN1cnJlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG9wdGltaXplZDtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVtb3ZlVW5uZWNlc3NhcnlUYWlsKGhpc3RvcnkpIHtcclxuICAgIHZhciByZW1vdmUgPSBfLnRha2VSaWdodFdoaWxlKGhpc3RvcnksIGZ1bmN0aW9uIChjdXJyZW50KSB7XHJcbiAgICAgICAgaWYgKGN1cnJlbnQuZGVsdGEpIHtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnQuaWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gIWhhc0VmZmVjdChjdXJyZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gXy5kaWZmZXJlbmNlKGhpc3RvcnksIHJlbW92ZSk7XHJcbn1cclxuXHJcbnZhciBvcHRpbWl6ZUhpc3RvcnkgPSBfLmZsb3coXHJcbiAgICBfLmZsYXR0ZW5EZWVwLFxyXG4gICAgY29tcHJlc3NTZXF1ZW5jZXMsXHJcbiAgICByZW1vdmVVbm5lY2Vzc2FyeVRhaWxcclxuKTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gb3B0aW1pemVIaXN0b3J5O1xyXG4iLCIvLyBDb3B5cmlnaHQgKGMpIDIwMTYsIHRoZSBBTE1Pc1QgcHJvamVjdCBhdXRob3JzLiBQbGVhc2Ugc2VlIHRoZVxyXG4vLyBBVVRIT1JTIGZpbGUgZm9yIGRldGFpbHMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzXHJcbi8vIGdvdmVybmVkIGJ5IHRoZSBNSVQgbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLlxyXG4vKmpzbGludCBub2RlOiB0cnVlICovXHJcblwidXNlIHN0cmljdFwiO1xyXG5cclxudmFyIGpvaW50ID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ2pvaW50J10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydqb2ludCddIDogbnVsbCk7XHJcblxyXG5mdW5jdGlvbiBpZ25vcmUoKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cclxuXHJcbmV4cG9ydHMudmFsaWRhdGVDb25uZWN0aW9uID0gZnVuY3Rpb24gKGNlbGxWaWV3UywgbWFnbmV0UywgY2VsbFZpZXdULCBtYWduZXRULCBlbmQsIGxpbmtWaWV3KSB7XHJcbiAgICBpZ25vcmUobWFnbmV0UywgbWFnbmV0VCk7XHJcbiAgICBpZiAoY2VsbFZpZXdTID09PSBjZWxsVmlld1QpIHsgcmV0dXJuIGZhbHNlOyB9XHJcbiAgICBpZiAobGlua1ZpZXcubW9kZWwudmFsaWRhdGVDb25uZWN0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIGxpbmtWaWV3Lm1vZGVsLnZhbGlkYXRlQ29ubmVjdGlvbihjZWxsVmlld1MsIG1hZ25ldFMsIGNlbGxWaWV3VCwgbWFnbmV0VCwgZW5kLCBsaW5rVmlldyk7XHJcbiAgICB9XHJcbiAgICBpZiAoZW5kID09PSAnc291cmNlJykge1xyXG4gICAgICAgIHJldHVybiAtMSAhPT0gbGlua1ZpZXcubW9kZWwudmFsaWRTb3VyY2VzLmluZGV4T2YoY2VsbFZpZXdTLm1vZGVsLmdldCgndHlwZScpKTtcclxuICAgIH1cclxuICAgIHJldHVybiAtMSAhPT0gbGlua1ZpZXcubW9kZWwudmFsaWRUYXJnZXRzLmluZGV4T2YoY2VsbFZpZXdULm1vZGVsLmdldCgndHlwZScpKTtcclxufTtcclxuIiwiLy8gQ29weXJpZ2h0IChjKSAyMDE2LCB0aGUgQUxNT3NUIHByb2plY3QgYXV0aG9ycy4gUGxlYXNlIHNlZSB0aGVcclxuLy8gQVVUSE9SUyBmaWxlIGZvciBkZXRhaWxzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpc1xyXG4vLyBnb3Zlcm5lZCBieSB0aGUgTUlUIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS5cclxuLypqc2xpbnQgbm9kZTogdHJ1ZSwgbm9tZW46IHRydWUgKi9cclxuXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKSxcclxuICAgICQgPSAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvd1snJCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnJCddIDogbnVsbCksXHJcbiAgICBqb2ludCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydqb2ludCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnam9pbnQnXSA6IG51bGwpO1xyXG5cclxuZnVuY3Rpb24gWm9vbVJlYWN0b3Iob3B0aW9ucykge1xyXG4gICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFpvb21SZWFjdG9yKSkgeyByZXR1cm4gbmV3IFpvb21SZWFjdG9yKG9wdGlvbnMpOyB9XHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuXHJcbiAgICBpZiAoIW9wdGlvbnMucGFwZXIgfHwgdHlwZW9mIG9wdGlvbnMucGFwZXIgIT09ICdvYmplY3QnIHx8ICEob3B0aW9ucy5wYXBlciBpbnN0YW5jZW9mIGpvaW50LmRpYS5QYXBlcikpIHsgdGhyb3cgbmV3IEVycm9yKCdwYXBlciBvcHRpb24gaXMgbWFuZGF0b3J5Jyk7IH1cclxuICAgIGlmICghb3B0aW9ucy5tb2RlbCB8fCB0eXBlb2Ygb3B0aW9ucy5tb2RlbCAhPT0gJ29iamVjdCcpIHsgdGhyb3cgbmV3IEVycm9yKCdtb2RlbCBvcHRpb24gaXMgbWFuZGF0b3J5Jyk7IH1cclxuICAgIGlmICghb3B0aW9ucy5lbCkgeyB0aHJvdyBuZXcgRXJyb3IoJ2VsIG9wdGlvbiBpcyBtYW5kYXRvcnknKTsgfVxyXG4gICAgaWYgKCQob3B0aW9ucy5lbCkubGVuZ3RoID09PSAwKSB7IHRocm93IG5ldyBFcnJvcignaW52YWxpZCBlbCBvcHRpb24nKTsgfVxyXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLm1pblNjYWxlICE9PSAnbnVtYmVyJykgeyB0aHJvdyBuZXcgRXJyb3IoJ21pblNjYWxlIG9wdGlvbiBpcyBtYW5kYXRvcnkgYW5kIGhhcyB0byBiZSBhIG51bWJlcicpOyB9XHJcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMubWF4U2NhbGUgIT09ICdudW1iZXInKSB7IHRocm93IG5ldyBFcnJvcignbWF4U2NhbGUgb3B0aW9uIGlzIG1hbmRhdG9yeSBhbmQgaGFzIHRvIGJlIGEgbnVtYmVyJyk7IH1cclxuICAgIGlmIChvcHRpb25zLm1pblNjYWxlIDwgMCkgeyB0aHJvdyBuZXcgRXJyb3IoJ21pblNjYWxlIGNhbm5vdCBiZSBsZXNzIHRoYW4gemVybycpOyB9XHJcbiAgICBpZiAob3B0aW9ucy5taW5TY2FsZSA+IG9wdGlvbnMubWF4U2NhbGUpIHsgdGhyb3cgbmV3IEVycm9yKCdtYXhTY2FsZSBjYW5ub3QgYmUgbGVzcyB0aGUgbWluU2NhbGUnKTsgfVxyXG5cclxuICAgIHZhciBzZWxmID0gdGhpcyxcclxuICAgICAgICBlbCA9ICQoJChvcHRpb25zLmVsKVswXSksXHJcbiAgICAgICAgcGFwZXIgPSBvcHRpb25zLnBhcGVyLFxyXG4gICAgICAgIG1vZGVsID0gb3B0aW9ucy5tb2RlbCxcclxuICAgICAgICBtaW5TY2FsZSA9IG9wdGlvbnMubWluU2NhbGUsXHJcbiAgICAgICAgbWF4U2NhbGUgPSBvcHRpb25zLm1heFNjYWxlLFxyXG4gICAgICAgIHBhZGRpbmdab29tRSA9IHt3aWR0aDogNTAsIGhlaWdodDogNTB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZVNjYWxlKHNjYWxlKSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWluKE1hdGgubWF4KHNjYWxlLCBtaW5TY2FsZSksIG1heFNjYWxlKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBtb3VzZXdoZWVsKGUsIGRlbHRhKSB7XHJcbiAgICAgICAgdmFyIHggPSBlLmNsaWVudFgsXHJcbiAgICAgICAgICAgIHkgPSBlLmNsaWVudFksXHJcbiAgICAgICAgICAgIGxlZnQgPSBlbC5vZmZzZXQoKS5sZWZ0LFxyXG4gICAgICAgICAgICB0b3AgPSBlbC5vZmZzZXQoKS50b3AsXHJcbiAgICAgICAgICAgIHdpZHRoID0gZWwud2lkdGgoKSxcclxuICAgICAgICAgICAgaGVpZ2h0ID0gZWwuaGVpZ2h0KCksXHJcbiAgICAgICAgICAgIHRvcExlZnQgPSBqb2ludC5nLnBvaW50KGxlZnQsIHRvcCksXHJcbiAgICAgICAgICAgIGJvdHRvbVJpZ2h0ID0gam9pbnQuZy5wb2ludChsZWZ0ICsgd2lkdGgsIHRvcCArIGhlaWdodCksXHJcbiAgICAgICAgICAgIGN1cnJlbnQgPSBqb2ludC5nLnBvaW50KHgsIHkpLFxyXG4gICAgICAgICAgICBtaW5Mb2NhbCA9IHBhcGVyLmNsaWVudFRvTG9jYWxQb2ludCh0b3BMZWZ0KSxcclxuICAgICAgICAgICAgbWF4TG9jYWwgPSBwYXBlci5jbGllbnRUb0xvY2FsUG9pbnQoYm90dG9tUmlnaHQpLFxyXG4gICAgICAgICAgICBzdGFydExvY2FsID0gcGFwZXIuY2xpZW50VG9Mb2NhbFBvaW50KGN1cnJlbnQpLFxyXG4gICAgICAgICAgICBzY2FsZSA9IHt4OiB3aWR0aCAvIChtYXhMb2NhbC54IC0gbWluTG9jYWwueCksIHk6IGhlaWdodCAvIChtYXhMb2NhbC55IC0gbWluTG9jYWwueSl9LFxyXG4gICAgICAgICAgICBvZmZzZXRDbGllbnQsXHJcbiAgICAgICAgICAgIG9yaWdpbjtcclxuICAgICAgICBzY2FsZSA9IG5vcm1hbGl6ZVNjYWxlKHNjYWxlLnggKiBNYXRoLnBvdygxLjEsIGRlbHRhKSk7XHJcbiAgICAgICAgcGFwZXIuc2NhbGUoc2NhbGUsIHNjYWxlKTtcclxuICAgICAgICBtaW5Mb2NhbCA9IHBhcGVyLmNsaWVudFRvTG9jYWxQb2ludCh0b3BMZWZ0KTtcclxuICAgICAgICBtYXhMb2NhbCA9IHBhcGVyLmNsaWVudFRvTG9jYWxQb2ludChib3R0b21SaWdodCk7XHJcbiAgICAgICAgc2NhbGUgPSBqb2ludC5nLnBvaW50KHdpZHRoIC8gKG1heExvY2FsLnggLSBtaW5Mb2NhbC54KSwgaGVpZ2h0IC8gKG1heExvY2FsLnkgLSBtaW5Mb2NhbC55KSk7XHJcbiAgICAgICAgb2Zmc2V0Q2xpZW50ID0gam9pbnQuZy5wb2ludChzdGFydExvY2FsLnggKiBzY2FsZS54LCBzdGFydExvY2FsLnkgKiBzY2FsZS55KTtcclxuICAgICAgICBvcmlnaW4gPSBqb2ludC5nLnBvaW50KHggLSBvZmZzZXRDbGllbnQueCwgeSAtIG9mZnNldENsaWVudC55KTtcclxuXHJcbiAgICAgICAgcGFwZXIuc2V0T3JpZ2luKG9yaWdpbi54IC0gbGVmdCwgb3JpZ2luLnkgLSB0b3ApO1xyXG5cclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcG9pbnRlcmRibGNsaWNrKCkge1xyXG4gICAgICAgIGlmIChtb2RlbC5nZXRFbGVtZW50cygpLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cclxuICAgICAgICAvLyBpdCBpcyBzaW1pbGFyIHRvIHBhcGVyLnNjYWxlQ29udGVudFRvRml0KCk7IGJ1dCBpIHJlcXVpcmUgdG8gZG8gaXQgbWFudWFsbHkgdG8gY2hhbmdlIGV2ZW4gdGhlIG9yaWdpblxyXG4gICAgICAgIHZhciB3aWR0aCA9IGVsLndpZHRoKCkgLSBwYWRkaW5nWm9vbUUud2lkdGggKiAyLFxyXG4gICAgICAgICAgICBoZWlnaHQgPSBlbC5oZWlnaHQoKSAtIHBhZGRpbmdab29tRS5oZWlnaHQgKiAyLFxyXG4gICAgICAgICAgICBiYm94ID0gbW9kZWwuZ2V0QkJveChtb2RlbC5nZXRFbGVtZW50cygpLCB7dXNlTW9kZWxHZW9tZXRyeTogdHJ1ZX0pLFxyXG4gICAgICAgICAgICBzY2FsZVggPSB3aWR0aCAvIGJib3gud2lkdGgsXHJcbiAgICAgICAgICAgIHNjYWxlWSA9IGhlaWdodCAvIGJib3guaGVpZ2h0LFxyXG4gICAgICAgICAgICBzY2FsZSA9IE1hdGgubWF4KE1hdGgubWluKHNjYWxlWCwgc2NhbGVZLCBtYXhTY2FsZSksIG1pblNjYWxlKSxcclxuICAgICAgICAgICAgb3ggPSAod2lkdGggLSBiYm94LndpZHRoICogc2NhbGUpIC8gMiAtIGJib3gueCAqIHNjYWxlLFxyXG4gICAgICAgICAgICBveSA9IChoZWlnaHQgLSBiYm94LmhlaWdodCAqIHNjYWxlKSAvIDIgLSBiYm94LnkgKiBzY2FsZTtcclxuXHJcbiAgICAgICAgcGFwZXIuc2NhbGUoc2NhbGUsIHNjYWxlKTtcclxuICAgICAgICBwYXBlci5zZXRPcmlnaW4ob3ggKyBwYWRkaW5nWm9vbUUud2lkdGgsIG95ICsgcGFkZGluZ1pvb21FLmhlaWdodCk7XHJcbiAgICB9XHJcblxyXG4gICAgcGFwZXIub24oJ2JsYW5rOnBvaW50ZXJkYmxjbGljaycsIHBvaW50ZXJkYmxjbGljayk7XHJcbiAgICBwYXBlci5vbignYmxhbms6bW91c2V3aGVlbCcsIF8ucmVhcmcobW91c2V3aGVlbCwgMCwgMykpO1xyXG4gICAgcGFwZXIub24oJ2NlbGw6bW91c2V3aGVlbCcsIF8ucmVhcmcobW91c2V3aGVlbCwgMSwgNCkpO1xyXG5cclxuICAgIHNlbGYuem9vbUUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcG9pbnRlcmRibGNsaWNrKCk7XHJcbiAgICB9O1xyXG59XHJcblxyXG5leHBvcnRzLlpvb21SZWFjdG9yID0gWm9vbVJlYWN0b3I7XHJcbiIsIi8vIENvcHlyaWdodCAoYykgMjAxOCwgdGhlIEFMTU9zVCBwcm9qZWN0IGF1dGhvcnMuIFBsZWFzZSBzZWUgdGhlXHJcbi8vIEFVVEhPUlMgZmlsZSBmb3IgZGV0YWlscy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXNcclxuLy8gZ292ZXJuZWQgYnkgdGhlIE1JVCBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuXHJcbi8qanNsaW50IG5vZGU6IHRydWUsIG5vbWVuOiB0cnVlKi9cclxuXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG52YXIgXyA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93WydfJ10gOiB0eXBlb2YgZ2xvYmFsICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsWydfJ10gOiBudWxsKTtcclxuXHJcbmZ1bmN0aW9uIGNoYW5nZUlkKGNlbGwsIG5ld0lkKSB7XHJcbiAgICB2YXIgb2xkSWQgPSBjZWxsLmdldCgnaWQnKSxcclxuICAgICAgICBncmFwaCA9IGNlbGwuZ3JhcGgsXHJcbiAgICAgICAgY2VsbHMsXHJcbiAgICAgICAgaW5ib3VuZExpbmtzLFxyXG4gICAgICAgIG91dGJvdW5kTGlua3MsXHJcbiAgICAgICAgcGFyZW50LFxyXG4gICAgICAgIGVtYmVkcztcclxuXHJcbiAgICBpZiAob2xkSWQgPT09IG5ld0lkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFncmFwaCkge1xyXG4gICAgICAgIGNlbGwuc2V0KCdpZCcsIG5ld0lkKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZ3JhcGguZ2V0Q2VsbChuZXdJZCkpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgY2VsbHMgPSBncmFwaC5nZXRDZWxscygpO1xyXG4gICAgaW5ib3VuZExpbmtzID0gZ3JhcGguZ2V0Q29ubmVjdGVkTGlua3MoY2VsbCwgeyBpbmJvdW5kOiB0cnVlIH0pO1xyXG4gICAgb3V0Ym91bmRMaW5rcyA9IGdyYXBoLmdldENvbm5lY3RlZExpbmtzKGNlbGwsIHsgb3V0Ym91bmQ6IHRydWUgfSk7XHJcbiAgICBwYXJlbnQgPSBncmFwaC5nZXRDZWxsKGNlbGwuZ2V0KCdwYXJlbnQnKSk7XHJcbiAgICBlbWJlZHMgPSBjZWxsLmdldEVtYmVkZGVkQ2VsbHMoKTtcclxuXHJcbiAgICBjZWxsLnNldCgnaWQnLCBuZXdJZCwge3NpbGVudDogdHJ1ZX0pO1xyXG4gICAgXy5mb3JFYWNoKGVtYmVkcywgZnVuY3Rpb24gKGNlbGwpIHtcclxuICAgICAgICBjZWxsLnNldCgncGFyZW50JywgbmV3SWQsIHtzaWxlbnQ6IHRydWV9KTtcclxuICAgIH0pO1xyXG4gICAgaWYgKHBhcmVudCkge1xyXG4gICAgICAgIGVtYmVkcyA9IHBhcmVudC5nZXQoJ2VtYmVkcycpO1xyXG4gICAgICAgIGVtYmVkc1tlbWJlZHMuaW5kZXhPZihvbGRJZCldID0gbmV3SWQ7XHJcbiAgICAgICAgcGFyZW50LnNldCgnZW1iZWRzJywgZW1iZWRzLCB7c2lsZW50OiB0cnVlfSk7XHJcbiAgICB9XHJcbiAgICBfLmZvckVhY2goaW5ib3VuZExpbmtzLCBmdW5jdGlvbiAobGluaykge1xyXG4gICAgICAgIGxpbmsucHJvcCgndGFyZ2V0L2lkJywgbmV3SWQsIHtzaWxlbnQ6IHRydWV9KTtcclxuICAgIH0pO1xyXG4gICAgXy5mb3JFYWNoKG91dGJvdW5kTGlua3MsIGZ1bmN0aW9uIChsaW5rKSB7XHJcbiAgICAgICAgbGluay5wcm9wKCdzb3VyY2UvaWQnLCBuZXdJZCwge3NpbGVudDogdHJ1ZX0pO1xyXG4gICAgfSk7XHJcbiAgICBncmFwaC5yZXNldENlbGxzKGNlbGxzKTtcclxuICAgIGNlbGwuc2V0KCdpZCcsIG9sZElkLCB7c2lsZW50OiB0cnVlfSk7XHJcbiAgICBjZWxsLnNldCgnaWQnLCBuZXdJZCk7XHJcblxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmV4cG9ydHMuY2hhbmdlSWQgPSBjaGFuZ2VJZDtcclxuIiwiLy8gQ29weXJpZ2h0IChjKSAyMDE2LCB0aGUgQUxNT3NUIHByb2plY3QgYXV0aG9ycy4gUGxlYXNlIHNlZSB0aGVcclxuLy8gQVVUSE9SUyBmaWxlIGZvciBkZXRhaWxzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpc1xyXG4vLyBnb3Zlcm5lZCBieSB0aGUgTUlUIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS5cclxuLypqc2xpbnQgbm9kZTogdHJ1ZSovXHJcblwidXNlIHN0cmljdFwiO1xyXG5cclxuZXhwb3J0cy5zb3J0Q2VsbHMgPSByZXF1aXJlKCcuL3NvcnRjZWxscycpLnNvcnRDZWxscztcclxuZXhwb3J0cy5jaGFuZ2VJZCA9IHJlcXVpcmUoJy4vY2hhbmdlaWQnKS5jaGFuZ2VJZDtcclxuZXhwb3J0cy5pc0Z1bGx5Q29udGFpbmVkID0gcmVxdWlyZSgnLi9pc2Z1bGx5Y29udGFpbmVkJykuaXNGdWxseUNvbnRhaW5lZDtcclxuIiwiLy8gQ29weXJpZ2h0IChjKSAyMDE4LCB0aGUgQUxNT3NUIHByb2plY3QgYXV0aG9ycy4gUGxlYXNlIHNlZSB0aGVcclxuLy8gQVVUSE9SUyBmaWxlIGZvciBkZXRhaWxzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpc1xyXG4vLyBnb3Zlcm5lZCBieSB0aGUgTUlUIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS5cclxuLypqc2xpbnQgbm9kZTogdHJ1ZSwgbm9tZW46IHRydWUqL1xyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbnZhciBqb2ludCA9ICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93Wydqb2ludCddIDogdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbFsnam9pbnQnXSA6IG51bGwpO1xyXG5cclxuZnVuY3Rpb24gaXNGdWxseUNvbnRhaW5lZChlbGVtZW50LCBwYXJlbnQpIHtcclxuICAgIGlmIChwYXJlbnQuaWQgPT09IGVsZW1lbnQuaWQpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICB2YXIgYmJveCA9IGVsZW1lbnQuZ2V0QkJveCh7dXNlTW9kZWxHZW9tZXRyeTogdHJ1ZX0pLFxyXG4gICAgICAgIHBhZGRpbmcgPSBwYXJlbnQucGFkZGluZyxcclxuICAgICAgICBwYmJveCA9IHBhcmVudC5nZXRCQm94KHt1c2VNb2RlbEdlb21ldHJ5OiB0cnVlfSksXHJcbiAgICAgICAgcGludGVybmFsID0gam9pbnQuZy5yZWN0KFxyXG4gICAgICAgICAgICBwYmJveC54ICsgcGFkZGluZy5sZWZ0LFxyXG4gICAgICAgICAgICBwYmJveC55ICsgcGFkZGluZy50b3AsXHJcbiAgICAgICAgICAgIHBiYm94LndpZHRoIC0gcGFkZGluZy5sZWZ0IC0gcGFkZGluZy5yaWdodCxcclxuICAgICAgICAgICAgcGJib3guaGVpZ2h0IC0gcGFkZGluZy50b3AgLSBwYWRkaW5nLmJvdHRvbVxyXG4gICAgICAgICk7XHJcbiAgICByZXR1cm4gcGludGVybmFsLmNvbnRhaW5zUmVjdChiYm94KTtcclxufVxyXG5cclxuZXhwb3J0cy5pc0Z1bGx5Q29udGFpbmVkID0gaXNGdWxseUNvbnRhaW5lZDtcclxuIiwiLy8gQ29weXJpZ2h0IChjKSAyMDE2LCB0aGUgQUxNT3NUIHByb2plY3QgYXV0aG9ycy4gUGxlYXNlIHNlZSB0aGVcclxuLy8gQVVUSE9SUyBmaWxlIGZvciBkZXRhaWxzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpc1xyXG4vLyBnb3Zlcm5lZCBieSB0aGUgTUlUIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS5cclxuLypqc2xpbnQgbm9kZTogdHJ1ZSwgbm9tZW46IHRydWUqL1xyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbnZhciBfID0gKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3dbJ18nXSA6IHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxbJ18nXSA6IG51bGwpO1xyXG5cclxuZnVuY3Rpb24gY29tcHV0ZUFuY2VzdG9ycyhpZCwgbG9va3VwKSB7XHJcbiAgICBpZiAoIWlkKSB7IHJldHVybiBfKFtdKTsgfVxyXG4gICAgcmV0dXJuIGNvbXB1dGVBbmNlc3RvcnMobG9va3VwW2lkXS5nZXQoJ3BhcmVudCcpLCBsb29rdXApLmNvbmNhdChpZCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNvcnRDZWxscyhjZWxscykge1xyXG4gICAgdmFyIGxvb2t1cCA9IF8uemlwT2JqZWN0KF8ubWFwKGNlbGxzLCBmdW5jdGlvbiAoY2VsbCkgeyByZXR1cm4gW2NlbGwuaWQsIGNlbGxdOyB9KSksXHJcbiAgICAgICAgYW5jZXN0b3JzID0gXy56aXBPYmplY3QoXy5tYXAoY2VsbHMsIGZ1bmN0aW9uIChjZWxsKSB7IHJldHVybiBbY2VsbC5pZCwgY29tcHV0ZUFuY2VzdG9ycyhjZWxsLmlkLCBsb29rdXApLnZhbHVlKCldOyB9KSk7XHJcbiAgICBmdW5jdGlvbiBjb21wYXJlUmVsYXRpdmVzKGNlbGwxLCBjZWxsMikge1xyXG4gICAgICAgIHZhciBwYXJlbnQgPSBsb29rdXBbY2VsbDEuZ2V0KCdwYXJlbnQnKV0sXHJcbiAgICAgICAgICAgIGVtYmVkcztcclxuICAgICAgICBpZiAocGFyZW50KSB7XHJcbiAgICAgICAgICAgIGVtYmVkcyA9IHBhcmVudC5nZXQoJ2VtYmVkcycpO1xyXG4gICAgICAgICAgICByZXR1cm4gZW1iZWRzLmluZGV4T2YoY2VsbDEuaWQpIC0gZW1iZWRzLmluZGV4T2YoY2VsbDIuaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY2VsbDEuaWQgPCBjZWxsMi5pZCA/IC0xIDogMTtcclxuICAgIH1cclxuICAgIHJldHVybiBjZWxscy5zb3J0KGZ1bmN0aW9uIChjZWxsMSwgY2VsbDIpIHtcclxuICAgICAgICBpZiAoY2VsbDEuaXNMaW5rKCkgIT09IGNlbGwyLmlzTGluaygpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjZWxsMi5pc0xpbmsoKSA/IC0xIDogMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNlbGwxLmlzTGluaygpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjZWxsMS5pZCA8IGNlbGwyLmlkID8gLTEgOiAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgYW5jZXN0b3JzMSA9IGFuY2VzdG9yc1tjZWxsMS5pZF0sXHJcbiAgICAgICAgICAgIGFuY2VzdG9yczIgPSBhbmNlc3RvcnNbY2VsbDIuaWRdLFxyXG4gICAgICAgICAgICBjb21tb25VbmNlc3RvcnM7XHJcbiAgICAgICAgaWYgKGFuY2VzdG9yczEubGVuZ3RoIDwgYW5jZXN0b3JzMi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYW5jZXN0b3JzMS5sZW5ndGggPiBhbmNlc3RvcnMyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29tbW9uVW5jZXN0b3JzID0gXy5pbnRlcnNlY3Rpb24oYW5jZXN0b3JzMSwgYW5jZXN0b3JzMik7XHJcbiAgICAgICAgYW5jZXN0b3JzMSA9IGFuY2VzdG9yczEuc2xpY2UoY29tbW9uVW5jZXN0b3JzLmxlbmd0aCk7XHJcbiAgICAgICAgYW5jZXN0b3JzMiA9IGFuY2VzdG9yczIuc2xpY2UoY29tbW9uVW5jZXN0b3JzLmxlbmd0aCk7XHJcbiAgICAgICAgaWYgKGFuY2VzdG9yczEubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb21wYXJlUmVsYXRpdmVzKGNlbGwxLCBjZWxsMik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjb21wYXJlUmVsYXRpdmVzKGxvb2t1cFthbmNlc3RvcnMxWzBdXSwgbG9va3VwW2FuY2VzdG9yczJbMF1dKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnRzLnNvcnRDZWxscyA9IHNvcnRDZWxscztcclxuIiwiLypnbG9iYWwgZGVmaW5lOmZhbHNlICovXG4vKipcbiAqIENvcHlyaWdodCAyMDEyLTIwMTcgQ3JhaWcgQ2FtcGJlbGxcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqXG4gKiBNb3VzZXRyYXAgaXMgYSBzaW1wbGUga2V5Ym9hcmQgc2hvcnRjdXQgbGlicmFyeSBmb3IgSmF2YXNjcmlwdCB3aXRoXG4gKiBubyBleHRlcm5hbCBkZXBlbmRlbmNpZXNcbiAqXG4gKiBAdmVyc2lvbiAxLjYuNVxuICogQHVybCBjcmFpZy5pcy9raWxsaW5nL21pY2VcbiAqL1xuKGZ1bmN0aW9uKHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuXG4gICAgLy8gQ2hlY2sgaWYgbW91c2V0cmFwIGlzIHVzZWQgaW5zaWRlIGJyb3dzZXIsIGlmIG5vdCwgcmV0dXJuXG4gICAgaWYgKCF3aW5kb3cpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIG1hcHBpbmcgb2Ygc3BlY2lhbCBrZXljb2RlcyB0byB0aGVpciBjb3JyZXNwb25kaW5nIGtleXNcbiAgICAgKlxuICAgICAqIGV2ZXJ5dGhpbmcgaW4gdGhpcyBkaWN0aW9uYXJ5IGNhbm5vdCB1c2Uga2V5cHJlc3MgZXZlbnRzXG4gICAgICogc28gaXQgaGFzIHRvIGJlIGhlcmUgdG8gbWFwIHRvIHRoZSBjb3JyZWN0IGtleWNvZGVzIGZvclxuICAgICAqIGtleXVwL2tleWRvd24gZXZlbnRzXG4gICAgICpcbiAgICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgICAqL1xuICAgIHZhciBfTUFQID0ge1xuICAgICAgICA4OiAnYmFja3NwYWNlJyxcbiAgICAgICAgOTogJ3RhYicsXG4gICAgICAgIDEzOiAnZW50ZXInLFxuICAgICAgICAxNjogJ3NoaWZ0JyxcbiAgICAgICAgMTc6ICdjdHJsJyxcbiAgICAgICAgMTg6ICdhbHQnLFxuICAgICAgICAyMDogJ2NhcHNsb2NrJyxcbiAgICAgICAgMjc6ICdlc2MnLFxuICAgICAgICAzMjogJ3NwYWNlJyxcbiAgICAgICAgMzM6ICdwYWdldXAnLFxuICAgICAgICAzNDogJ3BhZ2Vkb3duJyxcbiAgICAgICAgMzU6ICdlbmQnLFxuICAgICAgICAzNjogJ2hvbWUnLFxuICAgICAgICAzNzogJ2xlZnQnLFxuICAgICAgICAzODogJ3VwJyxcbiAgICAgICAgMzk6ICdyaWdodCcsXG4gICAgICAgIDQwOiAnZG93bicsXG4gICAgICAgIDQ1OiAnaW5zJyxcbiAgICAgICAgNDY6ICdkZWwnLFxuICAgICAgICA5MTogJ21ldGEnLFxuICAgICAgICA5MzogJ21ldGEnLFxuICAgICAgICAyMjQ6ICdtZXRhJ1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBtYXBwaW5nIGZvciBzcGVjaWFsIGNoYXJhY3RlcnMgc28gdGhleSBjYW4gc3VwcG9ydFxuICAgICAqXG4gICAgICogdGhpcyBkaWN0aW9uYXJ5IGlzIG9ubHkgdXNlZCBpbmNhc2UgeW91IHdhbnQgdG8gYmluZCBhXG4gICAgICoga2V5dXAgb3Iga2V5ZG93biBldmVudCB0byBvbmUgb2YgdGhlc2Uga2V5c1xuICAgICAqXG4gICAgICogQHR5cGUge09iamVjdH1cbiAgICAgKi9cbiAgICB2YXIgX0tFWUNPREVfTUFQID0ge1xuICAgICAgICAxMDY6ICcqJyxcbiAgICAgICAgMTA3OiAnKycsXG4gICAgICAgIDEwOTogJy0nLFxuICAgICAgICAxMTA6ICcuJyxcbiAgICAgICAgMTExIDogJy8nLFxuICAgICAgICAxODY6ICc7JyxcbiAgICAgICAgMTg3OiAnPScsXG4gICAgICAgIDE4ODogJywnLFxuICAgICAgICAxODk6ICctJyxcbiAgICAgICAgMTkwOiAnLicsXG4gICAgICAgIDE5MTogJy8nLFxuICAgICAgICAxOTI6ICdgJyxcbiAgICAgICAgMjE5OiAnWycsXG4gICAgICAgIDIyMDogJ1xcXFwnLFxuICAgICAgICAyMjE6ICddJyxcbiAgICAgICAgMjIyOiAnXFwnJ1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiB0aGlzIGlzIGEgbWFwcGluZyBvZiBrZXlzIHRoYXQgcmVxdWlyZSBzaGlmdCBvbiBhIFVTIGtleXBhZFxuICAgICAqIGJhY2sgdG8gdGhlIG5vbiBzaGlmdCBlcXVpdmVsZW50c1xuICAgICAqXG4gICAgICogdGhpcyBpcyBzbyB5b3UgY2FuIHVzZSBrZXl1cCBldmVudHMgd2l0aCB0aGVzZSBrZXlzXG4gICAgICpcbiAgICAgKiBub3RlIHRoYXQgdGhpcyB3aWxsIG9ubHkgd29yayByZWxpYWJseSBvbiBVUyBrZXlib2FyZHNcbiAgICAgKlxuICAgICAqIEB0eXBlIHtPYmplY3R9XG4gICAgICovXG4gICAgdmFyIF9TSElGVF9NQVAgPSB7XG4gICAgICAgICd+JzogJ2AnLFxuICAgICAgICAnISc6ICcxJyxcbiAgICAgICAgJ0AnOiAnMicsXG4gICAgICAgICcjJzogJzMnLFxuICAgICAgICAnJCc6ICc0JyxcbiAgICAgICAgJyUnOiAnNScsXG4gICAgICAgICdeJzogJzYnLFxuICAgICAgICAnJic6ICc3JyxcbiAgICAgICAgJyonOiAnOCcsXG4gICAgICAgICcoJzogJzknLFxuICAgICAgICAnKSc6ICcwJyxcbiAgICAgICAgJ18nOiAnLScsXG4gICAgICAgICcrJzogJz0nLFxuICAgICAgICAnOic6ICc7JyxcbiAgICAgICAgJ1xcXCInOiAnXFwnJyxcbiAgICAgICAgJzwnOiAnLCcsXG4gICAgICAgICc+JzogJy4nLFxuICAgICAgICAnPyc6ICcvJyxcbiAgICAgICAgJ3wnOiAnXFxcXCdcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogdGhpcyBpcyBhIGxpc3Qgb2Ygc3BlY2lhbCBzdHJpbmdzIHlvdSBjYW4gdXNlIHRvIG1hcFxuICAgICAqIHRvIG1vZGlmaWVyIGtleXMgd2hlbiB5b3Ugc3BlY2lmeSB5b3VyIGtleWJvYXJkIHNob3J0Y3V0c1xuICAgICAqXG4gICAgICogQHR5cGUge09iamVjdH1cbiAgICAgKi9cbiAgICB2YXIgX1NQRUNJQUxfQUxJQVNFUyA9IHtcbiAgICAgICAgJ29wdGlvbic6ICdhbHQnLFxuICAgICAgICAnY29tbWFuZCc6ICdtZXRhJyxcbiAgICAgICAgJ3JldHVybic6ICdlbnRlcicsXG4gICAgICAgICdlc2NhcGUnOiAnZXNjJyxcbiAgICAgICAgJ3BsdXMnOiAnKycsXG4gICAgICAgICdtb2QnOiAvTWFjfGlQb2R8aVBob25lfGlQYWQvLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKSA/ICdtZXRhJyA6ICdjdHJsJ1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiB2YXJpYWJsZSB0byBzdG9yZSB0aGUgZmxpcHBlZCB2ZXJzaW9uIG9mIF9NQVAgZnJvbSBhYm92ZVxuICAgICAqIG5lZWRlZCB0byBjaGVjayBpZiB3ZSBzaG91bGQgdXNlIGtleXByZXNzIG9yIG5vdCB3aGVuIG5vIGFjdGlvblxuICAgICAqIGlzIHNwZWNpZmllZFxuICAgICAqXG4gICAgICogQHR5cGUge09iamVjdHx1bmRlZmluZWR9XG4gICAgICovXG4gICAgdmFyIF9SRVZFUlNFX01BUDtcblxuICAgIC8qKlxuICAgICAqIGxvb3AgdGhyb3VnaCB0aGUgZiBrZXlzLCBmMSB0byBmMTkgYW5kIGFkZCB0aGVtIHRvIHRoZSBtYXBcbiAgICAgKiBwcm9ncmFtYXRpY2FsbHlcbiAgICAgKi9cbiAgICBmb3IgKHZhciBpID0gMTsgaSA8IDIwOyArK2kpIHtcbiAgICAgICAgX01BUFsxMTEgKyBpXSA9ICdmJyArIGk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogbG9vcCB0aHJvdWdoIHRvIG1hcCBudW1iZXJzIG9uIHRoZSBudW1lcmljIGtleXBhZFxuICAgICAqL1xuICAgIGZvciAoaSA9IDA7IGkgPD0gOTsgKytpKSB7XG5cbiAgICAgICAgLy8gVGhpcyBuZWVkcyB0byB1c2UgYSBzdHJpbmcgY2F1c2Ugb3RoZXJ3aXNlIHNpbmNlIDAgaXMgZmFsc2V5XG4gICAgICAgIC8vIG1vdXNldHJhcCB3aWxsIG5ldmVyIGZpcmUgZm9yIG51bXBhZCAwIHByZXNzZWQgYXMgcGFydCBvZiBhIGtleWRvd25cbiAgICAgICAgLy8gZXZlbnQuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2NjYW1wYmVsbC9tb3VzZXRyYXAvcHVsbC8yNThcbiAgICAgICAgX01BUFtpICsgOTZdID0gaS50b1N0cmluZygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGNyb3NzIGJyb3dzZXIgYWRkIGV2ZW50IG1ldGhvZFxuICAgICAqXG4gICAgICogQHBhcmFtIHtFbGVtZW50fEhUTUxEb2N1bWVudH0gb2JqZWN0XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFja1xuICAgICAqIEByZXR1cm5zIHZvaWRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBfYWRkRXZlbnQob2JqZWN0LCB0eXBlLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAob2JqZWN0LmFkZEV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgICAgIG9iamVjdC5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGNhbGxiYWNrLCBmYWxzZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBvYmplY3QuYXR0YWNoRXZlbnQoJ29uJyArIHR5cGUsIGNhbGxiYWNrKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiB0YWtlcyB0aGUgZXZlbnQgYW5kIHJldHVybnMgdGhlIGtleSBjaGFyYWN0ZXJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RXZlbnR9IGVcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICovXG4gICAgZnVuY3Rpb24gX2NoYXJhY3RlckZyb21FdmVudChlKSB7XG5cbiAgICAgICAgLy8gZm9yIGtleXByZXNzIGV2ZW50cyB3ZSBzaG91bGQgcmV0dXJuIHRoZSBjaGFyYWN0ZXIgYXMgaXNcbiAgICAgICAgaWYgKGUudHlwZSA9PSAna2V5cHJlc3MnKSB7XG4gICAgICAgICAgICB2YXIgY2hhcmFjdGVyID0gU3RyaW5nLmZyb21DaGFyQ29kZShlLndoaWNoKTtcblxuICAgICAgICAgICAgLy8gaWYgdGhlIHNoaWZ0IGtleSBpcyBub3QgcHJlc3NlZCB0aGVuIGl0IGlzIHNhZmUgdG8gYXNzdW1lXG4gICAgICAgICAgICAvLyB0aGF0IHdlIHdhbnQgdGhlIGNoYXJhY3RlciB0byBiZSBsb3dlcmNhc2UuICB0aGlzIG1lYW5zIGlmXG4gICAgICAgICAgICAvLyB5b3UgYWNjaWRlbnRhbGx5IGhhdmUgY2FwcyBsb2NrIG9uIHRoZW4geW91ciBrZXkgYmluZGluZ3NcbiAgICAgICAgICAgIC8vIHdpbGwgY29udGludWUgdG8gd29ya1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIHRoZSBvbmx5IHNpZGUgZWZmZWN0IHRoYXQgbWlnaHQgbm90IGJlIGRlc2lyZWQgaXMgaWYgeW91XG4gICAgICAgICAgICAvLyBiaW5kIHNvbWV0aGluZyBsaWtlICdBJyBjYXVzZSB5b3Ugd2FudCB0byB0cmlnZ2VyIGFuXG4gICAgICAgICAgICAvLyBldmVudCB3aGVuIGNhcGl0YWwgQSBpcyBwcmVzc2VkIGNhcHMgbG9jayB3aWxsIG5vIGxvbmdlclxuICAgICAgICAgICAgLy8gdHJpZ2dlciB0aGUgZXZlbnQuICBzaGlmdCthIHdpbGwgdGhvdWdoLlxuICAgICAgICAgICAgaWYgKCFlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgY2hhcmFjdGVyID0gY2hhcmFjdGVyLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjaGFyYWN0ZXI7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBmb3Igbm9uIGtleXByZXNzIGV2ZW50cyB0aGUgc3BlY2lhbCBtYXBzIGFyZSBuZWVkZWRcbiAgICAgICAgaWYgKF9NQVBbZS53aGljaF0pIHtcbiAgICAgICAgICAgIHJldHVybiBfTUFQW2Uud2hpY2hdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF9LRVlDT0RFX01BUFtlLndoaWNoXSkge1xuICAgICAgICAgICAgcmV0dXJuIF9LRVlDT0RFX01BUFtlLndoaWNoXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGlmIGl0IGlzIG5vdCBpbiB0aGUgc3BlY2lhbCBtYXBcblxuICAgICAgICAvLyB3aXRoIGtleWRvd24gYW5kIGtleXVwIGV2ZW50cyB0aGUgY2hhcmFjdGVyIHNlZW1zIHRvIGFsd2F5c1xuICAgICAgICAvLyBjb21lIGluIGFzIGFuIHVwcGVyY2FzZSBjaGFyYWN0ZXIgd2hldGhlciB5b3UgYXJlIHByZXNzaW5nIHNoaWZ0XG4gICAgICAgIC8vIG9yIG5vdC4gIHdlIHNob3VsZCBtYWtlIHN1cmUgaXQgaXMgYWx3YXlzIGxvd2VyY2FzZSBmb3IgY29tcGFyaXNvbnNcbiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoZS53aGljaCkudG9Mb3dlckNhc2UoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBjaGVja3MgaWYgdHdvIGFycmF5cyBhcmUgZXF1YWxcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IG1vZGlmaWVyczFcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBtb2RpZmllcnMyXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgZnVuY3Rpb24gX21vZGlmaWVyc01hdGNoKG1vZGlmaWVyczEsIG1vZGlmaWVyczIpIHtcbiAgICAgICAgcmV0dXJuIG1vZGlmaWVyczEuc29ydCgpLmpvaW4oJywnKSA9PT0gbW9kaWZpZXJzMi5zb3J0KCkuam9pbignLCcpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHRha2VzIGEga2V5IGV2ZW50IGFuZCBmaWd1cmVzIG91dCB3aGF0IHRoZSBtb2RpZmllcnMgYXJlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0V2ZW50fSBlXG4gICAgICogQHJldHVybnMge0FycmF5fVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIF9ldmVudE1vZGlmaWVycyhlKSB7XG4gICAgICAgIHZhciBtb2RpZmllcnMgPSBbXTtcblxuICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICAgICAgbW9kaWZpZXJzLnB1c2goJ3NoaWZ0Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZS5hbHRLZXkpIHtcbiAgICAgICAgICAgIG1vZGlmaWVycy5wdXNoKCdhbHQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlLmN0cmxLZXkpIHtcbiAgICAgICAgICAgIG1vZGlmaWVycy5wdXNoKCdjdHJsJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZS5tZXRhS2V5KSB7XG4gICAgICAgICAgICBtb2RpZmllcnMucHVzaCgnbWV0YScpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG1vZGlmaWVycztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBwcmV2ZW50cyBkZWZhdWx0IGZvciB0aGlzIGV2ZW50XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0V2ZW50fSBlXG4gICAgICogQHJldHVybnMgdm9pZFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIF9wcmV2ZW50RGVmYXVsdChlKSB7XG4gICAgICAgIGlmIChlLnByZXZlbnREZWZhdWx0KSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBlLnJldHVyblZhbHVlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogc3RvcHMgcHJvcG9nYXRpb24gZm9yIHRoaXMgZXZlbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RXZlbnR9IGVcbiAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICovXG4gICAgZnVuY3Rpb24gX3N0b3BQcm9wYWdhdGlvbihlKSB7XG4gICAgICAgIGlmIChlLnN0b3BQcm9wYWdhdGlvbikge1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGUuY2FuY2VsQnViYmxlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBkZXRlcm1pbmVzIGlmIHRoZSBrZXljb2RlIHNwZWNpZmllZCBpcyBhIG1vZGlmaWVyIGtleSBvciBub3RcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXlcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBfaXNNb2RpZmllcihrZXkpIHtcbiAgICAgICAgcmV0dXJuIGtleSA9PSAnc2hpZnQnIHx8IGtleSA9PSAnY3RybCcgfHwga2V5ID09ICdhbHQnIHx8IGtleSA9PSAnbWV0YSc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogcmV2ZXJzZXMgdGhlIG1hcCBsb29rdXAgc28gdGhhdCB3ZSBjYW4gbG9vayBmb3Igc3BlY2lmaWMga2V5c1xuICAgICAqIHRvIHNlZSB3aGF0IGNhbiBhbmQgY2FuJ3QgdXNlIGtleXByZXNzXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9XG4gICAgICovXG4gICAgZnVuY3Rpb24gX2dldFJldmVyc2VNYXAoKSB7XG4gICAgICAgIGlmICghX1JFVkVSU0VfTUFQKSB7XG4gICAgICAgICAgICBfUkVWRVJTRV9NQVAgPSB7fTtcbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBfTUFQKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBwdWxsIG91dCB0aGUgbnVtZXJpYyBrZXlwYWQgZnJvbSBoZXJlIGNhdXNlIGtleXByZXNzIHNob3VsZFxuICAgICAgICAgICAgICAgIC8vIGJlIGFibGUgdG8gZGV0ZWN0IHRoZSBrZXlzIGZyb20gdGhlIGNoYXJhY3RlclxuICAgICAgICAgICAgICAgIGlmIChrZXkgPiA5NSAmJiBrZXkgPCAxMTIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKF9NQVAuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgICAgICBfUkVWRVJTRV9NQVBbX01BUFtrZXldXSA9IGtleTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIF9SRVZFUlNFX01BUDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBwaWNrcyB0aGUgYmVzdCBhY3Rpb24gYmFzZWQgb24gdGhlIGtleSBjb21iaW5hdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIGNoYXJhY3RlciBmb3Iga2V5XG4gICAgICogQHBhcmFtIHtBcnJheX0gbW9kaWZpZXJzXG4gICAgICogQHBhcmFtIHtzdHJpbmc9fSBhY3Rpb24gcGFzc2VkIGluXG4gICAgICovXG4gICAgZnVuY3Rpb24gX3BpY2tCZXN0QWN0aW9uKGtleSwgbW9kaWZpZXJzLCBhY3Rpb24pIHtcblxuICAgICAgICAvLyBpZiBubyBhY3Rpb24gd2FzIHBpY2tlZCBpbiB3ZSBzaG91bGQgdHJ5IHRvIHBpY2sgdGhlIG9uZVxuICAgICAgICAvLyB0aGF0IHdlIHRoaW5rIHdvdWxkIHdvcmsgYmVzdCBmb3IgdGhpcyBrZXlcbiAgICAgICAgaWYgKCFhY3Rpb24pIHtcbiAgICAgICAgICAgIGFjdGlvbiA9IF9nZXRSZXZlcnNlTWFwKClba2V5XSA/ICdrZXlkb3duJyA6ICdrZXlwcmVzcyc7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBtb2RpZmllciBrZXlzIGRvbid0IHdvcmsgYXMgZXhwZWN0ZWQgd2l0aCBrZXlwcmVzcyxcbiAgICAgICAgLy8gc3dpdGNoIHRvIGtleWRvd25cbiAgICAgICAgaWYgKGFjdGlvbiA9PSAna2V5cHJlc3MnICYmIG1vZGlmaWVycy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGFjdGlvbiA9ICdrZXlkb3duJztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhY3Rpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgZnJvbSBhIHN0cmluZyBrZXkgY29tYmluYXRpb24gdG8gYW4gYXJyYXlcbiAgICAgKlxuICAgICAqIEBwYXJhbSAge3N0cmluZ30gY29tYmluYXRpb24gbGlrZSBcImNvbW1hbmQrc2hpZnQrbFwiXG4gICAgICogQHJldHVybiB7QXJyYXl9XG4gICAgICovXG4gICAgZnVuY3Rpb24gX2tleXNGcm9tU3RyaW5nKGNvbWJpbmF0aW9uKSB7XG4gICAgICAgIGlmIChjb21iaW5hdGlvbiA9PT0gJysnKSB7XG4gICAgICAgICAgICByZXR1cm4gWycrJ107XG4gICAgICAgIH1cblxuICAgICAgICBjb21iaW5hdGlvbiA9IGNvbWJpbmF0aW9uLnJlcGxhY2UoL1xcK3syfS9nLCAnK3BsdXMnKTtcbiAgICAgICAgcmV0dXJuIGNvbWJpbmF0aW9uLnNwbGl0KCcrJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBpbmZvIGZvciBhIHNwZWNpZmljIGtleSBjb21iaW5hdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtICB7c3RyaW5nfSBjb21iaW5hdGlvbiBrZXkgY29tYmluYXRpb24gKFwiY29tbWFuZCtzXCIgb3IgXCJhXCIgb3IgXCIqXCIpXG4gICAgICogQHBhcmFtICB7c3RyaW5nPX0gYWN0aW9uXG4gICAgICogQHJldHVybnMge09iamVjdH1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBfZ2V0S2V5SW5mbyhjb21iaW5hdGlvbiwgYWN0aW9uKSB7XG4gICAgICAgIHZhciBrZXlzO1xuICAgICAgICB2YXIga2V5O1xuICAgICAgICB2YXIgaTtcbiAgICAgICAgdmFyIG1vZGlmaWVycyA9IFtdO1xuXG4gICAgICAgIC8vIHRha2UgdGhlIGtleXMgZnJvbSB0aGlzIHBhdHRlcm4gYW5kIGZpZ3VyZSBvdXQgd2hhdCB0aGUgYWN0dWFsXG4gICAgICAgIC8vIHBhdHRlcm4gaXMgYWxsIGFib3V0XG4gICAgICAgIGtleXMgPSBfa2V5c0Zyb21TdHJpbmcoY29tYmluYXRpb24pO1xuXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBrZXkgPSBrZXlzW2ldO1xuXG4gICAgICAgICAgICAvLyBub3JtYWxpemUga2V5IG5hbWVzXG4gICAgICAgICAgICBpZiAoX1NQRUNJQUxfQUxJQVNFU1trZXldKSB7XG4gICAgICAgICAgICAgICAga2V5ID0gX1NQRUNJQUxfQUxJQVNFU1trZXldO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBpZiB0aGlzIGlzIG5vdCBhIGtleXByZXNzIGV2ZW50IHRoZW4gd2Ugc2hvdWxkXG4gICAgICAgICAgICAvLyBiZSBzbWFydCBhYm91dCB1c2luZyBzaGlmdCBrZXlzXG4gICAgICAgICAgICAvLyB0aGlzIHdpbGwgb25seSB3b3JrIGZvciBVUyBrZXlib2FyZHMgaG93ZXZlclxuICAgICAgICAgICAgaWYgKGFjdGlvbiAmJiBhY3Rpb24gIT0gJ2tleXByZXNzJyAmJiBfU0hJRlRfTUFQW2tleV0pIHtcbiAgICAgICAgICAgICAgICBrZXkgPSBfU0hJRlRfTUFQW2tleV07XG4gICAgICAgICAgICAgICAgbW9kaWZpZXJzLnB1c2goJ3NoaWZ0Jyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGlmIHRoaXMga2V5IGlzIGEgbW9kaWZpZXIgdGhlbiBhZGQgaXQgdG8gdGhlIGxpc3Qgb2YgbW9kaWZpZXJzXG4gICAgICAgICAgICBpZiAoX2lzTW9kaWZpZXIoa2V5KSkge1xuICAgICAgICAgICAgICAgIG1vZGlmaWVycy5wdXNoKGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBkZXBlbmRpbmcgb24gd2hhdCB0aGUga2V5IGNvbWJpbmF0aW9uIGlzXG4gICAgICAgIC8vIHdlIHdpbGwgdHJ5IHRvIHBpY2sgdGhlIGJlc3QgZXZlbnQgZm9yIGl0XG4gICAgICAgIGFjdGlvbiA9IF9waWNrQmVzdEFjdGlvbihrZXksIG1vZGlmaWVycywgYWN0aW9uKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2V5OiBrZXksXG4gICAgICAgICAgICBtb2RpZmllcnM6IG1vZGlmaWVycyxcbiAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2JlbG9uZ3NUbyhlbGVtZW50LCBhbmNlc3Rvcikge1xuICAgICAgICBpZiAoZWxlbWVudCA9PT0gbnVsbCB8fCBlbGVtZW50ID09PSBkb2N1bWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVsZW1lbnQgPT09IGFuY2VzdG9yKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBfYmVsb25nc1RvKGVsZW1lbnQucGFyZW50Tm9kZSwgYW5jZXN0b3IpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIE1vdXNldHJhcCh0YXJnZXRFbGVtZW50KSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICB0YXJnZXRFbGVtZW50ID0gdGFyZ2V0RWxlbWVudCB8fCBkb2N1bWVudDtcblxuICAgICAgICBpZiAoIShzZWxmIGluc3RhbmNlb2YgTW91c2V0cmFwKSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBNb3VzZXRyYXAodGFyZ2V0RWxlbWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogZWxlbWVudCB0byBhdHRhY2gga2V5IGV2ZW50cyB0b1xuICAgICAgICAgKlxuICAgICAgICAgKiBAdHlwZSB7RWxlbWVudH1cbiAgICAgICAgICovXG4gICAgICAgIHNlbGYudGFyZ2V0ID0gdGFyZ2V0RWxlbWVudDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogYSBsaXN0IG9mIGFsbCB0aGUgY2FsbGJhY2tzIHNldHVwIHZpYSBNb3VzZXRyYXAuYmluZCgpXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIHtPYmplY3R9XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLl9jYWxsYmFja3MgPSB7fTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogZGlyZWN0IG1hcCBvZiBzdHJpbmcgY29tYmluYXRpb25zIHRvIGNhbGxiYWNrcyB1c2VkIGZvciB0cmlnZ2VyKClcbiAgICAgICAgICpcbiAgICAgICAgICogQHR5cGUge09iamVjdH1cbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuX2RpcmVjdE1hcCA9IHt9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBrZWVwcyB0cmFjayBvZiB3aGF0IGxldmVsIGVhY2ggc2VxdWVuY2UgaXMgYXQgc2luY2UgbXVsdGlwbGVcbiAgICAgICAgICogc2VxdWVuY2VzIGNhbiBzdGFydCBvdXQgd2l0aCB0aGUgc2FtZSBzZXF1ZW5jZVxuICAgICAgICAgKlxuICAgICAgICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIF9zZXF1ZW5jZUxldmVscyA9IHt9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiB2YXJpYWJsZSB0byBzdG9yZSB0aGUgc2V0VGltZW91dCBjYWxsXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIHtudWxsfG51bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHZhciBfcmVzZXRUaW1lcjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogdGVtcG9yYXJ5IHN0YXRlIHdoZXJlIHdlIHdpbGwgaWdub3JlIHRoZSBuZXh0IGtleXVwXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufHN0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHZhciBfaWdub3JlTmV4dEtleXVwID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIHRlbXBvcmFyeSBzdGF0ZSB3aGVyZSB3ZSB3aWxsIGlnbm9yZSB0aGUgbmV4dCBrZXlwcmVzc1xuICAgICAgICAgKlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHZhciBfaWdub3JlTmV4dEtleXByZXNzID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGFyZSB3ZSBjdXJyZW50bHkgaW5zaWRlIG9mIGEgc2VxdWVuY2U/XG4gICAgICAgICAqIHR5cGUgb2YgYWN0aW9uIChcImtleXVwXCIgb3IgXCJrZXlkb3duXCIgb3IgXCJrZXlwcmVzc1wiKSBvciBmYWxzZVxuICAgICAgICAgKlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbnxzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgX25leHRFeHBlY3RlZEFjdGlvbiA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiByZXNldHMgYWxsIHNlcXVlbmNlIGNvdW50ZXJzIGV4Y2VwdCBmb3IgdGhlIG9uZXMgcGFzc2VkIGluXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkb05vdFJlc2V0XG4gICAgICAgICAqIEByZXR1cm5zIHZvaWRcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIF9yZXNldFNlcXVlbmNlcyhkb05vdFJlc2V0KSB7XG4gICAgICAgICAgICBkb05vdFJlc2V0ID0gZG9Ob3RSZXNldCB8fCB7fTtcblxuICAgICAgICAgICAgdmFyIGFjdGl2ZVNlcXVlbmNlcyA9IGZhbHNlLFxuICAgICAgICAgICAgICAgIGtleTtcblxuICAgICAgICAgICAgZm9yIChrZXkgaW4gX3NlcXVlbmNlTGV2ZWxzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRvTm90UmVzZXRba2V5XSkge1xuICAgICAgICAgICAgICAgICAgICBhY3RpdmVTZXF1ZW5jZXMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgX3NlcXVlbmNlTGV2ZWxzW2tleV0gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWFjdGl2ZVNlcXVlbmNlcykge1xuICAgICAgICAgICAgICAgIF9uZXh0RXhwZWN0ZWRBY3Rpb24gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBmaW5kcyBhbGwgY2FsbGJhY2tzIHRoYXQgbWF0Y2ggYmFzZWQgb24gdGhlIGtleWNvZGUsIG1vZGlmaWVycyxcbiAgICAgICAgICogYW5kIGFjdGlvblxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gY2hhcmFjdGVyXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IG1vZGlmaWVyc1xuICAgICAgICAgKiBAcGFyYW0ge0V2ZW50fE9iamVjdH0gZVxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZz19IHNlcXVlbmNlTmFtZSAtIG5hbWUgb2YgdGhlIHNlcXVlbmNlIHdlIGFyZSBsb29raW5nIGZvclxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZz19IGNvbWJpbmF0aW9uXG4gICAgICAgICAqIEBwYXJhbSB7bnVtYmVyPX0gbGV2ZWxcbiAgICAgICAgICogQHJldHVybnMge0FycmF5fVxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gX2dldE1hdGNoZXMoY2hhcmFjdGVyLCBtb2RpZmllcnMsIGUsIHNlcXVlbmNlTmFtZSwgY29tYmluYXRpb24sIGxldmVsKSB7XG4gICAgICAgICAgICB2YXIgaTtcbiAgICAgICAgICAgIHZhciBjYWxsYmFjaztcbiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gW107XG4gICAgICAgICAgICB2YXIgYWN0aW9uID0gZS50eXBlO1xuXG4gICAgICAgICAgICAvLyBpZiB0aGVyZSBhcmUgbm8gZXZlbnRzIHJlbGF0ZWQgdG8gdGhpcyBrZXljb2RlXG4gICAgICAgICAgICBpZiAoIXNlbGYuX2NhbGxiYWNrc1tjaGFyYWN0ZXJdKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBpZiBhIG1vZGlmaWVyIGtleSBpcyBjb21pbmcgdXAgb24gaXRzIG93biB3ZSBzaG91bGQgYWxsb3cgaXRcbiAgICAgICAgICAgIGlmIChhY3Rpb24gPT0gJ2tleXVwJyAmJiBfaXNNb2RpZmllcihjaGFyYWN0ZXIpKSB7XG4gICAgICAgICAgICAgICAgbW9kaWZpZXJzID0gW2NoYXJhY3Rlcl07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGxvb3AgdGhyb3VnaCBhbGwgY2FsbGJhY2tzIGZvciB0aGUga2V5IHRoYXQgd2FzIHByZXNzZWRcbiAgICAgICAgICAgIC8vIGFuZCBzZWUgaWYgYW55IG9mIHRoZW0gbWF0Y2hcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzZWxmLl9jYWxsYmFja3NbY2hhcmFjdGVyXS5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gc2VsZi5fY2FsbGJhY2tzW2NoYXJhY3Rlcl1baV07XG5cbiAgICAgICAgICAgICAgICAvLyBpZiBhIHNlcXVlbmNlIG5hbWUgaXMgbm90IHNwZWNpZmllZCwgYnV0IHRoaXMgaXMgYSBzZXF1ZW5jZSBhdFxuICAgICAgICAgICAgICAgIC8vIHRoZSB3cm9uZyBsZXZlbCB0aGVuIG1vdmUgb250byB0aGUgbmV4dCBtYXRjaFxuICAgICAgICAgICAgICAgIGlmICghc2VxdWVuY2VOYW1lICYmIGNhbGxiYWNrLnNlcSAmJiBfc2VxdWVuY2VMZXZlbHNbY2FsbGJhY2suc2VxXSAhPSBjYWxsYmFjay5sZXZlbCkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgYWN0aW9uIHdlIGFyZSBsb29raW5nIGZvciBkb2Vzbid0IG1hdGNoIHRoZSBhY3Rpb24gd2UgZ290XG4gICAgICAgICAgICAgICAgLy8gdGhlbiB3ZSBzaG91bGQga2VlcCBnb2luZ1xuICAgICAgICAgICAgICAgIGlmIChhY3Rpb24gIT0gY2FsbGJhY2suYWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYSBrZXlwcmVzcyBldmVudCBhbmQgdGhlIG1ldGEga2V5IGFuZCBjb250cm9sIGtleVxuICAgICAgICAgICAgICAgIC8vIGFyZSBub3QgcHJlc3NlZCB0aGF0IG1lYW5zIHRoYXQgd2UgbmVlZCB0byBvbmx5IGxvb2sgYXQgdGhlXG4gICAgICAgICAgICAgICAgLy8gY2hhcmFjdGVyLCBvdGhlcndpc2UgY2hlY2sgdGhlIG1vZGlmaWVycyBhcyB3ZWxsXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBjaHJvbWUgd2lsbCBub3QgZmlyZSBhIGtleXByZXNzIGlmIG1ldGEgb3IgY29udHJvbCBpcyBkb3duXG4gICAgICAgICAgICAgICAgLy8gc2FmYXJpIHdpbGwgZmlyZSBhIGtleXByZXNzIGlmIG1ldGEgb3IgbWV0YStzaGlmdCBpcyBkb3duXG4gICAgICAgICAgICAgICAgLy8gZmlyZWZveCB3aWxsIGZpcmUgYSBrZXlwcmVzcyBpZiBtZXRhIG9yIGNvbnRyb2wgaXMgZG93blxuICAgICAgICAgICAgICAgIGlmICgoYWN0aW9uID09ICdrZXlwcmVzcycgJiYgIWUubWV0YUtleSAmJiAhZS5jdHJsS2V5KSB8fCBfbW9kaWZpZXJzTWF0Y2gobW9kaWZpZXJzLCBjYWxsYmFjay5tb2RpZmllcnMpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gd2hlbiB5b3UgYmluZCBhIGNvbWJpbmF0aW9uIG9yIHNlcXVlbmNlIGEgc2Vjb25kIHRpbWUgaXRcbiAgICAgICAgICAgICAgICAgICAgLy8gc2hvdWxkIG92ZXJ3cml0ZSB0aGUgZmlyc3Qgb25lLiAgaWYgYSBzZXF1ZW5jZU5hbWUgb3JcbiAgICAgICAgICAgICAgICAgICAgLy8gY29tYmluYXRpb24gaXMgc3BlY2lmaWVkIGluIHRoaXMgY2FsbCBpdCBkb2VzIGp1c3QgdGhhdFxuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAvLyBAdG9kbyBtYWtlIGRlbGV0aW5nIGl0cyBvd24gbWV0aG9kP1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGVsZXRlQ29tYm8gPSAhc2VxdWVuY2VOYW1lICYmIGNhbGxiYWNrLmNvbWJvID09IGNvbWJpbmF0aW9uO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGVsZXRlU2VxdWVuY2UgPSBzZXF1ZW5jZU5hbWUgJiYgY2FsbGJhY2suc2VxID09IHNlcXVlbmNlTmFtZSAmJiBjYWxsYmFjay5sZXZlbCA9PSBsZXZlbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlbGV0ZUNvbWJvIHx8IGRlbGV0ZVNlcXVlbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9jYWxsYmFja3NbY2hhcmFjdGVyXS5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVzLnB1c2goY2FsbGJhY2spO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogYWN0dWFsbHkgY2FsbHMgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uXG4gICAgICAgICAqXG4gICAgICAgICAqIGlmIHlvdXIgY2FsbGJhY2sgZnVuY3Rpb24gcmV0dXJucyBmYWxzZSB0aGlzIHdpbGwgdXNlIHRoZSBqcXVlcnlcbiAgICAgICAgICogY29udmVudGlvbiAtIHByZXZlbnQgZGVmYXVsdCBhbmQgc3RvcCBwcm9wb2dhdGlvbiBvbiB0aGUgZXZlbnRcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2tcbiAgICAgICAgICogQHBhcmFtIHtFdmVudH0gZVxuICAgICAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBfZmlyZUNhbGxiYWNrKGNhbGxiYWNrLCBlLCBjb21ibywgc2VxdWVuY2UpIHtcblxuICAgICAgICAgICAgLy8gaWYgdGhpcyBldmVudCBzaG91bGQgbm90IGhhcHBlbiBzdG9wIGhlcmVcbiAgICAgICAgICAgIGlmIChzZWxmLnN0b3BDYWxsYmFjayhlLCBlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQsIGNvbWJvLCBzZXF1ZW5jZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChjYWxsYmFjayhlLCBjb21ibykgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgX3ByZXZlbnREZWZhdWx0KGUpO1xuICAgICAgICAgICAgICAgIF9zdG9wUHJvcGFnYXRpb24oZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogaGFuZGxlcyBhIGNoYXJhY3RlciBrZXkgZXZlbnRcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGNoYXJhY3RlclxuICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBtb2RpZmllcnNcbiAgICAgICAgICogQHBhcmFtIHtFdmVudH0gZVxuICAgICAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLl9oYW5kbGVLZXkgPSBmdW5jdGlvbihjaGFyYWN0ZXIsIG1vZGlmaWVycywgZSkge1xuICAgICAgICAgICAgdmFyIGNhbGxiYWNrcyA9IF9nZXRNYXRjaGVzKGNoYXJhY3RlciwgbW9kaWZpZXJzLCBlKTtcbiAgICAgICAgICAgIHZhciBpO1xuICAgICAgICAgICAgdmFyIGRvTm90UmVzZXQgPSB7fTtcbiAgICAgICAgICAgIHZhciBtYXhMZXZlbCA9IDA7XG4gICAgICAgICAgICB2YXIgcHJvY2Vzc2VkU2VxdWVuY2VDYWxsYmFjayA9IGZhbHNlO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIG1heExldmVsIGZvciBzZXF1ZW5jZXMgc28gd2UgY2FuIG9ubHkgZXhlY3V0ZSB0aGUgbG9uZ2VzdCBjYWxsYmFjayBzZXF1ZW5jZVxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFja3NbaV0uc2VxKSB7XG4gICAgICAgICAgICAgICAgICAgIG1heExldmVsID0gTWF0aC5tYXgobWF4TGV2ZWwsIGNhbGxiYWNrc1tpXS5sZXZlbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBsb29wIHRocm91Z2ggbWF0Y2hpbmcgY2FsbGJhY2tzIGZvciB0aGlzIGtleSBldmVudFxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7ICsraSkge1xuXG4gICAgICAgICAgICAgICAgLy8gZmlyZSBmb3IgYWxsIHNlcXVlbmNlIGNhbGxiYWNrc1xuICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgYmVjYXVzZSBpZiBmb3IgZXhhbXBsZSB5b3UgaGF2ZSBtdWx0aXBsZSBzZXF1ZW5jZXNcbiAgICAgICAgICAgICAgICAvLyBib3VuZCBzdWNoIGFzIFwiZyBpXCIgYW5kIFwiZyB0XCIgdGhleSBib3RoIG5lZWQgdG8gZmlyZSB0aGVcbiAgICAgICAgICAgICAgICAvLyBjYWxsYmFjayBmb3IgbWF0Y2hpbmcgZyBjYXVzZSBvdGhlcndpc2UgeW91IGNhbiBvbmx5IGV2ZXJcbiAgICAgICAgICAgICAgICAvLyBtYXRjaCB0aGUgZmlyc3Qgb25lXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrc1tpXS5zZXEpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IGZpcmUgY2FsbGJhY2tzIGZvciB0aGUgbWF4TGV2ZWwgdG8gcHJldmVudFxuICAgICAgICAgICAgICAgICAgICAvLyBzdWJzZXF1ZW5jZXMgZnJvbSBhbHNvIGZpcmluZ1xuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAvLyBmb3IgZXhhbXBsZSAnYSBvcHRpb24gYicgc2hvdWxkIG5vdCBjYXVzZSAnb3B0aW9uIGInIHRvIGZpcmVcbiAgICAgICAgICAgICAgICAgICAgLy8gZXZlbiB0aG91Z2ggJ29wdGlvbiBiJyBpcyBwYXJ0IG9mIHRoZSBvdGhlciBzZXF1ZW5jZVxuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAvLyBhbnkgc2VxdWVuY2VzIHRoYXQgZG8gbm90IG1hdGNoIGhlcmUgd2lsbCBiZSBkaXNjYXJkZWRcbiAgICAgICAgICAgICAgICAgICAgLy8gYmVsb3cgYnkgdGhlIF9yZXNldFNlcXVlbmNlcyBjYWxsXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFja3NbaV0ubGV2ZWwgIT0gbWF4TGV2ZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2VkU2VxdWVuY2VDYWxsYmFjayA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8ga2VlcCBhIGxpc3Qgb2Ygd2hpY2ggc2VxdWVuY2VzIHdlcmUgbWF0Y2hlcyBmb3IgbGF0ZXJcbiAgICAgICAgICAgICAgICAgICAgZG9Ob3RSZXNldFtjYWxsYmFja3NbaV0uc2VxXSA9IDE7XG4gICAgICAgICAgICAgICAgICAgIF9maXJlQ2FsbGJhY2soY2FsbGJhY2tzW2ldLmNhbGxiYWNrLCBlLCBjYWxsYmFja3NbaV0uY29tYm8sIGNhbGxiYWNrc1tpXS5zZXEpO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSB3ZXJlIG5vIHNlcXVlbmNlIG1hdGNoZXMgYnV0IHdlIGFyZSBzdGlsbCBoZXJlXG4gICAgICAgICAgICAgICAgLy8gdGhhdCBtZWFucyB0aGlzIGlzIGEgcmVndWxhciBtYXRjaCBzbyB3ZSBzaG91bGQgZmlyZSB0aGF0XG4gICAgICAgICAgICAgICAgaWYgKCFwcm9jZXNzZWRTZXF1ZW5jZUNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIF9maXJlQ2FsbGJhY2soY2FsbGJhY2tzW2ldLmNhbGxiYWNrLCBlLCBjYWxsYmFja3NbaV0uY29tYm8pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gaWYgdGhlIGtleSB5b3UgcHJlc3NlZCBtYXRjaGVzIHRoZSB0eXBlIG9mIHNlcXVlbmNlIHdpdGhvdXRcbiAgICAgICAgICAgIC8vIGJlaW5nIGEgbW9kaWZpZXIgKGllIFwia2V5dXBcIiBvciBcImtleXByZXNzXCIpIHRoZW4gd2Ugc2hvdWxkXG4gICAgICAgICAgICAvLyByZXNldCBhbGwgc2VxdWVuY2VzIHRoYXQgd2VyZSBub3QgbWF0Y2hlZCBieSB0aGlzIGV2ZW50XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gdGhpcyBpcyBzbywgZm9yIGV4YW1wbGUsIGlmIHlvdSBoYXZlIHRoZSBzZXF1ZW5jZSBcImggYSB0XCIgYW5kIHlvdVxuICAgICAgICAgICAgLy8gdHlwZSBcImggZSBhIHIgdFwiIGl0IGRvZXMgbm90IG1hdGNoLiAgaW4gdGhpcyBjYXNlIHRoZSBcImVcIiB3aWxsXG4gICAgICAgICAgICAvLyBjYXVzZSB0aGUgc2VxdWVuY2UgdG8gcmVzZXRcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBtb2RpZmllciBrZXlzIGFyZSBpZ25vcmVkIGJlY2F1c2UgeW91IGNhbiBoYXZlIGEgc2VxdWVuY2VcbiAgICAgICAgICAgIC8vIHRoYXQgY29udGFpbnMgbW9kaWZpZXJzIHN1Y2ggYXMgXCJlbnRlciBjdHJsK3NwYWNlXCIgYW5kIGluIG1vc3RcbiAgICAgICAgICAgIC8vIGNhc2VzIHRoZSBtb2RpZmllciBrZXkgd2lsbCBiZSBwcmVzc2VkIGJlZm9yZSB0aGUgbmV4dCBrZXlcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBhbHNvIGlmIHlvdSBoYXZlIGEgc2VxdWVuY2Ugc3VjaCBhcyBcImN0cmwrYiBhXCIgdGhlbiBwcmVzc2luZyB0aGVcbiAgICAgICAgICAgIC8vIFwiYlwiIGtleSB3aWxsIHRyaWdnZXIgYSBcImtleXByZXNzXCIgYW5kIGEgXCJrZXlkb3duXCJcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyB0aGUgXCJrZXlkb3duXCIgaXMgZXhwZWN0ZWQgd2hlbiB0aGVyZSBpcyBhIG1vZGlmaWVyLCBidXQgdGhlXG4gICAgICAgICAgICAvLyBcImtleXByZXNzXCIgZW5kcyB1cCBtYXRjaGluZyB0aGUgX25leHRFeHBlY3RlZEFjdGlvbiBzaW5jZSBpdCBvY2N1cnNcbiAgICAgICAgICAgIC8vIGFmdGVyIGFuZCB0aGF0IGNhdXNlcyB0aGUgc2VxdWVuY2UgdG8gcmVzZXRcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyB3ZSBpZ25vcmUga2V5cHJlc3NlcyBpbiBhIHNlcXVlbmNlIHRoYXQgZGlyZWN0bHkgZm9sbG93IGEga2V5ZG93blxuICAgICAgICAgICAgLy8gZm9yIHRoZSBzYW1lIGNoYXJhY3RlclxuICAgICAgICAgICAgdmFyIGlnbm9yZVRoaXNLZXlwcmVzcyA9IGUudHlwZSA9PSAna2V5cHJlc3MnICYmIF9pZ25vcmVOZXh0S2V5cHJlc3M7XG4gICAgICAgICAgICBpZiAoZS50eXBlID09IF9uZXh0RXhwZWN0ZWRBY3Rpb24gJiYgIV9pc01vZGlmaWVyKGNoYXJhY3RlcikgJiYgIWlnbm9yZVRoaXNLZXlwcmVzcykge1xuICAgICAgICAgICAgICAgIF9yZXNldFNlcXVlbmNlcyhkb05vdFJlc2V0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgX2lnbm9yZU5leHRLZXlwcmVzcyA9IHByb2Nlc3NlZFNlcXVlbmNlQ2FsbGJhY2sgJiYgZS50eXBlID09ICdrZXlkb3duJztcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogaGFuZGxlcyBhIGtleWRvd24gZXZlbnRcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHtFdmVudH0gZVxuICAgICAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBfaGFuZGxlS2V5RXZlbnQoZSkge1xuXG4gICAgICAgICAgICAvLyBub3JtYWxpemUgZS53aGljaCBmb3Iga2V5IGV2ZW50c1xuICAgICAgICAgICAgLy8gQHNlZSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzQyODU2MjcvamF2YXNjcmlwdC1rZXljb2RlLXZzLWNoYXJjb2RlLXV0dGVyLWNvbmZ1c2lvblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBlLndoaWNoICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgIGUud2hpY2ggPSBlLmtleUNvZGU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBjaGFyYWN0ZXIgPSBfY2hhcmFjdGVyRnJvbUV2ZW50KGUpO1xuXG4gICAgICAgICAgICAvLyBubyBjaGFyYWN0ZXIgZm91bmQgdGhlbiBzdG9wXG4gICAgICAgICAgICBpZiAoIWNoYXJhY3Rlcikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gbmVlZCB0byB1c2UgPT09IGZvciB0aGUgY2hhcmFjdGVyIGNoZWNrIGJlY2F1c2UgdGhlIGNoYXJhY3RlciBjYW4gYmUgMFxuICAgICAgICAgICAgaWYgKGUudHlwZSA9PSAna2V5dXAnICYmIF9pZ25vcmVOZXh0S2V5dXAgPT09IGNoYXJhY3Rlcikge1xuICAgICAgICAgICAgICAgIF9pZ25vcmVOZXh0S2V5dXAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlbGYuaGFuZGxlS2V5KGNoYXJhY3RlciwgX2V2ZW50TW9kaWZpZXJzKGUpLCBlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBjYWxsZWQgdG8gc2V0IGEgMSBzZWNvbmQgdGltZW91dCBvbiB0aGUgc3BlY2lmaWVkIHNlcXVlbmNlXG4gICAgICAgICAqXG4gICAgICAgICAqIHRoaXMgaXMgc28gYWZ0ZXIgZWFjaCBrZXkgcHJlc3MgaW4gdGhlIHNlcXVlbmNlIHlvdSBoYXZlIDEgc2Vjb25kXG4gICAgICAgICAqIHRvIHByZXNzIHRoZSBuZXh0IGtleSBiZWZvcmUgeW91IGhhdmUgdG8gc3RhcnQgb3ZlclxuICAgICAgICAgKlxuICAgICAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBfcmVzZXRTZXF1ZW5jZVRpbWVyKCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KF9yZXNldFRpbWVyKTtcbiAgICAgICAgICAgIF9yZXNldFRpbWVyID0gc2V0VGltZW91dChfcmVzZXRTZXF1ZW5jZXMsIDEwMDApO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGJpbmRzIGEga2V5IHNlcXVlbmNlIHRvIGFuIGV2ZW50XG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjb21ibyAtIGNvbWJvIHNwZWNpZmllZCBpbiBiaW5kIGNhbGxcbiAgICAgICAgICogQHBhcmFtIHtBcnJheX0ga2V5c1xuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFja1xuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZz19IGFjdGlvblxuICAgICAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBfYmluZFNlcXVlbmNlKGNvbWJvLCBrZXlzLCBjYWxsYmFjaywgYWN0aW9uKSB7XG5cbiAgICAgICAgICAgIC8vIHN0YXJ0IG9mZiBieSBhZGRpbmcgYSBzZXF1ZW5jZSBsZXZlbCByZWNvcmQgZm9yIHRoaXMgY29tYmluYXRpb25cbiAgICAgICAgICAgIC8vIGFuZCBzZXR0aW5nIHRoZSBsZXZlbCB0byAwXG4gICAgICAgICAgICBfc2VxdWVuY2VMZXZlbHNbY29tYm9dID0gMDtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBjYWxsYmFjayB0byBpbmNyZWFzZSB0aGUgc2VxdWVuY2UgbGV2ZWwgZm9yIHRoaXMgc2VxdWVuY2UgYW5kIHJlc2V0XG4gICAgICAgICAgICAgKiBhbGwgb3RoZXIgc2VxdWVuY2VzIHRoYXQgd2VyZSBhY3RpdmVcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmV4dEFjdGlvblxuICAgICAgICAgICAgICogQHJldHVybnMge0Z1bmN0aW9ufVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBmdW5jdGlvbiBfaW5jcmVhc2VTZXF1ZW5jZShuZXh0QWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBfbmV4dEV4cGVjdGVkQWN0aW9uID0gbmV4dEFjdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgKytfc2VxdWVuY2VMZXZlbHNbY29tYm9dO1xuICAgICAgICAgICAgICAgICAgICBfcmVzZXRTZXF1ZW5jZVRpbWVyKCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiB3cmFwcyB0aGUgc3BlY2lmaWVkIGNhbGxiYWNrIGluc2lkZSBvZiBhbm90aGVyIGZ1bmN0aW9uIGluIG9yZGVyXG4gICAgICAgICAgICAgKiB0byByZXNldCBhbGwgc2VxdWVuY2UgY291bnRlcnMgYXMgc29vbiBhcyB0aGlzIHNlcXVlbmNlIGlzIGRvbmVcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcGFyYW0ge0V2ZW50fSBlXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9jYWxsYmFja0FuZFJlc2V0KGUpIHtcbiAgICAgICAgICAgICAgICBfZmlyZUNhbGxiYWNrKGNhbGxiYWNrLCBlLCBjb21ibyk7XG5cbiAgICAgICAgICAgICAgICAvLyB3ZSBzaG91bGQgaWdub3JlIHRoZSBuZXh0IGtleSB1cCBpZiB0aGUgYWN0aW9uIGlzIGtleSBkb3duXG4gICAgICAgICAgICAgICAgLy8gb3Iga2V5cHJlc3MuICB0aGlzIGlzIHNvIGlmIHlvdSBmaW5pc2ggYSBzZXF1ZW5jZSBhbmRcbiAgICAgICAgICAgICAgICAvLyByZWxlYXNlIHRoZSBrZXkgdGhlIGZpbmFsIGtleSB3aWxsIG5vdCB0cmlnZ2VyIGEga2V5dXBcbiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uICE9PSAna2V5dXAnKSB7XG4gICAgICAgICAgICAgICAgICAgIF9pZ25vcmVOZXh0S2V5dXAgPSBfY2hhcmFjdGVyRnJvbUV2ZW50KGUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIHdlaXJkIHJhY2UgY29uZGl0aW9uIGlmIGEgc2VxdWVuY2UgZW5kcyB3aXRoIHRoZSBrZXlcbiAgICAgICAgICAgICAgICAvLyBhbm90aGVyIHNlcXVlbmNlIGJlZ2lucyB3aXRoXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChfcmVzZXRTZXF1ZW5jZXMsIDEwKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gbG9vcCB0aHJvdWdoIGtleXMgb25lIGF0IGEgdGltZSBhbmQgYmluZCB0aGUgYXBwcm9wcmlhdGUgY2FsbGJhY2tcbiAgICAgICAgICAgIC8vIGZ1bmN0aW9uLiAgZm9yIGFueSBrZXkgbGVhZGluZyB1cCB0byB0aGUgZmluYWwgb25lIGl0IHNob3VsZFxuICAgICAgICAgICAgLy8gaW5jcmVhc2UgdGhlIHNlcXVlbmNlLiBhZnRlciB0aGUgZmluYWwsIGl0IHNob3VsZCByZXNldCBhbGwgc2VxdWVuY2VzXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gaWYgYW4gYWN0aW9uIGlzIHNwZWNpZmllZCBpbiB0aGUgb3JpZ2luYWwgYmluZCBjYWxsIHRoZW4gdGhhdCB3aWxsXG4gICAgICAgICAgICAvLyBiZSB1c2VkIHRocm91Z2hvdXQuICBvdGhlcndpc2Ugd2Ugd2lsbCBwYXNzIHRoZSBhY3Rpb24gdGhhdCB0aGVcbiAgICAgICAgICAgIC8vIG5leHQga2V5IGluIHRoZSBzZXF1ZW5jZSBzaG91bGQgbWF0Y2guICB0aGlzIGFsbG93cyBhIHNlcXVlbmNlXG4gICAgICAgICAgICAvLyB0byBtaXggYW5kIG1hdGNoIGtleXByZXNzIGFuZCBrZXlkb3duIGV2ZW50cyBkZXBlbmRpbmcgb24gd2hpY2hcbiAgICAgICAgICAgIC8vIG9uZXMgYXJlIGJldHRlciBzdWl0ZWQgdG8gdGhlIGtleSBwcm92aWRlZFxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlzRmluYWwgPSBpICsgMSA9PT0ga2V5cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdmFyIHdyYXBwZWRDYWxsYmFjayA9IGlzRmluYWwgPyBfY2FsbGJhY2tBbmRSZXNldCA6IF9pbmNyZWFzZVNlcXVlbmNlKGFjdGlvbiB8fCBfZ2V0S2V5SW5mbyhrZXlzW2kgKyAxXSkuYWN0aW9uKTtcbiAgICAgICAgICAgICAgICBfYmluZFNpbmdsZShrZXlzW2ldLCB3cmFwcGVkQ2FsbGJhY2ssIGFjdGlvbiwgY29tYm8sIGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGJpbmRzIGEgc2luZ2xlIGtleWJvYXJkIGNvbWJpbmF0aW9uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjb21iaW5hdGlvblxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFja1xuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZz19IGFjdGlvblxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZz19IHNlcXVlbmNlTmFtZSAtIG5hbWUgb2Ygc2VxdWVuY2UgaWYgcGFydCBvZiBzZXF1ZW5jZVxuICAgICAgICAgKiBAcGFyYW0ge251bWJlcj19IGxldmVsIC0gd2hhdCBwYXJ0IG9mIHRoZSBzZXF1ZW5jZSB0aGUgY29tbWFuZCBpc1xuICAgICAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBfYmluZFNpbmdsZShjb21iaW5hdGlvbiwgY2FsbGJhY2ssIGFjdGlvbiwgc2VxdWVuY2VOYW1lLCBsZXZlbCkge1xuXG4gICAgICAgICAgICAvLyBzdG9yZSBhIGRpcmVjdCBtYXBwZWQgcmVmZXJlbmNlIGZvciB1c2Ugd2l0aCBNb3VzZXRyYXAudHJpZ2dlclxuICAgICAgICAgICAgc2VsZi5fZGlyZWN0TWFwW2NvbWJpbmF0aW9uICsgJzonICsgYWN0aW9uXSA9IGNhbGxiYWNrO1xuXG4gICAgICAgICAgICAvLyBtYWtlIHN1cmUgbXVsdGlwbGUgc3BhY2VzIGluIGEgcm93IGJlY29tZSBhIHNpbmdsZSBzcGFjZVxuICAgICAgICAgICAgY29tYmluYXRpb24gPSBjb21iaW5hdGlvbi5yZXBsYWNlKC9cXHMrL2csICcgJyk7XG5cbiAgICAgICAgICAgIHZhciBzZXF1ZW5jZSA9IGNvbWJpbmF0aW9uLnNwbGl0KCcgJyk7XG4gICAgICAgICAgICB2YXIgaW5mbztcblxuICAgICAgICAgICAgLy8gaWYgdGhpcyBwYXR0ZXJuIGlzIGEgc2VxdWVuY2Ugb2Yga2V5cyB0aGVuIHJ1biB0aHJvdWdoIHRoaXMgbWV0aG9kXG4gICAgICAgICAgICAvLyB0byByZXByb2Nlc3MgZWFjaCBwYXR0ZXJuIG9uZSBrZXkgYXQgYSB0aW1lXG4gICAgICAgICAgICBpZiAoc2VxdWVuY2UubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIF9iaW5kU2VxdWVuY2UoY29tYmluYXRpb24sIHNlcXVlbmNlLCBjYWxsYmFjaywgYWN0aW9uKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGluZm8gPSBfZ2V0S2V5SW5mbyhjb21iaW5hdGlvbiwgYWN0aW9uKTtcblxuICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRvIGluaXRpYWxpemUgYXJyYXkgaWYgdGhpcyBpcyB0aGUgZmlyc3QgdGltZVxuICAgICAgICAgICAgLy8gYSBjYWxsYmFjayBpcyBhZGRlZCBmb3IgdGhpcyBrZXlcbiAgICAgICAgICAgIHNlbGYuX2NhbGxiYWNrc1tpbmZvLmtleV0gPSBzZWxmLl9jYWxsYmFja3NbaW5mby5rZXldIHx8IFtdO1xuXG4gICAgICAgICAgICAvLyByZW1vdmUgYW4gZXhpc3RpbmcgbWF0Y2ggaWYgdGhlcmUgaXMgb25lXG4gICAgICAgICAgICBfZ2V0TWF0Y2hlcyhpbmZvLmtleSwgaW5mby5tb2RpZmllcnMsIHt0eXBlOiBpbmZvLmFjdGlvbn0sIHNlcXVlbmNlTmFtZSwgY29tYmluYXRpb24sIGxldmVsKTtcblxuICAgICAgICAgICAgLy8gYWRkIHRoaXMgY2FsbCBiYWNrIHRvIHRoZSBhcnJheVxuICAgICAgICAgICAgLy8gaWYgaXQgaXMgYSBzZXF1ZW5jZSBwdXQgaXQgYXQgdGhlIGJlZ2lubmluZ1xuICAgICAgICAgICAgLy8gaWYgbm90IHB1dCBpdCBhdCB0aGUgZW5kXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gdGhpcyBpcyBpbXBvcnRhbnQgYmVjYXVzZSB0aGUgd2F5IHRoZXNlIGFyZSBwcm9jZXNzZWQgZXhwZWN0c1xuICAgICAgICAgICAgLy8gdGhlIHNlcXVlbmNlIG9uZXMgdG8gY29tZSBmaXJzdFxuICAgICAgICAgICAgc2VsZi5fY2FsbGJhY2tzW2luZm8ua2V5XVtzZXF1ZW5jZU5hbWUgPyAndW5zaGlmdCcgOiAncHVzaCddKHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjazogY2FsbGJhY2ssXG4gICAgICAgICAgICAgICAgbW9kaWZpZXJzOiBpbmZvLm1vZGlmaWVycyxcbiAgICAgICAgICAgICAgICBhY3Rpb246IGluZm8uYWN0aW9uLFxuICAgICAgICAgICAgICAgIHNlcTogc2VxdWVuY2VOYW1lLFxuICAgICAgICAgICAgICAgIGxldmVsOiBsZXZlbCxcbiAgICAgICAgICAgICAgICBjb21ibzogY29tYmluYXRpb25cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGJpbmRzIG11bHRpcGxlIGNvbWJpbmF0aW9ucyB0byB0aGUgc2FtZSBjYWxsYmFja1xuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBjb21iaW5hdGlvbnNcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2tcbiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd8dW5kZWZpbmVkfSBhY3Rpb25cbiAgICAgICAgICogQHJldHVybnMgdm9pZFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5fYmluZE11bHRpcGxlID0gZnVuY3Rpb24oY29tYmluYXRpb25zLCBjYWxsYmFjaywgYWN0aW9uKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbWJpbmF0aW9ucy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIF9iaW5kU2luZ2xlKGNvbWJpbmF0aW9uc1tpXSwgY2FsbGJhY2ssIGFjdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhcnQhXG4gICAgICAgIF9hZGRFdmVudCh0YXJnZXRFbGVtZW50LCAna2V5cHJlc3MnLCBfaGFuZGxlS2V5RXZlbnQpO1xuICAgICAgICBfYWRkRXZlbnQodGFyZ2V0RWxlbWVudCwgJ2tleWRvd24nLCBfaGFuZGxlS2V5RXZlbnQpO1xuICAgICAgICBfYWRkRXZlbnQodGFyZ2V0RWxlbWVudCwgJ2tleXVwJywgX2hhbmRsZUtleUV2ZW50KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBiaW5kcyBhbiBldmVudCB0byBtb3VzZXRyYXBcbiAgICAgKlxuICAgICAqIGNhbiBiZSBhIHNpbmdsZSBrZXksIGEgY29tYmluYXRpb24gb2Yga2V5cyBzZXBhcmF0ZWQgd2l0aCArLFxuICAgICAqIGFuIGFycmF5IG9mIGtleXMsIG9yIGEgc2VxdWVuY2Ugb2Yga2V5cyBzZXBhcmF0ZWQgYnkgc3BhY2VzXG4gICAgICpcbiAgICAgKiBiZSBzdXJlIHRvIGxpc3QgdGhlIG1vZGlmaWVyIGtleXMgZmlyc3QgdG8gbWFrZSBzdXJlIHRoYXQgdGhlXG4gICAgICogY29ycmVjdCBrZXkgZW5kcyB1cCBnZXR0aW5nIGJvdW5kICh0aGUgbGFzdCBrZXkgaW4gdGhlIHBhdHRlcm4pXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ3xBcnJheX0ga2V5c1xuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrXG4gICAgICogQHBhcmFtIHtzdHJpbmc9fSBhY3Rpb24gLSAna2V5cHJlc3MnLCAna2V5ZG93bicsIG9yICdrZXl1cCdcbiAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICovXG4gICAgTW91c2V0cmFwLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24oa2V5cywgY2FsbGJhY2ssIGFjdGlvbikge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIGtleXMgPSBrZXlzIGluc3RhbmNlb2YgQXJyYXkgPyBrZXlzIDogW2tleXNdO1xuICAgICAgICBzZWxmLl9iaW5kTXVsdGlwbGUuY2FsbChzZWxmLCBrZXlzLCBjYWxsYmFjaywgYWN0aW9uKTtcbiAgICAgICAgcmV0dXJuIHNlbGY7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHVuYmluZHMgYW4gZXZlbnQgdG8gbW91c2V0cmFwXG4gICAgICpcbiAgICAgKiB0aGUgdW5iaW5kaW5nIHNldHMgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIG9mIHRoZSBzcGVjaWZpZWQga2V5IGNvbWJvXG4gICAgICogdG8gYW4gZW1wdHkgZnVuY3Rpb24gYW5kIGRlbGV0ZXMgdGhlIGNvcnJlc3BvbmRpbmcga2V5IGluIHRoZVxuICAgICAqIF9kaXJlY3RNYXAgZGljdC5cbiAgICAgKlxuICAgICAqIFRPRE86IGFjdHVhbGx5IHJlbW92ZSB0aGlzIGZyb20gdGhlIF9jYWxsYmFja3MgZGljdGlvbmFyeSBpbnN0ZWFkXG4gICAgICogb2YgYmluZGluZyBhbiBlbXB0eSBmdW5jdGlvblxuICAgICAqXG4gICAgICogdGhlIGtleWNvbWJvK2FjdGlvbiBoYXMgdG8gYmUgZXhhY3RseSB0aGUgc2FtZSBhc1xuICAgICAqIGl0IHdhcyBkZWZpbmVkIGluIHRoZSBiaW5kIG1ldGhvZFxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd8QXJyYXl9IGtleXNcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uXG4gICAgICogQHJldHVybnMgdm9pZFxuICAgICAqL1xuICAgIE1vdXNldHJhcC5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24oa2V5cywgYWN0aW9uKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgcmV0dXJuIHNlbGYuYmluZC5jYWxsKHNlbGYsIGtleXMsIGZ1bmN0aW9uKCkge30sIGFjdGlvbik7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHRyaWdnZXJzIGFuIGV2ZW50IHRoYXQgaGFzIGFscmVhZHkgYmVlbiBib3VuZFxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGtleXNcbiAgICAgKiBAcGFyYW0ge3N0cmluZz19IGFjdGlvblxuICAgICAqIEByZXR1cm5zIHZvaWRcbiAgICAgKi9cbiAgICBNb3VzZXRyYXAucHJvdG90eXBlLnRyaWdnZXIgPSBmdW5jdGlvbihrZXlzLCBhY3Rpb24pIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBpZiAoc2VsZi5fZGlyZWN0TWFwW2tleXMgKyAnOicgKyBhY3Rpb25dKSB7XG4gICAgICAgICAgICBzZWxmLl9kaXJlY3RNYXBba2V5cyArICc6JyArIGFjdGlvbl0oe30sIGtleXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZWxmO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXNldHMgdGhlIGxpYnJhcnkgYmFjayB0byBpdHMgaW5pdGlhbCBzdGF0ZS4gIHRoaXMgaXMgdXNlZnVsXG4gICAgICogaWYgeW91IHdhbnQgdG8gY2xlYXIgb3V0IHRoZSBjdXJyZW50IGtleWJvYXJkIHNob3J0Y3V0cyBhbmQgYmluZFxuICAgICAqIG5ldyBvbmVzIC0gZm9yIGV4YW1wbGUgaWYgeW91IHN3aXRjaCB0byBhbm90aGVyIHBhZ2VcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHZvaWRcbiAgICAgKi9cbiAgICBNb3VzZXRyYXAucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgc2VsZi5fY2FsbGJhY2tzID0ge307XG4gICAgICAgIHNlbGYuX2RpcmVjdE1hcCA9IHt9O1xuICAgICAgICByZXR1cm4gc2VsZjtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogc2hvdWxkIHdlIHN0b3AgdGhpcyBldmVudCBiZWZvcmUgZmlyaW5nIG9mZiBjYWxsYmFja3NcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RXZlbnR9IGVcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnRcbiAgICAgKiBAcmV0dXJuIHtib29sZWFufVxuICAgICAqL1xuICAgIE1vdXNldHJhcC5wcm90b3R5cGUuc3RvcENhbGxiYWNrID0gZnVuY3Rpb24oZSwgZWxlbWVudCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLy8gaWYgdGhlIGVsZW1lbnQgaGFzIHRoZSBjbGFzcyBcIm1vdXNldHJhcFwiIHRoZW4gbm8gbmVlZCB0byBzdG9wXG4gICAgICAgIGlmICgoJyAnICsgZWxlbWVudC5jbGFzc05hbWUgKyAnICcpLmluZGV4T2YoJyBtb3VzZXRyYXAgJykgPiAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF9iZWxvbmdzVG8oZWxlbWVudCwgc2VsZi50YXJnZXQpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBFdmVudHMgb3JpZ2luYXRpbmcgZnJvbSBhIHNoYWRvdyBET00gYXJlIHJlLXRhcmdldHRlZCBhbmQgYGUudGFyZ2V0YCBpcyB0aGUgc2hhZG93IGhvc3QsXG4gICAgICAgIC8vIG5vdCB0aGUgaW5pdGlhbCBldmVudCB0YXJnZXQgaW4gdGhlIHNoYWRvdyB0cmVlLiBOb3RlIHRoYXQgbm90IGFsbCBldmVudHMgY3Jvc3MgdGhlXG4gICAgICAgIC8vIHNoYWRvdyBib3VuZGFyeS5cbiAgICAgICAgLy8gRm9yIHNoYWRvdyB0cmVlcyB3aXRoIGBtb2RlOiAnb3BlbidgLCB0aGUgaW5pdGlhbCBldmVudCB0YXJnZXQgaXMgdGhlIGZpcnN0IGVsZW1lbnQgaW5cbiAgICAgICAgLy8gdGhlIGV2ZW504oCZcyBjb21wb3NlZCBwYXRoLiBGb3Igc2hhZG93IHRyZWVzIHdpdGggYG1vZGU6ICdjbG9zZWQnYCwgdGhlIGluaXRpYWwgZXZlbnRcbiAgICAgICAgLy8gdGFyZ2V0IGNhbm5vdCBiZSBvYnRhaW5lZC5cbiAgICAgICAgaWYgKCdjb21wb3NlZFBhdGgnIGluIGUgJiYgdHlwZW9mIGUuY29tcG9zZWRQYXRoID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAvLyBGb3Igb3BlbiBzaGFkb3cgdHJlZXMsIHVwZGF0ZSBgZWxlbWVudGAgc28gdGhhdCB0aGUgZm9sbG93aW5nIGNoZWNrIHdvcmtzLlxuICAgICAgICAgICAgdmFyIGluaXRpYWxFdmVudFRhcmdldCA9IGUuY29tcG9zZWRQYXRoKClbMF07XG4gICAgICAgICAgICBpZiAoaW5pdGlhbEV2ZW50VGFyZ2V0ICE9PSBlLnRhcmdldCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBpbml0aWFsRXZlbnRUYXJnZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBzdG9wIGZvciBpbnB1dCwgc2VsZWN0LCBhbmQgdGV4dGFyZWFcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQudGFnTmFtZSA9PSAnSU5QVVQnIHx8IGVsZW1lbnQudGFnTmFtZSA9PSAnU0VMRUNUJyB8fCBlbGVtZW50LnRhZ05hbWUgPT0gJ1RFWFRBUkVBJyB8fCBlbGVtZW50LmlzQ29udGVudEVkaXRhYmxlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBleHBvc2VzIF9oYW5kbGVLZXkgcHVibGljbHkgc28gaXQgY2FuIGJlIG92ZXJ3cml0dGVuIGJ5IGV4dGVuc2lvbnNcbiAgICAgKi9cbiAgICBNb3VzZXRyYXAucHJvdG90eXBlLmhhbmRsZUtleSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHJldHVybiBzZWxmLl9oYW5kbGVLZXkuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogYWxsb3cgY3VzdG9tIGtleSBtYXBwaW5nc1xuICAgICAqL1xuICAgIE1vdXNldHJhcC5hZGRLZXljb2RlcyA9IGZ1bmN0aW9uKG9iamVjdCkge1xuICAgICAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7XG4gICAgICAgICAgICBpZiAob2JqZWN0Lmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgICAgICBfTUFQW2tleV0gPSBvYmplY3Rba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBfUkVWRVJTRV9NQVAgPSBudWxsO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBJbml0IHRoZSBnbG9iYWwgbW91c2V0cmFwIGZ1bmN0aW9uc1xuICAgICAqXG4gICAgICogVGhpcyBtZXRob2QgaXMgbmVlZGVkIHRvIGFsbG93IHRoZSBnbG9iYWwgbW91c2V0cmFwIGZ1bmN0aW9ucyB0byB3b3JrXG4gICAgICogbm93IHRoYXQgbW91c2V0cmFwIGlzIGEgY29uc3RydWN0b3IgZnVuY3Rpb24uXG4gICAgICovXG4gICAgTW91c2V0cmFwLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGRvY3VtZW50TW91c2V0cmFwID0gTW91c2V0cmFwKGRvY3VtZW50KTtcbiAgICAgICAgZm9yICh2YXIgbWV0aG9kIGluIGRvY3VtZW50TW91c2V0cmFwKSB7XG4gICAgICAgICAgICBpZiAobWV0aG9kLmNoYXJBdCgwKSAhPT0gJ18nKSB7XG4gICAgICAgICAgICAgICAgTW91c2V0cmFwW21ldGhvZF0gPSAoZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkb2N1bWVudE1vdXNldHJhcFttZXRob2RdLmFwcGx5KGRvY3VtZW50TW91c2V0cmFwLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gKG1ldGhvZCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIE1vdXNldHJhcC5pbml0KCk7XG5cbiAgICAvLyBleHBvc2UgbW91c2V0cmFwIHRvIHRoZSBnbG9iYWwgb2JqZWN0XG4gICAgd2luZG93Lk1vdXNldHJhcCA9IE1vdXNldHJhcDtcblxuICAgIC8vIGV4cG9zZSBhcyBhIGNvbW1vbiBqcyBtb2R1bGVcbiAgICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBNb3VzZXRyYXA7XG4gICAgfVxuXG4gICAgLy8gZXhwb3NlIG1vdXNldHJhcCBhcyBhbiBBTUQgbW9kdWxlXG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICBkZWZpbmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gTW91c2V0cmFwO1xuICAgICAgICB9KTtcbiAgICB9XG59KSAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiBudWxsLCB0eXBlb2YgIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyBkb2N1bWVudCA6IG51bGwpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgb3V0JCA9IHR5cGVvZiBleHBvcnRzICE9ICd1bmRlZmluZWQnICYmIGV4cG9ydHMgfHwgdHlwZW9mIGRlZmluZSAhPSAndW5kZWZpbmVkJyAmJiB7fSB8fCB0aGlzIHx8IHdpbmRvdztcbiAgaWYgKHR5cGVvZiBkZWZpbmUgIT09ICd1bmRlZmluZWQnKSBkZWZpbmUoJ3NhdmUtc3ZnLWFzLXBuZycsIFtdLCBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG91dCQ7XG4gIH0pO1xuICBvdXQkLmRlZmF1bHQgPSBvdXQkO1xuXG4gIHZhciB4bWxOcyA9ICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3htbG5zLyc7XG4gIHZhciB4aHRtbE5zID0gJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwnO1xuICB2YXIgc3ZnTnMgPSAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnO1xuICB2YXIgZG9jdHlwZSA9ICc8P3htbCB2ZXJzaW9uPVwiMS4wXCIgc3RhbmRhbG9uZT1cIm5vXCI/PjwhRE9DVFlQRSBzdmcgUFVCTElDIFwiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU5cIiBcImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZFwiIFs8IUVOVElUWSBuYnNwIFwiJiMxNjA7XCI+XT4nO1xuICB2YXIgdXJsUmVnZXggPSAvdXJsXFwoW1wiJ10/KC4rPylbXCInXT9cXCkvO1xuICB2YXIgZm9udEZvcm1hdHMgPSB7XG4gICAgd29mZjI6ICdmb250L3dvZmYyJyxcbiAgICB3b2ZmOiAnZm9udC93b2ZmJyxcbiAgICBvdGY6ICdhcHBsaWNhdGlvbi94LWZvbnQtb3BlbnR5cGUnLFxuICAgIHR0ZjogJ2FwcGxpY2F0aW9uL3gtZm9udC10dGYnLFxuICAgIGVvdDogJ2FwcGxpY2F0aW9uL3ZuZC5tcy1mb250b2JqZWN0JyxcbiAgICBzZm50OiAnYXBwbGljYXRpb24vZm9udC1zZm50JyxcbiAgICBzdmc6ICdpbWFnZS9zdmcreG1sJ1xuICB9O1xuXG4gIHZhciBpc0VsZW1lbnQgPSBmdW5jdGlvbiBpc0VsZW1lbnQob2JqKSB7XG4gICAgcmV0dXJuIG9iaiBpbnN0YW5jZW9mIEhUTUxFbGVtZW50IHx8IG9iaiBpbnN0YW5jZW9mIFNWR0VsZW1lbnQ7XG4gIH07XG4gIHZhciByZXF1aXJlRG9tTm9kZSA9IGZ1bmN0aW9uIHJlcXVpcmVEb21Ob2RlKGVsKSB7XG4gICAgaWYgKCFpc0VsZW1lbnQoZWwpKSB0aHJvdyBuZXcgRXJyb3IoJ2FuIEhUTUxFbGVtZW50IG9yIFNWR0VsZW1lbnQgaXMgcmVxdWlyZWQ7IGdvdCAnICsgZWwpO1xuICB9O1xuICB2YXIgcmVxdWlyZURvbU5vZGVQcm9taXNlID0gZnVuY3Rpb24gcmVxdWlyZURvbU5vZGVQcm9taXNlKGVsKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGlmIChpc0VsZW1lbnQoZWwpKSByZXNvbHZlKGVsKTtlbHNlIHJlamVjdChuZXcgRXJyb3IoJ2FuIEhUTUxFbGVtZW50IG9yIFNWR0VsZW1lbnQgaXMgcmVxdWlyZWQ7IGdvdCAnICsgZWwpKTtcbiAgICB9KTtcbiAgfTtcbiAgdmFyIGlzRXh0ZXJuYWwgPSBmdW5jdGlvbiBpc0V4dGVybmFsKHVybCkge1xuICAgIHJldHVybiB1cmwgJiYgdXJsLmxhc3RJbmRleE9mKCdodHRwJywgMCkgPT09IDAgJiYgdXJsLmxhc3RJbmRleE9mKHdpbmRvdy5sb2NhdGlvbi5ob3N0KSA9PT0gLTE7XG4gIH07XG5cbiAgdmFyIGdldEZvbnRNaW1lVHlwZUZyb21VcmwgPSBmdW5jdGlvbiBnZXRGb250TWltZVR5cGVGcm9tVXJsKGZvbnRVcmwpIHtcbiAgICB2YXIgZm9ybWF0cyA9IE9iamVjdC5rZXlzKGZvbnRGb3JtYXRzKS5maWx0ZXIoZnVuY3Rpb24gKGV4dGVuc2lvbikge1xuICAgICAgcmV0dXJuIGZvbnRVcmwuaW5kZXhPZignLicgKyBleHRlbnNpb24pID4gMDtcbiAgICB9KS5tYXAoZnVuY3Rpb24gKGV4dGVuc2lvbikge1xuICAgICAgcmV0dXJuIGZvbnRGb3JtYXRzW2V4dGVuc2lvbl07XG4gICAgfSk7XG4gICAgaWYgKGZvcm1hdHMpIHJldHVybiBmb3JtYXRzWzBdO1xuICAgIGNvbnNvbGUuZXJyb3IoJ1Vua25vd24gZm9udCBmb3JtYXQgZm9yICcgKyBmb250VXJsICsgJy4gRm9udHMgbWF5IG5vdCBiZSB3b3JraW5nIGNvcnJlY3RseS4nKTtcbiAgICByZXR1cm4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7XG4gIH07XG5cbiAgdmFyIGFycmF5QnVmZmVyVG9CYXNlNjQgPSBmdW5jdGlvbiBhcnJheUJ1ZmZlclRvQmFzZTY0KGJ1ZmZlcikge1xuICAgIHZhciBiaW5hcnkgPSAnJztcbiAgICB2YXIgYnl0ZXMgPSBuZXcgVWludDhBcnJheShidWZmZXIpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnl0ZXMuYnl0ZUxlbmd0aDsgaSsrKSB7XG4gICAgICBiaW5hcnkgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlc1tpXSk7XG4gICAgfXJldHVybiB3aW5kb3cuYnRvYShiaW5hcnkpO1xuICB9O1xuXG4gIHZhciBnZXREaW1lbnNpb24gPSBmdW5jdGlvbiBnZXREaW1lbnNpb24oZWwsIGNsb25lLCBkaW0pIHtcbiAgICB2YXIgdiA9IGVsLnZpZXdCb3ggJiYgZWwudmlld0JveC5iYXNlVmFsICYmIGVsLnZpZXdCb3guYmFzZVZhbFtkaW1dIHx8IGNsb25lLmdldEF0dHJpYnV0ZShkaW0pICE9PSBudWxsICYmICFjbG9uZS5nZXRBdHRyaWJ1dGUoZGltKS5tYXRjaCgvJSQvKSAmJiBwYXJzZUludChjbG9uZS5nZXRBdHRyaWJ1dGUoZGltKSkgfHwgZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClbZGltXSB8fCBwYXJzZUludChjbG9uZS5zdHlsZVtkaW1dKSB8fCBwYXJzZUludCh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCkuZ2V0UHJvcGVydHlWYWx1ZShkaW0pKTtcbiAgICByZXR1cm4gdHlwZW9mIHYgPT09ICd1bmRlZmluZWQnIHx8IHYgPT09IG51bGwgfHwgaXNOYU4ocGFyc2VGbG9hdCh2KSkgPyAwIDogdjtcbiAgfTtcblxuICB2YXIgZ2V0RGltZW5zaW9ucyA9IGZ1bmN0aW9uIGdldERpbWVuc2lvbnMoZWwsIGNsb25lLCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgaWYgKGVsLnRhZ05hbWUgPT09ICdzdmcnKSByZXR1cm4ge1xuICAgICAgd2lkdGg6IHdpZHRoIHx8IGdldERpbWVuc2lvbihlbCwgY2xvbmUsICd3aWR0aCcpLFxuICAgICAgaGVpZ2h0OiBoZWlnaHQgfHwgZ2V0RGltZW5zaW9uKGVsLCBjbG9uZSwgJ2hlaWdodCcpXG4gICAgfTtlbHNlIGlmIChlbC5nZXRCQm94KSB7XG4gICAgICB2YXIgX2VsJGdldEJCb3ggPSBlbC5nZXRCQm94KCksXG4gICAgICAgICAgeCA9IF9lbCRnZXRCQm94LngsXG4gICAgICAgICAgeSA9IF9lbCRnZXRCQm94LnksXG4gICAgICAgICAgX3dpZHRoID0gX2VsJGdldEJCb3gud2lkdGgsXG4gICAgICAgICAgX2hlaWdodCA9IF9lbCRnZXRCQm94LmhlaWdodDtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgd2lkdGg6IHggKyBfd2lkdGgsXG4gICAgICAgIGhlaWdodDogeSArIF9oZWlnaHRcbiAgICAgIH07XG4gICAgfVxuICB9O1xuXG4gIHZhciByZUVuY29kZSA9IGZ1bmN0aW9uIHJlRW5jb2RlKGRhdGEpIHtcbiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGVuY29kZVVSSUNvbXBvbmVudChkYXRhKS5yZXBsYWNlKC8lKFswLTlBLUZdezJ9KS9nLCBmdW5jdGlvbiAobWF0Y2gsIHAxKSB7XG4gICAgICB2YXIgYyA9IFN0cmluZy5mcm9tQ2hhckNvZGUoJzB4JyArIHAxKTtcbiAgICAgIHJldHVybiBjID09PSAnJScgPyAnJTI1JyA6IGM7XG4gICAgfSkpO1xuICB9O1xuXG4gIHZhciB1cmlUb0Jsb2IgPSBmdW5jdGlvbiB1cmlUb0Jsb2IodXJpKSB7XG4gICAgdmFyIGJ5dGVTdHJpbmcgPSB3aW5kb3cuYXRvYih1cmkuc3BsaXQoJywnKVsxXSk7XG4gICAgdmFyIG1pbWVTdHJpbmcgPSB1cmkuc3BsaXQoJywnKVswXS5zcGxpdCgnOicpWzFdLnNwbGl0KCc7JylbMF07XG4gICAgdmFyIGJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihieXRlU3RyaW5nLmxlbmd0aCk7XG4gICAgdmFyIGludEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJ5dGVTdHJpbmcubGVuZ3RoOyBpKyspIHtcbiAgICAgIGludEFycmF5W2ldID0gYnl0ZVN0cmluZy5jaGFyQ29kZUF0KGkpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IEJsb2IoW2J1ZmZlcl0sIHsgdHlwZTogbWltZVN0cmluZyB9KTtcbiAgfTtcblxuICB2YXIgcXVlcnkgPSBmdW5jdGlvbiBxdWVyeShlbCwgc2VsZWN0b3IpIHtcbiAgICBpZiAoIXNlbGVjdG9yKSByZXR1cm47XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBlbC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSB8fCBlbC5wYXJlbnROb2RlICYmIGVsLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0ludmFsaWQgQ1NTIHNlbGVjdG9yIFwiJyArIHNlbGVjdG9yICsgJ1wiJywgZXJyKTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIGRldGVjdENzc0ZvbnQgPSBmdW5jdGlvbiBkZXRlY3RDc3NGb250KHJ1bGUsIGhyZWYpIHtcbiAgICAvLyBNYXRjaCBDU1MgZm9udC1mYWNlIHJ1bGVzIHRvIGV4dGVybmFsIGxpbmtzLlxuICAgIC8vIEBmb250LWZhY2Uge1xuICAgIC8vICAgc3JjOiBsb2NhbCgnQWJlbCcpLCB1cmwoaHR0cHM6Ly9mb250cy5nc3RhdGljLmNvbS9zL2FiZWwvdjYvVXpOLWllalIxVm9YVTJPYy03THNidmVzWlcyeE9RLXhzTnFPNDdtNTVEQS53b2ZmMik7XG4gICAgLy8gfVxuICAgIHZhciBtYXRjaCA9IHJ1bGUuY3NzVGV4dC5tYXRjaCh1cmxSZWdleCk7XG4gICAgdmFyIHVybCA9IG1hdGNoICYmIG1hdGNoWzFdIHx8ICcnO1xuICAgIGlmICghdXJsIHx8IHVybC5tYXRjaCgvXmRhdGE6LykgfHwgdXJsID09PSAnYWJvdXQ6YmxhbmsnKSByZXR1cm47XG4gICAgdmFyIGZ1bGxVcmwgPSB1cmwuc3RhcnRzV2l0aCgnLi4vJykgPyBocmVmICsgJy8uLi8nICsgdXJsIDogdXJsLnN0YXJ0c1dpdGgoJy4vJykgPyBocmVmICsgJy8uJyArIHVybCA6IHVybDtcbiAgICByZXR1cm4ge1xuICAgICAgdGV4dDogcnVsZS5jc3NUZXh0LFxuICAgICAgZm9ybWF0OiBnZXRGb250TWltZVR5cGVGcm9tVXJsKGZ1bGxVcmwpLFxuICAgICAgdXJsOiBmdWxsVXJsXG4gICAgfTtcbiAgfTtcblxuICB2YXIgaW5saW5lSW1hZ2VzID0gZnVuY3Rpb24gaW5saW5lSW1hZ2VzKGVsKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKEFycmF5LmZyb20oZWwucXVlcnlTZWxlY3RvckFsbCgnaW1hZ2UnKSkubWFwKGZ1bmN0aW9uIChpbWFnZSkge1xuICAgICAgdmFyIGhyZWYgPSBpbWFnZS5nZXRBdHRyaWJ1dGVOUygnaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluaycsICdocmVmJykgfHwgaW1hZ2UuZ2V0QXR0cmlidXRlKCdocmVmJyk7XG4gICAgICBpZiAoIWhyZWYpIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgICBpZiAoaXNFeHRlcm5hbChocmVmKSkge1xuICAgICAgICBocmVmICs9IChocmVmLmluZGV4T2YoJz8nKSA9PT0gLTEgPyAnPycgOiAnJicpICsgJ3Q9JyArIG5ldyBEYXRlKCkudmFsdWVPZigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICAgIGltZy5jcm9zc09yaWdpbiA9ICdhbm9ueW1vdXMnO1xuICAgICAgICBpbWcuc3JjID0gaHJlZjtcbiAgICAgICAgaW1nLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdChuZXcgRXJyb3IoJ0NvdWxkIG5vdCBsb2FkICcgKyBocmVmKSk7XG4gICAgICAgIH07XG4gICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY2FudmFzLndpZHRoID0gaW1nLndpZHRoO1xuICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBpbWcuaGVpZ2h0O1xuICAgICAgICAgIGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLmRyYXdJbWFnZShpbWcsIDAsIDApO1xuICAgICAgICAgIGltYWdlLnNldEF0dHJpYnV0ZU5TKCdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJywgJ2hyZWYnLCBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9wbmcnKSk7XG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH0pKTtcbiAgfTtcblxuICB2YXIgY2FjaGVkRm9udHMgPSB7fTtcbiAgdmFyIGlubGluZUZvbnRzID0gZnVuY3Rpb24gaW5saW5lRm9udHMoZm9udHMpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoZm9udHMubWFwKGZ1bmN0aW9uIChmb250KSB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBpZiAoY2FjaGVkRm9udHNbZm9udC51cmxdKSByZXR1cm4gcmVzb2x2ZShjYWNoZWRGb250c1tmb250LnVybF0pO1xuXG4gICAgICAgIHZhciByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgcmVxLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgLy8gVE9ETzogaXQgbWF5IGFsc28gYmUgd29ydGggaXQgdG8gd2FpdCB1bnRpbCBmb250cyBhcmUgZnVsbHkgbG9hZGVkIGJlZm9yZVxuICAgICAgICAgIC8vIGF0dGVtcHRpbmcgdG8gcmFzdGVyaXplIHRoZW0uIChlLmcuIHVzZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRm9udEZhY2VTZXQpXG4gICAgICAgICAgdmFyIGZvbnRJbkJhc2U2NCA9IGFycmF5QnVmZmVyVG9CYXNlNjQocmVxLnJlc3BvbnNlKTtcbiAgICAgICAgICB2YXIgZm9udFVyaSA9IGZvbnQudGV4dC5yZXBsYWNlKHVybFJlZ2V4LCAndXJsKFwiZGF0YTonICsgZm9udC5mb3JtYXQgKyAnO2Jhc2U2NCwnICsgZm9udEluQmFzZTY0ICsgJ1wiKScpICsgJ1xcbic7XG4gICAgICAgICAgY2FjaGVkRm9udHNbZm9udC51cmxdID0gZm9udFVyaTtcbiAgICAgICAgICByZXNvbHZlKGZvbnRVcmkpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVxLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBsb2FkIGZvbnQgZnJvbTogJyArIGZvbnQudXJsLCBlKTtcbiAgICAgICAgICBjYWNoZWRGb250c1tmb250LnVybF0gPSBudWxsO1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXEuYWRkRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGNvbnNvbGUud2FybignQWJvcnRlZCBsb2FkaW5nIGZvbnQgZnJvbTogJyArIGZvbnQudXJsLCBlKTtcbiAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVxLm9wZW4oJ0dFVCcsIGZvbnQudXJsKTtcbiAgICAgICAgcmVxLnJlc3BvbnNlVHlwZSA9ICdhcnJheWJ1ZmZlcic7XG4gICAgICAgIHJlcS5zZW5kKCk7XG4gICAgICB9KTtcbiAgICB9KSkudGhlbihmdW5jdGlvbiAoZm9udENzcykge1xuICAgICAgcmV0dXJuIGZvbnRDc3MuZmlsdGVyKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHJldHVybiB4O1xuICAgICAgfSkuam9pbignJyk7XG4gICAgfSk7XG4gIH07XG5cbiAgdmFyIGNhY2hlZFJ1bGVzID0gbnVsbDtcbiAgdmFyIHN0eWxlU2hlZXRSdWxlcyA9IGZ1bmN0aW9uIHN0eWxlU2hlZXRSdWxlcygpIHtcbiAgICBpZiAoY2FjaGVkUnVsZXMpIHJldHVybiBjYWNoZWRSdWxlcztcbiAgICByZXR1cm4gY2FjaGVkUnVsZXMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnN0eWxlU2hlZXRzKS5tYXAoZnVuY3Rpb24gKHNoZWV0KSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4geyBydWxlczogc2hlZXQuY3NzUnVsZXMsIGhyZWY6IHNoZWV0LmhyZWYgfTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdTdHlsZXNoZWV0IGNvdWxkIG5vdCBiZSBsb2FkZWQ6ICcgKyBzaGVldC5ocmVmLCBlKTtcbiAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHZhciBpbmxpbmVDc3MgPSBmdW5jdGlvbiBpbmxpbmVDc3MoZWwsIG9wdGlvbnMpIHtcbiAgICB2YXIgX3JlZiA9IG9wdGlvbnMgfHwge30sXG4gICAgICAgIHNlbGVjdG9yUmVtYXAgPSBfcmVmLnNlbGVjdG9yUmVtYXAsXG4gICAgICAgIG1vZGlmeVN0eWxlID0gX3JlZi5tb2RpZnlTdHlsZSxcbiAgICAgICAgbW9kaWZ5Q3NzID0gX3JlZi5tb2RpZnlDc3MsXG4gICAgICAgIGZvbnRzID0gX3JlZi5mb250cyxcbiAgICAgICAgZXhjbHVkZVVudXNlZENzcyA9IF9yZWYuZXhjbHVkZVVudXNlZENzcztcblxuICAgIHZhciBnZW5lcmF0ZUNzcyA9IG1vZGlmeUNzcyB8fCBmdW5jdGlvbiAoc2VsZWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICAgIHZhciBzZWwgPSBzZWxlY3RvclJlbWFwID8gc2VsZWN0b3JSZW1hcChzZWxlY3RvcikgOiBzZWxlY3RvcjtcbiAgICAgIHZhciBwcm9wcyA9IG1vZGlmeVN0eWxlID8gbW9kaWZ5U3R5bGUocHJvcGVydGllcykgOiBwcm9wZXJ0aWVzO1xuICAgICAgcmV0dXJuIHNlbCArICd7JyArIHByb3BzICsgJ31cXG4nO1xuICAgIH07XG4gICAgdmFyIGNzcyA9IFtdO1xuICAgIHZhciBkZXRlY3RGb250cyA9IHR5cGVvZiBmb250cyA9PT0gJ3VuZGVmaW5lZCc7XG4gICAgdmFyIGZvbnRMaXN0ID0gZm9udHMgfHwgW107XG4gICAgc3R5bGVTaGVldFJ1bGVzKCkuZm9yRWFjaChmdW5jdGlvbiAoX3JlZjIpIHtcbiAgICAgIHZhciBydWxlcyA9IF9yZWYyLnJ1bGVzLFxuICAgICAgICAgIGhyZWYgPSBfcmVmMi5ocmVmO1xuXG4gICAgICBpZiAoIXJ1bGVzKSByZXR1cm47XG4gICAgICBBcnJheS5mcm9tKHJ1bGVzKS5mb3JFYWNoKGZ1bmN0aW9uIChydWxlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcnVsZS5zdHlsZSAhPSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIGlmIChxdWVyeShlbCwgcnVsZS5zZWxlY3RvclRleHQpKSBjc3MucHVzaChnZW5lcmF0ZUNzcyhydWxlLnNlbGVjdG9yVGV4dCwgcnVsZS5zdHlsZS5jc3NUZXh0KSk7ZWxzZSBpZiAoZGV0ZWN0Rm9udHMgJiYgcnVsZS5jc3NUZXh0Lm1hdGNoKC9eQGZvbnQtZmFjZS8pKSB7XG4gICAgICAgICAgICB2YXIgZm9udCA9IGRldGVjdENzc0ZvbnQocnVsZSwgaHJlZik7XG4gICAgICAgICAgICBpZiAoZm9udCkgZm9udExpc3QucHVzaChmb250KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKCFleGNsdWRlVW51c2VkQ3NzKSB7XG4gICAgICAgICAgICBjc3MucHVzaChydWxlLmNzc1RleHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gaW5saW5lRm9udHMoZm9udExpc3QpLnRoZW4oZnVuY3Rpb24gKGZvbnRDc3MpIHtcbiAgICAgIHJldHVybiBjc3Muam9pbignXFxuJykgKyBmb250Q3NzO1xuICAgIH0pO1xuICB9O1xuXG4gIHZhciBkb3dubG9hZE9wdGlvbnMgPSBmdW5jdGlvbiBkb3dubG9hZE9wdGlvbnMoKSB7XG4gICAgaWYgKCFuYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYiAmJiAhKCdkb3dubG9hZCcgaW4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpKSkge1xuICAgICAgcmV0dXJuIHsgcG9wdXA6IHdpbmRvdy5vcGVuKCkgfTtcbiAgICB9XG4gIH07XG5cbiAgb3V0JC5wcmVwYXJlU3ZnID0gZnVuY3Rpb24gKGVsLCBvcHRpb25zLCBkb25lKSB7XG4gICAgcmVxdWlyZURvbU5vZGUoZWwpO1xuXG4gICAgdmFyIF9yZWYzID0gb3B0aW9ucyB8fCB7fSxcbiAgICAgICAgX3JlZjMkbGVmdCA9IF9yZWYzLmxlZnQsXG4gICAgICAgIGxlZnQgPSBfcmVmMyRsZWZ0ID09PSB1bmRlZmluZWQgPyAwIDogX3JlZjMkbGVmdCxcbiAgICAgICAgX3JlZjMkdG9wID0gX3JlZjMudG9wLFxuICAgICAgICB0b3AgPSBfcmVmMyR0b3AgPT09IHVuZGVmaW5lZCA/IDAgOiBfcmVmMyR0b3AsXG4gICAgICAgIHcgPSBfcmVmMy53aWR0aCxcbiAgICAgICAgaCA9IF9yZWYzLmhlaWdodCxcbiAgICAgICAgX3JlZjMkc2NhbGUgPSBfcmVmMy5zY2FsZSxcbiAgICAgICAgc2NhbGUgPSBfcmVmMyRzY2FsZSA9PT0gdW5kZWZpbmVkID8gMSA6IF9yZWYzJHNjYWxlLFxuICAgICAgICBfcmVmMyRyZXNwb25zaXZlID0gX3JlZjMucmVzcG9uc2l2ZSxcbiAgICAgICAgcmVzcG9uc2l2ZSA9IF9yZWYzJHJlc3BvbnNpdmUgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZjMkcmVzcG9uc2l2ZSxcbiAgICAgICAgX3JlZjMkZXhjbHVkZUNzcyA9IF9yZWYzLmV4Y2x1ZGVDc3MsXG4gICAgICAgIGV4Y2x1ZGVDc3MgPSBfcmVmMyRleGNsdWRlQ3NzID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYzJGV4Y2x1ZGVDc3M7XG5cbiAgICByZXR1cm4gaW5saW5lSW1hZ2VzKGVsKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBjbG9uZSA9IGVsLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgIGNsb25lLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IChvcHRpb25zIHx8IHt9KS5iYWNrZ3JvdW5kQ29sb3IgfHwgZWwuc3R5bGUuYmFja2dyb3VuZENvbG9yO1xuXG4gICAgICB2YXIgX2dldERpbWVuc2lvbnMgPSBnZXREaW1lbnNpb25zKGVsLCBjbG9uZSwgdywgaCksXG4gICAgICAgICAgd2lkdGggPSBfZ2V0RGltZW5zaW9ucy53aWR0aCxcbiAgICAgICAgICBoZWlnaHQgPSBfZ2V0RGltZW5zaW9ucy5oZWlnaHQ7XG5cbiAgICAgIGlmIChlbC50YWdOYW1lICE9PSAnc3ZnJykge1xuICAgICAgICBpZiAoZWwuZ2V0QkJveCkge1xuICAgICAgICAgIGlmIChjbG9uZS5nZXRBdHRyaWJ1dGUoJ3RyYW5zZm9ybScpICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNsb25lLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywgY2xvbmUuZ2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nKS5yZXBsYWNlKC90cmFuc2xhdGVcXCguKj9cXCkvLCAnJykpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTtcbiAgICAgICAgICBzdmcuYXBwZW5kQ2hpbGQoY2xvbmUpO1xuICAgICAgICAgIGNsb25lID0gc3ZnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0F0dGVtcHRlZCB0byByZW5kZXIgbm9uLVNWRyBlbGVtZW50JywgZWwpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjbG9uZS5zZXRBdHRyaWJ1dGUoJ3ZlcnNpb24nLCAnMS4xJyk7XG4gICAgICBjbG9uZS5zZXRBdHRyaWJ1dGUoJ3ZpZXdCb3gnLCBbbGVmdCwgdG9wLCB3aWR0aCwgaGVpZ2h0XS5qb2luKCcgJykpO1xuICAgICAgaWYgKCFjbG9uZS5nZXRBdHRyaWJ1dGUoJ3htbG5zJykpIGNsb25lLnNldEF0dHJpYnV0ZU5TKHhtbE5zLCAneG1sbnMnLCBzdmdOcyk7XG4gICAgICBpZiAoIWNsb25lLmdldEF0dHJpYnV0ZSgneG1sbnM6eGxpbmsnKSkgY2xvbmUuc2V0QXR0cmlidXRlTlMoeG1sTnMsICd4bWxuczp4bGluaycsICdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJyk7XG5cbiAgICAgIGlmIChyZXNwb25zaXZlKSB7XG4gICAgICAgIGNsb25lLnJlbW92ZUF0dHJpYnV0ZSgnd2lkdGgnKTtcbiAgICAgICAgY2xvbmUucmVtb3ZlQXR0cmlidXRlKCdoZWlnaHQnKTtcbiAgICAgICAgY2xvbmUuc2V0QXR0cmlidXRlKCdwcmVzZXJ2ZUFzcGVjdFJhdGlvJywgJ3hNaW5ZTWluIG1lZXQnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNsb25lLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3aWR0aCAqIHNjYWxlKTtcbiAgICAgICAgY2xvbmUuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBoZWlnaHQgKiBzY2FsZSk7XG4gICAgICB9XG5cbiAgICAgIEFycmF5LmZyb20oY2xvbmUucXVlcnlTZWxlY3RvckFsbCgnZm9yZWlnbk9iamVjdCA+IConKSkuZm9yRWFjaChmdW5jdGlvbiAoZm9yZWlnbk9iamVjdCkge1xuICAgICAgICBmb3JlaWduT2JqZWN0LnNldEF0dHJpYnV0ZU5TKHhtbE5zLCAneG1sbnMnLCBmb3JlaWduT2JqZWN0LnRhZ05hbWUgPT09ICdzdmcnID8gc3ZnTnMgOiB4aHRtbE5zKTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZXhjbHVkZUNzcykge1xuICAgICAgICB2YXIgb3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgb3V0ZXIuYXBwZW5kQ2hpbGQoY2xvbmUpO1xuICAgICAgICB2YXIgc3JjID0gb3V0ZXIuaW5uZXJIVE1MO1xuICAgICAgICBpZiAodHlwZW9mIGRvbmUgPT09ICdmdW5jdGlvbicpIGRvbmUoc3JjLCB3aWR0aCwgaGVpZ2h0KTtlbHNlIHJldHVybiB7IHNyYzogc3JjLCB3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0IH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gaW5saW5lQ3NzKGVsLCBvcHRpb25zKS50aGVuKGZ1bmN0aW9uIChjc3MpIHtcbiAgICAgICAgICB2YXIgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuICAgICAgICAgIHN0eWxlLnNldEF0dHJpYnV0ZSgndHlwZScsICd0ZXh0L2NzcycpO1xuICAgICAgICAgIHN0eWxlLmlubmVySFRNTCA9ICc8IVtDREFUQVtcXG4nICsgY3NzICsgJ1xcbl1dPic7XG5cbiAgICAgICAgICB2YXIgZGVmcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RlZnMnKTtcbiAgICAgICAgICBkZWZzLmFwcGVuZENoaWxkKHN0eWxlKTtcbiAgICAgICAgICBjbG9uZS5pbnNlcnRCZWZvcmUoZGVmcywgY2xvbmUuZmlyc3RDaGlsZCk7XG5cbiAgICAgICAgICB2YXIgb3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICBvdXRlci5hcHBlbmRDaGlsZChjbG9uZSk7XG4gICAgICAgICAgdmFyIHNyYyA9IG91dGVyLmlubmVySFRNTC5yZXBsYWNlKC9OU1xcZCs6aHJlZi9naSwgJ3htbG5zOnhsaW5rPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiIHhsaW5rOmhyZWYnKTtcblxuICAgICAgICAgIGlmICh0eXBlb2YgZG9uZSA9PT0gJ2Z1bmN0aW9uJykgZG9uZShzcmMsIHdpZHRoLCBoZWlnaHQpO2Vsc2UgcmV0dXJuIHsgc3JjOiBzcmMsIHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQgfTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgb3V0JC5zdmdBc0RhdGFVcmkgPSBmdW5jdGlvbiAoZWwsIG9wdGlvbnMsIGRvbmUpIHtcbiAgICByZXF1aXJlRG9tTm9kZShlbCk7XG4gICAgcmV0dXJuIG91dCQucHJlcGFyZVN2ZyhlbCwgb3B0aW9ucykudGhlbihmdW5jdGlvbiAoX3JlZjQpIHtcbiAgICAgIHZhciBzcmMgPSBfcmVmNC5zcmMsXG4gICAgICAgICAgd2lkdGggPSBfcmVmNC53aWR0aCxcbiAgICAgICAgICBoZWlnaHQgPSBfcmVmNC5oZWlnaHQ7XG5cbiAgICAgIHZhciBzdmdYbWwgPSAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnICsgd2luZG93LmJ0b2EocmVFbmNvZGUoZG9jdHlwZSArIHNyYykpO1xuICAgICAgaWYgKHR5cGVvZiBkb25lID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGRvbmUoc3ZnWG1sLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdmdYbWw7XG4gICAgfSk7XG4gIH07XG5cbiAgb3V0JC5zdmdBc1BuZ1VyaSA9IGZ1bmN0aW9uIChlbCwgb3B0aW9ucywgZG9uZSkge1xuICAgIHJlcXVpcmVEb21Ob2RlKGVsKTtcblxuICAgIHZhciBfcmVmNSA9IG9wdGlvbnMgfHwge30sXG4gICAgICAgIF9yZWY1JGVuY29kZXJUeXBlID0gX3JlZjUuZW5jb2RlclR5cGUsXG4gICAgICAgIGVuY29kZXJUeXBlID0gX3JlZjUkZW5jb2RlclR5cGUgPT09IHVuZGVmaW5lZCA/ICdpbWFnZS9wbmcnIDogX3JlZjUkZW5jb2RlclR5cGUsXG4gICAgICAgIF9yZWY1JGVuY29kZXJPcHRpb25zID0gX3JlZjUuZW5jb2Rlck9wdGlvbnMsXG4gICAgICAgIGVuY29kZXJPcHRpb25zID0gX3JlZjUkZW5jb2Rlck9wdGlvbnMgPT09IHVuZGVmaW5lZCA/IDAuOCA6IF9yZWY1JGVuY29kZXJPcHRpb25zLFxuICAgICAgICBjYW52ZyA9IF9yZWY1LmNhbnZnO1xuXG4gICAgdmFyIGNvbnZlcnRUb1BuZyA9IGZ1bmN0aW9uIGNvbnZlcnRUb1BuZyhfcmVmNikge1xuICAgICAgdmFyIHNyYyA9IF9yZWY2LnNyYyxcbiAgICAgICAgICB3aWR0aCA9IF9yZWY2LndpZHRoLFxuICAgICAgICAgIGhlaWdodCA9IF9yZWY2LmhlaWdodDtcblxuICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgdmFyIGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgIHZhciBwaXhlbFJhdGlvID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTtcblxuICAgICAgY2FudmFzLndpZHRoID0gd2lkdGggKiBwaXhlbFJhdGlvO1xuICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodCAqIHBpeGVsUmF0aW87XG4gICAgICBjYW52YXMuc3R5bGUud2lkdGggPSBjYW52YXMud2lkdGggKyAncHgnO1xuICAgICAgY2FudmFzLnN0eWxlLmhlaWdodCA9IGNhbnZhcy5oZWlnaHQgKyAncHgnO1xuICAgICAgY29udGV4dC5zZXRUcmFuc2Zvcm0ocGl4ZWxSYXRpbywgMCwgMCwgcGl4ZWxSYXRpbywgMCwgMCk7XG5cbiAgICAgIGlmIChjYW52ZykgY2FudmcoY2FudmFzLCBzcmMpO2Vsc2UgY29udGV4dC5kcmF3SW1hZ2Uoc3JjLCAwLCAwKTtcblxuICAgICAgdmFyIHBuZyA9IHZvaWQgMDtcbiAgICAgIHRyeSB7XG4gICAgICAgIHBuZyA9IGNhbnZhcy50b0RhdGFVUkwoZW5jb2RlclR5cGUsIGVuY29kZXJPcHRpb25zKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBTZWN1cml0eUVycm9yICE9PSAndW5kZWZpbmVkJyAmJiBlIGluc3RhbmNlb2YgU2VjdXJpdHlFcnJvciB8fCBlLm5hbWUgPT09ICdTZWN1cml0eUVycm9yJykge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlbmRlcmVkIFNWRyBpbWFnZXMgY2Fubm90IGJlIGRvd25sb2FkZWQgaW4gdGhpcyBicm93c2VyLicpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHRocm93IGU7XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIGRvbmUgPT09ICdmdW5jdGlvbicpIGRvbmUocG5nLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShwbmcpO1xuICAgIH07XG5cbiAgICBpZiAoY2FudmcpIHJldHVybiBvdXQkLnByZXBhcmVTdmcoZWwsIG9wdGlvbnMpLnRoZW4oY29udmVydFRvUG5nKTtlbHNlIHJldHVybiBvdXQkLnN2Z0FzRGF0YVVyaShlbCwgb3B0aW9ucykudGhlbihmdW5jdGlvbiAodXJpKSB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB2YXIgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgaW1hZ2Uub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiByZXNvbHZlKGNvbnZlcnRUb1BuZyh7XG4gICAgICAgICAgICBzcmM6IGltYWdlLFxuICAgICAgICAgICAgd2lkdGg6IGltYWdlLndpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0OiBpbWFnZS5oZWlnaHRcbiAgICAgICAgICB9KSk7XG4gICAgICAgIH07XG4gICAgICAgIGltYWdlLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmVqZWN0KCdUaGVyZSB3YXMgYW4gZXJyb3IgbG9hZGluZyB0aGUgZGF0YSBVUkkgYXMgYW4gaW1hZ2Ugb24gdGhlIGZvbGxvd2luZyBTVkdcXG4nICsgd2luZG93LmF0b2IodXJpLnNsaWNlKDI2KSkgKyAnT3BlbiB0aGUgZm9sbG93aW5nIGxpbmsgdG8gc2VlIGJyb3dzZXJcXCdzIGRpYWdub3Npc1xcbicgKyB1cmkpO1xuICAgICAgICB9O1xuICAgICAgICBpbWFnZS5zcmMgPSB1cmk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICBvdXQkLmRvd25sb2FkID0gZnVuY3Rpb24gKG5hbWUsIHVyaSwgb3B0aW9ucykge1xuICAgIGlmIChuYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYikgbmF2aWdhdG9yLm1zU2F2ZU9yT3BlbkJsb2IodXJpVG9CbG9iKHVyaSksIG5hbWUpO2Vsc2Uge1xuICAgICAgdmFyIHNhdmVMaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgaWYgKCdkb3dubG9hZCcgaW4gc2F2ZUxpbmspIHtcbiAgICAgICAgc2F2ZUxpbmsuZG93bmxvYWQgPSBuYW1lO1xuICAgICAgICBzYXZlTGluay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNhdmVMaW5rKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgYmxvYiA9IHVyaVRvQmxvYih1cmkpO1xuICAgICAgICAgIHZhciB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICAgIHNhdmVMaW5rLmhyZWYgPSB1cmw7XG4gICAgICAgICAgc2F2ZUxpbmsub25jbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgY29uc29sZS53YXJuKCdFcnJvciB3aGlsZSBnZXR0aW5nIG9iamVjdCBVUkwuIEZhbGxpbmcgYmFjayB0byBzdHJpbmcgVVJMLicpO1xuICAgICAgICAgIHNhdmVMaW5rLmhyZWYgPSB1cmk7XG4gICAgICAgIH1cbiAgICAgICAgc2F2ZUxpbmsuY2xpY2soKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChzYXZlTGluayk7XG4gICAgICB9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5wb3B1cCkge1xuICAgICAgICBvcHRpb25zLnBvcHVwLmRvY3VtZW50LnRpdGxlID0gbmFtZTtcbiAgICAgICAgb3B0aW9ucy5wb3B1cC5sb2NhdGlvbi5yZXBsYWNlKHVyaSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIG91dCQuc2F2ZVN2ZyA9IGZ1bmN0aW9uIChlbCwgbmFtZSwgb3B0aW9ucykge1xuICAgIHZhciBkb3dubG9hZE9wdHMgPSBkb3dubG9hZE9wdGlvbnMoKTsgLy8gZG9uJ3QgaW5saW5lLCBjYW4ndCBiZSBhc3luY1xuICAgIHJldHVybiByZXF1aXJlRG9tTm9kZVByb21pc2UoZWwpLnRoZW4oZnVuY3Rpb24gKGVsKSB7XG4gICAgICByZXR1cm4gb3V0JC5zdmdBc0RhdGFVcmkoZWwsIG9wdGlvbnMgfHwge30pO1xuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHVyaSkge1xuICAgICAgcmV0dXJuIG91dCQuZG93bmxvYWQobmFtZSwgdXJpLCBkb3dubG9hZE9wdHMpO1xuICAgIH0pO1xuICB9O1xuXG4gIG91dCQuc2F2ZVN2Z0FzUG5nID0gZnVuY3Rpb24gKGVsLCBuYW1lLCBvcHRpb25zKSB7XG4gICAgdmFyIGRvd25sb2FkT3B0cyA9IGRvd25sb2FkT3B0aW9ucygpOyAvLyBkb24ndCBpbmxpbmUsIGNhbid0IGJlIGFzeW5jXG4gICAgcmV0dXJuIHJlcXVpcmVEb21Ob2RlUHJvbWlzZShlbCkudGhlbihmdW5jdGlvbiAoZWwpIHtcbiAgICAgIHJldHVybiBvdXQkLnN2Z0FzUG5nVXJpKGVsLCBvcHRpb25zIHx8IHt9KTtcbiAgICB9KS50aGVuKGZ1bmN0aW9uICh1cmkpIHtcbiAgICAgIHJldHVybiBvdXQkLmRvd25sb2FkKG5hbWUsIHVyaSwgZG93bmxvYWRPcHRzKTtcbiAgICB9KTtcbiAgfTtcbn0pKCk7Il19\n"]}