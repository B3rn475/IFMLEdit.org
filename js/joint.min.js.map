{"version":3,"sources":["joint.js"],"names":["root","factory","define","amd","Backbone","_","$","exports","require","module","jQuery","joint","g","V","Vectorizer","this","toStr","isCallable","maxSafeInteger","toLength","object","chars","InvalidCharacterError","message","prototype","Error","name","btoa","input","block","charCode","str","String","idx","map","output","charAt","charCodeAt","atob","replace","length","bs","buffer","bc","fromCharCode","indexOf","subarray","start","end","slice","set_","array","offset","arguments","i","n","TypedArray","arg1","result","Array","byteLength","set","Uint8Array","window","Uint32Array","Int32Array","XMLHttpRequest","Object","defineProperty","get","VBArray","responseBody","toArray","includes","value","searchElement","fromIndex","TypeError","o","len","x","y","k","Math","max","abs","isNaN","find","predicate","thisArg","kValue","call","from","toString","fn","pow","number","Number","isFinite","floor","toInteger","min","arrayLike","C","items","T","mapFn","A","findIndex","search","startsWith","searchString","position","substr","math","cos","sin","sqrt","atan2","round","PI","random","bezier","curveThroughPoints","points","console","warn","Path","Curve","throughPoints","serialize","getCurveControlPoints","knots","firstControlPoints","secondControlPoints","Point","rhs","getFirstControlPoints","push","getCurveDivider","p0","p1","p2","p3","curve","t","divided","divide","controlPoint1","controlPoint2","tmp","b","getInversionSolver","p","closestPointT","p4","isArray","controlPoints","curves","bbox","a","c","t1","t2","b2ac","sqrtb2ac","x0","y0","x1","y1","x2","y2","x3","y3","tvalues","bounds","mt","j","jlen","X","Y","left","apply","top","right","bottom","Rect","clone","closestPoint","opt","pointAtT","closestPointLength","precision","undefined","PRECISION","localOpt","subdivisions","getSubdivisions","lengthAtT","closestPointNormalizedLength","cpLength","investigatedSubdivision","investigatedSubdivisionStartT","investigatedSubdivisionEndT","distFromStart","distFromEnd","minSumDist","subdivisionSize","currentSubdivision","startDist","distance","endDist","sumDist","precisionRatio","startPrecisionRatio","endPrecisionRatio","startDist1","endDist1","sumDist1","startDist2","endDist2","closestPointTangent","tangentAtT","dividerPoints","getSkeletonPoints","startControl1","startControlPoint1","startControl2","startControlPoint2","divider","dividerControl1","dividerControlPoint1","dividerControl2","dividerControlPoint2","endpointDistance","equals","control1","control2","midpoint1","Line","pointAt","midpoint2","midpoint3","subControl1","subControl2","previousLength","iteration","newSubdivisions","numSubdivisions","numNewSubdivisions","isDifferentiable","ratio","tAt","pointAtLength","tAtLength","scale","sx","sy","origin","tangentAt","tangentAtLength","skeletonPoints","tangentStart","tangentLine","translate","fromStart","baselinePointDistFromStart","baselinePointDistFromEnd","l","d","curveLength","newBaselinePointDistFromStart","newBaselinePointDistFromEnd","baseline1Length","baseline2Length","toPoints","toPolyline","Polyline","tx","ty","Ellipse","fromRect","rect","center","width","height","containsPoint","normalizedDistance","ellipse","inflate","dx","dy","intersectionWithLine","line","intersections","a1","a2","rx","ry","dir","vector","diff","difference","mDir","mDiff","dot","ta","tb","lerp","intersectionWithLineFromCenterToPoint","angle","rotate","pointNearestToPoint","m","mSquared","aSquared","bSquared","point","tangentTheta","q1","q3","theta","bearing","lat1","toRad","lat2","lon1","lon2","dLon","index","toDeg","parseInt","product","cpNormalizedLength","squaredLength","intersect","shape","intersection","pt1Dir","pt2Dir","det","deltaPt","alpha","beta","midpoint","lineLength","pointOffset","f","setLength","currentLength","scaleFactor","arg","parse","segments","isSegment","segment","appendSegment","previousObj","obj","createSegment","pathData","path","commands","match","numCommands","args","type","segmentConstructor","segmentTypes","applyToNew","currentSegment","numSegments","previousSegment","currentArg","prepareSegment","isVisible","segmentBBox","union","lastSegment","segmentSubdivisions","getSegmentSubdivisions","minSquaredDistance","Infinity","segmentClosestPointT","segmentClosestPoint","squaredDistance","segmentIndex","otherSegments","otherSegment","getSegment","insertSegment","nextSegment","splice","polylines","toPolylines","polyline","polylineIntersection","isValid","tValue","precisison","lastVisibleSegment","updateSubpathStart","isSubpathStart","subpathStartSegment","updateSubpathStartSegment","removeSegment","removedSegment","replaceSegment","replacedSegment","segmentAt","segmentIndexAt","segmentAtLength","segmentIndexAtLength","lastVisibleSegmentIndex","lastValidSegment","partialPoints","currentSegmentSubdivisions","subdivisionPoints","trim","configurable","enumerable","xy","split","parseFloat","fromPolar","deg","normalizeAngle","adhereToRect","r","angleBetween","NaN","changeInAngle","ref","cross","magnitude","manhattanDistance","move","normalize","reflection","cosAngle","sinAngle","snapToGrid","gx","gy","rad","toJSON","toPolar","update","vectorAngle","svgString","coords","numPoints","newPoints","minSqrDistance","sqrDistance","convexHull","startPoint","sortedPointRecords","entry","sort","record1","record2","sortOutput","startPointRecord","unshift","currentPointRecord","currentPoint","lastHullPointRecord","lastHullPoint","secondLastHullPointRecord","secondLastHullPoint","lowestHullIndex","insidePoints","hullPointRecords","pop","hasOwnProperty","correctTurnFound","crossProduct","indexOfLowestHullIndexRecord","currentHullIndex","hullPointRecordsReordered","newFirstChunk","newSecondChunk","concat","hullPoints","otherPoints","otherPoint","l2","int","lastValidLine","w","h","fromEllipse","e","st","ct","bottomLeft","bottomLine","bottomRight","bottomMiddle","containsRect","r0","r1","w0","h0","w1","h1","corner","mr","nr","myOrigin","myCorner","rOrigin","rCorner","pt","rectLines","topLine","rightLine","leftLine","dedupeArr","sides","connector","topLeft","leftMiddle","maxRectScaleToFit","sx1","sx2","sx3","sx4","sy1","sy2","sy3","sy4","ox","oy","topRight","maxRectUniformScaleToFit","moveAndExpand","newx","newy","newwidth","newheight","sideNearestToPoint","rightMiddle","distToLeft","distToRight","distToTop","closest","side","topMiddle","originX","originY","cornerX","cornerY","linear","domain","range","domainSpan","rangeSpan","gridSize","over360","constructor","argsArray","Function","bind","extend","child","create","inheritedProperty","key","src","getOwnPropertyDescriptor","segmentPrototype","writable","Lineto","outputArray","segmentPoint","segmentCoords","linetoPrototype","Curveto","segmentPoints","curvetoPrototype","c1","c2","Moveto","movetoPrototype","Closepath","closepathPrototype","L","M","Z","z","regexSupportedData","RegExp","keys","join","isDataSupported","data","test","SVGAngle","document","implementation","hasFeature","ns","xmlns","xml","xlink","xhtml","el","attrs","children","isV","node","isString","toLowerCase","createSvgDocument","svgDoc","childNodes","arrayOfVels","childNode","importNode","firstChild","createElementNS","ensureId","setAttributes","append","VPrototype","annotateTextLine","lineNode","lineAnnotations","includeAnnotationIndices","eol","lineHeight","baseSize","maxFontSize","fontMetrics","lastJ","annotation","fontSize","isObject","annotationAttrs","vTSpan","tspanNode","textContent","annotationClass","addClass","attr","annotations","createTextNode","appendChild","id","getTransformToElement","target","isSVGGraphicsElement","targetCTM","toNode","getScreenCTM","nodeCTM","inverse","multiply","createSVGMatrix","transform","matrix","isUndefined","transformStringToMatrix","absolute","matrixToTransformString","svgTransform","createSVGTransform","baseVal","appendItem","transformAttr","parseTransformString","newTranslate","cx","cy","newRotate","newScale","withoutTransformations","box","ownerSVGElement","getBBox","clientLeft","clientTop","clientWidth","clientHeight","transformRect","outputBBox","options","recursive","childBBox","currentChild","emRegex","convertEmToPx","em","numerical","text","content","sanitizeText","textPath","verticalAnchor","textVerticalAnchor","namedVerticalAnchor","iai","defaultLineHeight","autoLineHeight","empty","xml:space","display","containerNode","doc","vel","textPathElement","linkedPath","appendTo","defs","createTextPathNode","createDocumentFragment","annotatedY","lines","linesMetrics","lastI","lineMetrics","lineClassName","namespace","iLineHeight","annotateString","lineNodeStyle","style","fillOpacity","strokeOpacity","setAttribute","className","alignment","baseSizePx","flMaxFont","rLineHeights","lineHeightPx","llMaxFont","calculateDY","rh","removeAttr","qualifiedName","qualifyAttr","hasAttributeNS","local","removeAttributeNS","hasAttribute","removeAttribute","attributes","getAttribute","attrName","normalizePath","tagName","normalizePathData","remove","parentNode","removeChild","els","prepend","before","parent","insertBefore","svg","SVGSVGElement","toUpperCase","context","defsNode","getElementsByTagName","cloneNode","uniqueId","findOne","selector","found","querySelector","vels","nodes","querySelectorAll","nodeType","previousSibling","findParentByClass","terminator","hasClass","contains","bup","compareDocumentPosition","toLocalPoint","createSVGPoint","globalPoint","matrixTransform","globalToLocalMatrix","translateCenterToPoint","translateAndAutoOrient","reference","s","translateToOrigin","setTranslate","rotateAroundOrigin","setRotate","translateFinal","finalPosition","ctm","setMatrix","decomposition","decomposeMatrix","translateX","translateY","rotation","animateAlongPath","animateMotion","mpath","xlink:href","beginElement","documentElement","animation","animators","animationID","id2anim","targets","getTargets","animator","Animator","register","prevClasses","removeClass","newClasses","toggleClass","toAdd","sample","interval","getTotalLength","samples","getPointAtLength","convertToPath","convertToPathData","convertLineToPathData","convertPolygonToPathData","convertPolylineToPathData","convertEllipseToPathData","convertCircleToPathData","convertRectToPathData","toGeometryShape","getPointsFromSvgNode","findIntersection","spot","gRect","rectMatrix","rectMatrixComponents","resetRotation","gp","refDistance","minDistance","closestSamples","setAttributeNS","parseXML","async","idCounter","nodeName","parser","DOMParser","parseFromString","error","combinedKey","transformRegex","transformSeparatorRegex","transformationListRegex","transformationMatrix","matches","transformationMatch","scaleNonUniform","skewX","skewY","separator","decomposedMatrix","scaleX","scaleY","transformations","translateMatch","rotateMatch","scaleMatch","deltaTransformPoint","px","py","matrixToScale","matrixToRotate","matrixToTranslate","isVElement","SVGElement","svgDocument","svgMatrix","component","SVGMatrix","createSVGTransformFromMatrix","corner1","corner2","corner3","corner4","minX","maxX","minY","maxY","transformPoint","transformLine","transformPolyline","inPoints","outPoints","styleToObject","styleString","ret","styles","pair","createSlicePathData","innerRadius","outerRadius","startAngle","endAngle","svgArcMax","a0","da","df","c0","s0","s1","mergeAttrs","batch","item","prev","compacted","JSON","stringify","findAnnotationsAtIndex","forEach","findAnnotationsBetweenIndexes","shiftAnnotations","polygon","svgPointsToPath","nodePoints","numberOfItems","getItem","KAPPA","circle","cd","cdx","cdy","rectToPath","topRx","bottomRx","topRy","bottomRy","spaces","pathCommand","pathValues","tan","asin","q2c","ax","ay","a2c","large_arc_flag","sweep_flag","_120","res","f1","f2","rx2","ry2","toFixed","f2old","x2old","y2old","s2","hx","hy","m1","m2","m3","m4","newres","ii","pathToAbsolute","pathArray","pathString","paramCounts","q","v","params","parsePathString","pa0","mx","my","jj","pa","kk","bx","by","qx","qy","processPath","pcom","nx","ny","Q","fixArc","pp","shift","pi","pcoms","pfirst","seg","seglen","caf","client","util","config","version","classNamePrefix","defaultTheme","dia","ui","layout","shapes","format","connectors","highlighters","routers","anchors","connectionPoints","connectionStrategies","linkTools","mvc","views","setTheme","theme","invoke","View","env","_results","_tests","svgforeignobject","addTest","hashCode","hash","getByPath","delim","setByPath","diver","unsetByPath","propertyToRemove","flattenObject","stop","shouldGoDeeper","flatObject","flatKey","uuid","guid","toKebabCase","string","normalizeEvent","evt","normalizedEvent","touchEvt","originalEvent","changedTouches","property","useElement","correspondingUseElement","nextFrame","raf","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","lastTime","callback","currTime","Date","getTime","timeToCall","setTimeout","cancelFrame","cancelAnimationFrame","webkitCancelAnimationFrame","webkitCancelRequestAnimationFrame","msCancelAnimationFrame","msCancelRequestAnimationFrame","oCancelAnimationFrame","oCancelRequestAnimationFrame","mozCancelAnimationFrame","mozCancelRequestAnimationFrame","clearTimeout","shapePerimeterConnectionPoint","linkView","view","magnet","scalable","rotatable","paper","viewport","model","isPercentage","val","parseCssNumeric","restrictUnits","validUnitExp","unit","exec","getUnit","breakText","size","textSpan","textElement","textNode","opacity","body","words","full","word","eolWords","jl","getComputedTextLength","partition","substring","heightValue","lastL","ellipsis","lastLineWithOmission","lastChar","lastLine","sanitizeHTML","html","parseHTML","each","currentNode","attrValue","downloadBlob","blob","fileName","navigator","msSaveBlob","url","URL","createObjectURL","link","createElement","href","download","click","revokeObjectURL","downloadDataUri","dataUri","dataUriToBlob","decodedString","firstCommaIndex","decodeURIComponent","dataTypeString","mimeString","unescape","encodeURIComponent","ia","Blob","imageToDataUri","xhr","open","addEventListener","responseType","FileReader","status","reader","onload","onerror","readAsDataURL","response","modernHandler","bytes","suffix","u8a","Uint8ToString","legacyHandler","send","getElementBBox","$el","element","ownerDocument","clientBBox","getBoundingClientRect","strokeWidthX","strokeWidthY","pageXOffset","offsetLeft","pageYOffset","offsetTop","sortElements","elements","comparator","$elements","placements","nextSibling","setAttributesBySelector","$element","forIn","addBack","filter","has","omit","normalizeSides","vertical","horizontal","timing","quad","cubic","inout","t3","exponential","bounce","reverse","reflect","clamp","back","elastic","interpolate","hexColor","ca","cb","ra","rd","ga","gd","ba","bd","ma","mb","u","outline","margin","template","color","highlight","blur","stdDeviation","dropShadow","tpl","grayscale","amount","sepia","saturate","hueRotate","invert","amount2","brightness","contrast","specifier","locale","currency","decimal","thousands","grouping","fill","align","sign","symbol","zfill","comma","prefix","integer","zcomma","negative","fullSuffix","convert","lastIndexOf","after","formatGroup","padding","formatString","fieldDelimiterIndex","fieldDelimiter","endPlaceholder","formattedStringArray","pieceFormatedString","formatSpec","fieldName","toPrecision","toExponential","ceil","log","LN10","prefixes","regex","_attr","attrArray","toggleFullScreen","topDocument","prefixedResult","prop","propName","isFunction","addClassNamePrefix","_className","removeClassNamePrefix","wrapWith","methods","wrapper","wrappers","method","cells","Cell","parseDOMJSON","json","selectors","groupSelectors","svgNamespace","fragment","queue","siblingsDef","nodeDef","namespaceURI","css","nodeSelector","nodeGroups","groupSelector","nodeGroup","group","childrenDef","mixin","assign","supplement","defaults","deepMixin","deepSupplement","defaultsDeep","invokeMap","sortedIndex","sortedIndexBy","uniq","uniqBy","cloneDeep","isEmpty","isEqual","isPlainObject","debounce","groupBy","sortBy","flattenDeep","without","pick","bindAll","camelCase","merge","mergeWith","last","customizer","noop","customResult","isBoolean","isNumber","themeClassNamePrefix","requireSetThemeOverride","initialize","cid","init","renderChildren","svgElement","findAttribute","attributeName","attributeValue","_ensureElement","setElement","_createElement","_setAttributes","_ensureElClassName","_setElement","prefixedClassName","onRender","override","removeThemeClassName","addThemeClassName","onSetTheme","oldTheme","newTheme","onRemove","undelegateDocumentEvents","getEventNamespace","delegateElementEvents","events","eventNS","eventName","on","undelegateElementEvents","off","delegateDocumentEvents","eventData","currentData","stopPropagation","propagationStopped","isPropagationStopped","protoProps","staticProps","renderFn","render","__render__","GraphCells","Collection","cellNamespace","models","graph","collection","cell","Link","Element","dry","Graph","Model","_batches","cellModel","trigger","_sortOnChangeZ","_out","_in","_nodes","_edges","_restructureOnAdd","_restructureOnRemove","_restructureOnReset","_restructureOnChangeSource","_restructureOnChangeTarget","_removeCell","isLink","source","prevSource","previous","prevTarget","getOutboundEdges","getInboundEdges","fromJSON","resetCells","clear","startBatch","stopBatch","_prepareCell","minZIndex","firstCell","first","maxZIndex","lastCell","addCell","addCells","add","preparedCells","reset","removeCells","disconnectLinks","removeLinks","silent","getCell","getCells","getElements","getLinks","getFirstCell","getLastCell","getConnectedLinks","inbound","outbound","links","edges","exists","edge","deep","embeddedCells","getEmbeddedCells","embeddedElements","isElement","edgeCell","sourceId","targetId","includeEnclosed","getNeighbors","neighbors","reduce","loop","hasLoop","sourceElement","isEmbeddedIn","targetElement","getCommonAncestor","cellsAncestors","ancestors","parentId","commonAncestor","ancestor","every","cellAncestors","getSuccessors","cloneCells","cloneMap","embeds","newEmbeds","embed","cloneSubgraph","subgraph","getSubgraph","cellMap","getPredecessors","iteratee","breadthFirst","bfs","dfs","visited","next","neighbor","_visited","_distance","getSources","sources","getSinks","sinks","isSource","isSink","isSuccessor","elementA","elementB","isPredecessor","isNeighbor","findModelsFromPoint","findModelsInArea","strict","findModelsUnderElement","searchBy","getCellsBBox","memo","isEmbedded","resize","resizeCells","batchName","hasActiveBatch","some","batches","validations","multiLinks","sourceModel","getSourceElement","_link","_source","_target","port","linkPinning","setWrapper","dimension","refBBox","isValuePercentage","positionWrapper","axis","delta","valuePercentage","refOrigin","offsetWrapper","nodeBBox","shapeWrapper","shapeConstructor","resetOffset","$node","cache","cachedShape","shapeBBox","shapeOrigin","fitScale","dWrapper","pointsWrapper","atConnectionWrapper","zeroVector","tangent","isTextInUse","isLinkView","LinkView","contextMarker","marker","stroke","widthFn","heightFn","attributesNS","xlinkHref","xlinkShow","xlinkRole","xlinkType","xlinkArcrole","xlinkTitle","xlinkActuate","xmlSpace","xmlBase","xmlLang","preserveAspectRatio","requiredExtension","requiredFeatures","systemLanguage","externalResourcesRequired","qualify","defineFilter","defineGradient","sourceMarker","marker-start","defineMarker","targetMarker","marker-end","vertexMarker","marker-mid","textWrap","textAttrs","textHash","pathSelector","pathNode","findBySelector","SVGPathElement","wrappedText","font-weight","fontWeight","font-size","font-family","fontFamily","title","titleNode","refX","refY","refDx","refDy","refWidth","refHeight","refRx","refRy","refRInscribed","refRCircumscribed","rValue","diagonalLength","refCx","refCy","xAlignment","yAlignment","refDResetOffset","refDKeepOffset","refPointsResetOffset","refPointsKeepOffset","connection","getSerializedConnection","atConnectionLengthKeepGradient","atConnectionLengthIgnoreGradient","atConnectionRatioKeepGradient","atConnectionRatioIgnoreGradient","refR","refD","refPoints","atConnectionLength","atConnectionRatio","refX2","refY2","refWidth2","refHeight2","ToolView","_visible","configure","toolsView","relatedView","parentView","simulateRelatedView","getName","show","hide","focus","focusOpacity","focusTool","blurTool","ToolsView","tools","CellView","tool","focusedTool","blurredTool","mount","changed","defaultAttrs","finalAttrs","defaultAttr","value2","name2","_transitionIds","processPorts","previousPorts","ports","removedPorts","parentCell","getParentCell","unembed","toFront","shouldUpdate","toBack","unset","getAncestors","cellId","props","pathArrayLength","propertyPath","propertyValue","propertyPathArray","initializer","prevProperty","pathItem","isArrayIndex","baseAttributes","rewrite","removeProp","dirty","nestedPath","transition","duration","delay","timingFunction","valueFunction","interpolatingFunction","firstFrameTime","setter","runtime","progress","transitionId","initiator","stopTransitions","getTransitions","addTo","findView","findViewByModel","getAttributeDefinition","defNS","globalDefNS","classNames","list","model-id","listenTo","onChangeAttrs","markup","groups","rootSelector","can","feature","interactive","notify","getStrokeBBox","isMagnet","strokeWidth","partial","unhighlight","findMagnet","$rootEl","is","getSelector","prevSelector","nthChild","getLinkEnd","endType","hasPort","connectionStrategy","strategy","getMagnetFromLinkEnd","findPortNode","setNodeAttributes","processNodeAttributes","attrVal","def","normalAttrs","setAttrs","positionAttrs","offsetAttrs","relatives","raw","normal","updateRelativeAttributes","rawAttrs","nodeAttrs","setResult","HTMLElement","translation","nodeTransform","nodeMatrix","nodePosition","nodeScale","getNodeScale","scalableNode","positioned","offseted","nodeClientRect","findNodesAttributes","selectorCache","nodeId","nodesAttrs","mergeIds","selected","unique","prevNodeAttrs","selectedLength","sortIndex","getEventTarget","elementFromPoint","clientX","clientY","updateDOMSubtreeAttributes","rootNode","rootBBox","nodeData","processedAttrs","bboxCache","relativeItems","roAttrs","roAttributes","nodesAllAttrs","refNode","nodeAllAttrs","refSelector","processedAttributes","allAttributes","itemIndex","refNodeId","rotatableNode","mergeProcessedAttributes","roProcessedAttrs","removeTools","_toolsView","hasTools","addTools","onToolEvent","updateTools","hideTools","showTools","event","pointerdblclick","pointerclick","contextmenu","pointerdown","_graph","pointermove","pointerup","mouseover","mouseout","mouseenter","mouseleave","mousewheel","onevent","onmagnet","magnetpointerdblclick","magnetcontextmenu","setInteractivity","dispatchToolsEvent","Paper","_initializePorts","isSetter","parentRelative","parentPosition","currentPosition","elementPosition","translateBy","restrictedArea","translatedPosition","currentSize","direction","quadrant","top-right","top-left","bottom-left","bottom-right","fixedPoint","imageFixedPoint","radius","atan","scaledBBox","fitEmbeds","ElementView","_removePorts","_renderPorts","metrics","renderingOnlyAttrs","modelAttrs","rotatableSelector","scalableSelector","renderMarkup","renderJSONMarkup","renderStringMarkup","updateTransformation","sgResize","rgTranslate","rgRotate","transformation","getTranslateString","rotateString","getRotateString","useModelGeometry","getNodeBBox","localToPaperRect","nodeCache","getNodeData","getNodeBoundingRect","magnetMatrix","getNodeMatrix","translateMatrix","getRootTranslateMatrix","rotateMatrix","getRootRotateMatrix","boundingRect","getNodeUnrotatedBBox","getNodeShape","geometryShape","scalableBBox","rotatableBBox","prepareEmbedding","maxZ","processEmbedding","paperOptions","candidates","findParentBy","frontParentOnly","newCandidateView","prevCandidateView","candidateEmbedView","candidate","validateEmbedding","clearEmbedding","embedding","candidateView","finalizeEmbedding","getDelegatedView","dragStart","action","dragMagnet","delegatedView","drag","dragMagnetEnd","dragEnd","targetMagnet","magnetpointerclick","dragMagnetStart","getRestrictedArea","currentTarget","validateMagnet","magnetThreshold","dragLinkStart","delegateDragEvents","addLinkFromMagnet","startArrowheadMove","whenNotAllowed","getDefaultLink","grid","embeddingMode","mousemoved","clickThreshold","toolMarkup","doubleToolMarkup","vertexMarkup","arrowheadMarkup","defaultLabel","labelMarkup","_builtins","textAnchor","pointerEvents","disconnect","localSource","localTarget","router","isRouterProvided","localRouter","isConnectorProvided","localConnector","label","labels","insertLabel","appendLabel","removeLabel","vertex","vertices","insertVertex","removeVertex","applyToPoints","reparent","newParent","getTargetElement","prevParent","getRelationshipAncestor","connectionAncestor","isRelationshipEmbeddedIn","_getDefaultLabel","endsEqual","portsEqual","shortLinkLength","doubleLinkTools","longLinkLength","linkToolsOffset","doubleLinkToolsOffset","sampleInterval","_labelCache","_labelSelectors","_markerCache","_V","_dragData","decimalsRounding","watchSource","createWatcher","watchTarget","startListening","onToolsChange","onLabelsChange","onVerticesChange","onSourceChange","onTargetChange","renderVertexMarkers","renderTools","updateToolsPosition","requireRender","previousLabels","pathLength","renderLabels","updateLabels","updateLabelPositions","renderArrowheadMarkers","_getLabelMarkup","_getLabelStringMarkup","_normalizeLabelMarkup","vNode","DocumentFragment","hasChildNodes","vLabels","labelCache","labelSelectors","labelsCount","container","labelNode","builtinDefaultLabel","builtinDefaultLabelMarkup","defaultMarkup","_mergeLabelAttrs","hasCustomMarkup","labelAttrs","defaultLabelAttrs","builtinDefaultLabelAttrs","canLabelMove","defaultLabelMarkup","tool2","$tools","toolTemplate","_toolCache","_tool2Cache","markerVertices","$markerVertices","markupTemplate","markerArrowheads","$markerArrowheads","sourceArrowhead","targetArrowhead","updateConnection","updateDefaultConnectionPath","updateArrowheadMarkers","perpendicular","updatePostponed","removeRedundantLinearVertices","conciseVertices","current","sourceAnchor","targetAnchor","connectionWrap","markerSource","markerTarget","_translateAndAutoOrientArrows","getEndView","sourceView","targetView","getEndAnchor","getEndMagnet","sourceMagnet","route","_translateConnectionPoints","findAnchors","findRoute","findConnectionPoints","sourcePoint","targetPoint","markerPoints","findMarkerPoints","findPath","sourceMarkerPoint","targetMarkerPoint","firstWaypoint","lastWaypoint","sourceBBox","targetBBox","sourceAnchorRef","firstVertex","lastVertex","sourceDef","targetDef","getAnchor","anchor","targetAnchorRef","sourceConnectionPointDef","connectionPoint","defaultConnectionPoint","sourcePointRef","sourceLine","getConnectionPoint","targetConnectionPointDef","targetPointRef","targetLine","anchorDef","cellView","perpendicularLinks","defaultAnchor","anchorFn","anchorName","connectionPointDef","connectionPointFn","linkConnectionPoint","linkConnectionMagnet","connectionPointName","_normalizeLabelPosition","labelPosition","builtinDefaultLabelPosition","defaultLabelPosition","defaultPosition","labelPoint","getLabelCoordinates","connectionLength","getConnectionLength","toolPosition","onModelChange","endModel","onEndModelChange","previousEnd","stopListening","getModelById","cacheOnly","doUpdate","makeSelector","oppositeEndType","oppositeEnd","endId","oppositeEndId","oppositeSelector","handleBy","connectedModel","connectedView","connectedMagnet","oppositeEndModel","sourceArrow","targetArrow","_getDefaultLabelPositionArgs","_getLabelPositionArgs","_mergeLabelPositionArgs","labelPositionArgs","defaultLabelPositionArgs","addLabel","isPointProvided","localX","localY","positionArgs","getLabelPosition","addVertex","getVertexIndex","sendToken","token","isReversed","animationAttributes","dur","repeatCount","calcMode","keyPoints","keyTimes","vToken","onAnimationEnd","defaultRouter","routerFn","defaultConnector","connectorFn","getConnection","getConnectionSubdivisions","getPointAtRatio","getTangentAtLength","getTangentAtRatio","getClosestPoint","getClosestPointLength","getClosestPointRatio","labelOffset","isDistanceRelative","absoluteDistance","isDistanceAbsoluteReverse","reverseDistance","isOffsetAbsolute","absoluteOffset","pathOpt","labelDistance","labelOffsetDiff","labelOffsetCoordinates","positionOffset","vertexLength","currentVertex","dragVertexStart","dragVertexRemoveStart","dragArrowheadStart","dragConnectionStart","dragData","dragVertex","dragLabel","dragArrowhead","dragVertexEnd","dragLabelEnd","dragArrowheadEnd","linkTool","onlabel","dragLabelStart","vertexIdx","labelIdx","vertexNode","removeNode","arrowheadType","ignoreBackwardsCompatibility","snapLinks","_snapArrowhead","_connectArrowhead","_snapArrowheadEnd","_connectArrowheadEnd","linkAllowed","_finishEmbedding","_notifyConnectEvent","_disallow","_afterArrowheadMove","arrowhead","initialEnd","currentEnd","initialMagnet","magnetUnderPointer","viewsInArea","findViewsInArea","prevClosestView","closestView","prevClosestMagnet","closestMagnet","MAX_VALUE","pointer","validateConnection","validateConnectionArgs","newClosestMagnet","connecting","snapping","eventTarget","viewUnderPointer","_beforeArrowheadMove","markAvailable","_markAvailableMagnets","_unmarkAvailableMagnets","_createValidateConnectionArgs","oppositeArrowhead","isMagnetAvailable","marked","magnets","availableMagnets","magnetAvailability","elementAvailability","markedMagnets","markedKeys","drawGrid","background","elementView","guard","highlighting","default","preventContextMenu","preventDefaultBlankAction","restrictTranslate","defaultLink","cellViewS","magnetS","cellViewT","magnetT","childView","labelMove","allowLink","moveThreshold","cellViewNamespace","highlighterNamespace","dblclick","mousedown","touchstart","DOMMouseScroll","mouseenter .joint-cell","mouseleave .joint-cell","mouseenter .joint-tools","mouseleave .joint-tools","mousedown .joint-cell [event]","touchstart .joint-cell [event]","mousedown .joint-cell [magnet]","touchstart .joint-cell [magnet]","dblclick .joint-cell [magnet]","contextmenu .joint-cell [magnet]","mousedown .joint-link .label","touchstart .joint-link .label","dragstart .joint-cell image","documentEvents","mousemove","touchmove","mouseup","touchend","touchcancel","_highlights","setGrid","cloneOptions","setDimensions","onCellAdded","removeView","resetViews","_onSort","_onBatchStop","onCellHighlight","onCellUnhighlight","_views","$document","$background","drawBackground","$grid","_background","updateBackgroundImage","_viewportMatrix","_viewportTransformString","transformString","getCTM","ctmString","clientMatrix","_sortDelayingBatches","sortViews","removeViews","getComputedSize","computedSize","setOrigin","fitToContent","gridWidth","gridHeight","currentScale","currentTranslate","calcWidth","calcHeight","allowNewOrigin","minWidth","minHeight","maxWidth","maxHeight","dimensionChange","scaleContentToFit","contentBBox","getContentBBox","scaleGrid","minScale","maxScale","fittingBBox","minScaleX","maxScaleX","minScaleY","maxScaleY","newSx","newSy","contentTranslation","newOx","newOy","getContentArea","crect","clientCTM","getArea","paperToLocalRect","createViewForModel","optionalViewClass","defaultViewClass","namespaceViewClass","_asyncCells","_frameId","asyncRenderViews","renderView","onImageDragStart","beforeRenderViews","afterRenderViews","cellsCollection","cancelRenderViews","asyncBatchAdded","batchSize","$cells","cellA","cellB","MIN_SCALE","newTx","newTy","findViewsFromPoint","clientToLocalPoint","localToPaperPoint","localPoint","localRect","paperToLocalPoint","paperPoint","paperRect","localToClientPoint","localToClientRect","clientPoint","clientToLocalRect","clientRect","localToPagePoint","pageOffset","localToPageRect","pageToLocalPoint","pageToLocalRect","clientOffset","scrollX","scrollY","resolveHighlighter","highlighterDef","highlighter","paperOpt","magnetEl","preventDefault","normalizedEvt","Event","stopImmediatePropagation","delegateEvents","relatedTarget","wheelDelta","detail","eventNode","magnetEvent","handler","magnetNode","undelegateEvents","button","guarded","setGridSize","clearGrid","_getGriRefs","_gridCache","patterns","exist","_gridSettings","_resolveDrawGridOption","gridPatterns","pattern","localOptions","refs","gridLayerSetting","patternUnits","patternDefVel","patternUri","XMLSerializer","serializeToString","backgroundPosition","backgroundSize","drawBackgroundImage","img","HTMLImageElement","backgroundImage","backgroundRepeat","repeat","backgroundOpacity","backgroundQuality","quality","backgroundPattern","backgroundPatterns","canvas","HTMLCanvasElement","toDataURL","updateBackgroundColor","image","isDefined","defId","getElementById","filterId","filterSVGString","filterAttrs","filterUnits","gradient","gradientId","stops","stopTemplate","gradientSVGString","gradientAttrs","markerId","orient","overflow","markerUnits","flipXy","imgWidth","imgHeight","ctx","getContext","drawImage","setTransform","flipX","flipY","watermark","watermarkAngle","radians","stepX","stepY","thickness","fixedDot","mesh","stroke-width","doubleMesh","PortData","clonedData","portLayoutNamespace","Port","portLabelLayoutNamespace","PortLabel","_init","getPorts","getGroup","getPortsByGroup","groupName","getGroupPortsMetrics","elBBox","groupPosition","groupPositionName","groupArgs","portsArgs","groupPortTransformations","accumulator","portTransformation","portId","labelTransformation","_getPortLabelLayout","portAttrs","portSize","labelSize","portPosition","_evaluateGroup","_evaluatePort","_getPosition","_getLabel","evaluated","_createPositionNode","_getZIndex","setDefault","positionName","setDefaults","_createPortData","_processRemovedPort","currentItemsMap","removed","hasPorts","getPortIndex","getPort","getPortsPositions","_portSettingsData","positions","_isValidPortId","addPort","portProp","_validatePorts","portsAttr","errorMessages","addPorts","removePort","removePorts","portsForRemoval","remainingPorts","cp","rp","rpId","prevPortData","err","curPortData","added","prevPort","curPort","portContainerMarkup","portMarkup","portLabelMarkup","_portElementsCache","_refreshPorts","elementReferences","elem","_getContainerElement","count","portsGropsByZ","portElement","_getPortElement","groupNames","_appendPorts","_updatePorts","containerElement","portElements","_createPortElement","portCache","portRoot","portContentElement","portSelectors","portContentSelectors","_updatePortGroup","labelElement","portContainerElement","_getPortMarkup","portDoc","portFragment","port-group","portContainerSelectors","_getPortLabelMarkup","labelDoc","labelFragment","portLabelElement","portLabelSelectors","elementBBox","portsMetrics","cached","applyPortTransform","transformData","initialAngle",".","basic","Generic","ref-x","ref-y","text-anchor","y-alignment","TextView","ref-dy","PortsModelInterface","updatePortsAttrs","__super__","_portSelectors","newAttrs","portName","portAttributes","getPortAttrs","getPortSelector","PortsViewInterface","renderPorts","$inPorts","$outPorts","portTemplate",".content","x-alignment","updateSize","updateContent",".fobj","div","setForeignObjectSize","setDivContent","TextBlockView","noSVGForeignObjectElement","noTextAttrs","border","header","headerText","bodyText","lateralArea","bodyAttrs","topAttrs","kappa","xCenter","xRight","ySideTop","yCurveTop","ySideBottom","yCurveBottom","backgroundColor","textAlign","boxSizing","alignItems","justifyContent","foreignObject","wrapValue","wrapAttrs","strokeLinejoin","cursor","pointer-events","shadow","manhattan","step","maximumLoops","maxAllowedDirectionChange","excludeEnds","excludeTypes","startDirections","endDirections","directionMap","cost","directions","offsetX","offsetY","penalties","0","45","90","paddingBox","fallbackRouter","orthogonal","fallbackRoute","to","draggingRoute","ObstacleMap","mapGridSize","SortedSet","values","OPEN","CLOSE","getSourceBBox","getTargetBBox","getSourceAnchor","getDirectionAngle","numDirections","angleTheta","diffX","diffY","gridStepsX","gridStepsY","distanceX","distanceY","fixAngleEnd","normalizedAngle","getDirectionChange","angle1","angle2","directionChange","getGridDimension","absDiff","numSteps","snappedX","snappedY","getKey","normalizePoint","reconstructRoute","parents","tailPoint","prevDiff","currentKey","leadPoint","estimateCost","endPoints","getRectPoints","directionList","anchorCenterVector","dirList","rectPoints","farthestIntersectionDistance","endpoint","numIntersections","farthestIntersection","currentIntersection","getTargetAnchor","startPoints","isPointAccessible","openSet","costs","previousRouteDirectionAngle","previousDirectionAngle","isPathBeginning","gridOffsetX","gridOffsetY","getGridOffsets","endPointsKeys","endPoint","loopsRemaining","currentParent","currentCost","isRouteBeginning","isStart","directionAngle","neighborPoint","neighborKey","isClose","costFromStart","isOpen","point1","point2","resolveOptions","build","oldVertices","newVertices","partialRoute","dragFrom","dragTo","excludedEnds","excludedAncestors","isExcludedType","isExcludedEnd","excluded","isExcludedAncestor","gridKey","mapKey","obstacle","metro","diagonalCost","l1","intersectionPoint","directionFrom","oneSide","coordinate","opposites","N","S","E","W","freeJoin","getBBoxSize","getBearing","getPointBox","getPaddingBox","elementPadding","vertexVertex","d1","d2","opposite","elementVertex","fromBBox","vertexElement","toBBox","freePoints","freeBearingPoints","elementElement","fromBorder","toBorder","mid","startRoute","endRoute","insideElement","boundary","reversed","orthogonalVertices","isOrthogonal","isOrthogonalLoop","rounded","curr","prevDistance","nextDistance","startMove","endMove","roundedStart","roundedEnd","smooth","controlPointX","controlPointY","jumpover","JUMP_TYPES","IGNORED_CONNECTORS","createLines","resultLines","nextPoint","updateJumpOver","updateList","_jumpOverUpdateList","sortPoints","buildPath","jumpSize","jumpType","isJump","xAxisRotate","halfLine","centerLine","xOffset","yOffset","jumpOverLinkView","listenToOnce","jump","ignoreConnectors","allLinks","thisModel","thisIndex","linkViews","thisLines","linkLines","thisLine","lineIntersections","crossCheckLines","crossCheckLine","skip","jumpStart","jumpEnd","jumpLine","createJumps","portTransformAttrs","trans","lineLayout","ellipseLayout","stepFn","compensateRotation","dr","argPoint","ellipseSpread","stepAngle","labelAttributes","opt1","opt2","outsideLayout","autoOrient","getBBoxAngles","orientAngle","tl","bl","br","insideLayout","bBoxAngles","radialLayout","portCenterOffset","manual","outsideOriented","outside","insideOriented","inside","radial","radialOriented","defaultOptions","getHighlighterId","removeHighlighter","magnetBBox","magnetVel","highlightVel","vector-effect","highlightMatrix","paddingMatrix","highlightView","removeHandler","bboxWrapper","dxPercentage","dyPercentage","resolveRefAsBBoxCenter","refView","refPoint","midSide","modelCenter","portGroup","portsPositions","closestIntersection","bboxIntersection","rectangle","bboxWORotation","lineWORotation","firstElementChild","nextElementSibling","findShapeNode","localShape","targetMatrix","localMatrix","localLine","localRef","insideout","extrapolate","sticky","cpOffset","abs2rel","pin","relative","useDefaults","pinAbsolute","pinRelative","VertexHandle","onPointerDown","onPointerMove","onDoubleClick","onPointerUp","Vertices","handleClass","snapRadius","redundancyRemoval","vertexAdding","handles","mousedown .joint-vertices-path","touchstart .joint-vertices-path","resetHandles","updatePath","handle","startHandleListening","onHandleWillChange","onHandleChanging","onHandleChanged","onHandleRemove","getNeighborPoints","snapVertex","vertexAdded","onPathPointerDown","SegmentHandle","viewPoint","Segments","segmentLengthThreshold","snapHandle","nextVertex","renderHandle","updateHandle","onHandleChangeStart","onHandleChangeEnd","shiftHandleIndexes","resetAnchor","relatedModel","changeSourceAnchor","deleteSourceAnchor","sourceAnchorPosition","sourceAnchorDef","changeTargetAnchor","deleteTargetAnchor","targetAnchorPosition","targetAnchorDef","segmentLine","Arrowhead","xAxisVector","TargetArrowhead","class","SourceArrowhead","Button","actionFn","Remove","Boundary","stroke-dasharray","Anchor","snap","toolView","refIndex","customAnchorAttributes","defaultAnchorAttributes","areaPadding","restrictArea","toggleArea","updateAnchor","updateArea","anchorNode","customAnchor","anchorAttributes","areaNode","area","visible","snapFn","rotatedCoords","onPointerDblClick","SourceAnchor","TargetAnchor",".outer",".inner","erd","Entity","Relationship","Attribute","text-decoration","cardinality","Circle",".marker-target",".card",".rank",".name",".connection",".root",".label",".tokens > circle",".tokens.one > circle",".tokens.two > circle:nth-child(1)",".tokens.two > circle:nth-child(2)",".tokens.three > circle:nth-child(1)",".tokens.three > circle:nth-child(2)",".tokens.three > circle:nth-child(3)",".tokens.alot > text","pn","PlaceView","renderTokens","$tokens","tokens","inPorts","outPorts",".body","ref-width","ref-height","in",".port-label",".port-body","out","updatePortItems","inPortItems","createPortItems","outPortItems","createPortItem","_addGroupPort","addOutPort","addInPort","_removeGroupPort","removeOutPort","removeInPort","_changeGroup","properties","changeInGroup","changeOutGroup","devs",".uml-class-name-rect",".uml-class-attrs-rect",".uml-class-methods-rect",".uml-class-name-text",".uml-class-attrs-text",".uml-class-methods-text","updateRectangles","getClassName","rects","rectHeight","uml","ClassView","Class","AbstractView","InterfaceView",".uml-state-body",".uml-state-separator",".uml-state-name",".uml-state-events","change:name","updateName","change:events","updateEvents","change:size","circle.outer","circle.inner","operation","logic","Gate",".wire","font-variant","text-transform","IO","ref-dx",".input",".output",".input1",".input2","Gate11","Gate21","input1","input2",".marker-vertex","graphlib","dagre","DirectedGraph","exportElement","exportLink","minLen","weight","labelpos","labeloffset","importElement","gl","glNode","setPosition","importLink","edgeObj","glEdge","setVertices","setLinkVertices","setLabels","graphOrCells","resizeClusters","clusterPadding","glGraph","toGraphLib","directed","multigraph","compound","setNodeLabel","setEdgeLabel","setEdgeName","glLabel","marginX","marginY","rankDir","rankdir","nodeSep","nodesep","edgeSep","edgesep","rankSep","ranksep","ranker","marginx","marginy","setGraph","debugTiming","fromGraphLib","importEdge","clusters","aCluster","bCluster","glSize","glGraphType","at","setEdge","setNode","isCompound","setParent"],"mappings":"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","file":"joint.min.js","sourcesContent":["/*! JointJS v2.2.1 (2018-11-12) - JavaScript diagramming library\n\n\nThis Source Code Form is subject to the terms of the Mozilla Public\nLicense, v. 2.0. If a copy of the MPL was not distributed with this\nfile, You can obtain one at http://mozilla.org/MPL/2.0/.\n*/\n(function(root, factory) {\n\n    if (typeof define === 'function' && define.amd) {\n\n        // For AMD.\n\n        define(['backbone', 'lodash', 'jquery'], function(Backbone, _, $) {\n\n            Backbone.$ = $;\n\n            return factory(root, Backbone, _, $);\n        });\n\n    } else if (typeof exports !== 'undefined') {\n\n        // For Node.js or CommonJS.\n\n        var Backbone = require('backbone');\n        var _ = require('lodash');\n        var $ = Backbone.$ = require('jquery');\n\n        module.exports = factory(root, Backbone, _, $);\n\n    } else {\n\n        // As a browser global.\n\n        var Backbone = root.Backbone;\n        var _ = root._;\n        var $ = Backbone.$ = root.jQuery || root.$;\n\n        root.joint = factory(root, Backbone, _, $);\n        root.g = root.joint.g;\n        root.V = root.Vectorizer = root.joint.V;\n    }\n\n}(this, function(root, Backbone, _, $) {\n\n(function() {\n\n    /**\n     * version: 0.3.0\n     * git://github.com/davidchambers/Base64.js.git\n     */\n\n    var object = typeof exports != 'undefined' ? exports : this; // #8: web workers\n    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\n    function InvalidCharacterError(message) {\n        this.message = message;\n    }\n\n    InvalidCharacterError.prototype = new Error;\n    InvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\n    // encoder\n    // [https://gist.github.com/999166] by [https://github.com/nignag]\n    object.btoa || (\n        object.btoa = function(input) {\n            var str = String(input);\n            for (\n                // initialize result and counter\n                var block, charCode, idx = 0, map = chars, output = '';\n                // if the next str index does not exist:\n                //   change the mapping table to \"=\"\n                //   check if d has no fractional digits\n                str.charAt(idx | 0) || (map = '=', idx % 1);\n                // \"8 - idx % 1 * 8\" generates the sequence 2, 4, 6, 8\n                output += map.charAt(63 & block >> 8 - idx % 1 * 8)\n            ) {\n                charCode = str.charCodeAt(idx += 3 / 4);\n                if (charCode > 0xFF) {\n                    throw new InvalidCharacterError('\\'btoa\\' failed: The string to be encoded contains characters outside of the Latin1 range.');\n                }\n                block = block << 8 | charCode;\n            }\n            return output;\n        });\n\n    // decoder\n    // [https://gist.github.com/1020396] by [https://github.com/atk]\n    object.atob || (\n        object.atob = function(input) {\n            var str = String(input).replace(/=+$/, '');\n            if (str.length % 4 == 1) {\n                throw new InvalidCharacterError('\\'atob\\' failed: The string to be decoded is not correctly encoded.');\n            }\n            for (\n                // initialize result and counters\n                var bc = 0, bs, buffer, idx = 0, output = '';\n                // get next character\n                // eslint-disable-next-line no-cond-assign\n                buffer = str.charAt(idx++);\n                // character found in table? initialize bit storage and add its ascii value;\n                ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer,\n                // and if not first of each 4 characters,\n                // convert the first 8 bits to one ascii character\n                bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0\n            ) {\n                // try to find character in table (0-63, not found => -1)\n                buffer = chars.indexOf(buffer);\n            }\n            return output;\n        });\n\n}());\n\n(function() {\n\n    if (typeof Uint8Array !== 'undefined' || typeof window === 'undefined') {\n        return;\n    }\n\n    function subarray(start, end) {\n        return this.slice(start, end);\n    }\n\n    function set_(array, offset) {\n\n        if (arguments.length < 2) {\n            offset = 0;\n        }\n        for (var i = 0, n = array.length; i < n; ++i, ++offset) {\n            this[offset] = array[i] & 0xFF;\n        }\n    }\n\n    // we need typed arrays\n    function TypedArray(arg1) {\n\n        var result;\n        if (typeof arg1 === 'number') {\n            result = new Array(arg1);\n            for (var i = 0; i < arg1; ++i) {\n                result[i] = 0;\n            }\n        } else {\n            result = arg1.slice(0);\n        }\n        result.subarray = subarray;\n        result.buffer = result;\n        result.byteLength = result.length;\n        result.set = set_;\n        if (typeof arg1 === 'object' && arg1.buffer) {\n            result.buffer = arg1.buffer;\n        }\n\n        return result;\n    }\n\n    window.Uint8Array = TypedArray;\n    window.Uint32Array = TypedArray;\n    window.Int32Array = TypedArray;\n})();\n\n/**\n * make xhr.response = 'arraybuffer' available for the IE9\n */\n(function() {\n\n    if (typeof XMLHttpRequest === 'undefined') {\n        return;\n    }\n\n    if ('response' in XMLHttpRequest.prototype ||\n        'mozResponseArrayBuffer' in XMLHttpRequest.prototype ||\n        'mozResponse' in XMLHttpRequest.prototype ||\n        'responseArrayBuffer' in XMLHttpRequest.prototype) {\n        return;\n    }\n\n    Object.defineProperty(XMLHttpRequest.prototype, 'response', {\n        get: function() {\n            /* global VBArray:true */\n            return new Uint8Array(new VBArray(this.responseBody).toArray());\n        }\n    });\n})();\n\n// https://tc39.github.io/ecma262/#sec-array.prototype.includes\nif (!Array.prototype.includes) {\n    Object.defineProperty(Array.prototype, 'includes', {\n        value: function(searchElement, fromIndex) {\n\n            // 1. Let O be ? ToObject(this value).\n            if (this == null) {\n                throw new TypeError('\"this\" is null or not defined');\n            }\n\n            var o = Object(this);\n\n            // 2. Let len be ? ToLength(? Get(O, \"length\")).\n            var len = o.length >>> 0;\n\n            // 3. If len is 0, return false.\n            if (len === 0) {\n                return false;\n            }\n\n            // 4. Let n be ? ToInteger(fromIndex).\n            //    (If fromIndex is undefined, this step produces the value 0.)\n            var n = fromIndex | 0;\n\n            // 5. If n  0, then\n            //  a. Let k be n.\n            // 6. Else n < 0,\n            //  a. Let k be len + n.\n            //  b. If k < 0, let k be 0.\n            var k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);\n\n            function sameValueZero(x, y) {\n                return x === y || (typeof x === 'number' && typeof y === 'number' && isNaN(x) && isNaN(y));\n            }\n\n            // 7. Repeat, while k < len\n            while (k < len) {\n                // a. Let elementK be the result of ? Get(O, ! ToString(k)).\n                // b. If SameValueZero(searchElement, elementK) is true, return true.\n                // c. Increase k by 1.\n                if (sameValueZero(o[k], searchElement)) {\n                    return true;\n                }\n                k++;\n            }\n\n            // 8. Return false\n            return false;\n        }\n    });\n}\n\n// https://tc39.github.io/ecma262/#sec-array.prototype.find\nif (!Array.prototype.find) {\n    Object.defineProperty(Array.prototype, 'find', {\n        value: function(predicate) {\n            // 1. Let O be ? ToObject(this value).\n            if (this == null) {\n                throw new TypeError('\"this\" is null or not defined');\n            }\n\n            var o = Object(this);\n\n            // 2. Let len be ? ToLength(? Get(O, \"length\")).\n            var len = o.length >>> 0;\n\n            // 3. If IsCallable(predicate) is false, throw a TypeError exception.\n            if (typeof predicate !== 'function') {\n                throw new TypeError('predicate must be a function');\n            }\n\n            // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.\n            var thisArg = arguments[1];\n\n            // 5. Let k be 0.\n            var k = 0;\n\n            // 6. Repeat, while k < len\n            while (k < len) {\n                // a. Let Pk be ! ToString(k).\n                // b. Let kValue be ? Get(O, Pk).\n                // c. Let testResult be ToBoolean(? Call(predicate, T,  kValue, k, O )).\n                // d. If testResult is true, return kValue.\n                var kValue = o[k];\n                if (predicate.call(thisArg, kValue, k, o)) {\n                    return kValue;\n                }\n                // e. Increase k by 1.\n                k++;\n            }\n\n            // 7. Return undefined.\n            return undefined;\n        }\n    });\n}\n\n// Production steps of ECMA-262, Edition 6, 22.1.2.1\nif (!Array.from) {\n    Array.from = (function() {\n        var toStr = Object.prototype.toString;\n        var isCallable = function(fn) {\n            return typeof fn === 'function' || toStr.call(fn) === '[object Function]';\n        };\n        var toInteger = function(value) {\n            var number = Number(value);\n            if (isNaN(number)) { return 0; }\n            if (number === 0 || !isFinite(number)) { return number; }\n            return (number > 0 ? 1 : -1) * Math.floor(Math.abs(number));\n        };\n        var maxSafeInteger = Math.pow(2, 53) - 1;\n        var toLength = function(value) {\n            var len = toInteger(value);\n            return Math.min(Math.max(len, 0), maxSafeInteger);\n        };\n\n        // The length property of the from method is 1.\n        return function from(arrayLike/*, mapFn, thisArg */) {\n            // 1. Let C be the this value.\n            var C = this;\n\n            // 2. Let items be ToObject(arrayLike).\n            var items = Object(arrayLike);\n\n            // 3. ReturnIfAbrupt(items).\n            if (arrayLike == null) {\n                throw new TypeError('Array.from requires an array-like object - not null or undefined');\n            }\n\n            // 4. If mapfn is undefined, then let mapping be false.\n            var mapFn = arguments.length > 1 ? arguments[1] : void undefined;\n            var T;\n            if (typeof mapFn !== 'undefined') {\n                // 5. else\n                // 5. a If IsCallable(mapfn) is false, throw a TypeError exception.\n                if (!isCallable(mapFn)) {\n                    throw new TypeError('Array.from: when provided, the second argument must be a function');\n                }\n\n                // 5. b. If thisArg was supplied, let T be thisArg; else let T be undefined.\n                if (arguments.length > 2) {\n                    T = arguments[2];\n                }\n            }\n\n            // 10. Let lenValue be Get(items, \"length\").\n            // 11. Let len be ToLength(lenValue).\n            var len = toLength(items.length);\n\n            // 13. If IsConstructor(C) is true, then\n            // 13. a. Let A be the result of calling the [[Construct]] internal method\n            // of C with an argument list containing the single item len.\n            // 14. a. Else, Let A be ArrayCreate(len).\n            var A = isCallable(C) ? Object(new C(len)) : new Array(len);\n\n            // 16. Let k be 0.\n            var k = 0;\n            // 17. Repeat, while k < len (also steps a - h)\n            var kValue;\n            while (k < len) {\n                kValue = items[k];\n                if (mapFn) {\n                    A[k] = typeof T === 'undefined' ? mapFn(kValue, k) : mapFn.call(T, kValue, k);\n                } else {\n                    A[k] = kValue;\n                }\n                k += 1;\n            }\n            // 18. Let putStatus be Put(A, \"length\", len, true).\n            A.length = len;\n            // 20. Return A.\n            return A;\n        };\n    }());\n}\n\n// https://tc39.github.io/ecma262/#sec-array.prototype.findIndex\nif (!Array.prototype.findIndex) {\n    Object.defineProperty(Array.prototype, 'findIndex', {\n        value: function(predicate) {\n            // 1. Let O be ? ToObject(this value).\n            if (this == null) {\n                throw new TypeError('\"this\" is null or not defined');\n            }\n\n            var o = Object(this);\n\n            // 2. Let len be ? ToLength(? Get(O, \"length\")).\n            var len = o.length >>> 0;\n\n            // 3. If IsCallable(predicate) is false, throw a TypeError exception.\n            if (typeof predicate !== 'function') {\n                throw new TypeError('predicate must be a function');\n            }\n\n            // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.\n            var thisArg = arguments[1];\n\n            // 5. Let k be 0.\n            var k = 0;\n\n            // 6. Repeat, while k < len\n            while (k < len) {\n                // a. Let Pk be ! ToString(k).\n                // b. Let kValue be ? Get(O, Pk).\n                // c. Let testResult be ToBoolean(? Call(predicate, T,  kValue, k, O )).\n                // d. If testResult is true, return k.\n                var kValue = o[k];\n                if (predicate.call(thisArg, kValue, k, o)) {\n                    return k;\n                }\n                // e. Increase k by 1.\n                k++;\n            }\n\n            // 7. Return -1.\n            return -1;\n        }\n    });\n}\n\nif (!String.prototype.includes) {\n    String.prototype.includes = function(search, start) {\n        'use strict';\n        if (typeof start !== 'number') {\n            start = 0;\n        }\n\n        if (start + search.length > this.length) {\n            return false;\n        } else {\n            return this.indexOf(search, start) !== -1;\n        }\n    };\n}\n\nif (!String.prototype.startsWith) {\n    String.prototype.startsWith = function(searchString, position){\n        return this.substr(position || 0, searchString.length) === searchString;\n    };\n}\n\nNumber.isFinite = Number.isFinite || function(value) {\n    return typeof value === 'number' && isFinite(value);\n};\n\n//The following works because NaN is the only value in javascript which is not equal to itself.\nNumber.isNaN = Number.isNaN || function(value) {\n    return value !== value;\n};\n\n\n// Geometry library.\n// -----------------\n\nvar g = {};\n\n(function(g) {\n\n    // Declare shorthands to the most used math functions.\n    var math = Math;\n    var abs = math.abs;\n    var cos = math.cos;\n    var sin = math.sin;\n    var sqrt = math.sqrt;\n    var min = math.min;\n    var max = math.max;\n    var atan2 = math.atan2;\n    var round = math.round;\n    var floor = math.floor;\n    var PI = math.PI;\n    var random = math.random;\n    var pow = math.pow;\n\n    g.bezier = {\n\n        // Cubic Bezier curve path through points.\n        // @deprecated\n        // @param {array} points Array of points through which the smooth line will go.\n        // @return {array} SVG Path commands as an array\n        curveThroughPoints: function(points) {\n\n            console.warn('deprecated');\n\n            return new Path(Curve.throughPoints(points)).serialize();\n        },\n\n        // Get open-ended Bezier Spline Control Points.\n        // @deprecated\n        // @param knots Input Knot Bezier spline points (At least two points!).\n        // @param firstControlPoints Output First Control points. Array of knots.length - 1 length.\n        // @param secondControlPoints Output Second Control points. Array of knots.length - 1 length.\n        getCurveControlPoints: function(knots) {\n\n            console.warn('deprecated');\n\n            var firstControlPoints = [];\n            var secondControlPoints = [];\n            var n = knots.length - 1;\n            var i;\n\n            // Special case: Bezier curve should be a straight line.\n            if (n == 1) {\n                // 3P1 = 2P0 + P3\n                firstControlPoints[0] = new Point(\n                    (2 * knots[0].x + knots[1].x) / 3,\n                    (2 * knots[0].y + knots[1].y) / 3\n                );\n\n                // P2 = 2P1  P0\n                secondControlPoints[0] = new Point(\n                    2 * firstControlPoints[0].x - knots[0].x,\n                    2 * firstControlPoints[0].y - knots[0].y\n                );\n\n                return [firstControlPoints, secondControlPoints];\n            }\n\n            // Calculate first Bezier control points.\n            // Right hand side vector.\n            var rhs = [];\n\n            // Set right hand side X values.\n            for (i = 1; i < n - 1; i++) {\n                rhs[i] = 4 * knots[i].x + 2 * knots[i + 1].x;\n            }\n\n            rhs[0] = knots[0].x + 2 * knots[1].x;\n            rhs[n - 1] = (8 * knots[n - 1].x + knots[n].x) / 2.0;\n\n            // Get first control points X-values.\n            var x = this.getFirstControlPoints(rhs);\n\n            // Set right hand side Y values.\n            for (i = 1; i < n - 1; ++i) {\n                rhs[i] = 4 * knots[i].y + 2 * knots[i + 1].y;\n            }\n\n            rhs[0] = knots[0].y + 2 * knots[1].y;\n            rhs[n - 1] = (8 * knots[n - 1].y + knots[n].y) / 2.0;\n\n            // Get first control points Y-values.\n            var y = this.getFirstControlPoints(rhs);\n\n            // Fill output arrays.\n            for (i = 0; i < n; i++) {\n                // First control point.\n                firstControlPoints.push(new Point(x[i], y[i]));\n\n                // Second control point.\n                if (i < n - 1) {\n                    secondControlPoints.push(new Point(\n                        2 * knots [i + 1].x - x[i + 1],\n                        2 * knots[i + 1].y - y[i + 1]\n                    ));\n\n                } else {\n                    secondControlPoints.push(new Point(\n                        (knots[n].x + x[n - 1]) / 2,\n                        (knots[n].y + y[n - 1]) / 2)\n                    );\n                }\n            }\n\n            return [firstControlPoints, secondControlPoints];\n        },\n\n        // Divide a Bezier curve into two at point defined by value 't' <0,1>.\n        // Using deCasteljau algorithm. http://math.stackexchange.com/a/317867\n        // @deprecated\n        // @param control points (start, control start, control end, end)\n        // @return a function that accepts t and returns 2 curves.\n        getCurveDivider: function(p0, p1, p2, p3) {\n\n            console.warn('deprecated');\n\n            var curve = new Curve(p0, p1, p2, p3);\n\n            return function divideCurve(t) {\n\n                var divided = curve.divide(t);\n\n                return [{\n                    p0: divided[0].start,\n                    p1: divided[0].controlPoint1,\n                    p2: divided[0].controlPoint2,\n                    p3: divided[0].end\n                }, {\n                    p0: divided[1].start,\n                    p1: divided[1].controlPoint1,\n                    p2: divided[1].controlPoint2,\n                    p3: divided[1].end\n                }];\n            };\n        },\n\n        // Solves a tridiagonal system for one of coordinates (x or y) of first Bezier control points.\n        // @deprecated\n        // @param rhs Right hand side vector.\n        // @return Solution vector.\n        getFirstControlPoints: function(rhs) {\n\n            console.warn('deprecated');\n\n            var n = rhs.length;\n            // `x` is a solution vector.\n            var x = [];\n            var tmp = [];\n            var b = 2.0;\n\n            x[0] = rhs[0] / b;\n\n            // Decomposition and forward substitution.\n            for (var i = 1; i < n; i++) {\n                tmp[i] = 1 / b;\n                b = (i < n - 1 ? 4.0 : 3.5) - tmp[i];\n                x[i] = (rhs[i] - x[i - 1]) / b;\n            }\n\n            for (i = 1; i < n; i++) {\n                // Backsubstitution.\n                x[n - i - 1] -= tmp[n - i] * x[n - i];\n            }\n\n            return x;\n        },\n\n        // Solves an inversion problem -- Given the (x, y) coordinates of a point which lies on\n        // a parametric curve x = x(t)/w(t), y = y(t)/w(t), nd the parameter value t\n        // which corresponds to that point.\n        // @deprecated\n        // @param control points (start, control start, control end, end)\n        // @return a function that accepts a point and returns t.\n        getInversionSolver: function(p0, p1, p2, p3) {\n\n            console.warn('deprecated');\n\n            var curve = new Curve(p0, p1, p2, p3);\n\n            return function solveInversion(p) {\n\n                return curve.closestPointT(p);\n            };\n        }\n    };\n\n    var Curve = g.Curve = function(p1, p2, p3, p4) {\n\n        if (!(this instanceof Curve)) {\n            return new Curve(p1, p2, p3, p4);\n        }\n\n        if (p1 instanceof Curve) {\n            return new Curve(p1.start, p1.controlPoint1, p1.controlPoint2, p1.end);\n        }\n\n        this.start = new Point(p1);\n        this.controlPoint1 = new Point(p2);\n        this.controlPoint2 = new Point(p3);\n        this.end = new Point(p4);\n    };\n\n    // Curve passing through points.\n    // Ported from C# implementation by Oleg V. Polikarpotchkin and Peter Lee (http://www.codeproject.com/KB/graphics/BezierSpline.aspx).\n    // @param {array} points Array of points through which the smooth line will go.\n    // @return {array} curves.\n    Curve.throughPoints = (function() {\n\n        // Get open-ended Bezier Spline Control Points.\n        // @param knots Input Knot Bezier spline points (At least two points!).\n        // @param firstControlPoints Output First Control points. Array of knots.length - 1 length.\n        // @param secondControlPoints Output Second Control points. Array of knots.length - 1 length.\n        function getCurveControlPoints(knots) {\n\n            var firstControlPoints = [];\n            var secondControlPoints = [];\n            var n = knots.length - 1;\n            var i;\n\n            // Special case: Bezier curve should be a straight line.\n            if (n == 1) {\n                // 3P1 = 2P0 + P3\n                firstControlPoints[0] = new Point(\n                    (2 * knots[0].x + knots[1].x) / 3,\n                    (2 * knots[0].y + knots[1].y) / 3\n                );\n\n                // P2 = 2P1  P0\n                secondControlPoints[0] = new Point(\n                    2 * firstControlPoints[0].x - knots[0].x,\n                    2 * firstControlPoints[0].y - knots[0].y\n                );\n\n                return [firstControlPoints, secondControlPoints];\n            }\n\n            // Calculate first Bezier control points.\n            // Right hand side vector.\n            var rhs = [];\n\n            // Set right hand side X values.\n            for (i = 1; i < n - 1; i++) {\n                rhs[i] = 4 * knots[i].x + 2 * knots[i + 1].x;\n            }\n\n            rhs[0] = knots[0].x + 2 * knots[1].x;\n            rhs[n - 1] = (8 * knots[n - 1].x + knots[n].x) / 2.0;\n\n            // Get first control points X-values.\n            var x = getFirstControlPoints(rhs);\n\n            // Set right hand side Y values.\n            for (i = 1; i < n - 1; ++i) {\n                rhs[i] = 4 * knots[i].y + 2 * knots[i + 1].y;\n            }\n\n            rhs[0] = knots[0].y + 2 * knots[1].y;\n            rhs[n - 1] = (8 * knots[n - 1].y + knots[n].y) / 2.0;\n\n            // Get first control points Y-values.\n            var y = getFirstControlPoints(rhs);\n\n            // Fill output arrays.\n            for (i = 0; i < n; i++) {\n                // First control point.\n                firstControlPoints.push(new Point(x[i], y[i]));\n\n                // Second control point.\n                if (i < n - 1) {\n                    secondControlPoints.push(new Point(\n                        2 * knots [i + 1].x - x[i + 1],\n                        2 * knots[i + 1].y - y[i + 1]\n                    ));\n\n                } else {\n                    secondControlPoints.push(new Point(\n                        (knots[n].x + x[n - 1]) / 2,\n                        (knots[n].y + y[n - 1]) / 2\n                    ));\n                }\n            }\n\n            return [firstControlPoints, secondControlPoints];\n        }\n\n        // Solves a tridiagonal system for one of coordinates (x or y) of first Bezier control points.\n        // @param rhs Right hand side vector.\n        // @return Solution vector.\n        function getFirstControlPoints(rhs) {\n\n            var n = rhs.length;\n            // `x` is a solution vector.\n            var x = [];\n            var tmp = [];\n            var b = 2.0;\n\n            x[0] = rhs[0] / b;\n\n            // Decomposition and forward substitution.\n            for (var i = 1; i < n; i++) {\n                tmp[i] = 1 / b;\n                b = (i < n - 1 ? 4.0 : 3.5) - tmp[i];\n                x[i] = (rhs[i] - x[i - 1]) / b;\n            }\n\n            for (i = 1; i < n; i++) {\n                // Backsubstitution.\n                x[n - i - 1] -= tmp[n - i] * x[n - i];\n            }\n\n            return x;\n        }\n\n        return function(points) {\n\n            if (!points || (Array.isArray(points) && points.length < 2)) {\n                throw new Error('At least 2 points are required');\n            }\n\n            var controlPoints = getCurveControlPoints(points);\n\n            var curves = [];\n            var n = controlPoints[0].length;\n            for (var i = 0; i < n; i++) {\n\n                var controlPoint1 = new Point(controlPoints[0][i].x, controlPoints[0][i].y);\n                var controlPoint2 = new Point(controlPoints[1][i].x, controlPoints[1][i].y);\n\n                curves.push(new Curve(points[i], controlPoint1, controlPoint2, points[i + 1]));\n            }\n\n            return curves;\n        };\n    })();\n\n    Curve.prototype = {\n\n        // Returns a bbox that tightly envelops the curve.\n        bbox: function() {\n\n            var start = this.start;\n            var controlPoint1 = this.controlPoint1;\n            var controlPoint2 = this.controlPoint2;\n            var end = this.end;\n\n            var x0 = start.x;\n            var y0 = start.y;\n            var x1 = controlPoint1.x;\n            var y1 = controlPoint1.y;\n            var x2 = controlPoint2.x;\n            var y2 = controlPoint2.y;\n            var x3 = end.x;\n            var y3 = end.y;\n\n            var points = new Array(); // local extremes\n            var tvalues = new Array(); // t values of local extremes\n            var bounds = [new Array(), new Array()];\n\n            var a, b, c, t;\n            var t1, t2;\n            var b2ac, sqrtb2ac;\n\n            for (var i = 0; i < 2; ++i) {\n\n                if (i === 0) {\n                    b = 6 * x0 - 12 * x1 + 6 * x2;\n                    a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n                    c = 3 * x1 - 3 * x0;\n\n                } else {\n                    b = 6 * y0 - 12 * y1 + 6 * y2;\n                    a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n                    c = 3 * y1 - 3 * y0;\n                }\n\n                if (abs(a) < 1e-12) { // Numerical robustness\n                    if (abs(b) < 1e-12) { // Numerical robustness\n                        continue;\n                    }\n\n                    t = -c / b;\n                    if ((0 < t) && (t < 1)) tvalues.push(t);\n\n                    continue;\n                }\n\n                b2ac = b * b - 4 * c * a;\n                sqrtb2ac = sqrt(b2ac);\n\n                if (b2ac < 0) continue;\n\n                t1 = (-b + sqrtb2ac) / (2 * a);\n                if ((0 < t1) && (t1 < 1)) tvalues.push(t1);\n\n                t2 = (-b - sqrtb2ac) / (2 * a);\n                if ((0 < t2) && (t2 < 1)) tvalues.push(t2);\n            }\n\n            var j = tvalues.length;\n            var jlen = j;\n            var mt;\n            var x, y;\n\n            while (j--) {\n                t = tvalues[j];\n                mt = 1 - t;\n\n                x = (mt * mt * mt * x0) + (3 * mt * mt * t * x1) + (3 * mt * t * t * x2) + (t * t * t * x3);\n                bounds[0][j] = x;\n\n                y = (mt * mt * mt * y0) + (3 * mt * mt * t * y1) + (3 * mt * t * t * y2) + (t * t * t * y3);\n                bounds[1][j] = y;\n\n                points[j] = { X: x, Y: y };\n            }\n\n            tvalues[jlen] = 0;\n            tvalues[jlen + 1] = 1;\n\n            points[jlen] = { X: x0, Y: y0 };\n            points[jlen + 1] = { X: x3, Y: y3 };\n\n            bounds[0][jlen] = x0;\n            bounds[1][jlen] = y0;\n\n            bounds[0][jlen + 1] = x3;\n            bounds[1][jlen + 1] = y3;\n\n            tvalues.length = jlen + 2;\n            bounds[0].length = jlen + 2;\n            bounds[1].length = jlen + 2;\n            points.length = jlen + 2;\n\n            var left = min.apply(null, bounds[0]);\n            var top = min.apply(null, bounds[1]);\n            var right = max.apply(null, bounds[0]);\n            var bottom = max.apply(null, bounds[1]);\n\n            return new Rect(left, top, (right - left), (bottom - top));\n        },\n\n        clone: function() {\n\n            return new Curve(this.start, this.controlPoint1, this.controlPoint2, this.end);\n        },\n\n        // Returns the point on the curve closest to point `p`\n        closestPoint: function(p, opt) {\n\n            return this.pointAtT(this.closestPointT(p, opt));\n        },\n\n        closestPointLength: function(p, opt) {\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var subdivisions = (opt.subdivisions === undefined) ? this.getSubdivisions({ precision: precision }) : opt.subdivisions;\n            var localOpt = { precision: precision, subdivisions: subdivisions };\n\n            return this.lengthAtT(this.closestPointT(p, localOpt), localOpt);\n        },\n\n        closestPointNormalizedLength: function(p, opt) {\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var subdivisions = (opt.subdivisions === undefined) ? this.getSubdivisions({ precision: precision }) : opt.subdivisions;\n            var localOpt = { precision: precision, subdivisions: subdivisions };\n\n            var cpLength = this.closestPointLength(p, localOpt);\n            if (!cpLength) return 0;\n\n            var length = this.length(localOpt);\n            if (length === 0) return 0;\n\n            return cpLength / length;\n        },\n\n        // Returns `t` of the point on the curve closest to point `p`\n        closestPointT: function(p, opt) {\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var subdivisions = (opt.subdivisions === undefined) ? this.getSubdivisions({ precision: precision }) : opt.subdivisions;\n            // does not use localOpt\n\n            // identify the subdivision that contains the point:\n            var investigatedSubdivision;\n            var investigatedSubdivisionStartT; // assume that subdivisions are evenly spaced\n            var investigatedSubdivisionEndT;\n            var distFromStart; // distance of point from start of baseline\n            var distFromEnd; // distance of point from end of baseline\n            var minSumDist; // lowest observed sum of the two distances\n            var n = subdivisions.length;\n            var subdivisionSize = (n ? (1 / n) : 0);\n            for (var i = 0; i < n; i++) {\n\n                var currentSubdivision = subdivisions[i];\n\n                var startDist = currentSubdivision.start.distance(p);\n                var endDist = currentSubdivision.end.distance(p);\n                var sumDist = startDist + endDist;\n\n                // check that the point is closest to current subdivision and not any other\n                if (!minSumDist || (sumDist < minSumDist)) {\n                    investigatedSubdivision = currentSubdivision;\n\n                    investigatedSubdivisionStartT = i * subdivisionSize;\n                    investigatedSubdivisionEndT = (i + 1) * subdivisionSize;\n\n                    distFromStart = startDist;\n                    distFromEnd = endDist;\n\n                    minSumDist = sumDist;\n                }\n            }\n\n            var precisionRatio = pow(10, -precision);\n\n            // recursively divide investigated subdivision:\n            // until distance between baselinePoint and closest path endpoint is within 10^(-precision)\n            // then return the closest endpoint of that final subdivision\n            while (true) {\n\n                // check if we have reached required observed precision\n                var startPrecisionRatio;\n                var endPrecisionRatio;\n\n                startPrecisionRatio = (distFromStart ? (abs(distFromStart - distFromEnd) / distFromStart) : 0);\n                endPrecisionRatio = (distFromEnd ? (abs(distFromStart - distFromEnd) / distFromEnd) : 0);\n                if ((startPrecisionRatio < precisionRatio) || (endPrecisionRatio) < precisionRatio) {\n                    return ((distFromStart <= distFromEnd) ? investigatedSubdivisionStartT : investigatedSubdivisionEndT);\n                }\n\n                // otherwise, set up for next iteration\n                var divided = investigatedSubdivision.divide(0.5);\n                subdivisionSize /= 2;\n\n                var startDist1 = divided[0].start.distance(p);\n                var endDist1 = divided[0].end.distance(p);\n                var sumDist1 = startDist1 + endDist1;\n\n                var startDist2 = divided[1].start.distance(p);\n                var endDist2 = divided[1].end.distance(p);\n                var sumDist2 = startDist2 + endDist2;\n\n                if (sumDist1 <= sumDist2) {\n                    investigatedSubdivision = divided[0];\n\n                    investigatedSubdivisionEndT -= subdivisionSize; // subdivisionSize was already halved\n\n                    distFromStart = startDist1;\n                    distFromEnd = endDist1;\n\n                } else {\n                    investigatedSubdivision = divided[1];\n\n                    investigatedSubdivisionStartT += subdivisionSize; // subdivisionSize was already halved\n\n                    distFromStart = startDist2;\n                    distFromEnd = endDist2;\n                }\n            }\n        },\n\n        closestPointTangent: function(p, opt) {\n\n            return this.tangentAtT(this.closestPointT(p, opt));\n        },\n\n        // Divides the curve into two at point defined by `t` between 0 and 1.\n        // Using de Casteljau's algorithm (http://math.stackexchange.com/a/317867).\n        // Additional resource: https://pomax.github.io/bezierinfo/#decasteljau\n        divide: function(t) {\n\n            var start = this.start;\n            var controlPoint1 = this.controlPoint1;\n            var controlPoint2 = this.controlPoint2;\n            var end = this.end;\n\n            // shortcuts for `t` values that are out of range\n            if (t <= 0) {\n                return [\n                    new Curve(start, start, start, start),\n                    new Curve(start, controlPoint1, controlPoint2, end)\n                ];\n            }\n\n            if (t >= 1) {\n                return [\n                    new Curve(start, controlPoint1, controlPoint2, end),\n                    new Curve(end, end, end, end)\n                ];\n            }\n\n            var dividerPoints = this.getSkeletonPoints(t);\n\n            var startControl1 = dividerPoints.startControlPoint1;\n            var startControl2 = dividerPoints.startControlPoint2;\n            var divider = dividerPoints.divider;\n            var dividerControl1 = dividerPoints.dividerControlPoint1;\n            var dividerControl2 = dividerPoints.dividerControlPoint2;\n\n            // return array with two new curves\n            return [\n                new Curve(start, startControl1, startControl2, divider),\n                new Curve(divider, dividerControl1, dividerControl2, end)\n            ];\n        },\n\n        // Returns the distance between the curve's start and end points.\n        endpointDistance: function() {\n\n            return this.start.distance(this.end);\n        },\n\n        // Checks whether two curves are exactly the same.\n        equals: function(c) {\n\n            return !!c &&\n                    this.start.x === c.start.x &&\n                    this.start.y === c.start.y &&\n                    this.controlPoint1.x === c.controlPoint1.x &&\n                    this.controlPoint1.y === c.controlPoint1.y &&\n                    this.controlPoint2.x === c.controlPoint2.x &&\n                    this.controlPoint2.y === c.controlPoint2.y &&\n                    this.end.x === c.end.x &&\n                    this.end.y === c.end.y;\n        },\n\n        // Returns five helper points necessary for curve division.\n        getSkeletonPoints: function(t) {\n\n            var start = this.start;\n            var control1 = this.controlPoint1;\n            var control2 = this.controlPoint2;\n            var end = this.end;\n\n            // shortcuts for `t` values that are out of range\n            if (t <= 0) {\n                return {\n                    startControlPoint1: start.clone(),\n                    startControlPoint2: start.clone(),\n                    divider: start.clone(),\n                    dividerControlPoint1: control1.clone(),\n                    dividerControlPoint2: control2.clone()\n                };\n            }\n\n            if (t >= 1) {\n                return {\n                    startControlPoint1: control1.clone(),\n                    startControlPoint2: control2.clone(),\n                    divider: end.clone(),\n                    dividerControlPoint1: end.clone(),\n                    dividerControlPoint2: end.clone()\n                };\n            }\n\n            var midpoint1 = (new Line(start, control1)).pointAt(t);\n            var midpoint2 = (new Line(control1, control2)).pointAt(t);\n            var midpoint3 = (new Line(control2, end)).pointAt(t);\n\n            var subControl1 = (new Line(midpoint1, midpoint2)).pointAt(t);\n            var subControl2 = (new Line(midpoint2, midpoint3)).pointAt(t);\n\n            var divider = (new Line(subControl1, subControl2)).pointAt(t);\n\n            var output = {\n                startControlPoint1: midpoint1,\n                startControlPoint2: subControl1,\n                divider: divider,\n                dividerControlPoint1: subControl2,\n                dividerControlPoint2: midpoint3\n            };\n\n            return output;\n        },\n\n        // Returns a list of curves whose flattened length is better than `opt.precision`.\n        // That is, observed difference in length between recursions is less than 10^(-3) = 0.001 = 0.1%\n        // (Observed difference is not real precision, but close enough as long as special cases are covered)\n        // (That is why skipping iteration 1 is important)\n        // As a rule of thumb, increasing `precision` by 1 requires two more division operations\n        // - Precision 0 (endpointDistance) - total of 2^0 - 1 = 0 operations (1 subdivision)\n        // - Precision 1 (<10% error) - total of 2^2 - 1 = 3 operations (4 subdivisions)\n        // - Precision 2 (<1% error) - total of 2^4 - 1 = 15 operations requires 4 division operations on all elements (15 operations total) (16 subdivisions)\n        // - Precision 3 (<0.1% error) - total of 2^6 - 1 = 63 operations - acceptable when drawing (64 subdivisions)\n        // - Precision 4 (<0.01% error) - total of 2^8 - 1 = 255 operations - high resolution, can be used to interpolate `t` (256 subdivisions)\n        // (Variation of 1 recursion worse or better is possible depending on the curve, doubling/halving the number of operations accordingly)\n        getSubdivisions: function(opt) {\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            // not using opt.subdivisions\n            // not using localOpt\n\n            var subdivisions = [new Curve(this.start, this.controlPoint1, this.controlPoint2, this.end)];\n            if (precision === 0) return subdivisions;\n\n            var previousLength = this.endpointDistance();\n\n            var precisionRatio = pow(10, -precision);\n\n            // recursively divide curve at `t = 0.5`\n            // until the difference between observed length at subsequent iterations is lower than precision\n            var iteration = 0;\n            while (true) {\n                iteration += 1;\n\n                // divide all subdivisions\n                var newSubdivisions = [];\n                var numSubdivisions = subdivisions.length;\n                for (var i = 0; i < numSubdivisions; i++) {\n\n                    var currentSubdivision = subdivisions[i];\n                    var divided = currentSubdivision.divide(0.5); // dividing at t = 0.5 (not at middle length!)\n                    newSubdivisions.push(divided[0], divided[1]);\n                }\n\n                // measure new length\n                var length = 0;\n                var numNewSubdivisions = newSubdivisions.length;\n                for (var j = 0; j < numNewSubdivisions; j++) {\n\n                    var currentNewSubdivision = newSubdivisions[j];\n                    length += currentNewSubdivision.endpointDistance();\n                }\n\n                // check if we have reached required observed precision\n                // sine-like curves may have the same observed length in iteration 0 and 1 - skip iteration 1\n                // not a problem for further iterations because cubic curves cannot have more than two local extrema\n                // (i.e. cubic curves cannot intersect the baseline more than once)\n                // therefore two subsequent iterations cannot produce sampling with equal length\n                var observedPrecisionRatio = ((length !== 0) ? ((length - previousLength) / length) : 0);\n                if (iteration > 1 && observedPrecisionRatio < precisionRatio) {\n                    return newSubdivisions;\n                }\n\n                // otherwise, set up for next iteration\n                subdivisions = newSubdivisions;\n                previousLength = length;\n            }\n        },\n\n        isDifferentiable: function() {\n\n            var start = this.start;\n            var control1 = this.controlPoint1;\n            var control2 = this.controlPoint2;\n            var end = this.end;\n\n            return !(start.equals(control1) && control1.equals(control2) && control2.equals(end));\n        },\n\n        // Returns flattened length of the curve with precision better than `opt.precision`; or using `opt.subdivisions` provided.\n        length: function(opt) {\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision; // opt.precision only used in getSubdivisions() call\n            var subdivisions = (opt.subdivisions === undefined) ? this.getSubdivisions({ precision: precision }) : opt.subdivisions;\n            // not using localOpt\n\n            var length = 0;\n            var n = subdivisions.length;\n            for (var i = 0; i < n; i++) {\n\n                var currentSubdivision = subdivisions[i];\n                length += currentSubdivision.endpointDistance();\n            }\n\n            return length;\n        },\n\n        // Returns distance along the curve up to `t` with precision better than requested `opt.precision`. (Not using `opt.subdivisions`.)\n        lengthAtT: function(t, opt) {\n\n            if (t <= 0) return 0;\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            // not using opt.subdivisions\n            // not using localOpt\n\n            var subCurve = this.divide(t)[0];\n            var subCurveLength = subCurve.length({ precision: precision });\n\n            return subCurveLength;\n        },\n\n        // Returns point at requested `ratio` between 0 and 1 with precision better than `opt.precision`; optionally using `opt.subdivisions` provided.\n        // Mirrors Line.pointAt() function.\n        // For a function that tracks `t`, use Curve.pointAtT().\n        pointAt: function(ratio, opt) {\n\n            if (ratio <= 0) return this.start.clone();\n            if (ratio >= 1) return this.end.clone();\n\n            var t = this.tAt(ratio, opt);\n\n            return this.pointAtT(t);\n        },\n\n        // Returns point at requested `length` with precision better than requested `opt.precision`; optionally using `opt.subdivisions` provided.\n        pointAtLength: function(length, opt) {\n\n            var t = this.tAtLength(length, opt);\n\n            return this.pointAtT(t);\n        },\n\n        // Returns the point at provided `t` between 0 and 1.\n        // `t` does not track distance along curve as it does in Line objects.\n        // Non-linear relationship, speeds up and slows down as curve warps!\n        // For linear length-based solution, use Curve.pointAt().\n        pointAtT: function(t) {\n\n            if (t <= 0) return this.start.clone();\n            if (t >= 1) return this.end.clone();\n\n            return this.getSkeletonPoints(t).divider;\n        },\n\n        // Default precision\n        PRECISION: 3,\n\n        scale: function(sx, sy, origin) {\n\n            this.start.scale(sx, sy, origin);\n            this.controlPoint1.scale(sx, sy, origin);\n            this.controlPoint2.scale(sx, sy, origin);\n            this.end.scale(sx, sy, origin);\n            return this;\n        },\n\n        // Returns a tangent line at requested `ratio` with precision better than requested `opt.precision`; or using `opt.subdivisions` provided.\n        tangentAt: function(ratio, opt) {\n\n            if (!this.isDifferentiable()) return null;\n\n            if (ratio < 0) ratio = 0;\n            else if (ratio > 1) ratio = 1;\n\n            var t = this.tAt(ratio, opt);\n\n            return this.tangentAtT(t);\n        },\n\n        // Returns a tangent line at requested `length` with precision better than requested `opt.precision`; or using `opt.subdivisions` provided.\n        tangentAtLength: function(length, opt) {\n\n            if (!this.isDifferentiable()) return null;\n\n            var t = this.tAtLength(length, opt);\n\n            return this.tangentAtT(t);\n        },\n\n        // Returns a tangent line at requested `t`.\n        tangentAtT: function(t) {\n\n            if (!this.isDifferentiable()) return null;\n\n            if (t < 0) t = 0;\n            else if (t > 1) t = 1;\n\n            var skeletonPoints = this.getSkeletonPoints(t);\n\n            var p1 = skeletonPoints.startControlPoint2;\n            var p2 = skeletonPoints.dividerControlPoint1;\n\n            var tangentStart = skeletonPoints.divider;\n\n            var tangentLine = new Line(p1, p2);\n            tangentLine.translate(tangentStart.x - p1.x, tangentStart.y - p1.y); // move so that tangent line starts at the point requested\n\n            return tangentLine;\n        },\n\n        // Returns `t` at requested `ratio` with precision better than requested `opt.precision`; optionally using `opt.subdivisions` provided.\n        tAt: function(ratio, opt) {\n\n            if (ratio <= 0) return 0;\n            if (ratio >= 1) return 1;\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var subdivisions = (opt.subdivisions === undefined) ? this.getSubdivisions({ precision: precision }) : opt.subdivisions;\n            var localOpt = { precision: precision, subdivisions: subdivisions };\n\n            var curveLength = this.length(localOpt);\n            var length = curveLength * ratio;\n\n            return this.tAtLength(length, localOpt);\n        },\n\n        // Returns `t` at requested `length` with precision better than requested `opt.precision`; optionally using `opt.subdivisions` provided.\n        // Uses `precision` to approximate length within `precision` (always underestimates)\n        // Then uses a binary search to find the `t` of a subdivision endpoint that is close (within `precision`) to the `length`, if the curve was as long as approximated\n        // As a rule of thumb, increasing `precision` by 1 causes the algorithm to go 2^(precision - 1) deeper\n        // - Precision 0 (chooses one of the two endpoints) - 0 levels\n        // - Precision 1 (chooses one of 5 points, <10% error) - 1 level\n        // - Precision 2 (<1% error) - 3 levels\n        // - Precision 3 (<0.1% error) - 7 levels\n        // - Precision 4 (<0.01% error) - 15 levels\n        tAtLength: function(length, opt) {\n\n            var fromStart = true;\n            if (length < 0) {\n                fromStart = false; // negative lengths mean start calculation from end point\n                length = -length; // absolute value\n            }\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var subdivisions = (opt.subdivisions === undefined) ? this.getSubdivisions({ precision: precision }) : opt.subdivisions;\n            var localOpt = { precision: precision, subdivisions: subdivisions };\n\n            // identify the subdivision that contains the point at requested `length`:\n            var investigatedSubdivision;\n            var investigatedSubdivisionStartT; // assume that subdivisions are evenly spaced\n            var investigatedSubdivisionEndT;\n            //var baseline; // straightened version of subdivision to investigate\n            //var baselinePoint; // point on the baseline that is the requested distance away from start\n            var baselinePointDistFromStart; // distance of baselinePoint from start of baseline\n            var baselinePointDistFromEnd; // distance of baselinePoint from end of baseline\n            var l = 0; // length so far\n            var n = subdivisions.length;\n            var subdivisionSize = 1 / n;\n            for (var i = (fromStart ? (0) : (n - 1)); (fromStart ? (i < n) : (i >= 0)); (fromStart ? (i++) : (i--))) {\n\n                var currentSubdivision = subdivisions[i];\n                var d = currentSubdivision.endpointDistance(); // length of current subdivision\n\n                if (length <= (l + d)) {\n                    investigatedSubdivision = currentSubdivision;\n\n                    investigatedSubdivisionStartT = i * subdivisionSize;\n                    investigatedSubdivisionEndT = (i + 1) * subdivisionSize;\n\n                    baselinePointDistFromStart = (fromStart ? (length - l) : ((d + l) - length));\n                    baselinePointDistFromEnd = (fromStart ? ((d + l) - length) : (length - l));\n\n                    break;\n                }\n\n                l += d;\n            }\n\n            if (!investigatedSubdivision) return (fromStart ? 1 : 0); // length requested is out of range - return maximum t\n            // note that precision affects what length is recorded\n            // (imprecise measurements underestimate length by up to 10^(-precision) of the precise length)\n            // e.g. at precision 1, the length may be underestimated by up to 10% and cause this function to return 1\n\n            var curveLength = this.length(localOpt);\n\n            var precisionRatio = pow(10, -precision);\n\n            // recursively divide investigated subdivision:\n            // until distance between baselinePoint and closest path endpoint is within 10^(-precision)\n            // then return the closest endpoint of that final subdivision\n            while (true) {\n\n                // check if we have reached required observed precision\n                var observedPrecisionRatio;\n\n                observedPrecisionRatio = ((curveLength !== 0) ? (baselinePointDistFromStart / curveLength) : 0);\n                if (observedPrecisionRatio < precisionRatio) return investigatedSubdivisionStartT;\n                observedPrecisionRatio = ((curveLength !== 0) ? (baselinePointDistFromEnd / curveLength) : 0);\n                if (observedPrecisionRatio < precisionRatio) return investigatedSubdivisionEndT;\n\n                // otherwise, set up for next iteration\n                var newBaselinePointDistFromStart;\n                var newBaselinePointDistFromEnd;\n\n                var divided = investigatedSubdivision.divide(0.5);\n                subdivisionSize /= 2;\n\n                var baseline1Length = divided[0].endpointDistance();\n                var baseline2Length = divided[1].endpointDistance();\n\n                if (baselinePointDistFromStart <= baseline1Length) { // point at requested length is inside divided[0]\n                    investigatedSubdivision = divided[0];\n\n                    investigatedSubdivisionEndT -= subdivisionSize; // sudivisionSize was already halved\n\n                    newBaselinePointDistFromStart = baselinePointDistFromStart;\n                    newBaselinePointDistFromEnd = baseline1Length - newBaselinePointDistFromStart;\n\n                } else { // point at requested length is inside divided[1]\n                    investigatedSubdivision = divided[1];\n\n                    investigatedSubdivisionStartT += subdivisionSize; // subdivisionSize was already halved\n\n                    newBaselinePointDistFromStart = baselinePointDistFromStart - baseline1Length;\n                    newBaselinePointDistFromEnd = baseline2Length - newBaselinePointDistFromStart;\n                }\n\n                baselinePointDistFromStart = newBaselinePointDistFromStart;\n                baselinePointDistFromEnd = newBaselinePointDistFromEnd;\n            }\n        },\n\n        // Returns an array of points that represents the curve when flattened, up to `opt.precision`; or using `opt.subdivisions` provided.\n        // Flattened length is no more than 10^(-precision) away from real curve length.\n        toPoints: function(opt) {\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision; // opt.precision only used in getSubdivisions() call\n            var subdivisions = (opt.subdivisions === undefined) ? this.getSubdivisions({ precision: precision }) : opt.subdivisions;\n            // not using localOpt\n\n            var points = [subdivisions[0].start.clone()];\n            var n = subdivisions.length;\n            for (var i = 0; i < n; i++) {\n\n                var currentSubdivision = subdivisions[i];\n                points.push(currentSubdivision.end.clone());\n            }\n\n            return points;\n        },\n\n        // Returns a polyline that represents the curve when flattened, up to `opt.precision`; or using `opt.subdivisions` provided.\n        // Flattened length is no more than 10^(-precision) away from real curve length.\n        toPolyline: function(opt) {\n\n            return new Polyline(this.toPoints(opt));\n        },\n\n        toString: function() {\n\n            return this.start + ' ' + this.controlPoint1 + ' ' + this.controlPoint2 + ' ' + this.end;\n        },\n\n        translate: function(tx, ty) {\n\n            this.start.translate(tx, ty);\n            this.controlPoint1.translate(tx, ty);\n            this.controlPoint2.translate(tx, ty);\n            this.end.translate(tx, ty);\n            return this;\n        }\n    };\n\n    var Ellipse = g.Ellipse = function(c, a, b) {\n\n        if (!(this instanceof Ellipse)) {\n            return new Ellipse(c, a, b);\n        }\n\n        if (c instanceof Ellipse) {\n            return new Ellipse(new Point(c.x, c.y), c.a, c.b);\n        }\n\n        c = new Point(c);\n        this.x = c.x;\n        this.y = c.y;\n        this.a = a;\n        this.b = b;\n    };\n\n    Ellipse.fromRect = function(rect) {\n\n        rect = new Rect(rect);\n        return new Ellipse(rect.center(), rect.width / 2, rect.height / 2);\n    };\n\n    Ellipse.prototype = {\n\n        bbox: function() {\n\n            return new Rect(this.x - this.a, this.y - this.b, 2 * this.a, 2 * this.b);\n        },\n\n        /**\n         * @returns {g.Point}\n         */\n        center: function() {\n\n            return new Point(this.x, this.y);\n        },\n\n        clone: function() {\n\n            return new Ellipse(this);\n        },\n\n        /**\n         * @param {g.Point} p\n         * @returns {boolean}\n         */\n        containsPoint: function(p) {\n\n            return this.normalizedDistance(p) <= 1;\n        },\n\n        equals: function(ellipse) {\n\n            return !!ellipse &&\n                    ellipse.x === this.x &&\n                    ellipse.y === this.y &&\n                    ellipse.a === this.a &&\n                    ellipse.b === this.b;\n        },\n\n        // inflate by dx and dy\n        // @param dx {delta_x} representing additional size to x\n        // @param dy {delta_y} representing additional size to y -\n        // dy param is not required -> in that case y is sized by dx\n        inflate: function(dx, dy) {\n            if (dx === undefined) {\n                dx = 0;\n            }\n\n            if (dy === undefined) {\n                dy = dx;\n            }\n\n            this.a += 2 * dx;\n            this.b += 2 * dy;\n\n            return this;\n        },\n\n        intersectionWithLine: function(line) {\n\n            var intersections = [];\n            var a1 = line.start;\n            var a2 = line.end;\n            var rx = this.a;\n            var ry = this.b;\n            var dir = line.vector();\n            var diff = a1.difference(new Point(this));\n            var mDir = new Point(dir.x / (rx * rx), dir.y / (ry * ry));\n            var mDiff = new Point(diff.x / (rx * rx), diff.y / (ry * ry));\n\n            var a = dir.dot(mDir);\n            var b = dir.dot(mDiff);\n            var c = diff.dot(mDiff) - 1.0;\n            var d = b * b - a * c;\n\n            if (d < 0) {\n                return null;\n            } else if (d > 0) {\n                var root = sqrt(d);\n                var ta = (-b - root) / a;\n                var tb = (-b + root) / a;\n\n                if ((ta < 0 || 1 < ta) && (tb < 0 || 1 < tb)) {\n                    // if ((ta < 0 && tb < 0) || (ta > 1 && tb > 1)) outside else inside\n                    return null;\n                } else {\n                    if (0 <= ta && ta <= 1) intersections.push(a1.lerp(a2, ta));\n                    if (0 <= tb && tb <= 1) intersections.push(a1.lerp(a2, tb));\n                }\n            } else {\n                var t = -b / a;\n                if (0 <= t && t <= 1) {\n                    intersections.push(a1.lerp(a2, t));\n                } else {\n                    // outside\n                    return null;\n                }\n            }\n\n            return intersections;\n        },\n\n        // Find point on me where line from my center to\n        // point p intersects my boundary.\n        // @param {number} angle If angle is specified, intersection with rotated ellipse is computed.\n        intersectionWithLineFromCenterToPoint: function(p, angle) {\n\n            p = new Point(p);\n\n            if (angle) p.rotate(new Point(this.x, this.y), angle);\n\n            var dx = p.x - this.x;\n            var dy = p.y - this.y;\n            var result;\n\n            if (dx === 0) {\n                result = this.bbox().pointNearestToPoint(p);\n                if (angle) return result.rotate(new Point(this.x, this.y), -angle);\n                return result;\n            }\n\n            var m = dy / dx;\n            var mSquared = m * m;\n            var aSquared = this.a * this.a;\n            var bSquared = this.b * this.b;\n\n            var x = sqrt(1 / ((1 / aSquared) + (mSquared / bSquared)));\n            x = dx < 0 ? -x : x;\n\n            var y = m * x;\n            result = new Point(this.x + x, this.y + y);\n\n            if (angle) return result.rotate(new Point(this.x, this.y), -angle);\n            return result;\n        },\n\n        /**\n         * @param {g.Point} point\n         * @returns {number} result < 1 - inside ellipse, result == 1 - on ellipse boundary, result > 1 - outside\n         */\n        normalizedDistance: function(point) {\n\n            var x0 = point.x;\n            var y0 = point.y;\n            var a = this.a;\n            var b = this.b;\n            var x = this.x;\n            var y = this.y;\n\n            return ((x0 - x) * (x0 - x)) / (a * a ) + ((y0 - y) * (y0 - y)) / (b * b);\n        },\n\n        /** Compute angle between tangent and x axis\n         * @param {g.Point} p Point of tangency, it has to be on ellipse boundaries.\n         * @returns {number} angle between tangent and x axis\n         */\n        tangentTheta: function(p) {\n\n            var refPointDelta = 30;\n            var x0 = p.x;\n            var y0 = p.y;\n            var a = this.a;\n            var b = this.b;\n            var center = this.bbox().center();\n            var m = center.x;\n            var n = center.y;\n\n            var q1 = x0 > center.x + a / 2;\n            var q3 = x0 < center.x - a / 2;\n\n            var y, x;\n            if (q1 || q3) {\n                y = x0 > center.x ? y0 - refPointDelta : y0 + refPointDelta;\n                x = (a * a / (x0 - m)) - (a * a * (y0 - n) * (y - n)) / (b * b * (x0 - m)) + m;\n\n            } else {\n                x = y0 > center.y ? x0 + refPointDelta : x0 - refPointDelta;\n                y = ( b * b / (y0 - n)) - (b * b * (x0 - m) * (x - m)) / (a * a * (y0 - n)) + n;\n            }\n\n            return (new Point(x, y)).theta(p);\n\n        },\n\n        toString: function() {\n\n            return (new Point(this.x, this.y)).toString() + ' ' + this.a + ' ' + this.b;\n        }\n    };\n\n    var Line = g.Line = function(p1, p2) {\n\n        if (!(this instanceof Line)) {\n            return new Line(p1, p2);\n        }\n\n        if (p1 instanceof Line) {\n            return new Line(p1.start, p1.end);\n        }\n\n        this.start = new Point(p1);\n        this.end = new Point(p2);\n    };\n\n    Line.prototype = {\n\n        bbox: function() {\n\n            var left = min(this.start.x, this.end.x);\n            var top = min(this.start.y, this.end.y);\n            var right = max(this.start.x, this.end.x);\n            var bottom = max(this.start.y, this.end.y);\n\n            return new Rect(left, top, (right - left), (bottom - top));\n        },\n\n        // @return the bearing (cardinal direction) of the line. For example N, W, or SE.\n        // @returns {String} One of the following bearings : NE, E, SE, S, SW, W, NW, N.\n        bearing: function() {\n\n            var lat1 = toRad(this.start.y);\n            var lat2 = toRad(this.end.y);\n            var lon1 = this.start.x;\n            var lon2 = this.end.x;\n            var dLon = toRad(lon2 - lon1);\n            var y = sin(dLon) * cos(lat2);\n            var x = cos(lat1) * sin(lat2) - sin(lat1) * cos(lat2) * cos(dLon);\n            var brng = toDeg(atan2(y, x));\n\n            var bearings = ['NE', 'E', 'SE', 'S', 'SW', 'W', 'NW', 'N'];\n\n            var index = brng - 22.5;\n            if (index < 0)\n                index += 360;\n            index = parseInt(index / 45);\n\n            return bearings[index];\n        },\n\n        clone: function() {\n\n            return new Line(this.start, this.end);\n        },\n\n        // @return {point} the closest point on the line to point `p`\n        closestPoint: function(p) {\n\n            return this.pointAt(this.closestPointNormalizedLength(p));\n        },\n\n        closestPointLength: function(p) {\n\n            return this.closestPointNormalizedLength(p) * this.length();\n        },\n\n        // @return {number} the normalized length of the closest point on the line to point `p`\n        closestPointNormalizedLength: function(p) {\n\n            var product = this.vector().dot((new Line(this.start, p)).vector());\n            var cpNormalizedLength = min(1, max(0, product / this.squaredLength()));\n\n            // cpNormalizedLength returns `NaN` if this line has zero length\n            // we can work with that - if `NaN`, return 0\n            if (cpNormalizedLength !== cpNormalizedLength) return 0; // condition evaluates to `true` if and only if cpNormalizedLength is `NaN`\n            // (`NaN` is the only value that is not equal to itself)\n\n            return cpNormalizedLength;\n        },\n\n        closestPointTangent: function(p) {\n\n            return this.tangentAt(this.closestPointNormalizedLength(p));\n        },\n\n        equals: function(l) {\n\n            return !!l &&\n                    this.start.x === l.start.x &&\n                    this.start.y === l.start.y &&\n                    this.end.x === l.end.x &&\n                    this.end.y === l.end.y;\n        },\n\n        // @return {point} Point where I'm intersecting a line.\n        // @return [point] Points where I'm intersecting a rectangle.\n        // @see Squeak Smalltalk, LineSegment>>intersectionWith:\n        intersect: function(shape, opt) {\n\n            if (shape instanceof Line ||\n                shape instanceof Rect ||\n                shape instanceof Polyline ||\n                shape instanceof Ellipse ||\n                shape instanceof Path\n            ) {\n                var intersection = shape.intersectionWithLine(this, opt);\n\n                // Backwards compatibility\n                if (intersection && (shape instanceof Line)) {\n                    intersection = intersection[0];\n                }\n\n                return intersection;\n            }\n\n            return null;\n        },\n\n        intersectionWithLine: function(line) {\n\n            var pt1Dir = new Point(this.end.x - this.start.x, this.end.y - this.start.y);\n            var pt2Dir = new Point(line.end.x - line.start.x, line.end.y - line.start.y);\n            var det = (pt1Dir.x * pt2Dir.y) - (pt1Dir.y * pt2Dir.x);\n            var deltaPt = new Point(line.start.x - this.start.x, line.start.y - this.start.y);\n            var alpha = (deltaPt.x * pt2Dir.y) - (deltaPt.y * pt2Dir.x);\n            var beta = (deltaPt.x * pt1Dir.y) - (deltaPt.y * pt1Dir.x);\n\n            if (det === 0 || alpha * det < 0 || beta * det < 0) {\n                // No intersection found.\n                return null;\n            }\n\n            if (det > 0) {\n                if (alpha > det || beta > det) {\n                    return null;\n                }\n\n            } else {\n                if (alpha < det || beta < det) {\n                    return null;\n                }\n            }\n\n            return [new Point(\n                this.start.x + (alpha * pt1Dir.x / det),\n                this.start.y + (alpha * pt1Dir.y / det)\n            )];\n        },\n\n        isDifferentiable: function() {\n\n            return !this.start.equals(this.end);\n        },\n\n        // @return {double} length of the line\n        length: function() {\n\n            return sqrt(this.squaredLength());\n        },\n\n        // @return {point} my midpoint\n        midpoint: function() {\n\n            return new Point(\n                (this.start.x + this.end.x) / 2,\n                (this.start.y + this.end.y) / 2\n            );\n        },\n\n        // @return {point} my point at 't' <0,1>\n        pointAt: function(t) {\n\n            var start = this.start;\n            var end = this.end;\n\n            if (t <= 0) return start.clone();\n            if (t >= 1) return end.clone();\n\n            return start.lerp(end, t);\n        },\n\n        pointAtLength: function(length) {\n\n            var start = this.start;\n            var end = this.end;\n\n            var fromStart = true;\n            if (length < 0) {\n                fromStart = false; // negative lengths mean start calculation from end point\n                length = -length; // absolute value\n            }\n\n            var lineLength = this.length();\n            if (length >= lineLength) return (fromStart ? end.clone() : start.clone());\n\n            return this.pointAt((fromStart ? (length) : (lineLength - length)) / lineLength);\n        },\n\n        // @return {number} the offset of the point `p` from the line. + if the point `p` is on the right side of the line, - if on the left and 0 if on the line.\n        pointOffset: function(p) {\n\n            // Find the sign of the determinant of vectors (start,end), where p is the query point.\n            p = new g.Point(p);\n            var start = this.start;\n            var end = this.end;\n            var determinant = ((end.x - start.x) * (p.y - start.y) - (end.y - start.y) * (p.x - start.x));\n\n            return determinant / this.length();\n        },\n\n        rotate: function(origin, angle) {\n\n            this.start.rotate(origin, angle);\n            this.end.rotate(origin, angle);\n            return this;\n        },\n\n        round: function(precision) {\n\n            var f = pow(10, precision || 0);\n            this.start.x = round(this.start.x * f) / f;\n            this.start.y = round(this.start.y * f) / f;\n            this.end.x = round(this.end.x * f) / f;\n            this.end.y = round(this.end.y * f) / f;\n            return this;\n        },\n\n        scale: function(sx, sy, origin) {\n\n            this.start.scale(sx, sy, origin);\n            this.end.scale(sx, sy, origin);\n            return this;\n        },\n\n        // @return {number} scale the line so that it has the requested length\n        setLength: function(length) {\n\n            var currentLength = this.length();\n            if (!currentLength) return this;\n\n            var scaleFactor = length / currentLength;\n            return this.scale(scaleFactor, scaleFactor, this.start);\n        },\n\n        // @return {integer} length without sqrt\n        // @note for applications where the exact length is not necessary (e.g. compare only)\n        squaredLength: function() {\n\n            var x0 = this.start.x;\n            var y0 = this.start.y;\n            var x1 = this.end.x;\n            var y1 = this.end.y;\n            return (x0 -= x1) * x0 + (y0 -= y1) * y0;\n        },\n\n        tangentAt: function(t) {\n\n            if (!this.isDifferentiable()) return null;\n\n            var start = this.start;\n            var end = this.end;\n\n            var tangentStart = this.pointAt(t); // constrains `t` between 0 and 1\n\n            var tangentLine = new Line(start, end);\n            tangentLine.translate(tangentStart.x - start.x, tangentStart.y - start.y); // move so that tangent line starts at the point requested\n\n            return tangentLine;\n        },\n\n        tangentAtLength: function(length) {\n\n            if (!this.isDifferentiable()) return null;\n\n            var start = this.start;\n            var end = this.end;\n\n            var tangentStart = this.pointAtLength(length);\n\n            var tangentLine = new Line(start, end);\n            tangentLine.translate(tangentStart.x - start.x, tangentStart.y - start.y); // move so that tangent line starts at the point requested\n\n            return tangentLine;\n        },\n\n        toString: function() {\n\n            return this.start.toString() + ' ' + this.end.toString();\n        },\n\n        translate: function(tx, ty) {\n\n            this.start.translate(tx, ty);\n            this.end.translate(tx, ty);\n            return this;\n        },\n\n        // @return vector {point} of the line\n        vector: function() {\n\n            return new Point(this.end.x - this.start.x, this.end.y - this.start.y);\n        }\n    };\n\n    // For backwards compatibility:\n    Line.prototype.intersection = Line.prototype.intersect;\n\n    // Accepts path data string, array of segments, array of Curves and/or Lines, or a Polyline.\n    // Path created is not guaranteed to be a valid (serializable) path (might not start with an M).\n    var Path = g.Path = function(arg) {\n\n        if (!(this instanceof Path)) {\n            return new Path(arg);\n        }\n\n        if (typeof arg === 'string') { // create from a path data string\n            return new Path.parse(arg);\n        }\n\n        this.segments = [];\n\n        var i;\n        var n;\n\n        if (!arg) {\n            // don't do anything\n\n        } else if (Array.isArray(arg) && arg.length !== 0) { // if arg is a non-empty array\n            n = arg.length;\n            if (arg[0].isSegment) { // create from an array of segments\n                for (i = 0; i < n; i++) {\n\n                    var segment = arg[i];\n\n                    this.appendSegment(segment);\n                }\n\n            } else { // create from an array of Curves and/or Lines\n                var previousObj = null;\n                for (i = 0; i < n; i++) {\n\n                    var obj = arg[i];\n\n                    if (!((obj instanceof Line) || (obj instanceof Curve))) {\n                        throw new Error('Cannot construct a path segment from the provided object.');\n                    }\n\n                    if (i === 0) this.appendSegment(Path.createSegment('M', obj.start));\n\n                    // if objects do not link up, moveto segments are inserted to cover the gaps\n                    if (previousObj && !previousObj.end.equals(obj.start)) this.appendSegment(Path.createSegment('M', obj.start));\n\n                    if (obj instanceof Line) {\n                        this.appendSegment(Path.createSegment('L', obj.end));\n\n                    } else if (obj instanceof Curve) {\n                        this.appendSegment(Path.createSegment('C', obj.controlPoint1, obj.controlPoint2, obj.end));\n                    }\n\n                    previousObj = obj;\n                }\n            }\n\n        } else if (arg.isSegment) { // create from a single segment\n            this.appendSegment(arg);\n\n        } else if (arg instanceof Line) { // create from a single Line\n            this.appendSegment(Path.createSegment('M', arg.start));\n            this.appendSegment(Path.createSegment('L', arg.end));\n\n        } else if (arg instanceof Curve) { // create from a single Curve\n            this.appendSegment(Path.createSegment('M', arg.start));\n            this.appendSegment(Path.createSegment('C', arg.controlPoint1, arg.controlPoint2, arg.end));\n\n        } else if (arg instanceof Polyline && arg.points && arg.points.length !== 0) { // create from a Polyline\n            n = arg.points.length;\n            for (i = 0; i < n; i++) {\n\n                var point = arg.points[i];\n\n                if (i === 0) this.appendSegment(Path.createSegment('M', point));\n                else this.appendSegment(Path.createSegment('L', point));\n            }\n        }\n    };\n\n    // More permissive than V.normalizePathData and Path.prototype.serialize.\n    // Allows path data strings that do not start with a Moveto command (unlike SVG specification).\n    // Does not require spaces between elements; commas are allowed, separators may be omitted when unambiguous (e.g. 'ZM10,10', 'L1.6.8', 'M100-200').\n    // Allows for command argument chaining.\n    // Throws an error if wrong number of arguments is provided with a command.\n    // Throws an error if an unrecognized path command is provided (according to Path.segmentTypes). Only a subset of SVG commands is currently supported (L, C, M, Z).\n    Path.parse = function(pathData) {\n\n        if (!pathData) return new Path();\n\n        var path = new Path();\n\n        var commandRe = /(?:[a-zA-Z] *)(?:(?:-?\\d+(?:\\.\\d+)? *,? *)|(?:-?\\.\\d+ *,? *))+|(?:[a-zA-Z] *)(?! |\\d|-|\\.)/g;\n        var commands = pathData.match(commandRe);\n\n        var numCommands = commands.length;\n        for (var i = 0; i < numCommands; i++) {\n\n            var command = commands[i];\n            var argRe = /(?:[a-zA-Z])|(?:(?:-?\\d+(?:\\.\\d+)?))|(?:(?:-?\\.\\d+))/g;\n            var args = command.match(argRe);\n\n            var segment = Path.createSegment.apply(this, args); // args = [type, coordinate1, coordinate2...]\n            path.appendSegment(segment);\n        }\n\n        return path;\n    };\n\n    // Create a segment or an array of segments.\n    // Accepts unlimited points/coords arguments after `type`.\n    Path.createSegment = function(type) {\n\n        if (!type) throw new Error('Type must be provided.');\n\n        var segmentConstructor = Path.segmentTypes[type];\n        if (!segmentConstructor) throw new Error(type + ' is not a recognized path segment type.');\n\n        var args = [];\n        var n = arguments.length;\n        for (var i = 1; i < n; i++) { // do not add first element (`type`) to args array\n            args.push(arguments[i]);\n        }\n\n        return applyToNew(segmentConstructor, args);\n    },\n\n    Path.prototype = {\n\n        // Accepts one segment or an array of segments as argument.\n        // Throws an error if argument is not a segment or an array of segments.\n        appendSegment: function(arg) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            // works even if path has no segments\n\n            var currentSegment;\n\n            var previousSegment = ((numSegments !== 0) ? segments[numSegments - 1] : null); // if we are appending to an empty path, previousSegment is null\n            var nextSegment = null;\n\n            if (!Array.isArray(arg)) { // arg is a segment\n                if (!arg || !arg.isSegment) throw new Error('Segment required.');\n\n                currentSegment = this.prepareSegment(arg, previousSegment, nextSegment);\n                segments.push(currentSegment);\n\n            } else { // arg is an array of segments\n                if (!arg[0].isSegment) throw new Error('Segments required.');\n\n                var n = arg.length;\n                for (var i = 0; i < n; i++) {\n\n                    var currentArg = arg[i];\n                    currentSegment = this.prepareSegment(currentArg, previousSegment, nextSegment);\n                    segments.push(currentSegment);\n                    previousSegment = currentSegment;\n                }\n            }\n        },\n\n        // Returns the bbox of the path.\n        // If path has no segments, returns null.\n        // If path has only invisible segments, returns bbox of the end point of last segment.\n        bbox: function() {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null; // if segments is an empty array\n\n            var bbox;\n            for (var i = 0; i < numSegments; i++) {\n\n                var segment = segments[i];\n                if (segment.isVisible) {\n                    var segmentBBox = segment.bbox();\n                    bbox = bbox ? bbox.union(segmentBBox) : segmentBBox;\n                }\n            }\n\n            if (bbox) return bbox;\n\n            // if the path has only invisible elements, return end point of last segment\n            var lastSegment = segments[numSegments - 1];\n            return new Rect(lastSegment.end.x, lastSegment.end.y, 0, 0);\n        },\n\n        // Returns a new path that is a clone of this path.\n        clone: function() {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            // works even if path has no segments\n\n            var path = new Path();\n            for (var i = 0; i < numSegments; i++) {\n\n                var segment = segments[i].clone();\n                path.appendSegment(segment);\n            }\n\n            return path;\n        },\n\n        closestPoint: function(p, opt) {\n\n            var t = this.closestPointT(p, opt);\n            if (!t) return null;\n\n            return this.pointAtT(t);\n        },\n\n        closestPointLength: function(p, opt) {\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var segmentSubdivisions = (opt.segmentSubdivisions === undefined) ? this.getSegmentSubdivisions({ precision: precision }) : opt.segmentSubdivisions;\n            var localOpt = { precision: precision, segmentSubdivisions: segmentSubdivisions };\n\n            var t = this.closestPointT(p, localOpt);\n            if (!t) return 0;\n\n            return this.lengthAtT(t, localOpt);\n        },\n\n        closestPointNormalizedLength: function(p, opt) {\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var segmentSubdivisions = (opt.segmentSubdivisions === undefined) ? this.getSegmentSubdivisions({ precision: precision }) : opt.segmentSubdivisions;\n            var localOpt = { precision: precision, segmentSubdivisions: segmentSubdivisions };\n\n            var cpLength = this.closestPointLength(p, localOpt);\n            if (cpLength === 0) return 0; // shortcut\n\n            var length = this.length(localOpt);\n            if (length === 0) return 0; // prevents division by zero\n\n            return cpLength / length;\n        },\n\n        // Private function.\n        closestPointT: function(p, opt) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null; // if segments is an empty array\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var segmentSubdivisions = (opt.segmentSubdivisions === undefined) ? this.getSegmentSubdivisions({ precision: precision }) : opt.segmentSubdivisions;\n            // not using localOpt\n\n            var closestPointT;\n            var minSquaredDistance = Infinity;\n            for (var i = 0; i < numSegments; i++) {\n\n                var segment = segments[i];\n                var subdivisions = segmentSubdivisions[i];\n\n                if (segment.isVisible) {\n                    var segmentClosestPointT = segment.closestPointT(p, { precision: precision, subdivisions: subdivisions });\n                    var segmentClosestPoint = segment.pointAtT(segmentClosestPointT);\n                    var squaredDistance = (new Line(segmentClosestPoint, p)).squaredLength();\n\n                    if (squaredDistance < minSquaredDistance) {\n                        closestPointT = { segmentIndex: i, value: segmentClosestPointT };\n                        minSquaredDistance = squaredDistance;\n                    }\n                }\n            }\n\n            if (closestPointT) return closestPointT;\n\n            // if no visible segment, return end of last segment\n            return { segmentIndex: numSegments - 1, value: 1 };\n        },\n\n        closestPointTangent: function(p, opt) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null; // if segments is an empty array\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var segmentSubdivisions = (opt.segmentSubdivisions === undefined) ? this.getSegmentSubdivisions({ precision: precision }) : opt.segmentSubdivisions;\n            // not using localOpt\n\n            var closestPointTangent;\n            var minSquaredDistance = Infinity;\n            for (var i = 0; i < numSegments; i++) {\n\n                var segment = segments[i];\n                var subdivisions = segmentSubdivisions[i];\n\n                if (segment.isDifferentiable()) {\n                    var segmentClosestPointT = segment.closestPointT(p, { precision: precision, subdivisions: subdivisions });\n                    var segmentClosestPoint = segment.pointAtT(segmentClosestPointT);\n                    var squaredDistance = (new Line(segmentClosestPoint, p)).squaredLength();\n\n                    if (squaredDistance < minSquaredDistance) {\n                        closestPointTangent = segment.tangentAtT(segmentClosestPointT);\n                        minSquaredDistance = squaredDistance;\n                    }\n                }\n            }\n\n            if (closestPointTangent) return closestPointTangent;\n\n            // if no valid segment, return null\n            return null;\n        },\n\n        // Checks whether two paths are exactly the same.\n        // If `p` is undefined or null, returns false.\n        equals: function(p) {\n\n            if (!p) return false;\n\n            var segments = this.segments;\n            var otherSegments = p.segments;\n\n            var numSegments = segments.length;\n            if (otherSegments.length !== numSegments) return false; // if the two paths have different number of segments, they cannot be equal\n\n            for (var i = 0; i < numSegments; i++) {\n\n                var segment = segments[i];\n                var otherSegment = otherSegments[i];\n\n                // as soon as an inequality is found in segments, return false\n                if ((segment.type !== otherSegment.type) || (!segment.equals(otherSegment))) return false;\n            }\n\n            // if no inequality found in segments, return true\n            return true;\n        },\n\n        // Accepts negative indices.\n        // Throws an error if path has no segments.\n        // Throws an error if index is out of range.\n        getSegment: function(index) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) throw new Error('Path has no segments.');\n\n            if (index < 0) index = numSegments + index; // convert negative indices to positive\n            if (index >= numSegments || index < 0) throw new Error('Index out of range.');\n\n            return segments[index];\n        },\n\n        // Returns an array of segment subdivisions, with precision better than requested `opt.precision`.\n        getSegmentSubdivisions: function(opt) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            // works even if path has no segments\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            // not using opt.segmentSubdivisions\n            // not using localOpt\n\n            var segmentSubdivisions = [];\n            for (var i = 0; i < numSegments; i++) {\n\n                var segment = segments[i];\n                var subdivisions = segment.getSubdivisions({ precision: precision });\n                segmentSubdivisions.push(subdivisions);\n            }\n\n            return segmentSubdivisions;\n        },\n\n        // Insert `arg` at given `index`.\n        // `index = 0` means insert at the beginning.\n        // `index = segments.length` means insert at the end.\n        // Accepts negative indices, from `-1` to `-(segments.length + 1)`.\n        // Accepts one segment or an array of segments as argument.\n        // Throws an error if index is out of range.\n        // Throws an error if argument is not a segment or an array of segments.\n        insertSegment: function(index, arg) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            // works even if path has no segments\n\n            // note that these are incremented comapared to getSegments()\n            // we can insert after last element (note that this changes the meaning of index -1)\n            if (index < 0) index = numSegments + index + 1; // convert negative indices to positive\n            if (index > numSegments || index < 0) throw new Error('Index out of range.');\n\n            var currentSegment;\n\n            var previousSegment = null;\n            var nextSegment = null;\n\n            if (numSegments !== 0) {\n                if (index >= 1) {\n                    previousSegment = segments[index - 1];\n                    nextSegment = previousSegment.nextSegment; // if we are inserting at end, nextSegment is null\n\n                } else { // if index === 0\n                    // previousSegment is null\n                    nextSegment = segments[0];\n                }\n            }\n\n            if (!Array.isArray(arg)) {\n                if (!arg || !arg.isSegment) throw new Error('Segment required.');\n\n                currentSegment = this.prepareSegment(arg, previousSegment, nextSegment);\n                segments.splice(index, 0, currentSegment);\n\n            } else {\n                if (!arg[0].isSegment) throw new Error('Segments required.');\n\n                var n = arg.length;\n                for (var i = 0; i < n; i++) {\n\n                    var currentArg = arg[i];\n                    currentSegment = this.prepareSegment(currentArg, previousSegment, nextSegment);\n                    segments.splice((index + i), 0, currentSegment); // incrementing index to insert subsequent segments after inserted segments\n                    previousSegment = currentSegment;\n                }\n            }\n        },\n\n        intersectionWithLine: function(line, opt) {\n\n            var intersection = null;\n            var polylines = this.toPolylines(opt);\n            if (!polylines) return null;\n            for (var i = 0, n = polylines.length; i < n; i++) {\n                var polyline = polylines[i];\n                var polylineIntersection = line.intersect(polyline);\n                if (polylineIntersection) {\n                    intersection || (intersection = []);\n                    if (Array.isArray(polylineIntersection)) {\n                        Array.prototype.push.apply(intersection, polylineIntersection);\n                    } else {\n                        intersection.push(polylineIntersection);\n                    }\n                }\n            }\n\n            return intersection;\n        },\n\n        isDifferentiable: function() {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n\n            for (var i = 0; i < numSegments; i++) {\n\n                var segment = segments[i];\n                // as soon as a differentiable segment is found in segments, return true\n                if (segment.isDifferentiable()) return true;\n            }\n\n            // if no differentiable segment is found in segments, return false\n            return false;\n        },\n\n        // Checks whether current path segments are valid.\n        // Note that d is allowed to be empty - should disable rendering of the path.\n        isValid: function() {\n\n            var segments = this.segments;\n            var isValid = (segments.length === 0) || (segments[0].type === 'M'); // either empty or first segment is a Moveto\n            return isValid;\n        },\n\n        // Returns length of the path, with precision better than requested `opt.precision`; or using `opt.segmentSubdivisions` provided.\n        // If path has no segments, returns 0.\n        length: function(opt) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return 0; // if segments is an empty array\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision; // opt.precision only used in getSegmentSubdivisions() call\n            var segmentSubdivisions = (opt.segmentSubdivisions === undefined) ? this.getSegmentSubdivisions({ precision: precision }) : opt.segmentSubdivisions;\n            // not using localOpt\n\n            var length = 0;\n            for (var i = 0; i < numSegments; i++) {\n\n                var segment = segments[i];\n                var subdivisions = segmentSubdivisions[i];\n                length += segment.length({ subdivisions: subdivisions });\n            }\n\n            return length;\n        },\n\n        // Private function.\n        lengthAtT: function(t, opt) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return 0; // if segments is an empty array\n\n            var segmentIndex = t.segmentIndex;\n            if (segmentIndex < 0) return 0; // regardless of t.value\n\n            var tValue = t.value;\n            if (segmentIndex >= numSegments) {\n                segmentIndex = numSegments - 1;\n                tValue = 1;\n            }\n            else if (tValue < 0) tValue = 0;\n            else if (tValue > 1) tValue = 1;\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var segmentSubdivisions = (opt.segmentSubdivisions === undefined) ? this.getSegmentSubdivisions({ precision: precision }) : opt.segmentSubdivisions;\n            // not using localOpt\n\n            var subdivisions;\n            var length = 0;\n            for (var i = 0; i < segmentIndex; i++) {\n\n                var segment = segments[i];\n                subdivisions = segmentSubdivisions[i];\n                length += segment.length({ precisison: precision, subdivisions: subdivisions });\n            }\n\n            segment = segments[segmentIndex];\n            subdivisions = segmentSubdivisions[segmentIndex];\n            length += segment.lengthAtT(tValue, { precisison: precision, subdivisions: subdivisions });\n\n            return length;\n        },\n\n        // Returns point at requested `ratio` between 0 and 1, with precision better than requested `opt.precision`; optionally using `opt.segmentSubdivisions` provided.\n        pointAt: function(ratio, opt) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null; // if segments is an empty array\n\n            if (ratio <= 0) return this.start.clone();\n            if (ratio >= 1) return this.end.clone();\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var segmentSubdivisions = (opt.segmentSubdivisions === undefined) ? this.getSegmentSubdivisions({ precision: precision }) : opt.segmentSubdivisions;\n            var localOpt = { precision: precision, segmentSubdivisions: segmentSubdivisions };\n\n            var pathLength = this.length(localOpt);\n            var length = pathLength * ratio;\n\n            return this.pointAtLength(length, localOpt);\n        },\n\n        // Returns point at requested `length`, with precision better than requested `opt.precision`; optionally using `opt.segmentSubdivisions` provided.\n        // Accepts negative length.\n        pointAtLength: function(length, opt) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null; // if segments is an empty array\n\n            if (length === 0) return this.start.clone();\n\n            var fromStart = true;\n            if (length < 0) {\n                fromStart = false; // negative lengths mean start calculation from end point\n                length = -length; // absolute value\n            }\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var segmentSubdivisions = (opt.segmentSubdivisions === undefined) ? this.getSegmentSubdivisions({ precision: precision }) : opt.segmentSubdivisions;\n            // not using localOpt\n\n            var lastVisibleSegment;\n            var l = 0; // length so far\n            for (var i = (fromStart ? 0 : (numSegments - 1)); (fromStart ? (i < numSegments) : (i >= 0)); (fromStart ? (i++) : (i--))) {\n\n                var segment = segments[i];\n                var subdivisions = segmentSubdivisions[i];\n                var d = segment.length({ precision: precision, subdivisions: subdivisions });\n\n                if (segment.isVisible) {\n                    if (length <= (l + d)) {\n                        return segment.pointAtLength(((fromStart ? 1 : -1) * (length - l)), { precision: precision, subdivisions: subdivisions });\n                    }\n\n                    lastVisibleSegment = segment;\n                }\n\n                l += d;\n            }\n\n            // if length requested is higher than the length of the path, return last visible segment endpoint\n            if (lastVisibleSegment) return (fromStart ? lastVisibleSegment.end : lastVisibleSegment.start);\n\n            // if no visible segment, return last segment end point (no matter if fromStart or no)\n            var lastSegment = segments[numSegments - 1];\n            return lastSegment.end.clone();\n        },\n\n        // Private function.\n        pointAtT: function(t) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null; // if segments is an empty array\n\n            var segmentIndex = t.segmentIndex;\n            if (segmentIndex < 0) return segments[0].pointAtT(0);\n            if (segmentIndex >= numSegments) return segments[numSegments - 1].pointAtT(1);\n\n            var tValue = t.value;\n            if (tValue < 0) tValue = 0;\n            else if (tValue > 1) tValue = 1;\n\n            return segments[segmentIndex].pointAtT(tValue);\n        },\n\n        // Default precision\n        PRECISION: 3,\n\n        // Helper method for adding segments.\n        prepareSegment: function(segment, previousSegment, nextSegment) {\n\n            // insert after previous segment and before previous segment's next segment\n            segment.previousSegment = previousSegment;\n            segment.nextSegment = nextSegment;\n            if (previousSegment) previousSegment.nextSegment = segment;\n            if (nextSegment) nextSegment.previousSegment = segment;\n\n            var updateSubpathStart = segment;\n            if (segment.isSubpathStart) {\n                segment.subpathStartSegment = segment; // assign self as subpath start segment\n                updateSubpathStart = nextSegment; // start updating from next segment\n            }\n\n            // assign previous segment's subpath start (or self if it is a subpath start) to subsequent segments\n            if (updateSubpathStart) this.updateSubpathStartSegment(updateSubpathStart);\n\n            return segment;\n        },\n\n        // Remove the segment at `index`.\n        // Accepts negative indices, from `-1` to `-segments.length`.\n        // Throws an error if path has no segments.\n        // Throws an error if index is out of range.\n        removeSegment: function(index) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) throw new Error('Path has no segments.');\n\n            if (index < 0) index = numSegments + index; // convert negative indices to positive\n            if (index >= numSegments || index < 0) throw new Error('Index out of range.');\n\n            var removedSegment = segments.splice(index, 1)[0];\n            var previousSegment = removedSegment.previousSegment;\n            var nextSegment = removedSegment.nextSegment;\n\n            // link the previous and next segments together (if present)\n            if (previousSegment) previousSegment.nextSegment = nextSegment; // may be null\n            if (nextSegment) nextSegment.previousSegment = previousSegment; // may be null\n\n            // if removed segment used to start a subpath, update all subsequent segments until another subpath start segment is reached\n            if (removedSegment.isSubpathStart && nextSegment) this.updateSubpathStartSegment(nextSegment);\n        },\n\n        // Replace the segment at `index` with `arg`.\n        // Accepts negative indices, from `-1` to `-segments.length`.\n        // Accepts one segment or an array of segments as argument.\n        // Throws an error if path has no segments.\n        // Throws an error if index is out of range.\n        // Throws an error if argument is not a segment or an array of segments.\n        replaceSegment: function(index, arg) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) throw new Error('Path has no segments.');\n\n            if (index < 0) index = numSegments + index; // convert negative indices to positive\n            if (index >= numSegments || index < 0) throw new Error('Index out of range.');\n\n            var currentSegment;\n\n            var replacedSegment = segments[index];\n            var previousSegment = replacedSegment.previousSegment;\n            var nextSegment = replacedSegment.nextSegment;\n\n            var updateSubpathStart = replacedSegment.isSubpathStart; // boolean: is an update of subpath starts necessary?\n\n            if (!Array.isArray(arg)) {\n                if (!arg || !arg.isSegment) throw new Error('Segment required.');\n\n                currentSegment = this.prepareSegment(arg, previousSegment, nextSegment);\n                segments.splice(index, 1, currentSegment); // directly replace\n\n                if (updateSubpathStart && currentSegment.isSubpathStart) updateSubpathStart = false; // already updated by `prepareSegment`\n\n            } else {\n                if (!arg[0].isSegment) throw new Error('Segments required.');\n\n                segments.splice(index, 1);\n\n                var n = arg.length;\n                for (var i = 0; i < n; i++) {\n\n                    var currentArg = arg[i];\n                    currentSegment = this.prepareSegment(currentArg, previousSegment, nextSegment);\n                    segments.splice((index + i), 0, currentSegment); // incrementing index to insert subsequent segments after inserted segments\n                    previousSegment = currentSegment;\n\n                    if (updateSubpathStart && currentSegment.isSubpathStart) updateSubpathStart = false; // already updated by `prepareSegment`\n                }\n            }\n\n            // if replaced segment used to start a subpath and no new subpath start was added, update all subsequent segments until another subpath start segment is reached\n            if (updateSubpathStart && nextSegment) this.updateSubpathStartSegment(nextSegment);\n        },\n\n        scale: function(sx, sy, origin) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n\n            for (var i = 0; i < numSegments; i++) {\n\n                var segment = segments[i];\n                segment.scale(sx, sy, origin);\n            }\n\n            return this;\n        },\n\n        segmentAt: function(ratio, opt) {\n\n            var index = this.segmentIndexAt(ratio, opt);\n            if (!index) return null;\n\n            return this.getSegment(index);\n        },\n\n        // Accepts negative length.\n        segmentAtLength: function(length, opt) {\n\n            var index = this.segmentIndexAtLength(length, opt);\n            if (!index) return null;\n\n            return this.getSegment(index);\n        },\n\n        segmentIndexAt: function(ratio, opt) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null; // if segments is an empty array\n\n            if (ratio < 0) ratio = 0;\n            if (ratio > 1) ratio = 1;\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var segmentSubdivisions = (opt.segmentSubdivisions === undefined) ? this.getSegmentSubdivisions({ precision: precision }) : opt.segmentSubdivisions;\n            var localOpt = { precision: precision, segmentSubdivisions: segmentSubdivisions };\n\n            var pathLength = this.length(localOpt);\n            var length = pathLength * ratio;\n\n            return this.segmentIndexAtLength(length, localOpt);\n        },\n\n        // Accepts negative length.\n        segmentIndexAtLength: function(length, opt) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null; // if segments is an empty array\n\n            var fromStart = true;\n            if (length < 0) {\n                fromStart = false; // negative lengths mean start calculation from end point\n                length = -length; // absolute value\n            }\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var segmentSubdivisions = (opt.segmentSubdivisions === undefined) ? this.getSegmentSubdivisions({ precision: precision }) : opt.segmentSubdivisions;\n            // not using localOpt\n\n            var lastVisibleSegmentIndex = null;\n            var l = 0; // length so far\n            for (var i = (fromStart ? 0 : (numSegments - 1)); (fromStart ? (i < numSegments) : (i >= 0)); (fromStart ? (i++) : (i--))) {\n\n                var segment = segments[i];\n                var subdivisions = segmentSubdivisions[i];\n                var d = segment.length({ precision: precision, subdivisions: subdivisions });\n\n                if (segment.isVisible) {\n                    if (length <= (l + d)) return i;\n                    lastVisibleSegmentIndex = i;\n                }\n\n                l += d;\n            }\n\n            // if length requested is higher than the length of the path, return last visible segment index\n            // if no visible segment, return null\n            return lastVisibleSegmentIndex;\n        },\n\n        // Returns a string that can be used to reconstruct the path.\n        // Additional error checking compared to toString (must start with M segment).\n        serialize: function() {\n\n            if (!this.isValid()) throw new Error('Invalid path segments.');\n\n            return this.toString();\n        },\n\n        // Returns tangent line at requested `ratio` between 0 and 1, with precision better than requested `opt.precision`; optionally using `opt.segmentSubdivisions` provided.\n        tangentAt: function(ratio, opt) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null; // if segments is an empty array\n\n            if (ratio < 0) ratio = 0;\n            if (ratio > 1) ratio = 1;\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var segmentSubdivisions = (opt.segmentSubdivisions === undefined) ? this.getSegmentSubdivisions({ precision: precision }) : opt.segmentSubdivisions;\n            var localOpt = { precision: precision, segmentSubdivisions: segmentSubdivisions };\n\n            var pathLength = this.length(localOpt);\n            var length = pathLength * ratio;\n\n            return this.tangentAtLength(length, localOpt);\n        },\n\n        // Returns tangent line at requested `length`, with precision better than requested `opt.precision`; optionally using `opt.segmentSubdivisions` provided.\n        // Accepts negative length.\n        tangentAtLength: function(length, opt) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null; // if segments is an empty array\n\n            var fromStart = true;\n            if (length < 0) {\n                fromStart = false; // negative lengths mean start calculation from end point\n                length = -length; // absolute value\n            }\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var segmentSubdivisions = (opt.segmentSubdivisions === undefined) ? this.getSegmentSubdivisions({ precision: precision }) : opt.segmentSubdivisions;\n            // not using localOpt\n\n            var lastValidSegment; // visible AND differentiable (with a tangent)\n            var l = 0; // length so far\n            for (var i = (fromStart ? 0 : (numSegments - 1)); (fromStart ? (i < numSegments) : (i >= 0)); (fromStart ? (i++) : (i--))) {\n\n                var segment = segments[i];\n                var subdivisions = segmentSubdivisions[i];\n                var d = segment.length({ precision: precision, subdivisions: subdivisions });\n\n                if (segment.isDifferentiable()) {\n                    if (length <= (l + d)) {\n                        return segment.tangentAtLength(((fromStart ? 1 : -1) * (length - l)), { precision: precision, subdivisions: subdivisions });\n                    }\n\n                    lastValidSegment = segment;\n                }\n\n                l += d;\n            }\n\n            // if length requested is higher than the length of the path, return tangent of endpoint of last valid segment\n            if (lastValidSegment) {\n                var t = (fromStart ? 1 : 0);\n                return lastValidSegment.tangentAtT(t);\n            }\n\n            // if no valid segment, return null\n            return null;\n        },\n\n        // Private function.\n        tangentAtT: function(t) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null; // if segments is an empty array\n\n            var segmentIndex = t.segmentIndex;\n            if (segmentIndex < 0) return segments[0].tangentAtT(0);\n            if (segmentIndex >= numSegments) return segments[numSegments - 1].tangentAtT(1);\n\n            var tValue = t.value;\n            if (tValue < 0) tValue = 0;\n            else if (tValue > 1) tValue = 1;\n\n            return segments[segmentIndex].tangentAtT(tValue);\n        },\n\n        toPoints: function(opt) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null; // if segments is an empty array\n\n            opt = opt || {};\n            var precision = (opt.precision === undefined) ? this.PRECISION : opt.precision;\n            var segmentSubdivisions = (opt.segmentSubdivisions === undefined) ? this.getSegmentSubdivisions({ precision: precision }) : opt.segmentSubdivisions;\n\n            var points = [];\n            var partialPoints = [];\n            for (var i = 0; i < numSegments; i++) {\n                var segment = segments[i];\n                if (segment.isVisible) {\n                    var currentSegmentSubdivisions = segmentSubdivisions[i];\n                    if (currentSegmentSubdivisions.length > 0) {\n                        var subdivisionPoints = currentSegmentSubdivisions.map(function(curve) {\n                            return curve.start;\n                        });\n                        Array.prototype.push.apply(partialPoints, subdivisionPoints);\n                    } else {\n                        partialPoints.push(segment.start);\n                    }\n                } else if (partialPoints.length > 0) {\n                    partialPoints.push(segments[i - 1].end);\n                    points.push(partialPoints);\n                    partialPoints = [];\n                }\n            }\n\n            if (partialPoints.length > 0) {\n                partialPoints.push(this.end);\n                points.push(partialPoints);\n            }\n            return points;\n        },\n\n        toPolylines: function(opt) {\n\n            var polylines = [];\n            var points = this.toPoints(opt);\n            if (!points) return null;\n            for (var i = 0, n = points.length; i < n; i++) {\n                polylines.push(new Polyline(points[i]));\n            }\n\n            return polylines;\n        },\n\n        toString: function() {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n\n            var pathData = '';\n            for (var i = 0; i < numSegments; i++) {\n\n                var segment = segments[i];\n                pathData += segment.serialize() + ' ';\n            }\n\n            return pathData.trim();\n        },\n\n        translate: function(tx, ty) {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n\n            for (var i = 0; i < numSegments; i++) {\n\n                var segment = segments[i];\n                segment.translate(tx, ty);\n            }\n\n            return this;\n        },\n\n        // Helper method for updating subpath start of segments, starting with the one provided.\n        updateSubpathStartSegment: function(segment) {\n\n            var previousSegment = segment.previousSegment; // may be null\n            while (segment && !segment.isSubpathStart) {\n\n                // assign previous segment's subpath start segment to this segment\n                if (previousSegment) segment.subpathStartSegment = previousSegment.subpathStartSegment; // may be null\n                else segment.subpathStartSegment = null; // if segment had no previous segment, assign null - creates an invalid path!\n\n                previousSegment = segment;\n                segment = segment.nextSegment; // move on to the segment after etc.\n            }\n        }\n    };\n\n    Object.defineProperty(Path.prototype, 'start', {\n        // Getter for the first visible endpoint of the path.\n\n        configurable: true,\n\n        enumerable: true,\n\n        get: function() {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null;\n\n            for (var i = 0; i < numSegments; i++) {\n\n                var segment = segments[i];\n                if (segment.isVisible) return segment.start;\n            }\n\n            // if no visible segment, return last segment end point\n            return segments[numSegments - 1].end;\n        }\n    });\n\n    Object.defineProperty(Path.prototype, 'end', {\n        // Getter for the last visible endpoint of the path.\n\n        configurable: true,\n\n        enumerable: true,\n\n        get: function() {\n\n            var segments = this.segments;\n            var numSegments = segments.length;\n            if (numSegments === 0) return null;\n\n            for (var i = numSegments - 1; i >= 0; i--) {\n\n                var segment = segments[i];\n                if (segment.isVisible) return segment.end;\n            }\n\n            // if no visible segment, return last segment end point\n            return segments[numSegments - 1].end;\n        }\n    });\n\n    /*\n        Point is the most basic object consisting of x/y coordinate.\n\n        Possible instantiations are:\n        * `Point(10, 20)`\n        * `new Point(10, 20)`\n        * `Point('10 20')`\n        * `Point(Point(10, 20))`\n    */\n    var Point = g.Point = function(x, y) {\n\n        if (!(this instanceof Point)) {\n            return new Point(x, y);\n        }\n\n        if (typeof x === 'string') {\n            var xy = x.split(x.indexOf('@') === -1 ? ' ' : '@');\n            x = parseFloat(xy[0]);\n            y = parseFloat(xy[1]);\n\n        } else if (Object(x) === x) {\n            y = x.y;\n            x = x.x;\n        }\n\n        this.x = x === undefined ? 0 : x;\n        this.y = y === undefined ? 0 : y;\n    };\n\n    // Alternative constructor, from polar coordinates.\n    // @param {number} Distance.\n    // @param {number} Angle in radians.\n    // @param {point} [optional] Origin.\n    Point.fromPolar = function(distance, angle, origin) {\n\n        origin = (origin && new Point(origin)) || new Point(0, 0);\n        var x = abs(distance * cos(angle));\n        var y = abs(distance * sin(angle));\n        var deg = normalizeAngle(toDeg(angle));\n\n        if (deg < 90) {\n            y = -y;\n\n        } else if (deg < 180) {\n            x = -x;\n            y = -y;\n\n        } else if (deg < 270) {\n            x = -x;\n        }\n\n        return new Point(origin.x + x, origin.y + y);\n    };\n\n    // Create a point with random coordinates that fall into the range `[x1, x2]` and `[y1, y2]`.\n    Point.random = function(x1, x2, y1, y2) {\n\n        return new Point(floor(random() * (x2 - x1 + 1) + x1), floor(random() * (y2 - y1 + 1) + y1));\n    };\n\n    Point.prototype = {\n\n        // If point lies outside rectangle `r`, return the nearest point on the boundary of rect `r`,\n        // otherwise return point itself.\n        // (see Squeak Smalltalk, Point>>adhereTo:)\n        adhereToRect: function(r) {\n\n            if (r.containsPoint(this)) {\n                return this;\n            }\n\n            this.x = min(max(this.x, r.x), r.x + r.width);\n            this.y = min(max(this.y, r.y), r.y + r.height);\n            return this;\n        },\n\n        // Compute the angle between vector from me to p1 and the vector from me to p2.\n        // ordering of points p1 and p2 is important!\n        // theta function's angle convention:\n        // returns angles between 0 and 180 when the angle is counterclockwise\n        // returns angles between 180 and 360 to convert clockwise angles into counterclockwise ones\n        // returns NaN if any of the points p1, p2 is coincident with this point\n        angleBetween: function(p1, p2) {\n\n            var angleBetween = (this.equals(p1) || this.equals(p2)) ? NaN : (this.theta(p2) - this.theta(p1));\n\n            if (angleBetween < 0) {\n                angleBetween += 360; // correction to keep angleBetween between 0 and 360\n            }\n\n            return angleBetween;\n        },\n\n        // Return the bearing between me and the given point.\n        bearing: function(point) {\n\n            return (new Line(this, point)).bearing();\n        },\n\n        // Returns change in angle from my previous position (-dx, -dy) to my new position\n        // relative to ref point.\n        changeInAngle: function(dx, dy, ref) {\n\n            // Revert the translation and measure the change in angle around x-axis.\n            return this.clone().offset(-dx, -dy).theta(ref) - this.theta(ref);\n        },\n\n        clone: function() {\n\n            return new Point(this);\n        },\n\n        // Returns the cross product of this point relative to two other points\n        // this point is the common point\n        // point p1 lies on the first vector, point p2 lies on the second vector\n        // watch out for the ordering of points p1 and p2!\n        // positive result indicates a clockwise (\"right\") turn from first to second vector\n        // negative result indicates a counterclockwise (\"left\") turn from first to second vector\n        // note that the above directions are reversed from the usual answer on the Internet\n        // that is because we are in a left-handed coord system (because the y-axis points downward)\n        cross: function(p1, p2) {\n\n            return (p1 && p2) ? (((p2.x - this.x) * (p1.y - this.y)) - ((p2.y - this.y) * (p1.x - this.x))) : NaN;\n        },\n\n        difference: function(dx, dy) {\n\n            if ((Object(dx) === dx)) {\n                dy = dx.y;\n                dx = dx.x;\n            }\n\n            return new Point(this.x - (dx || 0), this.y - (dy || 0));\n        },\n\n        // Returns distance between me and point `p`.\n        distance: function(p) {\n\n            return (new Line(this, p)).length();\n        },\n\n        // Returns the dot product of this point with given other point\n        dot: function(p) {\n\n            return p ? (this.x * p.x + this.y * p.y) : NaN;\n        },\n\n        equals: function(p) {\n\n            return !!p &&\n                this.x === p.x &&\n                this.y === p.y;\n        },\n\n        // Linear interpolation\n        lerp: function(p, t) {\n\n            var x = this.x;\n            var y = this.y;\n            return new Point((1 - t) * x + t * p.x, (1 - t) * y + t * p.y);\n        },\n\n        magnitude: function() {\n\n            return sqrt((this.x * this.x) + (this.y * this.y)) || 0.01;\n        },\n\n        // Returns a manhattan (taxi-cab) distance between me and point `p`.\n        manhattanDistance: function(p) {\n\n            return abs(p.x - this.x) + abs(p.y - this.y);\n        },\n\n        // Move point on line starting from ref ending at me by\n        // distance distance.\n        move: function(ref, distance) {\n\n            var theta = toRad((new Point(ref)).theta(this));\n            var offset = this.offset(cos(theta) * distance, -sin(theta) * distance);\n            return offset;\n        },\n\n        // Scales x and y such that the distance between the point and the origin (0,0) is equal to the given length.\n        normalize: function(length) {\n\n            var scale = (length || 1) / this.magnitude();\n            return this.scale(scale, scale);\n        },\n\n        // Offset me by the specified amount.\n        offset: function(dx, dy) {\n\n            if ((Object(dx) === dx)) {\n                dy = dx.y;\n                dx = dx.x;\n            }\n\n            this.x += dx || 0;\n            this.y += dy || 0;\n            return this;\n        },\n\n        // Returns a point that is the reflection of me with\n        // the center of inversion in ref point.\n        reflection: function(ref) {\n\n            return (new Point(ref)).move(this, this.distance(ref));\n        },\n\n        // Rotate point by angle around origin.\n        // Angle is flipped because this is a left-handed coord system (y-axis points downward).\n        rotate: function(origin, angle) {\n\n            origin = origin || new g.Point(0, 0);\n\n            angle = toRad(normalizeAngle(-angle));\n            var cosAngle = cos(angle);\n            var sinAngle = sin(angle);\n\n            var x = (cosAngle * (this.x - origin.x)) - (sinAngle * (this.y - origin.y)) + origin.x;\n            var y = (sinAngle * (this.x - origin.x)) + (cosAngle * (this.y - origin.y)) + origin.y;\n\n            this.x = x;\n            this.y = y;\n            return this;\n        },\n\n        round: function(precision) {\n\n            var f = pow(10, precision || 0);\n            this.x = round(this.x * f) / f;\n            this.y = round(this.y * f) / f;\n            return this;\n        },\n\n        // Scale point with origin.\n        scale: function(sx, sy, origin) {\n\n            origin = (origin && new Point(origin)) || new Point(0, 0);\n            this.x = origin.x + sx * (this.x - origin.x);\n            this.y = origin.y + sy * (this.y - origin.y);\n            return this;\n        },\n\n        snapToGrid: function(gx, gy) {\n\n            this.x = snapToGrid(this.x, gx);\n            this.y = snapToGrid(this.y, gy || gx);\n            return this;\n        },\n\n        squaredDistance: function(p) {\n\n            return (new Line(this, p)).squaredLength();\n        },\n\n        // Compute the angle between me and `p` and the x axis.\n        // (cartesian-to-polar coordinates conversion)\n        // Return theta angle in degrees.\n        theta: function(p) {\n\n            p = new Point(p);\n\n            // Invert the y-axis.\n            var y = -(p.y - this.y);\n            var x = p.x - this.x;\n            var rad = atan2(y, x); // defined for all 0 corner cases\n\n            // Correction for III. and IV. quadrant.\n            if (rad < 0) {\n                rad = 2 * PI + rad;\n            }\n\n            return 180 * rad / PI;\n        },\n\n        toJSON: function() {\n\n            return { x: this.x, y: this.y };\n        },\n\n        // Converts rectangular to polar coordinates.\n        // An origin can be specified, otherwise it's 0@0.\n        toPolar: function(o) {\n\n            o = (o && new Point(o)) || new Point(0, 0);\n            var x = this.x;\n            var y = this.y;\n            this.x = sqrt((x - o.x) * (x - o.x) + (y - o.y) * (y - o.y)); // r\n            this.y = toRad(o.theta(new Point(x, y)));\n            return this;\n        },\n\n        toString: function() {\n\n            return this.x + '@' + this.y;\n        },\n\n        update: function(x, y) {\n\n            this.x = x || 0;\n            this.y = y || 0;\n            return this;\n        },\n\n        // Compute the angle between the vector from 0,0 to me and the vector from 0,0 to p.\n        // Returns NaN if p is at 0,0.\n        vectorAngle: function(p) {\n\n            var zero = new Point(0,0);\n            return zero.angleBetween(this, p);\n        }\n    };\n\n    Point.prototype.translate = Point.prototype.offset;\n\n    var Polyline = g.Polyline = function(points) {\n\n        if (!(this instanceof Polyline)) {\n            return new Polyline(points);\n        }\n\n        if (typeof points === 'string') {\n            return new Polyline.parse(points);\n        }\n\n        this.points = (Array.isArray(points) ? points.map(Point) : []);\n    };\n\n    Polyline.parse = function(svgString) {\n        svgString = svgString.trim();\n        if (svgString === '') return new Polyline();\n\n        var points = [];\n\n        var coords = svgString.split(/\\s*,\\s*|\\s+/);\n        var n = coords.length;\n        for (var i = 0; i < n; i += 2) {\n            points.push({ x: +coords[i], y: +coords[i + 1] });\n        }\n\n        return new Polyline(points);\n    };\n\n    Polyline.prototype = {\n\n        bbox: function() {\n\n            var x1 = Infinity;\n            var x2 = -Infinity;\n            var y1 = Infinity;\n            var y2 = -Infinity;\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return null; // if points array is empty\n\n            for (var i = 0; i < numPoints; i++) {\n\n                var point = points[i];\n                var x = point.x;\n                var y = point.y;\n\n                if (x < x1) x1 = x;\n                if (x > x2) x2 = x;\n                if (y < y1) y1 = y;\n                if (y > y2) y2 = y;\n            }\n\n            return new Rect(x1, y1, x2 - x1, y2 - y1);\n        },\n\n        clone: function() {\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return new Polyline(); // if points array is empty\n\n            var newPoints = [];\n            for (var i = 0; i < numPoints; i++) {\n\n                var point = points[i].clone();\n                newPoints.push(point);\n            }\n\n            return new Polyline(newPoints);\n        },\n\n        closestPoint: function(p) {\n\n            var cpLength = this.closestPointLength(p);\n\n            return this.pointAtLength(cpLength);\n        },\n\n        closestPointLength: function(p) {\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return 0; // if points array is empty\n            if (numPoints === 1) return 0; // if there is only one point\n\n            var cpLength;\n            var minSqrDistance = Infinity;\n            var length = 0;\n            var n = numPoints - 1;\n            for (var i = 0; i < n; i++) {\n\n                var line = new Line(points[i], points[i + 1]);\n                var lineLength = line.length();\n\n                var cpNormalizedLength = line.closestPointNormalizedLength(p);\n                var cp = line.pointAt(cpNormalizedLength);\n\n                var sqrDistance = cp.squaredDistance(p);\n                if (sqrDistance < minSqrDistance) {\n                    minSqrDistance = sqrDistance;\n                    cpLength = length + (cpNormalizedLength * lineLength);\n                }\n\n                length += lineLength;\n            }\n\n            return cpLength;\n        },\n\n        closestPointNormalizedLength: function(p) {\n\n            var cpLength = this.closestPointLength(p);\n            if (cpLength === 0) return 0; // shortcut\n\n            var length = this.length();\n            if (length === 0) return 0; // prevents division by zero\n\n            return cpLength / length;\n        },\n\n        closestPointTangent: function(p) {\n\n            var cpLength = this.closestPointLength(p);\n\n            return this.tangentAtLength(cpLength);\n        },\n\n        // Returns a convex-hull polyline from this polyline.\n        // Implements the Graham scan (https://en.wikipedia.org/wiki/Graham_scan).\n        // Output polyline starts at the first element of the original polyline that is on the hull, then continues clockwise.\n        // Minimal polyline is found (only vertices of the hull are reported, no collinear points).\n        convexHull: function() {\n\n            var i;\n            var n;\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return new Polyline(); // if points array is empty\n\n            // step 1: find the starting point - point with the lowest y (if equality, highest x)\n            var startPoint;\n            for (i = 0; i < numPoints; i++) {\n                if (startPoint === undefined) {\n                    // if this is the first point we see, set it as start point\n                    startPoint = points[i];\n\n                } else if (points[i].y < startPoint.y) {\n                    // start point should have lowest y from all points\n                    startPoint = points[i];\n\n                } else if ((points[i].y === startPoint.y) && (points[i].x > startPoint.x)) {\n                    // if two points have the lowest y, choose the one that has highest x\n                    // there are no points to the right of startPoint - no ambiguity about theta 0\n                    // if there are several coincident start point candidates, first one is reported\n                    startPoint = points[i];\n                }\n            }\n\n            // step 2: sort the list of points\n            // sorting by angle between line from startPoint to point and the x-axis (theta)\n\n            // step 2a: create the point records = [point, originalIndex, angle]\n            var sortedPointRecords = [];\n            for (i = 0; i < numPoints; i++) {\n\n                var angle = startPoint.theta(points[i]);\n                if (angle === 0) {\n                    angle = 360; // give highest angle to start point\n                    // the start point will end up at end of sorted list\n                    // the start point will end up at beginning of hull points list\n                }\n\n                var entry = [points[i], i, angle];\n                sortedPointRecords.push(entry);\n            }\n\n            // step 2b: sort the list in place\n            sortedPointRecords.sort(function(record1, record2) {\n                // returning a negative number here sorts record1 before record2\n                // if first angle is smaller than second, first angle should come before second\n\n                var sortOutput = record1[2] - record2[2];  // negative if first angle smaller\n                if (sortOutput === 0) {\n                    // if the two angles are equal, sort by originalIndex\n                    sortOutput = record2[1] - record1[1]; // negative if first index larger\n                    // coincident points will be sorted in reverse-numerical order\n                    // so the coincident points with lower original index will be considered first\n                }\n\n                return sortOutput;\n            });\n\n            // step 2c: duplicate start record from the top of the stack to the bottom of the stack\n            if (sortedPointRecords.length > 2) {\n                var startPointRecord = sortedPointRecords[sortedPointRecords.length-1];\n                sortedPointRecords.unshift(startPointRecord);\n            }\n\n            // step 3a: go through sorted points in order and find those with right turns\n            // we want to get our results in clockwise order\n            var insidePoints = {}; // dictionary of points with left turns - cannot be on the hull\n            var hullPointRecords = []; // stack of records with right turns - hull point candidates\n\n            var currentPointRecord;\n            var currentPoint;\n            var lastHullPointRecord;\n            var lastHullPoint;\n            var secondLastHullPointRecord;\n            var secondLastHullPoint;\n            while (sortedPointRecords.length !== 0) {\n\n                currentPointRecord = sortedPointRecords.pop();\n                currentPoint = currentPointRecord[0];\n\n                // check if point has already been discarded\n                // keys for insidePoints are stored in the form 'point.x@point.y@@originalIndex'\n                if (insidePoints.hasOwnProperty(currentPointRecord[0] + '@@' + currentPointRecord[1])) {\n                    // this point had an incorrect turn at some previous iteration of this loop\n                    // this disqualifies it from possibly being on the hull\n                    continue;\n                }\n\n                var correctTurnFound = false;\n                while (!correctTurnFound) {\n\n                    if (hullPointRecords.length < 2) {\n                        // not enough points for comparison, just add current point\n                        hullPointRecords.push(currentPointRecord);\n                        correctTurnFound = true;\n\n                    } else {\n                        lastHullPointRecord = hullPointRecords.pop();\n                        lastHullPoint = lastHullPointRecord[0];\n                        secondLastHullPointRecord = hullPointRecords.pop();\n                        secondLastHullPoint = secondLastHullPointRecord[0];\n\n                        var crossProduct = secondLastHullPoint.cross(lastHullPoint, currentPoint);\n\n                        if (crossProduct < 0) {\n                            // found a right turn\n                            hullPointRecords.push(secondLastHullPointRecord);\n                            hullPointRecords.push(lastHullPointRecord);\n                            hullPointRecords.push(currentPointRecord);\n                            correctTurnFound = true;\n\n                        } else if (crossProduct === 0) {\n                            // the three points are collinear\n                            // three options:\n                            // there may be a 180 or 0 degree angle at lastHullPoint\n                            // or two of the three points are coincident\n                            var THRESHOLD = 1e-10; // we have to take rounding errors into account\n                            var angleBetween = lastHullPoint.angleBetween(secondLastHullPoint, currentPoint);\n                            if (abs(angleBetween - 180) < THRESHOLD) { // rouding around 180 to 180\n                                // if the cross product is 0 because the angle is 180 degrees\n                                // discard last hull point (add to insidePoints)\n                                //insidePoints.unshift(lastHullPoint);\n                                insidePoints[lastHullPointRecord[0] + '@@' + lastHullPointRecord[1]] = lastHullPoint;\n                                // reenter second-to-last hull point (will be last at next iter)\n                                hullPointRecords.push(secondLastHullPointRecord);\n                                // do not do anything with current point\n                                // correct turn not found\n\n                            } else if (lastHullPoint.equals(currentPoint) || secondLastHullPoint.equals(lastHullPoint)) {\n                                // if the cross product is 0 because two points are the same\n                                // discard last hull point (add to insidePoints)\n                                //insidePoints.unshift(lastHullPoint);\n                                insidePoints[lastHullPointRecord[0] + '@@' + lastHullPointRecord[1]] = lastHullPoint;\n                                // reenter second-to-last hull point (will be last at next iter)\n                                hullPointRecords.push(secondLastHullPointRecord);\n                                // do not do anything with current point\n                                // correct turn not found\n\n                            } else if (abs(((angleBetween + 1) % 360) - 1) < THRESHOLD) { // rounding around 0 and 360 to 0\n                                // if the cross product is 0 because the angle is 0 degrees\n                                // remove last hull point from hull BUT do not discard it\n                                // reenter second-to-last hull point (will be last at next iter)\n                                hullPointRecords.push(secondLastHullPointRecord);\n                                // put last hull point back into the sorted point records list\n                                sortedPointRecords.push(lastHullPointRecord);\n                                // we are switching the order of the 0deg and 180deg points\n                                // correct turn not found\n                            }\n\n                        } else {\n                            // found a left turn\n                            // discard last hull point (add to insidePoints)\n                            //insidePoints.unshift(lastHullPoint);\n                            insidePoints[lastHullPointRecord[0] + '@@' + lastHullPointRecord[1]] = lastHullPoint;\n                            // reenter second-to-last hull point (will be last at next iter of loop)\n                            hullPointRecords.push(secondLastHullPointRecord);\n                            // do not do anything with current point\n                            // correct turn not found\n                        }\n                    }\n                }\n            }\n            // at this point, hullPointRecords contains the output points in clockwise order\n            // the points start with lowest-y,highest-x startPoint, and end at the same point\n\n            // step 3b: remove duplicated startPointRecord from the end of the array\n            if (hullPointRecords.length > 2) {\n                hullPointRecords.pop();\n            }\n\n            // step 4: find the lowest originalIndex record and put it at the beginning of hull\n            var lowestHullIndex; // the lowest originalIndex on the hull\n            var indexOfLowestHullIndexRecord = -1; // the index of the record with lowestHullIndex\n            n = hullPointRecords.length;\n            for (i = 0; i < n; i++) {\n\n                var currentHullIndex = hullPointRecords[i][1];\n\n                if (lowestHullIndex === undefined || currentHullIndex < lowestHullIndex) {\n                    lowestHullIndex = currentHullIndex;\n                    indexOfLowestHullIndexRecord = i;\n                }\n            }\n\n            var hullPointRecordsReordered = [];\n            if (indexOfLowestHullIndexRecord > 0) {\n                var newFirstChunk = hullPointRecords.slice(indexOfLowestHullIndexRecord);\n                var newSecondChunk = hullPointRecords.slice(0, indexOfLowestHullIndexRecord);\n                hullPointRecordsReordered = newFirstChunk.concat(newSecondChunk);\n\n            } else {\n                hullPointRecordsReordered = hullPointRecords;\n            }\n\n            var hullPoints = [];\n            n = hullPointRecordsReordered.length;\n            for (i = 0; i < n; i++) {\n                hullPoints.push(hullPointRecordsReordered[i][0]);\n            }\n\n            return new Polyline(hullPoints);\n        },\n\n        // Checks whether two polylines are exactly the same.\n        // If `p` is undefined or null, returns false.\n        equals: function(p) {\n\n            if (!p) return false;\n\n            var points = this.points;\n            var otherPoints = p.points;\n\n            var numPoints = points.length;\n            if (otherPoints.length !== numPoints) return false; // if the two polylines have different number of points, they cannot be equal\n\n            for (var i = 0; i < numPoints; i++) {\n\n                var point = points[i];\n                var otherPoint = p.points[i];\n\n                // as soon as an inequality is found in points, return false\n                if (!point.equals(otherPoint)) return false;\n            }\n\n            // if no inequality found in points, return true\n            return true;\n        },\n\n        intersectionWithLine: function(l) {\n            var line = new Line(l);\n            var intersections = [];\n            var points = this.points;\n            for (var i = 0, n = points.length - 1; i < n; i++) {\n                var a = points[i];\n                var b = points[i+1];\n                var l2 = new Line(a, b);\n                var int = line.intersectionWithLine(l2);\n                if (int) intersections.push(int[0]);\n            }\n            return (intersections.length > 0) ? intersections : null;\n        },\n\n        isDifferentiable: function() {\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return false;\n\n            var n = numPoints - 1;\n            for (var i = 0; i < n; i++) {\n\n                var a = points[i];\n                var b = points[i + 1];\n                var line = new Line(a, b);\n\n                // as soon as a differentiable line is found between two points, return true\n                if (line.isDifferentiable()) return true;\n            }\n\n            // if no differentiable line is found between pairs of points, return false\n            return false;\n        },\n\n        length: function() {\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return 0; // if points array is empty\n\n            var length = 0;\n            var n = numPoints - 1;\n            for (var i = 0; i < n; i++) {\n                length += points[i].distance(points[i + 1]);\n            }\n\n            return length;\n        },\n\n        pointAt: function(ratio) {\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return null; // if points array is empty\n            if (numPoints === 1) return points[0].clone(); // if there is only one point\n\n            if (ratio <= 0) return points[0].clone();\n            if (ratio >= 1) return points[numPoints - 1].clone();\n\n            var polylineLength = this.length();\n            var length = polylineLength * ratio;\n\n            return this.pointAtLength(length);\n        },\n\n        pointAtLength: function(length) {\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return null; // if points array is empty\n            if (numPoints === 1) return points[0].clone(); // if there is only one point\n\n            var fromStart = true;\n            if (length < 0) {\n                fromStart = false; // negative lengths mean start calculation from end point\n                length = -length; // absolute value\n            }\n\n            var l = 0;\n            var n = numPoints - 1;\n            for (var i = (fromStart ? 0 : (n - 1)); (fromStart ? (i < n) : (i >= 0)); (fromStart ? (i++) : (i--))) {\n\n                var a = points[i];\n                var b = points[i + 1];\n                var line = new Line(a, b);\n                var d = a.distance(b);\n\n                if (length <= (l + d)) {\n                    return line.pointAtLength((fromStart ? 1 : -1) * (length - l));\n                }\n\n                l += d;\n            }\n\n            // if length requested is higher than the length of the polyline, return last endpoint\n            var lastPoint = (fromStart ? points[numPoints - 1] : points[0]);\n            return lastPoint.clone();\n        },\n\n        scale: function(sx, sy, origin) {\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return this; // if points array is empty\n\n            for (var i = 0; i < numPoints; i++) {\n                points[i].scale(sx, sy, origin);\n            }\n\n            return this;\n        },\n\n        tangentAt: function(ratio) {\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return null; // if points array is empty\n            if (numPoints === 1) return null; // if there is only one point\n\n            if (ratio < 0) ratio = 0;\n            if (ratio > 1) ratio = 1;\n\n            var polylineLength = this.length();\n            var length = polylineLength * ratio;\n\n            return this.tangentAtLength(length);\n        },\n\n        tangentAtLength: function(length) {\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return null; // if points array is empty\n            if (numPoints === 1) return null; // if there is only one point\n\n            var fromStart = true;\n            if (length < 0) {\n                fromStart = false; // negative lengths mean start calculation from end point\n                length = -length; // absolute value\n            }\n\n            var lastValidLine; // differentiable (with a tangent)\n            var l = 0; // length so far\n            var n = numPoints - 1;\n            for (var i = (fromStart ? (0) : (n - 1)); (fromStart ? (i < n) : (i >= 0)); (fromStart ? (i++) : (i--))) {\n\n                var a = points[i];\n                var b = points[i + 1];\n                var line = new Line(a, b);\n                var d = a.distance(b);\n\n                if (line.isDifferentiable()) { // has a tangent line (line length is not 0)\n                    if (length <= (l + d)) {\n                        return line.tangentAtLength((fromStart ? 1 : -1) * (length - l));\n                    }\n\n                    lastValidLine = line;\n                }\n\n                l += d;\n            }\n\n            // if length requested is higher than the length of the polyline, return last valid endpoint\n            if (lastValidLine) {\n                var ratio = (fromStart ? 1 : 0);\n                return lastValidLine.tangentAt(ratio);\n            }\n\n            // if no valid line, return null\n            return null;\n        },\n\n        toString: function() {\n\n            return this.points + '';\n        },\n\n        translate: function(tx, ty) {\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return this; // if points array is empty\n\n            for (var i = 0; i < numPoints; i++) {\n                points[i].translate(tx, ty);\n            }\n\n            return this;\n        },\n\n        // Return svgString that can be used to recreate this line.\n        serialize: function() {\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return ''; // if points array is empty\n\n            var output = '';\n            for (var i = 0; i < numPoints; i++) {\n\n                var point = points[i];\n                output += point.x + ',' + point.y + ' ';\n            }\n\n            return output.trim();\n        }\n    };\n\n    Object.defineProperty(Polyline.prototype, 'start', {\n        // Getter for the first point of the polyline.\n\n        configurable: true,\n\n        enumerable: true,\n\n        get: function() {\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return null; // if points array is empty\n\n            return this.points[0];\n        },\n    });\n\n    Object.defineProperty(Polyline.prototype, 'end', {\n        // Getter for the last point of the polyline.\n\n        configurable: true,\n\n        enumerable: true,\n\n        get: function() {\n\n            var points = this.points;\n            var numPoints = points.length;\n            if (numPoints === 0) return null; // if points array is empty\n\n            return this.points[numPoints - 1];\n        },\n    });\n\n    var Rect = g.Rect = function(x, y, w, h) {\n\n        if (!(this instanceof Rect)) {\n            return new Rect(x, y, w, h);\n        }\n\n        if ((Object(x) === x)) {\n            y = x.y;\n            w = x.width;\n            h = x.height;\n            x = x.x;\n        }\n\n        this.x = x === undefined ? 0 : x;\n        this.y = y === undefined ? 0 : y;\n        this.width = w === undefined ? 0 : w;\n        this.height = h === undefined ? 0 : h;\n    };\n\n    Rect.fromEllipse = function(e) {\n\n        e = new Ellipse(e);\n        return new Rect(e.x - e.a, e.y - e.b, 2 * e.a, 2 * e.b);\n    };\n\n    Rect.prototype = {\n\n        // Find my bounding box when I'm rotated with the center of rotation in the center of me.\n        // @return r {rectangle} representing a bounding box\n        bbox: function(angle) {\n\n            if (!angle) return this.clone();\n\n            var theta = toRad(angle);\n            var st = abs(sin(theta));\n            var ct = abs(cos(theta));\n            var w = this.width * ct + this.height * st;\n            var h = this.width * st + this.height * ct;\n            return new Rect(this.x + (this.width - w) / 2, this.y + (this.height - h) / 2, w, h);\n        },\n\n        bottomLeft: function() {\n\n            return new Point(this.x, this.y + this.height);\n        },\n\n        bottomLine: function() {\n\n            return new Line(this.bottomLeft(), this.bottomRight());\n        },\n\n        bottomMiddle: function() {\n\n            return new Point(this.x + this.width / 2, this.y + this.height);\n        },\n\n        center: function() {\n\n            return new Point(this.x + this.width / 2, this.y + this.height / 2);\n        },\n\n        clone: function() {\n\n            return new Rect(this);\n        },\n\n        // @return {bool} true if point p is insight me\n        containsPoint: function(p) {\n\n            p = new Point(p);\n            return p.x >= this.x && p.x <= this.x + this.width && p.y >= this.y && p.y <= this.y + this.height;\n        },\n\n        // @return {bool} true if rectangle `r` is inside me.\n        containsRect: function(r) {\n\n            var r0 = new Rect(this).normalize();\n            var r1 = new Rect(r).normalize();\n            var w0 = r0.width;\n            var h0 = r0.height;\n            var w1 = r1.width;\n            var h1 = r1.height;\n\n            if (!w0 || !h0 || !w1 || !h1) {\n                // At least one of the dimensions is 0\n                return false;\n            }\n\n            var x0 = r0.x;\n            var y0 = r0.y;\n            var x1 = r1.x;\n            var y1 = r1.y;\n\n            w1 += x1;\n            w0 += x0;\n            h1 += y1;\n            h0 += y0;\n\n            return x0 <= x1 && w1 <= w0 && y0 <= y1 && h1 <= h0;\n        },\n\n        corner: function() {\n\n            return new Point(this.x + this.width, this.y + this.height);\n        },\n\n        // @return {boolean} true if rectangles are equal.\n        equals: function(r) {\n\n            var mr = (new Rect(this)).normalize();\n            var nr = (new Rect(r)).normalize();\n            return mr.x === nr.x && mr.y === nr.y && mr.width === nr.width && mr.height === nr.height;\n        },\n\n        // inflate by dx and dy, recompute origin [x, y]\n        // @param dx {delta_x} representing additional size to x\n        // @param dy {delta_y} representing additional size to y -\n        // dy param is not required -> in that case y is sized by dx\n        inflate: function(dx, dy) {\n\n            if (dx === undefined) {\n                dx = 0;\n            }\n\n            if (dy === undefined) {\n                dy = dx;\n            }\n\n            this.x -= dx;\n            this.y -= dy;\n            this.width += 2 * dx;\n            this.height += 2 * dy;\n\n            return this;\n        },\n\n        // @return {rect} if rectangles intersect, {null} if not.\n        intersect: function(r) {\n\n            var myOrigin = this.origin();\n            var myCorner = this.corner();\n            var rOrigin = r.origin();\n            var rCorner = r.corner();\n\n            // No intersection found\n            if (rCorner.x <= myOrigin.x ||\n                rCorner.y <= myOrigin.y ||\n                rOrigin.x >= myCorner.x ||\n                rOrigin.y >= myCorner.y) return null;\n\n            var x = max(myOrigin.x, rOrigin.x);\n            var y = max(myOrigin.y, rOrigin.y);\n\n            return new Rect(x, y, min(myCorner.x, rCorner.x) - x, min(myCorner.y, rCorner.y) - y);\n        },\n\n        intersectionWithLine: function(line) {\n\n            var r = this;\n            var rectLines = [ r.topLine(), r.rightLine(), r.bottomLine(), r.leftLine() ];\n            var points = [];\n            var dedupeArr = [];\n            var pt, i;\n\n            var n = rectLines.length;\n            for (i = 0; i < n; i ++) {\n\n                pt = line.intersect(rectLines[i]);\n                if (pt !== null && dedupeArr.indexOf(pt.toString()) < 0) {\n                    points.push(pt);\n                    dedupeArr.push(pt.toString());\n                }\n            }\n\n            return points.length > 0 ? points : null;\n        },\n\n        // Find point on my boundary where line starting\n        // from my center ending in point p intersects me.\n        // @param {number} angle If angle is specified, intersection with rotated rectangle is computed.\n        intersectionWithLineFromCenterToPoint: function(p, angle) {\n\n            p = new Point(p);\n            var center = new Point(this.x + this.width / 2, this.y + this.height / 2);\n            var result;\n\n            if (angle) p.rotate(center, angle);\n\n            // (clockwise, starting from the top side)\n            var sides = [\n                this.topLine(),\n                this.rightLine(),\n                this.bottomLine(),\n                this.leftLine()\n            ];\n            var connector = new Line(center, p);\n\n            for (var i = sides.length - 1; i >= 0; --i) {\n                var intersection = sides[i].intersection(connector);\n                if (intersection !== null) {\n                    result = intersection;\n                    break;\n                }\n            }\n            if (result && angle) result.rotate(center, -angle);\n            return result;\n        },\n\n        leftLine: function() {\n\n            return new Line(this.topLeft(), this.bottomLeft());\n        },\n\n        leftMiddle: function() {\n\n            return new Point(this.x , this.y + this.height / 2);\n        },\n\n        maxRectScaleToFit: function(rect, origin) {\n\n            rect = new Rect(rect);\n            origin || (origin = rect.center());\n\n            var sx1, sx2, sx3, sx4, sy1, sy2, sy3, sy4;\n            var ox = origin.x;\n            var oy = origin.y;\n\n            // Here we find the maximal possible scale for all corner points (for x and y axis) of the rectangle,\n            // so when the scale is applied the point is still inside the rectangle.\n\n            sx1 = sx2 = sx3 = sx4 = sy1 = sy2 = sy3 = sy4 = Infinity;\n\n            // Top Left\n            var p1 = rect.topLeft();\n            if (p1.x < ox) {\n                sx1 = (this.x - ox) / (p1.x - ox);\n            }\n            if (p1.y < oy) {\n                sy1 = (this.y - oy) / (p1.y - oy);\n            }\n            // Bottom Right\n            var p2 = rect.bottomRight();\n            if (p2.x > ox) {\n                sx2 = (this.x + this.width - ox) / (p2.x - ox);\n            }\n            if (p2.y > oy) {\n                sy2 = (this.y + this.height - oy) / (p2.y - oy);\n            }\n            // Top Right\n            var p3 = rect.topRight();\n            if (p3.x > ox) {\n                sx3 = (this.x + this.width - ox) / (p3.x - ox);\n            }\n            if (p3.y < oy) {\n                sy3 = (this.y - oy) / (p3.y - oy);\n            }\n            // Bottom Left\n            var p4 = rect.bottomLeft();\n            if (p4.x < ox) {\n                sx4 = (this.x - ox) / (p4.x - ox);\n            }\n            if (p4.y > oy) {\n                sy4 = (this.y + this.height - oy) / (p4.y - oy);\n            }\n\n            return {\n                sx: min(sx1, sx2, sx3, sx4),\n                sy: min(sy1, sy2, sy3, sy4)\n            };\n        },\n\n        maxRectUniformScaleToFit: function(rect, origin) {\n\n            var scale = this.maxRectScaleToFit(rect, origin);\n            return min(scale.sx, scale.sy);\n        },\n\n        // Move and expand me.\n        // @param r {rectangle} representing deltas\n        moveAndExpand: function(r) {\n\n            this.x += r.x || 0;\n            this.y += r.y || 0;\n            this.width += r.width || 0;\n            this.height += r.height || 0;\n            return this;\n        },\n\n        // Normalize the rectangle; i.e., make it so that it has a non-negative width and height.\n        // If width < 0 the function swaps the left and right corners,\n        // and it swaps the top and bottom corners if height < 0\n        // like in http://qt-project.org/doc/qt-4.8/qrectf.html#normalized\n        normalize: function() {\n\n            var newx = this.x;\n            var newy = this.y;\n            var newwidth = this.width;\n            var newheight = this.height;\n            if (this.width < 0) {\n                newx = this.x + this.width;\n                newwidth = -this.width;\n            }\n            if (this.height < 0) {\n                newy = this.y + this.height;\n                newheight = -this.height;\n            }\n            this.x = newx;\n            this.y = newy;\n            this.width = newwidth;\n            this.height = newheight;\n            return this;\n        },\n\n        // Offset me by the specified amount.\n        offset: function(dx, dy) {\n\n            // pretend that this is a point and call offset()\n            // rewrites x and y according to dx and dy\n            return Point.prototype.offset.call(this, dx, dy);\n        },\n\n        origin: function() {\n\n            return new Point(this.x, this.y);\n        },\n\n        // @return {point} a point on my boundary nearest to the given point.\n        // @see Squeak Smalltalk, Rectangle>>pointNearestTo:\n        pointNearestToPoint: function(point) {\n\n            point = new Point(point);\n            if (this.containsPoint(point)) {\n                var side = this.sideNearestToPoint(point);\n                switch (side){\n                    case 'right': return new Point(this.x + this.width, point.y);\n                    case 'left': return new Point(this.x, point.y);\n                    case 'bottom': return new Point(point.x, this.y + this.height);\n                    case 'top': return new Point(point.x, this.y);\n                }\n            }\n            return point.adhereToRect(this);\n        },\n\n        rightLine: function() {\n\n            return new Line(this.topRight(), this.bottomRight());\n        },\n\n        rightMiddle: function() {\n\n            return new Point(this.x + this.width, this.y + this.height / 2);\n        },\n\n        round: function(precision) {\n\n            var f = pow(10, precision || 0);\n            this.x = round(this.x * f) / f;\n            this.y = round(this.y * f) / f;\n            this.width = round(this.width * f) / f;\n            this.height = round(this.height * f) / f;\n            return this;\n        },\n\n        // Scale rectangle with origin.\n        scale: function(sx, sy, origin) {\n\n            origin = this.origin().scale(sx, sy, origin);\n            this.x = origin.x;\n            this.y = origin.y;\n            this.width *= sx;\n            this.height *= sy;\n            return this;\n        },\n\n        // @return {string} (left|right|top|bottom) side which is nearest to point\n        // @see Squeak Smalltalk, Rectangle>>sideNearestTo:\n        sideNearestToPoint: function(point) {\n\n            point = new Point(point);\n            var distToLeft = point.x - this.x;\n            var distToRight = (this.x + this.width) - point.x;\n            var distToTop = point.y - this.y;\n            var distToBottom = (this.y + this.height) - point.y;\n            var closest = distToLeft;\n            var side = 'left';\n\n            if (distToRight < closest) {\n                closest = distToRight;\n                side = 'right';\n            }\n            if (distToTop < closest) {\n                closest = distToTop;\n                side = 'top';\n            }\n            if (distToBottom < closest) {\n                // closest = distToBottom;\n                side = 'bottom';\n            }\n            return side;\n        },\n\n        snapToGrid: function(gx, gy) {\n\n            var origin = this.origin().snapToGrid(gx, gy);\n            var corner = this.corner().snapToGrid(gx, gy);\n            this.x = origin.x;\n            this.y = origin.y;\n            this.width = corner.x - origin.x;\n            this.height = corner.y - origin.y;\n            return this;\n        },\n\n        toJSON: function() {\n\n            return { x: this.x, y: this.y, width: this.width, height: this.height };\n        },\n\n        topLine: function() {\n\n            return new Line(this.topLeft(), this.topRight());\n        },\n\n        topMiddle: function() {\n\n            return new Point(this.x + this.width / 2, this.y);\n        },\n\n        topRight: function() {\n\n            return new Point(this.x + this.width, this.y);\n        },\n\n        toString: function() {\n\n            return this.origin().toString() + ' ' + this.corner().toString();\n        },\n\n        // @return {rect} representing the union of both rectangles.\n        union: function(rect) {\n\n            rect = new Rect(rect);\n            var myOrigin = this.origin();\n            var myCorner = this.corner();\n            var rOrigin = rect.origin();\n            var rCorner = rect.corner();\n\n            var originX = min(myOrigin.x, rOrigin.x);\n            var originY = min(myOrigin.y, rOrigin.y);\n            var cornerX = max(myCorner.x, rCorner.x);\n            var cornerY = max(myCorner.y, rCorner.y);\n\n            return new Rect(originX, originY, cornerX - originX, cornerY - originY);\n        }\n    };\n\n    Rect.prototype.bottomRight = Rect.prototype.corner;\n\n    Rect.prototype.topLeft = Rect.prototype.origin;\n\n    Rect.prototype.translate = Rect.prototype.offset;\n\n    g.scale = {\n\n        // Return the `value` from the `domain` interval scaled to the `range` interval.\n        linear: function(domain, range, value) {\n\n            var domainSpan = domain[1] - domain[0];\n            var rangeSpan = range[1] - range[0];\n            return (((value - domain[0]) / domainSpan) * rangeSpan + range[0]) || 0;\n        }\n    };\n\n    var normalizeAngle = g.normalizeAngle = function(angle) {\n\n        return (angle % 360) + (angle < 0 ? 360 : 0);\n    };\n\n    var snapToGrid = g.snapToGrid = function(value, gridSize) {\n\n        return gridSize * round(value / gridSize);\n    };\n\n    var toDeg = g.toDeg = function(rad) {\n\n        return (180 * rad / PI) % 360;\n    };\n\n    var toRad = g.toRad = function(deg, over360) {\n\n        over360 = over360 || false;\n        deg = over360 ? deg : (deg % 360);\n        return deg * PI / 180;\n    };\n\n    // For backwards compatibility:\n    g.ellipse = g.Ellipse;\n    g.line = g.Line;\n    g.point = g.Point;\n    g.rect = g.Rect;\n\n    // Local helper function.\n    // Use an array of arguments to call a constructor (function called with `new`).\n    // Adapted from https://stackoverflow.com/a/8843181/2263595\n    // It is not necessary to use this function if the arguments can be passed separately (i.e. if the number of arguments is limited).\n    // - If that is the case, use `new constructor(arg1, arg2)`, for example.\n    // It is not necessary to use this function if the function that needs an array of arguments is not supposed to be used as a constructor.\n    // - If that is the case, use `f.apply(thisArg, [arg1, arg2...])`, for example.\n    function applyToNew(constructor, argsArray) {\n        // The `new` keyword can only be applied to functions that take a limited number of arguments.\n        // - We can fake that with .bind().\n        // - It calls a function (`constructor`, here) with the arguments that were provided to it - effectively transforming an unlimited number of arguments into limited.\n        // - So `new (constructor.bind(thisArg, arg1, arg2...))`\n        // - `thisArg` can be anything (e.g. null) because `new` keyword resets context to the constructor object.\n        // We need to pass in a variable number of arguments to the bind() call.\n        // - We can use .apply().\n        // - So `new (constructor.bind.apply(constructor, [thisArg, arg1, arg2...]))`\n        // - `thisArg` can still be anything because `new` overwrites it.\n        // Finally, to make sure that constructor.bind overwriting is not a problem, we switch to `Function.prototype.bind`.\n        // - So, the final version is `new (Function.prototype.bind.apply(constructor, [thisArg, arg1, arg2...]))`\n\n        // The function expects `argsArray[0]` to be `thisArg`.\n        // - This means that whatever is sent as the first element will be ignored.\n        // - The constructor will only see arguments starting from argsArray[1].\n        // - So, a new dummy element is inserted at the start of the array.\n        argsArray.unshift(null);\n\n        return new (Function.prototype.bind.apply(constructor, argsArray));\n    }\n\n    // Local helper function.\n    // Add properties from arguments on top of properties from `obj`.\n    // This allows for rudimentary inheritance.\n    // - The `obj` argument acts as parent.\n    // - This function creates a new object that inherits all `obj` properties and adds/replaces those that are present in arguments.\n    // - A high-level example: calling `extend(Vehicle, Car)` would be akin to declaring `class Car extends Vehicle`.\n    function extend(obj) {\n        // In JavaScript, the combination of a constructor function (e.g. `g.Line = function(...) {...}`) and prototype (e.g. `g.Line.prototype = {...}) is akin to a C++ class.\n        // - When inheritance is not necessary, we can leave it at that. (This would be akin to calling extend with only `obj`.)\n        // - But, what if we wanted the `g.Line` quasiclass to inherit from another quasiclass (let's call it `g.GeometryObject`) in JavaScript?\n        // - First, realize that both of those quasiclasses would still have their own separate constructor function.\n        // - So what we are actually saying is that we want the `g.Line` prototype to inherit from `g.GeometryObject` prototype.\n        // - This method provides a way to do exactly that.\n        // - It copies parent prototype's properties, then adds extra ones from child prototype/overrides parent prototype properties with child prototype properties.\n        // - Therefore, to continue with the example above:\n        //   - `g.Line.prototype = extend(g.GeometryObject.prototype, linePrototype)`\n        //   - Where `linePrototype` is a properties object that looks just like `g.Line.prototype` does right now.\n        //   - Then, `g.Line` would allow the programmer to access to all methods currently in `g.Line.Prototype`, plus any non-overriden methods from `g.GeometryObject.prototype`.\n        //   - In that aspect, `g.GeometryObject` would then act like the parent of `g.Line`.\n        // - Multiple inheritance is also possible, if multiple arguments are provided.\n        // - What if we wanted to add another level of abstraction between `g.GeometryObject` and `g.Line` (let's call it `g.LinearObject`)?\n        //   - `g.Line.prototype = extend(g.GeometryObject.prototype, g.LinearObject.prototype, linePrototype)`\n        //   - The ancestors are applied in order of appearance.\n        //   - That means that `g.Line` would have inherited from `g.LinearObject` that would have inherited from `g.GeometryObject`.\n        //   - Any number of ancestors may be provided.\n        // - Note that neither `obj` nor any of the arguments need to actually be prototypes of any JavaScript quasiclass, that was just a simplified explanation.\n        // - We can create a new object composed from the properties of any number of other objects (since they do not have a constructor, we can think of those as interfaces).\n        //   - `extend({ a: 1, b: 2 }, { b: 10, c: 20 }, { c: 100, d: 200 })` gives `{ a: 1, b: 10, c: 100, d: 200 }`.\n        //   - Basically, with this function, we can emulate the `extends` keyword as well as the `implements` keyword.\n        // - Therefore, both of the following are valid:\n        //   - `Lineto.prototype = extend(Line.prototype, segmentPrototype, linetoPrototype)`\n        //   - `Moveto.prototype = extend(segmentPrototype, movetoPrototype)`\n\n        var i;\n        var n;\n\n        var args = [];\n        n = arguments.length;\n        for (i = 1; i < n; i++) { // skip over obj\n            args.push(arguments[i]);\n        }\n\n        if (!obj) throw new Error('Missing a parent object.');\n        var child = Object.create(obj);\n\n        n = args.length;\n        for (i = 0; i < n; i++) {\n\n            var src = args[i];\n\n            var inheritedProperty;\n            var key;\n            for (key in src) {\n\n                if (src.hasOwnProperty(key)) {\n                    delete child[key]; // delete property inherited from parent\n                    inheritedProperty = Object.getOwnPropertyDescriptor(src, key); // get new definition of property from src\n                    Object.defineProperty(child, key, inheritedProperty); // re-add property with new definition (includes getter/setter methods)\n                }\n            }\n        }\n\n        return child;\n    }\n\n    // Path segment interface:\n    var segmentPrototype = {\n\n        // virtual\n        bbox: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // virtual\n        clone: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // virtual\n        closestPoint: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // virtual\n        closestPointLength: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // virtual\n        closestPointNormalizedLength: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // Redirect calls to closestPointNormalizedLength() function if closestPointT() is not defined for segment.\n        closestPointT: function(p) {\n\n            if (this.closestPointNormalizedLength) return this.closestPointNormalizedLength(p);\n\n            throw new Error('Neither closestPointT() nor closestPointNormalizedLength() function is implemented.');\n        },\n\n        // virtual\n        closestPointTangent: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // virtual\n        equals: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // virtual\n        getSubdivisions: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // virtual\n        isDifferentiable: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        isSegment: true,\n\n        isSubpathStart: false, // true for Moveto segments\n\n        isVisible: true, // false for Moveto segments\n\n        // virtual\n        length: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // Return a fraction of result of length() function if lengthAtT() is not defined for segment.\n        lengthAtT: function(t) {\n\n            if (t <= 0) return 0;\n\n            var length = this.length();\n\n            if (t >= 1) return length;\n\n            return length * t;\n        },\n\n        nextSegment: null, // needed for subpath start segment updating\n\n        // virtual\n        pointAt: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // virtual\n        pointAtLength: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // Redirect calls to pointAt() function if pointAtT() is not defined for segment.\n        pointAtT: function(t) {\n\n            if (this.pointAt) return this.pointAt(t);\n\n            throw new Error('Neither pointAtT() nor pointAt() function is implemented.');\n        },\n\n        previousSegment: null, // needed to get segment start property\n\n        subpathStartSegment: null, // needed to get Closepath segment end property\n\n        // virtual\n        scale: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // virtual\n        serialize: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // virtual\n        tangentAt: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // virtual\n        tangentAtLength: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // Redirect calls to tangentAt() function if tangentAtT() is not defined for segment.\n        tangentAtT: function(t) {\n\n            if (this.tangentAt) return this.tangentAt(t);\n\n            throw new Error('Neither tangentAtT() nor tangentAt() function is implemented.');\n        },\n\n        // virtual\n        toString: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        },\n\n        // virtual\n        translate: function() {\n\n            throw new Error('Declaration missing for virtual function.');\n        }\n    };\n\n    // usually directly assigned\n    // getter for Closepath\n    Object.defineProperty(segmentPrototype, 'end', {\n\n        configurable: true,\n\n        enumerable: true,\n\n        writable: true\n    });\n\n    // always a getter\n    // always throws error for Moveto\n    Object.defineProperty(segmentPrototype, 'start', {\n        // get a reference to the end point of previous segment\n\n        configurable: true,\n\n        enumerable: true,\n\n        get: function() {\n\n            if (!this.previousSegment) throw new Error('Missing previous segment. (This segment cannot be the first segment of a path; OR segment has not yet been added to a path.)');\n\n            return this.previousSegment.end;\n        }\n    });\n\n    // virtual\n    Object.defineProperty(segmentPrototype, 'type', {\n\n        configurable: true,\n\n        enumerable: true,\n\n        get: function() {\n\n            throw new Error('Bad segment declaration. No type specified.');\n        }\n    });\n\n    // Path segment implementations:\n    var Lineto = function() {\n\n        var args = [];\n        var n = arguments.length;\n        for (var i = 0; i < n; i++) {\n            args.push(arguments[i]);\n        }\n\n        if (!(this instanceof Lineto)) { // switching context of `this` to Lineto when called without `new`\n            return applyToNew(Lineto, args);\n        }\n\n        if (n === 0) {\n            throw new Error('Lineto constructor expects 1 point or 2 coordinates (none provided).');\n        }\n\n        var outputArray;\n\n        if (typeof args[0] === 'string' || typeof args[0] === 'number') { // coordinates provided\n            if (n === 2) {\n                this.end = new Point(+args[0], +args[1]);\n                return this;\n\n            } else if (n < 2) {\n                throw new Error('Lineto constructor expects 1 point or 2 coordinates (' + n + ' coordinates provided).');\n\n            } else { // this is a poly-line segment\n                var segmentCoords;\n                outputArray = [];\n                for (i = 0; i < n; i += 2) { // coords come in groups of two\n\n                    segmentCoords = args.slice(i, i + 2); // will send one coord if args.length not divisible by 2\n                    outputArray.push(applyToNew(Lineto, segmentCoords));\n                }\n                return outputArray;\n            }\n\n        } else { // points provided\n            if (n === 1) {\n                this.end = new Point(args[0]);\n                return this;\n\n            } else { // this is a poly-line segment\n                var segmentPoint;\n                outputArray = [];\n                for (i = 0; i < n; i += 1) {\n\n                    segmentPoint = args[i];\n                    outputArray.push(new Lineto(segmentPoint));\n                }\n                return outputArray;\n            }\n        }\n    };\n\n    var linetoPrototype = {\n\n        clone: function() {\n\n            return new Lineto(this.end);\n        },\n\n        getSubdivisions: function() {\n\n            return [];\n        },\n\n        isDifferentiable: function() {\n\n            if (!this.previousSegment) return false;\n\n            return !this.start.equals(this.end);\n        },\n\n        scale: function(sx, sy, origin) {\n\n            this.end.scale(sx, sy, origin);\n            return this;\n        },\n\n        serialize: function() {\n\n            var end = this.end;\n            return this.type + ' ' + end.x + ' ' + end.y;\n        },\n\n        toString: function() {\n\n            return this.type + ' ' + this.start + ' ' + this.end;\n        },\n\n        translate: function(tx, ty) {\n\n            this.end.translate(tx, ty);\n            return this;\n        }\n    };\n\n    Object.defineProperty(linetoPrototype, 'type', {\n\n        configurable: true,\n\n        enumerable: true,\n\n        value: 'L'\n    });\n\n    Lineto.prototype = extend(segmentPrototype, Line.prototype, linetoPrototype);\n\n    var Curveto = function() {\n\n        var args = [];\n        var n = arguments.length;\n        for (var i = 0; i < n; i++) {\n            args.push(arguments[i]);\n        }\n\n        if (!(this instanceof Curveto)) { // switching context of `this` to Curveto when called without `new`\n            return applyToNew(Curveto, args);\n        }\n\n        if (n === 0) {\n            throw new Error('Curveto constructor expects 3 points or 6 coordinates (none provided).');\n        }\n\n        var outputArray;\n\n        if (typeof args[0] === 'string' || typeof args[0] === 'number') { // coordinates provided\n            if (n === 6) {\n                this.controlPoint1 = new Point(+args[0], +args[1]);\n                this.controlPoint2 = new Point(+args[2], +args[3]);\n                this.end = new Point(+args[4], +args[5]);\n                return this;\n\n            } else if (n < 6) {\n                throw new Error('Curveto constructor expects 3 points or 6 coordinates (' + n + ' coordinates provided).');\n\n            } else { // this is a poly-bezier segment\n                var segmentCoords;\n                outputArray = [];\n                for (i = 0; i < n; i += 6) { // coords come in groups of six\n\n                    segmentCoords = args.slice(i, i + 6); // will send fewer than six coords if args.length not divisible by 6\n                    outputArray.push(applyToNew(Curveto, segmentCoords));\n                }\n                return outputArray;\n            }\n\n        } else { // points provided\n            if (n === 3) {\n                this.controlPoint1 = new Point(args[0]);\n                this.controlPoint2 = new Point(args[1]);\n                this.end = new Point(args[2]);\n                return this;\n\n            } else if (n < 3) {\n                throw new Error('Curveto constructor expects 3 points or 6 coordinates (' + n + ' points provided).');\n\n            } else { // this is a poly-bezier segment\n                var segmentPoints;\n                outputArray = [];\n                for (i = 0; i < n; i += 3) { // points come in groups of three\n\n                    segmentPoints = args.slice(i, i + 3); // will send fewer than three points if args.length is not divisible by 3\n                    outputArray.push(applyToNew(Curveto, segmentPoints));\n                }\n                return outputArray;\n            }\n        }\n    };\n\n    var curvetoPrototype = {\n\n        clone: function() {\n\n            return new Curveto(this.controlPoint1, this.controlPoint2, this.end);\n        },\n\n        isDifferentiable: function() {\n\n            if (!this.previousSegment) return false;\n\n            var start = this.start;\n            var control1 = this.controlPoint1;\n            var control2 = this.controlPoint2;\n            var end = this.end;\n\n            return !(start.equals(control1) && control1.equals(control2) && control2.equals(end));\n        },\n\n        scale: function(sx, sy, origin) {\n\n            this.controlPoint1.scale(sx, sy, origin);\n            this.controlPoint2.scale(sx, sy, origin);\n            this.end.scale(sx, sy, origin);\n            return this;\n        },\n\n        serialize: function() {\n\n            var c1 = this.controlPoint1;\n            var c2 = this.controlPoint2;\n            var end = this.end;\n            return this.type + ' ' + c1.x + ' ' + c1.y + ' ' + c2.x + ' ' + c2.y + ' ' + end.x + ' ' + end.y;\n        },\n\n        toString: function() {\n\n            return this.type + ' ' + this.start + ' ' + this.controlPoint1 + ' ' + this.controlPoint2 + ' ' + this.end;\n        },\n\n        translate: function(tx, ty) {\n\n            this.controlPoint1.translate(tx, ty);\n            this.controlPoint2.translate(tx, ty);\n            this.end.translate(tx, ty);\n            return this;\n        }\n    };\n\n    Object.defineProperty(curvetoPrototype, 'type', {\n\n        configurable: true,\n\n        enumerable: true,\n\n        value: 'C'\n    });\n\n    Curveto.prototype = extend(segmentPrototype, Curve.prototype, curvetoPrototype);\n\n    var Moveto = function() {\n\n        var args = [];\n        var n = arguments.length;\n        for (var i = 0; i < n; i++) {\n            args.push(arguments[i]);\n        }\n\n        if (!(this instanceof Moveto)) { // switching context of `this` to Moveto when called without `new`\n            return applyToNew(Moveto, args);\n        }\n\n        if (n === 0) {\n            throw new Error('Moveto constructor expects 1 point or 2 coordinates (none provided).');\n        }\n\n        var outputArray;\n\n        if (typeof args[0] === 'string' || typeof args[0] === 'number') { // coordinates provided\n            if (n === 2) {\n                this.end = new Point(+args[0], +args[1]);\n                return this;\n\n            } else if (n < 2) {\n                throw new Error('Moveto constructor expects 1 point or 2 coordinates (' + n + ' coordinates provided).');\n\n            } else { // this is a moveto-with-subsequent-poly-line segment\n                var segmentCoords;\n                outputArray = [];\n                for (i = 0; i < n; i += 2) { // coords come in groups of two\n\n                    segmentCoords = args.slice(i, i + 2); // will send one coord if args.length not divisible by 2\n                    if (i === 0) outputArray.push(applyToNew(Moveto, segmentCoords));\n                    else outputArray.push(applyToNew(Lineto, segmentCoords));\n                }\n                return outputArray;\n            }\n\n        } else { // points provided\n            if (n === 1) {\n                this.end = new Point(args[0]);\n                return this;\n\n            } else { // this is a moveto-with-subsequent-poly-line segment\n                var segmentPoint;\n                outputArray = [];\n                for (i = 0; i < n; i += 1) { // points come one by one\n\n                    segmentPoint = args[i];\n                    if (i === 0) outputArray.push(new Moveto(segmentPoint));\n                    else outputArray.push(new Lineto(segmentPoint));\n                }\n                return outputArray;\n            }\n        }\n    };\n\n    var movetoPrototype = {\n\n        bbox: function() {\n\n            return null;\n        },\n\n        clone: function() {\n\n            return new Moveto(this.end);\n        },\n\n        closestPoint: function() {\n\n            return this.end.clone();\n        },\n\n        closestPointNormalizedLength: function() {\n\n            return 0;\n        },\n\n        closestPointLength: function() {\n\n            return 0;\n        },\n\n        closestPointT: function() {\n\n            return 1;\n        },\n\n        closestPointTangent: function() {\n\n            return null;\n        },\n\n        equals: function(m) {\n\n            return this.end.equals(m.end);\n        },\n\n        getSubdivisions: function() {\n\n            return [];\n        },\n\n        isDifferentiable: function() {\n\n            return false;\n        },\n\n        isSubpathStart: true,\n\n        isVisible: false,\n\n        length: function() {\n\n            return 0;\n        },\n\n        lengthAtT: function() {\n\n            return 0;\n        },\n\n        pointAt: function() {\n\n            return this.end.clone();\n        },\n\n        pointAtLength: function() {\n\n            return this.end.clone();\n        },\n\n        pointAtT: function() {\n\n            return this.end.clone();\n        },\n\n        scale: function(sx, sy, origin) {\n\n            this.end.scale(sx, sy, origin);\n            return this;\n        },\n\n        serialize: function() {\n\n            var end = this.end;\n            return this.type + ' ' + end.x + ' ' + end.y;\n        },\n\n        tangentAt: function() {\n\n            return null;\n        },\n\n        tangentAtLength: function() {\n\n            return null;\n        },\n\n        tangentAtT: function() {\n\n            return null;\n        },\n\n        toString: function() {\n\n            return this.type + ' ' + this.end;\n        },\n\n        translate: function(tx, ty) {\n\n            this.end.translate(tx, ty);\n            return this;\n        }\n    };\n\n    Object.defineProperty(movetoPrototype, 'start', {\n\n        configurable: true,\n\n        enumerable: true,\n\n        get: function() {\n\n            throw new Error('Illegal access. Moveto segments should not need a start property.');\n        }\n    });\n\n    Object.defineProperty(movetoPrototype, 'type', {\n\n        configurable: true,\n\n        enumerable: true,\n\n        value: 'M'\n    });\n\n    Moveto.prototype = extend(segmentPrototype, movetoPrototype); // does not inherit from any other geometry object\n\n    var Closepath = function() {\n\n        var args = [];\n        var n = arguments.length;\n        for (var i = 0; i < n; i++) {\n            args.push(arguments[i]);\n        }\n\n        if (!(this instanceof Closepath)) { // switching context of `this` to Closepath when called without `new`\n            return applyToNew(Closepath, args);\n        }\n\n        if (n > 0) {\n            throw new Error('Closepath constructor expects no arguments.');\n        }\n\n        return this;\n    };\n\n    var closepathPrototype = {\n\n        clone: function() {\n\n            return new Closepath();\n        },\n\n        getSubdivisions: function() {\n\n            return [];\n        },\n\n        isDifferentiable: function() {\n\n            if (!this.previousSegment || !this.subpathStartSegment) return false;\n\n            return !this.start.equals(this.end);\n        },\n\n        scale: function() {\n\n            return this;\n        },\n\n        serialize: function() {\n\n            return this.type;\n        },\n\n        toString: function() {\n\n            return this.type + ' ' + this.start + ' ' + this.end;\n        },\n\n        translate: function() {\n\n            return this;\n        }\n    };\n\n    Object.defineProperty(closepathPrototype, 'end', {\n        // get a reference to the end point of subpath start segment\n\n        configurable: true,\n\n        enumerable: true,\n\n        get: function() {\n\n            if (!this.subpathStartSegment) throw new Error('Missing subpath start segment. (This segment needs a subpath start segment (e.g. Moveto); OR segment has not yet been added to a path.)');\n\n            return this.subpathStartSegment.end;\n        }\n    });\n\n    Object.defineProperty(closepathPrototype, 'type', {\n\n        configurable: true,\n\n        enumerable: true,\n\n        value: 'Z'\n    });\n\n    Closepath.prototype = extend(segmentPrototype, Line.prototype, closepathPrototype);\n\n    var segmentTypes = Path.segmentTypes = {\n        L: Lineto,\n        C: Curveto,\n        M: Moveto,\n        Z: Closepath,\n        z: Closepath\n    };\n\n    Path.regexSupportedData = new RegExp('^[\\\\s\\\\d' + Object.keys(segmentTypes).join('') + ',.]*$');\n\n    Path.isDataSupported = function(data) {\n\n        if (typeof data !== 'string') return false;\n        return this.regexSupportedData.test(data);\n    };\n\n})(g);\n\n// Vectorizer.\n// -----------\n\n// A tiny library for making your life easier when dealing with SVG.\n// The only Vectorizer dependency is the Geometry library.\n\nvar V; // eslint-disable-line no-unused-vars\nvar Vectorizer; // eslint-disable-line no-unused-vars\n\nV = Vectorizer = (function() {\n\n    'use strict';\n\n    var hasSvg = typeof window === 'object' &&\n                !!(\n                    window.SVGAngle ||\n                    document.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1')\n                );\n\n    // SVG support is required.\n    if (!hasSvg) {\n\n        // Return a function that throws an error when it is used.\n        return function() {\n            throw new Error('SVG is required to use Vectorizer.');\n        };\n    }\n\n    // XML namespaces.\n    var ns = {\n        xmlns: 'http://www.w3.org/2000/svg',\n        xml: 'http://www.w3.org/XML/1998/namespace',\n        xlink: 'http://www.w3.org/1999/xlink',\n        xhtml: 'http://www.w3.org/1999/xhtml'\n    };\n\n    var SVGversion = '1.1';\n\n    // Declare shorthands to the most used math functions.\n    var math = Math;\n    var PI = math.PI;\n    var atan2 = math.atan2;\n    var sqrt = math.sqrt;\n    var min = math.min;\n    var max = math.max;\n    var cos = math.cos;\n    var sin = math.sin;\n\n    var V = function(el, attrs, children) {\n\n        // This allows using V() without the new keyword.\n        if (!(this instanceof V)) {\n            return V.apply(Object.create(V.prototype), arguments);\n        }\n\n        if (!el) return;\n\n        if (V.isV(el)) {\n            el = el.node;\n        }\n\n        attrs = attrs || {};\n\n        if (V.isString(el)) {\n\n            if (el.toLowerCase() === 'svg') {\n\n                // Create a new SVG canvas.\n                el = V.createSvgDocument();\n\n            } else if (el[0] === '<') {\n\n                // Create element from an SVG string.\n                // Allows constructs of type: `document.appendChild(V('<rect></rect>').node)`.\n\n                var svgDoc = V.createSvgDocument(el);\n\n                // Note that `V()` might also return an array should the SVG string passed as\n                // the first argument contain more than one root element.\n                if (svgDoc.childNodes.length > 1) {\n\n                    // Map child nodes to `V`s.\n                    var arrayOfVels = [];\n                    var i, len;\n\n                    for (i = 0, len = svgDoc.childNodes.length; i < len; i++) {\n\n                        var childNode = svgDoc.childNodes[i];\n                        arrayOfVels.push(new V(document.importNode(childNode, true)));\n                    }\n\n                    return arrayOfVels;\n                }\n\n                el = document.importNode(svgDoc.firstChild, true);\n\n            } else {\n\n                el = document.createElementNS(ns.xmlns, el);\n            }\n\n            V.ensureId(el);\n        }\n\n        this.node = el;\n\n        this.setAttributes(attrs);\n\n        if (children) {\n            this.append(children);\n        }\n\n        return this;\n    };\n\n    var VPrototype = V.prototype;\n\n    Object.defineProperty(VPrototype, 'id', {\n        enumerable: true,\n        get: function() {\n            return this.node.id;\n        },\n        set: function(id) {\n            this.node.id = id;\n        }\n    });\n\n    /**\n     * @param {SVGGElement} toElem\n     * @returns {SVGMatrix}\n     */\n    VPrototype.getTransformToElement = function(target) {\n        var node = this.node;\n        if (V.isSVGGraphicsElement(target) && V.isSVGGraphicsElement(node)) {\n            var targetCTM = V.toNode(target).getScreenCTM();\n            var nodeCTM = node.getScreenCTM();\n            if (targetCTM && nodeCTM) {\n                return targetCTM.inverse().multiply(nodeCTM);\n            }\n        }\n        // Could not get actual transformation matrix\n        return V.createSVGMatrix();\n    };\n\n    /**\n     * @param {SVGMatrix} matrix\n     * @param {Object=} opt\n     * @returns {Vectorizer|SVGMatrix} Setter / Getter\n     */\n    VPrototype.transform = function(matrix, opt) {\n\n        var node = this.node;\n        if (V.isUndefined(matrix)) {\n            return V.transformStringToMatrix(this.attr('transform'));\n        }\n\n        if (opt && opt.absolute) {\n            return this.attr('transform', V.matrixToTransformString(matrix));\n        }\n\n        var svgTransform = V.createSVGTransform(matrix);\n        node.transform.baseVal.appendItem(svgTransform);\n        return this;\n    };\n\n    VPrototype.translate = function(tx, ty, opt) {\n\n        opt = opt || {};\n        ty = ty || 0;\n\n        var transformAttr = this.attr('transform') || '';\n        var transform = V.parseTransformString(transformAttr);\n        transformAttr = transform.value;\n        // Is it a getter?\n        if (V.isUndefined(tx)) {\n            return transform.translate;\n        }\n\n        transformAttr = transformAttr.replace(/translate\\([^)]*\\)/g, '').trim();\n\n        var newTx = opt.absolute ? tx : transform.translate.tx + tx;\n        var newTy = opt.absolute ? ty : transform.translate.ty + ty;\n        var newTranslate = 'translate(' + newTx + ',' + newTy + ')';\n\n        // Note that `translate()` is always the first transformation. This is\n        // usually the desired case.\n        this.attr('transform', (newTranslate + ' ' + transformAttr).trim());\n        return this;\n    };\n\n    VPrototype.rotate = function(angle, cx, cy, opt) {\n\n        opt = opt || {};\n\n        var transformAttr = this.attr('transform') || '';\n        var transform = V.parseTransformString(transformAttr);\n        transformAttr = transform.value;\n\n        // Is it a getter?\n        if (V.isUndefined(angle)) {\n            return transform.rotate;\n        }\n\n        transformAttr = transformAttr.replace(/rotate\\([^)]*\\)/g, '').trim();\n\n        angle %= 360;\n\n        var newAngle = opt.absolute ? angle : transform.rotate.angle + angle;\n        var newOrigin = (cx !== undefined && cy !== undefined) ? ',' + cx + ',' + cy : '';\n        var newRotate = 'rotate(' + newAngle + newOrigin + ')';\n\n        this.attr('transform', (transformAttr + ' ' + newRotate).trim());\n        return this;\n    };\n\n    // Note that `scale` as the only transformation does not combine with previous values.\n    VPrototype.scale = function(sx, sy) {\n\n        sy = V.isUndefined(sy) ? sx : sy;\n\n        var transformAttr = this.attr('transform') || '';\n        var transform = V.parseTransformString(transformAttr);\n        transformAttr = transform.value;\n\n        // Is it a getter?\n        if (V.isUndefined(sx)) {\n            return transform.scale;\n        }\n\n        transformAttr = transformAttr.replace(/scale\\([^)]*\\)/g, '').trim();\n\n        var newScale = 'scale(' + sx + ',' + sy + ')';\n\n        this.attr('transform', (transformAttr + ' ' + newScale).trim());\n        return this;\n    };\n\n    // Get SVGRect that contains coordinates and dimension of the real bounding box,\n    // i.e. after transformations are applied.\n    // If `target` is specified, bounding box will be computed relatively to `target` element.\n    VPrototype.bbox = function(withoutTransformations, target) {\n\n        var box;\n        var node = this.node;\n        var ownerSVGElement = node.ownerSVGElement;\n\n        // If the element is not in the live DOM, it does not have a bounding box defined and\n        // so fall back to 'zero' dimension element.\n        if (!ownerSVGElement) {\n            return new g.Rect(0, 0, 0, 0);\n        }\n\n        try {\n\n            box = node.getBBox();\n\n        } catch (e) {\n\n            // Fallback for IE.\n            box = {\n                x: node.clientLeft,\n                y: node.clientTop,\n                width: node.clientWidth,\n                height: node.clientHeight\n            };\n        }\n\n        if (withoutTransformations) {\n            return new g.Rect(box);\n        }\n\n        var matrix = this.getTransformToElement(target || ownerSVGElement);\n\n        return V.transformRect(box, matrix);\n    };\n\n    // Returns an SVGRect that contains coordinates and dimensions of the real bounding box,\n    // i.e. after transformations are applied.\n    // Fixes a browser implementation bug that returns incorrect bounding boxes for groups of svg elements.\n    // Takes an (Object) `opt` argument (optional) with the following attributes:\n    // (Object) `target` (optional): if not undefined, transform bounding boxes relative to `target`; if undefined, transform relative to this\n    // (Boolean) `recursive` (optional): if true, recursively enter all groups and get a union of element bounding boxes (svg bbox fix); if false or undefined, return result of native function this.node.getBBox();\n    VPrototype.getBBox = function(opt) {\n\n        var options = {};\n\n        var outputBBox;\n        var node = this.node;\n        var ownerSVGElement = node.ownerSVGElement;\n\n        // If the element is not in the live DOM, it does not have a bounding box defined and\n        // so fall back to 'zero' dimension element.\n        // If the element is not an SVGGraphicsElement, we could not measure the bounding box either\n        if (!ownerSVGElement || !V.isSVGGraphicsElement(node)) {\n            return new g.Rect(0, 0, 0, 0);\n        }\n\n        if (opt) {\n            if (opt.target) { // check if target exists\n                options.target = V.toNode(opt.target); // works for V objects, jquery objects, and node objects\n            }\n            if (opt.recursive) {\n                options.recursive = opt.recursive;\n            }\n        }\n\n        if (!options.recursive) {\n            try {\n                outputBBox = node.getBBox();\n            } catch (e) {\n                // Fallback for IE.\n                outputBBox = {\n                    x: node.clientLeft,\n                    y: node.clientTop,\n                    width: node.clientWidth,\n                    height: node.clientHeight\n                };\n            }\n\n            if (!options.target) {\n                // transform like this (that is, not at all)\n                return new g.Rect(outputBBox);\n            } else {\n                // transform like target\n                var matrix = this.getTransformToElement(options.target);\n                return V.transformRect(outputBBox, matrix);\n            }\n        } else { // if we want to calculate the bbox recursively\n            // browsers report correct bbox around svg elements (one that envelops the path lines tightly)\n            // but some browsers fail to report the same bbox when the elements are in a group (returning a looser bbox that also includes control points, like node.getClientRect())\n            // this happens even if we wrap a single svg element into a group!\n            // this option setting makes the function recursively enter all the groups from this and deeper, get bboxes of the elements inside, then return a union of those bboxes\n\n            var children = this.children();\n            var n = children.length;\n\n            if (n === 0) {\n                return this.getBBox({ target: options.target, recursive: false });\n            }\n\n            // recursion's initial pass-through setting:\n            // recursive passes-through just keep the target as whatever was set up here during the initial pass-through\n            if (!options.target) {\n                // transform children/descendants like this (their parent/ancestor)\n                options.target = this;\n            } // else transform children/descendants like target\n\n            for (var i = 0; i < n; i++) {\n                var currentChild = children[i];\n\n                var childBBox;\n\n                // if currentChild is not a group element, get its bbox with a nonrecursive call\n                if (currentChild.children().length === 0) {\n                    childBBox = currentChild.getBBox({ target: options.target, recursive: false });\n                }\n                else {\n                    // if currentChild is a group element (determined by checking the number of children), enter it with a recursive call\n                    childBBox = currentChild.getBBox({ target: options.target, recursive: true });\n                }\n\n                if (!outputBBox) {\n                    // if this is the first iteration\n                    outputBBox = childBBox;\n                } else {\n                    // make a new bounding box rectangle that contains this child's bounding box and previous bounding box\n                    outputBBox = outputBBox.union(childBBox);\n                }\n            }\n\n            return outputBBox;\n        }\n    };\n\n    // Text() helpers\n\n    function createTextPathNode(attrs, vel) {\n        attrs || (attrs = {});\n        var textPathElement = V('textPath');\n        var d = attrs.d;\n        if (d && attrs['xlink:href'] === undefined) {\n            // If `opt.attrs` is a plain string, consider it to be directly the\n            // SVG path data for the text to go along (this is a shortcut).\n            // Otherwise if it is an object and contains the `d` property, then this is our path.\n            // Wrap the text in the SVG <textPath> element that points\n            // to a path defined by `opt.attrs` inside the `<defs>` element.\n            var linkedPath = V('path').attr('d', d).appendTo(vel.defs());\n            textPathElement.attr('xlink:href', '#' + linkedPath.id);\n        }\n        if (V.isObject(attrs)) {\n            // Set attributes on the `<textPath>`. The most important one\n            // is the `xlink:href` that points to our newly created `<path/>` element in `<defs/>`.\n            // Note that we also allow the following construct:\n            // `t.text('my text', { textPath: { 'xlink:href': '#my-other-path' } })`.\n            // In other words, one can completely skip the auto-creation of the path\n            // and use any other arbitrary path that is in the document.\n            textPathElement.attr(attrs);\n        }\n        return textPathElement.node;\n    }\n\n    function annotateTextLine(lineNode, lineAnnotations, opt) {\n        opt || (opt = {});\n        var includeAnnotationIndices = opt.includeAnnotationIndices;\n        var eol = opt.eol;\n        var lineHeight = opt.lineHeight;\n        var baseSize = opt.baseSize;\n        var maxFontSize = 0;\n        var fontMetrics = {};\n        var lastJ = lineAnnotations.length - 1;\n        for (var j = 0; j <= lastJ; j++) {\n            var annotation = lineAnnotations[j];\n            var fontSize = null;\n            if (V.isObject(annotation)) {\n                var annotationAttrs = annotation.attrs;\n                var vTSpan = V('tspan', annotationAttrs);\n                var tspanNode = vTSpan.node;\n                var t = annotation.t;\n                if (eol && j === lastJ) t += eol;\n                tspanNode.textContent = t;\n                // Per annotation className\n                var annotationClass = annotationAttrs['class'];\n                if (annotationClass) vTSpan.addClass(annotationClass);\n                // If `opt.includeAnnotationIndices` is `true`,\n                // set the list of indices of all the applied annotations\n                // in the `annotations` attribute. This list is a comma\n                // separated list of indices.\n                if (includeAnnotationIndices) vTSpan.attr('annotations', annotation.annotations);\n                // Check for max font size\n                fontSize = parseFloat(annotationAttrs['font-size']);\n                if (fontSize === undefined) fontSize = baseSize;\n                if (fontSize && fontSize > maxFontSize) maxFontSize = fontSize;\n            } else {\n                if (eol && j === lastJ) annotation += eol;\n                tspanNode = document.createTextNode(annotation || ' ');\n                if (baseSize && baseSize > maxFontSize) maxFontSize = baseSize;\n            }\n            lineNode.appendChild(tspanNode);\n        }\n\n        if (maxFontSize) fontMetrics.maxFontSize = maxFontSize;\n        if (lineHeight) {\n            fontMetrics.lineHeight = lineHeight;\n        } else if (maxFontSize) {\n            fontMetrics.lineHeight = (maxFontSize * 1.2);\n        }\n        return fontMetrics;\n    }\n\n    var emRegex = /em$/;\n\n    function convertEmToPx(em, fontSize) {\n        var numerical = parseFloat(em);\n        if (emRegex.test(em)) return numerical * fontSize;\n        return numerical;\n    }\n\n    function calculateDY(alignment, linesMetrics, baseSizePx, lineHeight) {\n        if (!Array.isArray(linesMetrics)) return 0;\n        var n = linesMetrics.length;\n        if (!n) return 0;\n        var lineMetrics = linesMetrics[0];\n        var flMaxFont = convertEmToPx(lineMetrics.maxFontSize, baseSizePx) || baseSizePx;\n        var rLineHeights = 0;\n        var lineHeightPx = convertEmToPx(lineHeight, baseSizePx);\n        for (var i = 1; i < n; i++) {\n            lineMetrics = linesMetrics[i];\n            var iLineHeight = convertEmToPx(lineMetrics.lineHeight, baseSizePx) || lineHeightPx;\n            rLineHeights += iLineHeight;\n        }\n        var llMaxFont = convertEmToPx(lineMetrics.maxFontSize, baseSizePx) || baseSizePx;\n        var dy;\n        switch (alignment) {\n            case 'middle':\n                dy = (flMaxFont / 2) - (0.15 * llMaxFont) - (rLineHeights / 2);\n                break;\n            case 'bottom':\n                dy = -(0.25 * llMaxFont) - rLineHeights;\n                break;\n            default:\n            case 'top':\n                dy = (0.8 * flMaxFont);\n                break;\n        }\n        return dy;\n    }\n\n    VPrototype.text = function(content, opt) {\n\n        if (content && typeof content !== 'string') throw new Error('Vectorizer: text() expects the first argument to be a string.');\n\n        // Replace all spaces with the Unicode No-break space (http://www.fileformat.info/info/unicode/char/a0/index.htm).\n        // IE would otherwise collapse all spaces into one.\n        content = V.sanitizeText(content);\n        opt || (opt = {});\n\n        // End of Line character\n        var eol = opt.eol;\n        // Text along path\n        var textPath = opt.textPath;\n        // Vertical shift\n        var verticalAnchor = opt.textVerticalAnchor;\n        var namedVerticalAnchor = (verticalAnchor === 'middle' || verticalAnchor === 'bottom' || verticalAnchor === 'top');\n        // Horizontal shift applied to all the lines but the first.\n        var x = opt.x;\n        if (x === undefined) x = this.attr('x') || 0;\n        // Annotations\n        var iai = opt.includeAnnotationIndices;\n        var annotations = opt.annotations;\n        if (annotations && !V.isArray(annotations)) annotations = [annotations];\n        // Shift all the <tspan> but first by one line (`1em`)\n        var defaultLineHeight = opt.lineHeight;\n        var autoLineHeight = (defaultLineHeight === 'auto');\n        var lineHeight = (autoLineHeight) ? '1.5em' : (defaultLineHeight || '1em');\n        // Clearing the element\n        this.empty();\n        this.attr({\n            // Preserve spaces. In other words, we do not want consecutive spaces to get collapsed to one.\n            'xml:space': 'preserve',\n            // An empty text gets rendered into the DOM in webkit-based browsers.\n            // In order to unify this behaviour across all browsers\n            // we rather hide the text element when it's empty.\n            'display': (content) ? null : 'none'\n        });\n        // Set default font-size if none\n        var fontSize = parseFloat(this.attr('font-size'));\n        if (!fontSize) {\n            fontSize = 16;\n            if (namedVerticalAnchor || annotations) this.attr('font-size', fontSize);\n        }\n\n        var doc = document;\n        var containerNode;\n        if (textPath) {\n            // Now all the `<tspan>`s will be inside the `<textPath>`.\n            if (typeof textPath === 'string') textPath = { d: textPath };\n            containerNode = createTextPathNode(textPath, this);\n        } else {\n            containerNode = doc.createDocumentFragment();\n        }\n        var offset = 0;\n        var lines = content.split('\\n');\n        var linesMetrics = [];\n        var annotatedY;\n        for (var i = 0, lastI = lines.length - 1; i <= lastI; i++) {\n            var dy = lineHeight;\n            var lineClassName = 'v-line';\n            var lineNode = doc.createElementNS(V.namespace.xmlns, 'tspan');\n            var line = lines[i];\n            var lineMetrics;\n            if (line) {\n                if (annotations) {\n                    // Find the *compacted* annotations for this line.\n                    var lineAnnotations = V.annotateString(line, annotations, {\n                        offset: -offset,\n                        includeAnnotationIndices: iai\n                    });\n                    lineMetrics = annotateTextLine(lineNode, lineAnnotations, {\n                        includeAnnotationIndices: iai,\n                        eol: (i !== lastI && eol),\n                        lineHeight: (autoLineHeight) ? null : lineHeight,\n                        baseSize: fontSize\n                    });\n                    // Get the line height based on the biggest font size in the annotations for this line.\n                    var iLineHeight = lineMetrics.lineHeight;\n                    if (iLineHeight && autoLineHeight && i !== 0) dy = iLineHeight;\n                    if (i === 0) annotatedY = lineMetrics.maxFontSize * 0.8;\n                } else {\n                    if (eol && i !== lastI) line += eol;\n                    lineNode.textContent = line;\n                }\n            } else {\n                // Make sure the textContent is never empty. If it is, add a dummy\n                // character and make it invisible, making the following lines correctly\n                // relatively positioned. `dy=1em` won't work with empty lines otherwise.\n                lineNode.textContent = '-';\n                lineClassName += ' v-empty-line';\n                // 'opacity' needs to be specified with fill, stroke. Opacity without specification\n                // is not applied in Firefox\n                var lineNodeStyle = lineNode.style;\n                lineNodeStyle.fillOpacity = 0;\n                lineNodeStyle.strokeOpacity = 0;\n                if (annotations) lineMetrics = {};\n            }\n            if (lineMetrics) linesMetrics.push(lineMetrics);\n            if (i > 0) lineNode.setAttribute('dy', dy);\n            // Firefox requires 'x' to be set on the first line when inside a text path\n            if (i > 0 || textPath) lineNode.setAttribute('x', x);\n            lineNode.className.baseVal = lineClassName;\n            containerNode.appendChild(lineNode);\n            offset += line.length + 1;      // + 1 = newline character.\n        }\n        // Y Alignment calculation\n        if (namedVerticalAnchor) {\n            if (annotations) {\n                dy = calculateDY(verticalAnchor, linesMetrics, fontSize, lineHeight);\n            } else if (verticalAnchor === 'top') {\n                // A shortcut for top alignment. It does not depend on font-size nor line-height\n                dy = '0.8em';\n            } else {\n                var rh; // remaining height\n                if (lastI > 0) {\n                    rh = parseFloat(lineHeight) || 1;\n                    rh *= lastI;\n                    if (!emRegex.test(lineHeight)) rh /= fontSize;\n                } else {\n                    // Single-line text\n                    rh = 0;\n                }\n                switch (verticalAnchor) {\n                    case 'middle':\n                        dy = (0.3 - (rh / 2)) + 'em';\n                        break;\n                    case 'bottom':\n                        dy = (-rh - 0.3) + 'em';\n                        break;\n                }\n            }\n        } else {\n            if (verticalAnchor === 0) {\n                dy = '0em';\n            } else if (verticalAnchor) {\n                dy = verticalAnchor;\n            } else {\n                // No vertical anchor is defined\n                dy = 0;\n                // Backwards compatibility - we change the `y` attribute instead of `dy`.\n                if (this.attr('y') === null) this.attr('y', annotatedY || '0.8em');\n            }\n        }\n        containerNode.firstChild.setAttribute('dy', dy);\n        // Appending lines to the element.\n        this.append(containerNode);\n        return this;\n    };\n\n    /**\n     * @public\n     * @param {string} name\n     * @returns {Vectorizer}\n     */\n    VPrototype.removeAttr = function(name) {\n\n        var qualifiedName = V.qualifyAttr(name);\n        var el = this.node;\n\n        if (qualifiedName.ns) {\n            if (el.hasAttributeNS(qualifiedName.ns, qualifiedName.local)) {\n                el.removeAttributeNS(qualifiedName.ns, qualifiedName.local);\n            }\n        } else if (el.hasAttribute(name)) {\n            el.removeAttribute(name);\n        }\n        return this;\n    };\n\n    VPrototype.attr = function(name, value) {\n\n        if (V.isUndefined(name)) {\n\n            // Return all attributes.\n            var attributes = this.node.attributes;\n            var attrs = {};\n\n            for (var i = 0; i < attributes.length; i++) {\n                attrs[attributes[i].name] = attributes[i].value;\n            }\n\n            return attrs;\n        }\n\n        if (V.isString(name) && V.isUndefined(value)) {\n            return this.node.getAttribute(name);\n        }\n\n        if (typeof name === 'object') {\n\n            for (var attrName in name) {\n                if (name.hasOwnProperty(attrName)) {\n                    this.setAttribute(attrName, name[attrName]);\n                }\n            }\n\n        } else {\n\n            this.setAttribute(name, value);\n        }\n\n        return this;\n    };\n\n    VPrototype.normalizePath = function() {\n\n        var tagName = this.tagName();\n        if (tagName === 'PATH') {\n            this.attr('d', V.normalizePathData(this.attr('d')));\n        }\n\n        return this;\n    };\n\n    VPrototype.remove = function() {\n\n        if (this.node.parentNode) {\n            this.node.parentNode.removeChild(this.node);\n        }\n\n        return this;\n    };\n\n    VPrototype.empty = function() {\n\n        while (this.node.firstChild) {\n            this.node.removeChild(this.node.firstChild);\n        }\n\n        return this;\n    };\n\n    /**\n     * @private\n     * @param {object} attrs\n     * @returns {Vectorizer}\n     */\n    VPrototype.setAttributes = function(attrs) {\n\n        for (var key in attrs) {\n            if (attrs.hasOwnProperty(key)) {\n                this.setAttribute(key, attrs[key]);\n            }\n        }\n\n        return this;\n    };\n\n    VPrototype.append = function(els) {\n\n        if (!V.isArray(els)) {\n            els = [els];\n        }\n\n        for (var i = 0, len = els.length; i < len; i++) {\n            this.node.appendChild(V.toNode(els[i]));\n        }\n\n        return this;\n    };\n\n    VPrototype.prepend = function(els) {\n\n        var child = this.node.firstChild;\n        return child ? V(child).before(els) : this.append(els);\n    };\n\n    VPrototype.before = function(els) {\n\n        var node = this.node;\n        var parent = node.parentNode;\n\n        if (parent) {\n\n            if (!V.isArray(els)) {\n                els = [els];\n            }\n\n            for (var i = 0, len = els.length; i < len; i++) {\n                parent.insertBefore(V.toNode(els[i]), node);\n            }\n        }\n\n        return this;\n    };\n\n    VPrototype.appendTo = function(node) {\n        V.toNode(node).appendChild(this.node);\n        return this;\n    },\n\n    VPrototype.svg = function() {\n\n        return this.node instanceof window.SVGSVGElement ? this : V(this.node.ownerSVGElement);\n    };\n\n    VPrototype.tagName = function() {\n\n        return this.node.tagName.toUpperCase();\n    };\n\n    VPrototype.defs = function() {\n        var context = this.svg() || this;\n        var defsNode = context.node.getElementsByTagName('defs')[0];\n        if (defsNode) return V(defsNode);\n        return V('defs').appendTo(context);\n    };\n\n    VPrototype.clone = function() {\n\n        var clone = V(this.node.cloneNode(true/* deep */));\n        // Note that clone inherits also ID. Therefore, we need to change it here.\n        clone.node.id = V.uniqueId();\n        return clone;\n    };\n\n    VPrototype.findOne = function(selector) {\n\n        var found = this.node.querySelector(selector);\n        return found ? V(found) : undefined;\n    };\n\n    VPrototype.find = function(selector) {\n\n        var vels = [];\n        var nodes = this.node.querySelectorAll(selector);\n\n        if (nodes) {\n\n            // Map DOM elements to `V`s.\n            for (var i = 0; i < nodes.length; i++) {\n                vels.push(V(nodes[i]));\n            }\n        }\n\n        return vels;\n    };\n\n    // Returns an array of V elements made from children of this.node.\n    VPrototype.children = function() {\n\n        var children = this.node.childNodes;\n\n        var outputArray = [];\n        for (var i = 0; i < children.length; i++) {\n            var currentChild = children[i];\n            if (currentChild.nodeType === 1) {\n                outputArray.push(V(children[i]));\n            }\n        }\n        return outputArray;\n    };\n\n    // Find an index of an element inside its container.\n    VPrototype.index = function() {\n\n        var index = 0;\n        var node = this.node.previousSibling;\n\n        while (node) {\n            // nodeType 1 for ELEMENT_NODE\n            if (node.nodeType === 1) index++;\n            node = node.previousSibling;\n        }\n\n        return index;\n    };\n\n    VPrototype.findParentByClass = function(className, terminator) {\n\n        var ownerSVGElement = this.node.ownerSVGElement;\n        var node = this.node.parentNode;\n\n        while (node && node !== terminator && node !== ownerSVGElement) {\n\n            var vel = V(node);\n            if (vel.hasClass(className)) {\n                return vel;\n            }\n\n            node = node.parentNode;\n        }\n\n        return null;\n    };\n\n    // https://jsperf.com/get-common-parent\n    VPrototype.contains = function(el) {\n\n        var a = this.node;\n        var b = V.toNode(el);\n        var bup = b && b.parentNode;\n\n        return (a === bup) || !!(bup && bup.nodeType === 1 && (a.compareDocumentPosition(bup) & 16));\n    };\n\n    // Convert global point into the coordinate space of this element.\n    VPrototype.toLocalPoint = function(x, y) {\n\n        var svg = this.svg().node;\n\n        var p = svg.createSVGPoint();\n        p.x = x;\n        p.y = y;\n\n        try {\n\n            var globalPoint = p.matrixTransform(svg.getScreenCTM().inverse());\n            var globalToLocalMatrix = this.getTransformToElement(svg).inverse();\n\n        } catch (e) {\n            // IE9 throws an exception in odd cases. (`Unexpected call to method or property access`)\n            // We have to make do with the original coordianates.\n            return p;\n        }\n\n        return globalPoint.matrixTransform(globalToLocalMatrix);\n    };\n\n    VPrototype.translateCenterToPoint = function(p) {\n\n        var bbox = this.getBBox({ target: this.svg() });\n        var center = bbox.center();\n\n        this.translate(p.x - center.x, p.y - center.y);\n        return this;\n    };\n\n    // Efficiently auto-orient an element. This basically implements the orient=auto attribute\n    // of markers. The easiest way of understanding on what this does is to imagine the element is an\n    // arrowhead. Calling this method on the arrowhead makes it point to the `position` point while\n    // being auto-oriented (properly rotated) towards the `reference` point.\n    // `target` is the element relative to which the transformations are applied. Usually a viewport.\n    VPrototype.translateAndAutoOrient = function(position, reference, target) {\n\n        // Clean-up previously set transformations except the scale. If we didn't clean up the\n        // previous transformations then they'd add up with the old ones. Scale is an exception as\n        // it doesn't add up, consider: `this.scale(2).scale(2).scale(2)`. The result is that the\n        // element is scaled by the factor 2, not 8.\n\n        var s = this.scale();\n        this.attr('transform', '');\n        this.scale(s.sx, s.sy);\n\n        var svg = this.svg().node;\n        var bbox = this.getBBox({ target: target || svg });\n\n        // 1. Translate to origin.\n        var translateToOrigin = svg.createSVGTransform();\n        translateToOrigin.setTranslate(-bbox.x - bbox.width / 2, -bbox.y - bbox.height / 2);\n\n        // 2. Rotate around origin.\n        var rotateAroundOrigin = svg.createSVGTransform();\n        var angle = (new g.Point(position)).changeInAngle(position.x - reference.x, position.y - reference.y, reference);\n        rotateAroundOrigin.setRotate(angle, 0, 0);\n\n        // 3. Translate to the `position` + the offset (half my width) towards the `reference` point.\n        var translateFinal = svg.createSVGTransform();\n        var finalPosition = (new g.Point(position)).move(reference, bbox.width / 2);\n        translateFinal.setTranslate(position.x + (position.x - finalPosition.x), position.y + (position.y - finalPosition.y));\n\n        // 4. Apply transformations.\n        var ctm = this.getTransformToElement(target || svg);\n        var transform = svg.createSVGTransform();\n        transform.setMatrix(\n            translateFinal.matrix.multiply(\n                rotateAroundOrigin.matrix.multiply(\n                    translateToOrigin.matrix.multiply(\n                        ctm)))\n        );\n\n        // Instead of directly setting the `matrix()` transform on the element, first, decompose\n        // the matrix into separate transforms. This allows us to use normal Vectorizer methods\n        // as they don't work on matrices. An example of this is to retrieve a scale of an element.\n        // this.node.transform.baseVal.initialize(transform);\n\n        var decomposition = V.decomposeMatrix(transform.matrix);\n\n        this.translate(decomposition.translateX, decomposition.translateY);\n        this.rotate(decomposition.rotation);\n        // Note that scale has been already applied, hence the following line stays commented. (it's here just for reference).\n        //this.scale(decomposition.scaleX, decomposition.scaleY);\n\n        return this;\n    };\n\n    VPrototype.animateAlongPath = function(attrs, path) {\n\n        path = V.toNode(path);\n\n        var id = V.ensureId(path);\n        var animateMotion = V('animateMotion', attrs);\n        var mpath = V('mpath', { 'xlink:href': '#' + id });\n\n        animateMotion.append(mpath);\n\n        this.append(animateMotion);\n        try {\n            animateMotion.node.beginElement();\n        } catch (e) {\n            // Fallback for IE 9.\n            // Run the animation programatically if FakeSmile (`http://leunen.me/fakesmile/`) present\n            if (document.documentElement.getAttribute('smiling') === 'fake') {\n                /* global getTargets:true, Animator:true, animators:true id2anim:true */\n                // Register the animation. (See `https://answers.launchpad.net/smil/+question/203333`)\n                var animation = animateMotion.node;\n                animation.animators = [];\n\n                var animationID = animation.getAttribute('id');\n                if (animationID) id2anim[animationID] = animation;\n\n                var targets = getTargets(animation);\n                for (var i = 0, len = targets.length; i < len; i++) {\n                    var target = targets[i];\n                    var animator = new Animator(animation, target, i);\n                    animators.push(animator);\n                    animation.animators[i] = animator;\n                    animator.register();\n                }\n            }\n        }\n        return this;\n    };\n\n    VPrototype.hasClass = function(className) {\n\n        return new RegExp('(\\\\s|^)' + className + '(\\\\s|$)').test(this.node.getAttribute('class'));\n    };\n\n    VPrototype.addClass = function(className) {\n\n        if (className && !this.hasClass(className)) {\n            var prevClasses = this.node.getAttribute('class') || '';\n            this.node.setAttribute('class', (prevClasses + ' ' + className).trim());\n        }\n\n        return this;\n    };\n\n    VPrototype.removeClass = function(className) {\n\n        if (className && this.hasClass(className)) {\n            var newClasses = this.node.getAttribute('class').replace(new RegExp('(\\\\s|^)' + className + '(\\\\s|$)', 'g'), '$2');\n            this.node.setAttribute('class', newClasses);\n        }\n\n        return this;\n    };\n\n    VPrototype.toggleClass = function(className, toAdd) {\n\n        var toRemove = V.isUndefined(toAdd) ? this.hasClass(className) : !toAdd;\n\n        if (toRemove) {\n            this.removeClass(className);\n        } else {\n            this.addClass(className);\n        }\n\n        return this;\n    };\n\n    // Interpolate path by discrete points. The precision of the sampling\n    // is controlled by `interval`. In other words, `sample()` will generate\n    // a point on the path starting at the beginning of the path going to the end\n    // every `interval` pixels.\n    // The sampler can be very useful for e.g. finding intersection between two\n    // paths (finding the two closest points from two samples).\n    VPrototype.sample = function(interval) {\n\n        interval = interval || 1;\n        var node = this.node;\n        var length = node.getTotalLength();\n        var samples = [];\n        var distance = 0;\n        var sample;\n        while (distance < length) {\n            sample = node.getPointAtLength(distance);\n            samples.push({ x: sample.x, y: sample.y, distance: distance });\n            distance += interval;\n        }\n        return samples;\n    };\n\n    VPrototype.convertToPath = function() {\n\n        var path = V('path');\n        path.attr(this.attr());\n        var d = this.convertToPathData();\n        if (d) {\n            path.attr('d', d);\n        }\n        return path;\n    };\n\n    VPrototype.convertToPathData = function() {\n\n        var tagName = this.tagName();\n\n        switch (tagName) {\n            case 'PATH':\n                return this.attr('d');\n            case 'LINE':\n                return V.convertLineToPathData(this.node);\n            case 'POLYGON':\n                return V.convertPolygonToPathData(this.node);\n            case 'POLYLINE':\n                return V.convertPolylineToPathData(this.node);\n            case 'ELLIPSE':\n                return V.convertEllipseToPathData(this.node);\n            case 'CIRCLE':\n                return V.convertCircleToPathData(this.node);\n            case 'RECT':\n                return V.convertRectToPathData(this.node);\n        }\n\n        throw new Error(tagName + ' cannot be converted to PATH.');\n    };\n\n    V.prototype.toGeometryShape = function() {\n        var x, y, width, height, cx, cy, r, rx, ry, points, d, x1, x2, y1, y2;\n        switch (this.tagName()) {\n\n            case 'RECT':\n                x = parseFloat(this.attr('x')) || 0;\n                y = parseFloat(this.attr('y')) || 0;\n                width = parseFloat(this.attr('width')) || 0;\n                height = parseFloat(this.attr('height')) || 0;\n                return new g.Rect(x, y, width, height);\n\n            case 'CIRCLE':\n                cx = parseFloat(this.attr('cx')) || 0;\n                cy = parseFloat(this.attr('cy')) || 0;\n                r = parseFloat(this.attr('r')) || 0;\n                return new g.Ellipse({ x: cx, y: cy }, r, r);\n\n            case 'ELLIPSE':\n                cx = parseFloat(this.attr('cx')) || 0;\n                cy = parseFloat(this.attr('cy')) || 0;\n                rx = parseFloat(this.attr('rx')) || 0;\n                ry = parseFloat(this.attr('ry')) || 0;\n                return new g.Ellipse({ x: cx, y: cy }, rx, ry);\n\n            case 'POLYLINE':\n                points = V.getPointsFromSvgNode(this);\n                return new g.Polyline(points);\n\n            case 'POLYGON':\n                points = V.getPointsFromSvgNode(this);\n                if (points.length > 1) points.push(points[0]);\n                return new g.Polyline(points);\n\n            case 'PATH':\n                d = this.attr('d');\n                if (!g.Path.isDataSupported(d)) d = V.normalizePathData(d);\n                return new g.Path(d);\n\n            case 'LINE':\n                x1 = parseFloat(this.attr('x1')) || 0;\n                y1 = parseFloat(this.attr('y1')) || 0;\n                x2 = parseFloat(this.attr('x2')) || 0;\n                y2 = parseFloat(this.attr('y2')) || 0;\n                return new g.Line({ x: x1, y: y1 }, { x: x2, y: y2 });\n        }\n\n        // Anything else is a rectangle\n        return this.getBBox();\n    },\n\n    // Find the intersection of a line starting in the center\n    // of the SVG `node` ending in the point `ref`.\n    // `target` is an SVG element to which `node`s transformations are relative to.\n    // In JointJS, `target` is the `paper.viewport` SVG group element.\n    // Note that `ref` point must be in the coordinate system of the `target` for this function to work properly.\n    // Returns a point in the `target` coordinte system (the same system as `ref` is in) if\n    // an intersection is found. Returns `undefined` otherwise.\n    VPrototype.findIntersection = function(ref, target) {\n\n        var svg = this.svg().node;\n        target = target || svg;\n        var bbox = this.getBBox({ target: target });\n        var center = bbox.center();\n\n        if (!bbox.intersectionWithLineFromCenterToPoint(ref)) return undefined;\n\n        var spot;\n        var tagName = this.tagName();\n\n        // Little speed up optimalization for `<rect>` element. We do not do conversion\n        // to path element and sampling but directly calculate the intersection through\n        // a transformed geometrical rectangle.\n        if (tagName === 'RECT') {\n\n            var gRect = new g.Rect(\n                parseFloat(this.attr('x') || 0),\n                parseFloat(this.attr('y') || 0),\n                parseFloat(this.attr('width')),\n                parseFloat(this.attr('height'))\n            );\n            // Get the rect transformation matrix with regards to the SVG document.\n            var rectMatrix = this.getTransformToElement(target);\n            // Decompose the matrix to find the rotation angle.\n            var rectMatrixComponents = V.decomposeMatrix(rectMatrix);\n            // Now we want to rotate the rectangle back so that we\n            // can use `intersectionWithLineFromCenterToPoint()` passing the angle as the second argument.\n            var resetRotation = svg.createSVGTransform();\n            resetRotation.setRotate(-rectMatrixComponents.rotation, center.x, center.y);\n            var rect = V.transformRect(gRect, resetRotation.matrix.multiply(rectMatrix));\n            spot = (new g.Rect(rect)).intersectionWithLineFromCenterToPoint(ref, rectMatrixComponents.rotation);\n\n        } else if (tagName === 'PATH' || tagName === 'POLYGON' || tagName === 'POLYLINE' || tagName === 'CIRCLE' || tagName === 'ELLIPSE') {\n\n            var pathNode = (tagName === 'PATH') ? this : this.convertToPath();\n            var samples = pathNode.sample();\n            var minDistance = Infinity;\n            var closestSamples = [];\n\n            var i, sample, gp, centerDistance, refDistance, distance;\n\n            for (i = 0; i < samples.length; i++) {\n\n                sample = samples[i];\n                // Convert the sample point in the local coordinate system to the global coordinate system.\n                gp = V.createSVGPoint(sample.x, sample.y);\n                gp = gp.matrixTransform(this.getTransformToElement(target));\n                sample = new g.Point(gp);\n                centerDistance = sample.distance(center);\n                // Penalize a higher distance to the reference point by 10%.\n                // This gives better results. This is due to\n                // inaccuracies introduced by rounding errors and getPointAtLength() returns.\n                refDistance = sample.distance(ref) * 1.1;\n                distance = centerDistance + refDistance;\n\n                if (distance < minDistance) {\n                    minDistance = distance;\n                    closestSamples = [{ sample: sample, refDistance: refDistance }];\n                } else if (distance < minDistance + 1) {\n                    closestSamples.push({ sample: sample, refDistance: refDistance });\n                }\n            }\n\n            closestSamples.sort(function(a, b) {\n                return a.refDistance - b.refDistance;\n            });\n\n            if (closestSamples[0]) {\n                spot = closestSamples[0].sample;\n            }\n        }\n\n        return spot;\n    };\n\n    /**\n     * @private\n     * @param {string} name\n     * @param {string} value\n     * @returns {Vectorizer}\n     */\n    VPrototype.setAttribute = function(name, value) {\n\n        var el = this.node;\n\n        if (value === null) {\n            this.removeAttr(name);\n            return this;\n        }\n\n        var qualifiedName = V.qualifyAttr(name);\n\n        if (qualifiedName.ns) {\n            // Attribute names can be namespaced. E.g. `image` elements\n            // have a `xlink:href` attribute to set the source of the image.\n            el.setAttributeNS(qualifiedName.ns, name, value);\n        } else if (name === 'id') {\n            el.id = value;\n        } else {\n            el.setAttribute(name, value);\n        }\n\n        return this;\n    };\n\n    // Create an SVG document element.\n    // If `content` is passed, it will be used as the SVG content of the `<svg>` root element.\n    V.createSvgDocument = function(content) {\n\n        var svg = '<svg xmlns=\"' + ns.xmlns + '\" xmlns:xlink=\"' + ns.xlink + '\" version=\"' + SVGversion + '\">' + (content || '') + '</svg>';\n        var xml = V.parseXML(svg, { async: false });\n        return xml.documentElement;\n    };\n\n    V.idCounter = 0;\n\n    // A function returning a unique identifier for this client session with every call.\n    V.uniqueId = function() {\n\n        return 'v-' + (++V.idCounter);\n    };\n\n    V.toNode = function(el) {\n\n        return V.isV(el) ? el.node : (el.nodeName && el || el[0]);\n    };\n\n    V.ensureId = function(node) {\n\n        node = V.toNode(node);\n        return node.id || (node.id = V.uniqueId());\n    };\n\n    // Replace all spaces with the Unicode No-break space (http://www.fileformat.info/info/unicode/char/a0/index.htm).\n    // IE would otherwise collapse all spaces into one. This is used in the text() method but it is\n    // also exposed so that the programmer can use it in case he needs to. This is useful e.g. in tests\n    // when you want to compare the actual DOM text content without having to add the unicode character in\n    // the place of all spaces.\n    V.sanitizeText = function(text) {\n\n        return (text || '').replace(/ /g, '\\u00A0');\n    };\n\n    V.isUndefined = function(value) {\n\n        return typeof value === 'undefined';\n    };\n\n    V.isString = function(value) {\n\n        return typeof value === 'string';\n    };\n\n    V.isObject = function(value) {\n\n        return value && (typeof value === 'object');\n    };\n\n    V.isArray = Array.isArray;\n\n    V.parseXML = function(data, opt) {\n\n        opt = opt || {};\n\n        var xml;\n\n        try {\n            var parser = new DOMParser();\n\n            if (!V.isUndefined(opt.async)) {\n                parser.async = opt.async;\n            }\n\n            xml = parser.parseFromString(data, 'text/xml');\n        } catch (error) {\n            xml = undefined;\n        }\n\n        if (!xml || xml.getElementsByTagName('parsererror').length) {\n            throw new Error('Invalid XML: ' + data);\n        }\n\n        return xml;\n    };\n\n    /**\n     * @param {string} name\n     * @returns {{ns: string|null, local: string}} namespace and attribute name\n     */\n    V.qualifyAttr = function(name) {\n\n        if (name.indexOf(':') !== -1) {\n            var combinedKey = name.split(':');\n            return {\n                ns: ns[combinedKey[0]],\n                local: combinedKey[1]\n            };\n        }\n\n        return {\n            ns: null,\n            local: name\n        };\n    };\n\n    V.transformRegex = /(\\w+)\\(([^,)]+),?([^)]+)?\\)/gi;\n    V.transformSeparatorRegex = /[ ,]+/;\n    V.transformationListRegex = /^(\\w+)\\((.*)\\)/;\n\n    V.transformStringToMatrix = function(transform) {\n\n        var transformationMatrix = V.createSVGMatrix();\n        var matches = transform && transform.match(V.transformRegex);\n        if (!matches) {\n            return transformationMatrix;\n        }\n\n        for (var i = 0, n = matches.length; i < n; i++) {\n            var transformationString = matches[i];\n\n            var transformationMatch = transformationString.match(V.transformationListRegex);\n            if (transformationMatch) {\n                var sx, sy, tx, ty, angle;\n                var ctm = V.createSVGMatrix();\n                var args = transformationMatch[2].split(V.transformSeparatorRegex);\n                switch (transformationMatch[1].toLowerCase()) {\n                    case 'scale':\n                        sx = parseFloat(args[0]);\n                        sy = (args[1] === undefined) ? sx : parseFloat(args[1]);\n                        ctm = ctm.scaleNonUniform(sx, sy);\n                        break;\n                    case 'translate':\n                        tx = parseFloat(args[0]);\n                        ty = parseFloat(args[1]);\n                        ctm = ctm.translate(tx, ty);\n                        break;\n                    case 'rotate':\n                        angle = parseFloat(args[0]);\n                        tx = parseFloat(args[1]) || 0;\n                        ty = parseFloat(args[2]) || 0;\n                        if (tx !== 0 || ty !== 0) {\n                            ctm = ctm.translate(tx, ty).rotate(angle).translate(-tx, -ty);\n                        } else {\n                            ctm = ctm.rotate(angle);\n                        }\n                        break;\n                    case 'skewx':\n                        angle = parseFloat(args[0]);\n                        ctm = ctm.skewX(angle);\n                        break;\n                    case 'skewy':\n                        angle = parseFloat(args[0]);\n                        ctm = ctm.skewY(angle);\n                        break;\n                    case 'matrix':\n                        ctm.a = parseFloat(args[0]);\n                        ctm.b = parseFloat(args[1]);\n                        ctm.c = parseFloat(args[2]);\n                        ctm.d = parseFloat(args[3]);\n                        ctm.e = parseFloat(args[4]);\n                        ctm.f = parseFloat(args[5]);\n                        break;\n                    default:\n                        continue;\n                }\n\n                transformationMatrix = transformationMatrix.multiply(ctm);\n            }\n\n        }\n        return transformationMatrix;\n    };\n\n    V.matrixToTransformString = function(matrix) {\n        matrix || (matrix = true);\n\n        return 'matrix(' +\n            (matrix.a !== undefined ? matrix.a : 1) + ',' +\n            (matrix.b !== undefined ? matrix.b : 0) + ',' +\n            (matrix.c !== undefined ? matrix.c : 0) + ',' +\n            (matrix.d !== undefined ? matrix.d : 1) + ',' +\n            (matrix.e !== undefined ? matrix.e : 0) + ',' +\n            (matrix.f !== undefined ? matrix.f : 0) +\n            ')';\n    };\n\n    V.parseTransformString = function(transform) {\n\n        var translate, rotate, scale;\n\n        if (transform) {\n\n            var separator = V.transformSeparatorRegex;\n\n            // Allow reading transform string with a single matrix\n            if (transform.trim().indexOf('matrix') >= 0) {\n\n                var matrix = V.transformStringToMatrix(transform);\n                var decomposedMatrix = V.decomposeMatrix(matrix);\n\n                translate = [decomposedMatrix.translateX, decomposedMatrix.translateY];\n                scale = [decomposedMatrix.scaleX, decomposedMatrix.scaleY];\n                rotate = [decomposedMatrix.rotation];\n\n                var transformations = [];\n                if (translate[0] !== 0 || translate[1] !== 0) {\n                    transformations.push('translate(' + translate + ')');\n                }\n                if (scale[0] !== 1 || scale[1] !== 1) {\n                    transformations.push('scale(' + scale + ')');\n                }\n                if (rotate[0] !== 0) {\n                    transformations.push('rotate(' + rotate + ')');\n                }\n                transform = transformations.join(' ');\n\n            } else {\n\n                var translateMatch = transform.match(/translate\\((.*?)\\)/);\n                if (translateMatch) {\n                    translate = translateMatch[1].split(separator);\n                }\n                var rotateMatch = transform.match(/rotate\\((.*?)\\)/);\n                if (rotateMatch) {\n                    rotate = rotateMatch[1].split(separator);\n                }\n                var scaleMatch = transform.match(/scale\\((.*?)\\)/);\n                if (scaleMatch) {\n                    scale = scaleMatch[1].split(separator);\n                }\n            }\n        }\n\n        var sx = (scale && scale[0]) ? parseFloat(scale[0]) : 1;\n\n        return {\n            value: transform,\n            translate: {\n                tx: (translate && translate[0]) ? parseInt(translate[0], 10) : 0,\n                ty: (translate && translate[1]) ? parseInt(translate[1], 10) : 0\n            },\n            rotate: {\n                angle: (rotate && rotate[0]) ? parseInt(rotate[0], 10) : 0,\n                cx: (rotate && rotate[1]) ? parseInt(rotate[1], 10) : undefined,\n                cy: (rotate && rotate[2]) ? parseInt(rotate[2], 10) : undefined\n            },\n            scale: {\n                sx: sx,\n                sy: (scale && scale[1]) ? parseFloat(scale[1]) : sx\n            }\n        };\n    };\n\n    V.deltaTransformPoint = function(matrix, point) {\n\n        var dx = point.x * matrix.a + point.y * matrix.c + 0;\n        var dy = point.x * matrix.b + point.y * matrix.d + 0;\n        return { x: dx, y: dy };\n    };\n\n    V.decomposeMatrix = function(matrix) {\n\n        // @see https://gist.github.com/2052247\n\n        // calculate delta transform point\n        var px = V.deltaTransformPoint(matrix, { x: 0, y: 1 });\n        var py = V.deltaTransformPoint(matrix, { x: 1, y: 0 });\n\n        // calculate skew\n        var skewX = ((180 / PI) * atan2(px.y, px.x) - 90);\n        var skewY = ((180 / PI) * atan2(py.y, py.x));\n\n        return {\n\n            translateX: matrix.e,\n            translateY: matrix.f,\n            scaleX: sqrt(matrix.a * matrix.a + matrix.b * matrix.b),\n            scaleY: sqrt(matrix.c * matrix.c + matrix.d * matrix.d),\n            skewX: skewX,\n            skewY: skewY,\n            rotation: skewX // rotation is the same as skew x\n        };\n    };\n\n    // Return the `scale` transformation from the following equation:\n    // `translate(tx, ty) . rotate(angle) . scale(sx, sy) === matrix(a,b,c,d,e,f)`\n    V.matrixToScale = function(matrix) {\n\n        var a,b,c,d;\n        if (matrix) {\n            a = V.isUndefined(matrix.a) ? 1 : matrix.a;\n            d = V.isUndefined(matrix.d) ? 1 : matrix.d;\n            b = matrix.b;\n            c = matrix.c;\n        } else {\n            a = d = 1;\n        }\n        return {\n            sx: b ? sqrt(a * a + b * b) : a,\n            sy: c ? sqrt(c * c + d * d) : d\n        };\n    },\n\n    // Return the `rotate` transformation from the following equation:\n    // `translate(tx, ty) . rotate(angle) . scale(sx, sy) === matrix(a,b,c,d,e,f)`\n    V.matrixToRotate = function(matrix) {\n\n        var p = { x: 0, y: 1 };\n        if (matrix) {\n            p =  V.deltaTransformPoint(matrix, p);\n        }\n\n        return {\n            angle: g.normalizeAngle(g.toDeg(atan2(p.y, p.x)) - 90)\n        };\n    },\n\n    // Return the `translate` transformation from the following equation:\n    // `translate(tx, ty) . rotate(angle) . scale(sx, sy) === matrix(a,b,c,d,e,f)`\n    V.matrixToTranslate = function(matrix) {\n\n        return {\n            tx: (matrix && matrix.e) || 0,\n            ty: (matrix && matrix.f) || 0\n        };\n    },\n\n    V.isV = function(object) {\n\n        return object instanceof V;\n    };\n\n    // For backwards compatibility:\n    V.isVElement = V.isV;\n\n    // Element implements `getBBox()`, `getCTM()` and `getScreenCTM()`\n    // https://developer.mozilla.org/en-US/docs/Web/API/SVGGraphicsElement\n    V.isSVGGraphicsElement = function(node) {\n        if (!node) return false;\n        node = V.toNode(node);\n        // IE/Edge does not implement SVGGraphicsElement interface, thus check for `getScreenCTM` below\n        return node instanceof SVGElement && typeof node.getScreenCTM === 'function';\n    };\n\n    var svgDocument = V('svg').node;\n\n    V.createSVGMatrix = function(matrix) {\n\n        var svgMatrix = svgDocument.createSVGMatrix();\n        for (var component in matrix) {\n            svgMatrix[component] = matrix[component];\n        }\n\n        return svgMatrix;\n    };\n\n    V.createSVGTransform = function(matrix) {\n\n        if (!V.isUndefined(matrix)) {\n\n            if (!(matrix instanceof SVGMatrix)) {\n                matrix = V.createSVGMatrix(matrix);\n            }\n\n            return svgDocument.createSVGTransformFromMatrix(matrix);\n        }\n\n        return svgDocument.createSVGTransform();\n    };\n\n    V.createSVGPoint = function(x, y) {\n\n        var p = svgDocument.createSVGPoint();\n        p.x = x;\n        p.y = y;\n        return p;\n    };\n\n    V.transformRect = function(r, matrix) {\n\n        var p = svgDocument.createSVGPoint();\n\n        p.x = r.x;\n        p.y = r.y;\n        var corner1 = p.matrixTransform(matrix);\n\n        p.x = r.x + r.width;\n        p.y = r.y;\n        var corner2 = p.matrixTransform(matrix);\n\n        p.x = r.x + r.width;\n        p.y = r.y + r.height;\n        var corner3 = p.matrixTransform(matrix);\n\n        p.x = r.x;\n        p.y = r.y + r.height;\n        var corner4 = p.matrixTransform(matrix);\n\n        var minX = min(corner1.x, corner2.x, corner3.x, corner4.x);\n        var maxX = max(corner1.x, corner2.x, corner3.x, corner4.x);\n        var minY = min(corner1.y, corner2.y, corner3.y, corner4.y);\n        var maxY = max(corner1.y, corner2.y, corner3.y, corner4.y);\n\n        return new g.Rect(minX, minY, maxX - minX, maxY - minY);\n    };\n\n    V.transformPoint = function(p, matrix) {\n\n        return new g.Point(V.createSVGPoint(p.x, p.y).matrixTransform(matrix));\n    };\n\n    V.transformLine = function(l, matrix) {\n\n        return new g.Line(\n            V.transformPoint(l.start, matrix),\n            V.transformPoint(l.end, matrix)\n        );\n    };\n\n    V.transformPolyline = function(p, matrix) {\n\n        var inPoints = (p instanceof g.Polyline) ? p.points : p;\n        if (!V.isArray(inPoints)) inPoints = [];\n        var outPoints = [];\n        for (var i = 0, n = inPoints.length; i < n; i++) outPoints[i] = V.transformPoint(inPoints[i], matrix);\n        return new g.Polyline(outPoints);\n    },\n\n    // Convert a style represented as string (e.g. `'fill=\"blue\"; stroke=\"red\"'`) to\n    // an object (`{ fill: 'blue', stroke: 'red' }`).\n    V.styleToObject = function(styleString) {\n        var ret = {};\n        var styles = styleString.split(';');\n        for (var i = 0; i < styles.length; i++) {\n            var style = styles[i];\n            var pair = style.split('=');\n            ret[pair[0].trim()] = pair[1].trim();\n        }\n        return ret;\n    };\n\n    // Inspired by d3.js https://github.com/mbostock/d3/blob/master/src/svg/arc.js\n    V.createSlicePathData = function(innerRadius, outerRadius, startAngle, endAngle) {\n\n        var svgArcMax = 2 * PI - 1e-6;\n        var r0 = innerRadius;\n        var r1 = outerRadius;\n        var a0 = startAngle;\n        var a1 = endAngle;\n        var da = (a1 < a0 && (da = a0, a0 = a1, a1 = da), a1 - a0);\n        var df = da < PI ? '0' : '1';\n        var c0 = cos(a0);\n        var s0 = sin(a0);\n        var c1 = cos(a1);\n        var s1 = sin(a1);\n\n        return (da >= svgArcMax)\n            ? (r0\n                ? 'M0,' + r1\n                + 'A' + r1 + ',' + r1 + ' 0 1,1 0,' + (-r1)\n                + 'A' + r1 + ',' + r1 + ' 0 1,1 0,' + r1\n                + 'M0,' + r0\n                + 'A' + r0 + ',' + r0 + ' 0 1,0 0,' + (-r0)\n                + 'A' + r0 + ',' + r0 + ' 0 1,0 0,' + r0\n                + 'Z'\n                : 'M0,' + r1\n                + 'A' + r1 + ',' + r1 + ' 0 1,1 0,' + (-r1)\n                + 'A' + r1 + ',' + r1 + ' 0 1,1 0,' + r1\n                + 'Z')\n            : (r0\n                ? 'M' + r1 * c0 + ',' + r1 * s0\n                + 'A' + r1 + ',' + r1 + ' 0 ' + df + ',1 ' + r1 * c1 + ',' + r1 * s1\n                + 'L' + r0 * c1 + ',' + r0 * s1\n                + 'A' + r0 + ',' + r0 + ' 0 ' + df + ',0 ' + r0 * c0 + ',' + r0 * s0\n                + 'Z'\n                : 'M' + r1 * c0 + ',' + r1 * s0\n                + 'A' + r1 + ',' + r1 + ' 0 ' + df + ',1 ' + r1 * c1 + ',' + r1 * s1\n                + 'L0,0'\n                + 'Z');\n    };\n\n    // Merge attributes from object `b` with attributes in object `a`.\n    // Note that this modifies the object `a`.\n    // Also important to note that attributes are merged but CSS classes are concatenated.\n    V.mergeAttrs = function(a, b) {\n\n        for (var attr in b) {\n\n            if (attr === 'class') {\n                // Concatenate classes.\n                a[attr] = a[attr] ? a[attr] + ' ' + b[attr] : b[attr];\n            } else if (attr === 'style') {\n                // `style` attribute can be an object.\n                if (V.isObject(a[attr]) && V.isObject(b[attr])) {\n                    // `style` stored in `a` is an object.\n                    a[attr] = V.mergeAttrs(a[attr], b[attr]);\n                } else if (V.isObject(a[attr])) {\n                    // `style` in `a` is an object but it's a string in `b`.\n                    // Convert the style represented as a string to an object in `b`.\n                    a[attr] = V.mergeAttrs(a[attr], V.styleToObject(b[attr]));\n                } else if (V.isObject(b[attr])) {\n                    // `style` in `a` is a string, in `b` it's an object.\n                    a[attr] = V.mergeAttrs(V.styleToObject(a[attr]), b[attr]);\n                } else {\n                    // Both styles are strings.\n                    a[attr] = V.mergeAttrs(V.styleToObject(a[attr]), V.styleToObject(b[attr]));\n                }\n            } else {\n                a[attr] = b[attr];\n            }\n        }\n\n        return a;\n    };\n\n    V.annotateString = function(t, annotations, opt) {\n\n        annotations = annotations || [];\n        opt = opt || {};\n\n        var offset = opt.offset || 0;\n        var compacted = [];\n        var batch;\n        var ret = [];\n        var item;\n        var prev;\n\n        for (var i = 0; i < t.length; i++) {\n\n            item = ret[i] = t[i];\n\n            for (var j = 0; j < annotations.length; j++) {\n\n                var annotation = annotations[j];\n                var start = annotation.start + offset;\n                var end = annotation.end + offset;\n\n                if (i >= start && i < end) {\n                    // Annotation applies.\n                    if (V.isObject(item)) {\n                        // There is more than one annotation to be applied => Merge attributes.\n                        item.attrs = V.mergeAttrs(V.mergeAttrs({}, item.attrs), annotation.attrs);\n                    } else {\n                        item = ret[i] = { t: t[i], attrs: annotation.attrs };\n                    }\n                    if (opt.includeAnnotationIndices) {\n                        (item.annotations || (item.annotations = [])).push(j);\n                    }\n                }\n            }\n\n            prev = ret[i - 1];\n\n            if (!prev) {\n\n                batch = item;\n\n            } else if (V.isObject(item) && V.isObject(prev)) {\n                // Both previous item and the current one are annotations. If the attributes\n                // didn't change, merge the text.\n                if (JSON.stringify(item.attrs) === JSON.stringify(prev.attrs)) {\n                    batch.t += item.t;\n                } else {\n                    compacted.push(batch);\n                    batch = item;\n                }\n\n            } else if (V.isObject(item)) {\n                // Previous item was a string, current item is an annotation.\n                compacted.push(batch);\n                batch = item;\n\n            } else if (V.isObject(prev)) {\n                // Previous item was an annotation, current item is a string.\n                compacted.push(batch);\n                batch = item;\n\n            } else {\n                // Both previous and current item are strings.\n                batch = (batch || '') + item;\n            }\n        }\n\n        if (batch) {\n            compacted.push(batch);\n        }\n\n        return compacted;\n    };\n\n    V.findAnnotationsAtIndex = function(annotations, index) {\n\n        var found = [];\n\n        if (annotations) {\n\n            annotations.forEach(function(annotation) {\n\n                if (annotation.start < index && index <= annotation.end) {\n                    found.push(annotation);\n                }\n            });\n        }\n\n        return found;\n    };\n\n    V.findAnnotationsBetweenIndexes = function(annotations, start, end) {\n\n        var found = [];\n\n        if (annotations) {\n\n            annotations.forEach(function(annotation) {\n\n                if ((start >= annotation.start && start < annotation.end) || (end > annotation.start && end <= annotation.end) || (annotation.start >= start && annotation.end < end)) {\n                    found.push(annotation);\n                }\n            });\n        }\n\n        return found;\n    };\n\n    // Shift all the text annotations after character `index` by `offset` positions.\n    V.shiftAnnotations = function(annotations, index, offset) {\n\n        if (annotations) {\n\n            annotations.forEach(function(annotation) {\n\n                if (annotation.start < index && annotation.end >= index) {\n                    annotation.end += offset;\n                } else if (annotation.start >= index) {\n                    annotation.start += offset;\n                    annotation.end += offset;\n                }\n            });\n        }\n\n        return annotations;\n    };\n\n    V.convertLineToPathData = function(line) {\n\n        line = V(line);\n        var d = [\n            'M', line.attr('x1'), line.attr('y1'),\n            'L', line.attr('x2'), line.attr('y2')\n        ].join(' ');\n        return d;\n    };\n\n    V.convertPolygonToPathData = function(polygon) {\n\n        var points = V.getPointsFromSvgNode(polygon);\n        if (points.length === 0) return null;\n\n        return V.svgPointsToPath(points) + ' Z';\n    };\n\n    V.convertPolylineToPathData = function(polyline) {\n\n        var points = V.getPointsFromSvgNode(polyline);\n        if (points.length === 0) return null;\n\n        return V.svgPointsToPath(points);\n    };\n\n    V.svgPointsToPath = function(points) {\n\n        for (var i = 0, n = points.length; i < n; i++) {\n            points[i] = points[i].x + ' ' + points[i].y;\n        }\n\n        return 'M ' + points.join(' L');\n    };\n\n    V.getPointsFromSvgNode = function(node) {\n\n        node = V.toNode(node);\n        var points = [];\n        var nodePoints = node.points;\n        if (nodePoints) {\n            for (var i = 0, n = nodePoints.numberOfItems; i < n; i++) {\n                points.push(nodePoints.getItem(i));\n            }\n        }\n\n        return points;\n    };\n\n    V.KAPPA = 0.551784;\n\n    V.convertCircleToPathData = function(circle) {\n\n        circle = V(circle);\n        var cx = parseFloat(circle.attr('cx')) || 0;\n        var cy = parseFloat(circle.attr('cy')) || 0;\n        var r = parseFloat(circle.attr('r'));\n        var cd = r * V.KAPPA; // Control distance.\n\n        var d = [\n            'M', cx, cy - r,    // Move to the first point.\n            'C', cx + cd, cy - r, cx + r, cy - cd, cx + r, cy, // I. Quadrant.\n            'C', cx + r, cy + cd, cx + cd, cy + r, cx, cy + r, // II. Quadrant.\n            'C', cx - cd, cy + r, cx - r, cy + cd, cx - r, cy, // III. Quadrant.\n            'C', cx - r, cy - cd, cx - cd, cy - r, cx, cy - r, // IV. Quadrant.\n            'Z'\n        ].join(' ');\n        return d;\n    };\n\n    V.convertEllipseToPathData = function(ellipse) {\n\n        ellipse = V(ellipse);\n        var cx = parseFloat(ellipse.attr('cx')) || 0;\n        var cy = parseFloat(ellipse.attr('cy')) || 0;\n        var rx = parseFloat(ellipse.attr('rx'));\n        var ry = parseFloat(ellipse.attr('ry')) || rx;\n        var cdx = rx * V.KAPPA; // Control distance x.\n        var cdy = ry * V.KAPPA; // Control distance y.\n\n        var d = [\n            'M', cx, cy - ry,    // Move to the first point.\n            'C', cx + cdx, cy - ry, cx + rx, cy - cdy, cx + rx, cy, // I. Quadrant.\n            'C', cx + rx, cy + cdy, cx + cdx, cy + ry, cx, cy + ry, // II. Quadrant.\n            'C', cx - cdx, cy + ry, cx - rx, cy + cdy, cx - rx, cy, // III. Quadrant.\n            'C', cx - rx, cy - cdy, cx - cdx, cy - ry, cx, cy - ry, // IV. Quadrant.\n            'Z'\n        ].join(' ');\n        return d;\n    };\n\n    V.convertRectToPathData = function(rect) {\n\n        rect = V(rect);\n\n        return V.rectToPath({\n            x: parseFloat(rect.attr('x')) || 0,\n            y: parseFloat(rect.attr('y')) || 0,\n            width: parseFloat(rect.attr('width')) || 0,\n            height: parseFloat(rect.attr('height')) || 0,\n            rx: parseFloat(rect.attr('rx')) || 0,\n            ry: parseFloat(rect.attr('ry')) || 0\n        });\n    };\n\n    // Convert a rectangle to SVG path commands. `r` is an object of the form:\n    // `{ x: [number], y: [number], width: [number], height: [number], top-ry: [number], top-ry: [number], bottom-rx: [number], bottom-ry: [number] }`,\n    // where `x, y, width, height` are the usual rectangle attributes and [top-/bottom-]rx/ry allows for\n    // specifying radius of the rectangle for all its sides (as opposed to the built-in SVG rectangle\n    // that has only `rx` and `ry` attributes).\n    V.rectToPath = function(r) {\n\n        var d;\n        var x = r.x;\n        var y = r.y;\n        var width = r.width;\n        var height = r.height;\n        var topRx = min(r.rx || r['top-rx'] || 0, width / 2);\n        var bottomRx = min(r.rx || r['bottom-rx'] || 0, width / 2);\n        var topRy = min(r.ry || r['top-ry'] || 0, height / 2);\n        var bottomRy = min(r.ry || r['bottom-ry'] || 0, height / 2);\n\n        if (topRx || bottomRx || topRy || bottomRy) {\n            d = [\n                'M', x, y + topRy,\n                'v', height - topRy - bottomRy,\n                'a', bottomRx, bottomRy, 0, 0, 0, bottomRx, bottomRy,\n                'h', width - 2 * bottomRx,\n                'a', bottomRx, bottomRy, 0, 0, 0, bottomRx, -bottomRy,\n                'v', -(height - bottomRy - topRy),\n                'a', topRx, topRy, 0, 0, 0, -topRx, -topRy,\n                'h', -(width - 2 * topRx),\n                'a', topRx, topRy, 0, 0, 0, -topRx, topRy,\n                'Z'\n            ];\n        } else {\n            d = [\n                'M', x, y,\n                'H', x + width,\n                'V', y + height,\n                'H', x,\n                'V', y,\n                'Z'\n            ];\n        }\n\n        return d.join(' ');\n    };\n\n    // Take a path data string\n    // Return a normalized path data string\n    // If data cannot be parsed, return 'M 0 0'\n    // Adapted from Rappid normalizePath polyfill\n    // Highly inspired by Raphael Library (www.raphael.com)\n    V.normalizePathData = (function() {\n\n        var spaces = '\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029';\n        var pathCommand = new RegExp('([a-z])[' + spaces + ',]*((-?\\\\d*\\\\.?\\\\d*(?:e[\\\\-+]?\\\\d+)?[' + spaces + ']*,?[' + spaces + ']*)+)', 'ig');\n        var pathValues = new RegExp('(-?\\\\d*\\\\.?\\\\d*(?:e[\\\\-+]?\\\\d+)?)[' + spaces + ']*,?[' + spaces + ']*', 'ig');\n\n        var math = Math;\n        var PI = math.PI;\n        var sin = math.sin;\n        var cos = math.cos;\n        var tan = math.tan;\n        var asin = math.asin;\n        var sqrt = math.sqrt;\n        var abs = math.abs;\n\n        function q2c(x1, y1, ax, ay, x2, y2) {\n\n            var _13 = 1 / 3;\n            var _23 = 2 / 3;\n            return [(_13 * x1) + (_23 * ax), (_13 * y1) + (_23 * ay), (_13 * x2) + (_23 * ax), (_13 * y2) + (_23 * ay), x2, y2];\n        }\n\n        function a2c(x1, y1, rx, ry, angle, large_arc_flag, sweep_flag, x2, y2, recursive) {\n            // for more information of where this math came from visit:\n            // http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\n\n            var _120 = (PI * 120) / 180;\n            var rad = (PI / 180) * (+angle || 0);\n            var res = [];\n            var xy;\n\n            var rotate = function(x, y, rad) {\n\n                var X = (x * cos(rad)) - (y * sin(rad));\n                var Y = (x * sin(rad)) + (y * cos(rad));\n                return { x: X, y: Y };\n            };\n\n            if (!recursive) {\n                xy = rotate(x1, y1, -rad);\n                x1 = xy.x;\n                y1 = xy.y;\n\n                xy = rotate(x2, y2, -rad);\n                x2 = xy.x;\n                y2 = xy.y;\n\n                var x = (x1 - x2) / 2;\n                var y = (y1 - y2) / 2;\n                var h = ((x * x) / (rx * rx)) + ((y * y) / (ry * ry));\n\n                if (h > 1) {\n                    h = sqrt(h);\n                    rx = h * rx;\n                    ry = h * ry;\n                }\n\n                var rx2 = rx * rx;\n                var ry2 = ry * ry;\n\n                var k = ((large_arc_flag == sweep_flag) ? -1 : 1) * sqrt(abs(((rx2 * ry2) - (rx2 * y * y) - (ry2 * x * x)) / ((rx2 * y * y) + (ry2 * x * x))));\n\n                var cx = ((k * rx * y) / ry) + ((x1 + x2) / 2);\n                var cy = ((k * -ry * x) / rx) + ((y1 + y2) / 2);\n\n                var f1 = asin(((y1 - cy) / ry).toFixed(9));\n                var f2 = asin(((y2 - cy) / ry).toFixed(9));\n\n                f1 = ((x1 < cx) ? (PI - f1) : f1);\n                f2 = ((x2 < cx) ? (PI - f2) : f2);\n\n                if (f1 < 0) f1 = (PI * 2) + f1;\n                if (f2 < 0) f2 = (PI * 2) + f2;\n\n                if ((sweep_flag && f1) > f2) f1 = f1 - (PI * 2);\n                if ((!sweep_flag && f2) > f1) f2 = f2 - (PI * 2);\n\n            } else {\n                f1 = recursive[0];\n                f2 = recursive[1];\n                cx = recursive[2];\n                cy = recursive[3];\n            }\n\n            var df = f2 - f1;\n\n            if (abs(df) > _120) {\n                var f2old = f2;\n                var x2old = x2;\n                var y2old = y2;\n\n                f2 = f1 + (_120 * (((sweep_flag && f2) > f1) ? 1 : -1));\n                x2 = cx + (rx * cos(f2));\n                y2 = cy + (ry * sin(f2));\n\n                res = a2c(x2, y2, rx, ry, angle, 0, sweep_flag, x2old, y2old, [f2, f2old, cx, cy]);\n            }\n\n            df = f2 - f1;\n\n            var c1 = cos(f1);\n            var s1 = sin(f1);\n            var c2 = cos(f2);\n            var s2 = sin(f2);\n\n            var t = tan(df / 4);\n\n            var hx = (4 / 3) * (rx * t);\n            var hy = (4 / 3) * (ry * t);\n\n            var m1 = [x1, y1];\n            var m2 = [x1 + (hx * s1), y1 - (hy * c1)];\n            var m3 = [x2 + (hx * s2), y2 - (hy * c2)];\n            var m4 = [x2, y2];\n\n            m2[0] = (2 * m1[0]) - m2[0];\n            m2[1] = (2 * m1[1]) - m2[1];\n\n            if (recursive) {\n                return [m2, m3, m4].concat(res);\n\n            } else {\n                res = [m2, m3, m4].concat(res).join().split(',');\n\n                var newres = [];\n                var ii = res.length;\n                for (var i = 0; i < ii; i++) {\n                    newres[i] = (i % 2) ? rotate(res[i - 1], res[i], rad).y : rotate(res[i], res[i + 1], rad).x;\n                }\n\n                return newres;\n            }\n        }\n\n        function parsePathString(pathString) {\n\n            if (!pathString) return null;\n\n            var paramCounts = { a: 7, c: 6, h: 1, l: 2, m: 2, q: 4, s: 4, t: 2, v: 1, z: 0 };\n            var data = [];\n\n            String(pathString).replace(pathCommand, function(a, b, c) {\n\n                var params = [];\n                var name = b.toLowerCase();\n                c.replace(pathValues, function(a, b) {\n                    if (b) params.push(+b);\n                });\n\n                if ((name === 'm') && (params.length > 2)) {\n                    data.push([b].concat(params.splice(0, 2)));\n                    name = 'l';\n                    b = ((b === 'm') ? 'l' : 'L');\n                }\n\n                while (params.length >= paramCounts[name]) {\n                    data.push([b].concat(params.splice(0, paramCounts[name])));\n                    if (!paramCounts[name]) break;\n                }\n            });\n\n            return data;\n        }\n\n        function pathToAbsolute(pathArray) {\n\n            if (!Array.isArray(pathArray) || !Array.isArray(pathArray && pathArray[0])) { // rough assumption\n                pathArray = parsePathString(pathArray);\n            }\n\n            // if invalid string, return 'M 0 0'\n            if (!pathArray || !pathArray.length) return [['M', 0, 0]];\n\n            var res = [];\n            var x = 0;\n            var y = 0;\n            var mx = 0;\n            var my = 0;\n            var start = 0;\n            var pa0;\n\n            var ii = pathArray.length;\n            for (var i = start; i < ii; i++) {\n\n                var r = [];\n                res.push(r);\n\n                var pa = pathArray[i];\n                pa0 = pa[0];\n\n                if (pa0 != pa0.toUpperCase()) {\n                    r[0] = pa0.toUpperCase();\n\n                    var jj;\n                    var j;\n                    switch (r[0]) {\n                        case 'A':\n                            r[1] = pa[1];\n                            r[2] = pa[2];\n                            r[3] = pa[3];\n                            r[4] = pa[4];\n                            r[5] = pa[5];\n                            r[6] = +pa[6] + x;\n                            r[7] = +pa[7] + y;\n                            break;\n\n                        case 'V':\n                            r[1] = +pa[1] + y;\n                            break;\n\n                        case 'H':\n                            r[1] = +pa[1] + x;\n                            break;\n\n                        case 'M':\n                            mx = +pa[1] + x;\n                            my = +pa[2] + y;\n\n                            jj = pa.length;\n                            for (j = 1; j < jj; j++) {\n                                r[j] = +pa[j] + ((j % 2) ? x : y);\n                            }\n                            break;\n\n                        default:\n                            jj = pa.length;\n                            for (j = 1; j < jj; j++) {\n                                r[j] = +pa[j] + ((j % 2) ? x : y);\n                            }\n                            break;\n                    }\n                } else {\n                    var kk = pa.length;\n                    for (var k = 0; k < kk; k++) {\n                        r[k] = pa[k];\n                    }\n                }\n\n                switch (r[0]) {\n                    case 'Z':\n                        x = +mx;\n                        y = +my;\n                        break;\n\n                    case 'H':\n                        x = r[1];\n                        break;\n\n                    case 'V':\n                        y = r[1];\n                        break;\n\n                    case 'M':\n                        mx = r[r.length - 2];\n                        my = r[r.length - 1];\n                        x = r[r.length - 2];\n                        y = r[r.length - 1];\n                        break;\n\n                    default:\n                        x = r[r.length - 2];\n                        y = r[r.length - 1];\n                        break;\n                }\n            }\n\n            return res;\n        }\n\n        function normalize(path) {\n\n            var p = pathToAbsolute(path);\n            var attrs = { x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0, qx: null, qy: null };\n\n            function processPath(path, d, pcom) {\n\n                var nx, ny;\n\n                if (!path) return ['C', d.x, d.y, d.x, d.y, d.x, d.y];\n\n                if (!(path[0] in { T: 1, Q: 1 })) {\n                    d.qx = null;\n                    d.qy = null;\n                }\n\n                switch (path[0]) {\n                    case 'M':\n                        d.X = path[1];\n                        d.Y = path[2];\n                        break;\n\n                    case 'A':\n                        path = ['C'].concat(a2c.apply(0, [d.x, d.y].concat(path.slice(1))));\n                        break;\n\n                    case 'S':\n                        if (pcom === 'C' || pcom === 'S') { // In 'S' case we have to take into account, if the previous command is C/S.\n                            nx = (d.x * 2) - d.bx;          // And reflect the previous\n                            ny = (d.y * 2) - d.by;          // command's control point relative to the current point.\n                        }\n                        else {                            // or some else or nothing\n                            nx = d.x;\n                            ny = d.y;\n                        }\n                        path = ['C', nx, ny].concat(path.slice(1));\n                        break;\n\n                    case 'T':\n                        if (pcom === 'Q' || pcom === 'T') { // In 'T' case we have to take into account, if the previous command is Q/T.\n                            d.qx = (d.x * 2) - d.qx;        // And make a reflection similar\n                            d.qy = (d.y * 2) - d.qy;        // to case 'S'.\n                        }\n                        else {                            // or something else or nothing\n                            d.qx = d.x;\n                            d.qy = d.y;\n                        }\n                        path = ['C'].concat(q2c(d.x, d.y, d.qx, d.qy, path[1], path[2]));\n                        break;\n\n                    case 'Q':\n                        d.qx = path[1];\n                        d.qy = path[2];\n                        path = ['C'].concat(q2c(d.x, d.y, path[1], path[2], path[3], path[4]));\n                        break;\n\n                    case 'H':\n                        path = ['L'].concat(path[1], d.y);\n                        break;\n\n                    case 'V':\n                        path = ['L'].concat(d.x, path[1]);\n                        break;\n\n                    case 'L':\n                        break;\n\n                    case 'Z':\n                        break;\n                }\n\n                return path;\n            }\n\n            function fixArc(pp, i) {\n\n                if (pp[i].length > 7) {\n\n                    pp[i].shift();\n                    var pi = pp[i];\n\n                    while (pi.length) {\n                        pcoms[i] = 'A'; // if created multiple 'C's, their original seg is saved\n                        pp.splice(i++, 0, ['C'].concat(pi.splice(0, 6)));\n                    }\n\n                    pp.splice(i, 1);\n                    ii = p.length;\n                }\n            }\n\n            var pcoms = []; // path commands of original path p\n            var pfirst = ''; // temporary holder for original path command\n            var pcom = ''; // holder for previous path command of original path\n\n            var ii = p.length;\n            for (var i = 0; i < ii; i++) {\n                if (p[i]) pfirst = p[i][0]; // save current path command\n\n                if (pfirst !== 'C') { // C is not saved yet, because it may be result of conversion\n                    pcoms[i] = pfirst; // Save current path command\n                    if (i > 0) pcom = pcoms[i - 1]; // Get previous path command pcom\n                }\n\n                p[i] = processPath(p[i], attrs, pcom); // Previous path command is inputted to processPath\n\n                if (pcoms[i] !== 'A' && pfirst === 'C') pcoms[i] = 'C'; // 'A' is the only command\n                // which may produce multiple 'C's\n                // so we have to make sure that 'C' is also 'C' in original path\n\n                fixArc(p, i); // fixArc adds also the right amount of 'A's to pcoms\n\n                var seg = p[i];\n                var seglen = seg.length;\n\n                attrs.x = seg[seglen - 2];\n                attrs.y = seg[seglen - 1];\n\n                attrs.bx = parseFloat(seg[seglen - 4]) || attrs.x;\n                attrs.by = parseFloat(seg[seglen - 3]) || attrs.y;\n            }\n\n            // make sure normalized path data string starts with an M segment\n            if (!p[0][0] || p[0][0] !== 'M') {\n                p.unshift(['M', 0, 0]);\n            }\n\n            return p;\n        }\n\n        return function(pathData) {\n            return normalize(pathData).join(',').split(',').join(' ');\n        };\n    })();\n\n    V.namespace = ns;\n\n    return V;\n\n})();\n\n// Global namespace.\n\nvar joint = {\n\n    version: '2.2.1',\n\n    config: {\n        // The class name prefix config is for advanced use only.\n        // Be aware that if you change the prefix, the JointJS CSS will no longer function properly.\n        classNamePrefix: 'joint-',\n        defaultTheme: 'default'\n    },\n\n    // `joint.dia` namespace.\n    dia: {},\n\n    // `joint.ui` namespace.\n    ui: {},\n\n    // `joint.layout` namespace.\n    layout: {},\n\n    // `joint.shapes` namespace.\n    shapes: {},\n\n    // `joint.format` namespace.\n    format: {},\n\n    // `joint.connectors` namespace.\n    connectors: {},\n\n    // `joint.highlighters` namespace.\n    highlighters: {},\n\n    // `joint.routers` namespace.\n    routers: {},\n\n    // `joint.anchors` namespace.\n    anchors: {},\n\n    // `joint.connectionPoints` namespace.\n    connectionPoints: {},\n\n    // `joint.connectionStrategies` namespace.\n    connectionStrategies: {},\n\n    // `joint.linkTools` namespace.\n    linkTools: {},\n\n    // `joint.mvc` namespace.\n    mvc: {\n        views: {}\n    },\n\n    setTheme: function(theme, opt) {\n\n        opt = opt || {};\n\n        joint.util.invoke(joint.mvc.views, 'setTheme', theme, opt);\n\n        // Update the default theme on the view prototype.\n        joint.mvc.View.prototype.defaultTheme = theme;\n    },\n\n    // `joint.env` namespace.\n    env: {\n\n        _results: {},\n\n        _tests: {\n\n            svgforeignobject: function() {\n                return !!document.createElementNS &&\n              /SVGForeignObject/.test(({}).toString.call(document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject')));\n            }\n        },\n\n        addTest: function(name, fn) {\n\n            return joint.env._tests[name] = fn;\n        },\n\n        test: function(name) {\n\n            var fn = joint.env._tests[name];\n\n            if (!fn) {\n                throw new Error('Test not defined (\"' + name + '\"). Use `joint.env.addTest(name, fn) to add a new test.`');\n            }\n\n            var result = joint.env._results[name];\n\n            if (typeof result !== 'undefined') {\n                return result;\n            }\n\n            try {\n                result = fn();\n            } catch (error) {\n                result = false;\n            }\n\n            // Cache the test result.\n            joint.env._results[name] = result;\n\n            return result;\n        }\n    },\n\n    util: {\n\n        // Return a simple hash code from a string. See http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/.\n        hashCode: function(str) {\n\n            var hash = 0;\n            if (str.length == 0) return hash;\n            for (var i = 0; i < str.length; i++) {\n                var c = str.charCodeAt(i);\n                hash = ((hash << 5) - hash) + c;\n                hash = hash & hash; // Convert to 32bit integer\n            }\n            return hash;\n        },\n\n        getByPath: function(obj, path, delim) {\n\n            var keys = Array.isArray(path) ? path.slice() : path.split(delim || '/');\n            var key;\n\n            while (keys.length) {\n                key = keys.shift();\n                if (Object(obj) === obj && key in obj) {\n                    obj = obj[key];\n                } else {\n                    return undefined;\n                }\n            }\n            return obj;\n        },\n\n        setByPath: function(obj, path, value, delim) {\n\n            var keys = Array.isArray(path) ? path : path.split(delim || '/');\n\n            var diver = obj;\n            var i = 0;\n\n            for (var len = keys.length; i < len - 1; i++) {\n                // diver creates an empty object if there is no nested object under such a key.\n                // This means that one can populate an empty nested object with setByPath().\n                diver = diver[keys[i]] || (diver[keys[i]] = {});\n            }\n            diver[keys[len - 1]] = value;\n\n            return obj;\n        },\n\n        unsetByPath: function(obj, path, delim) {\n\n            delim = delim || '/';\n\n            var pathArray = Array.isArray(path) ? path.slice() : path.split(delim);\n\n            var propertyToRemove = pathArray.pop();\n            if (pathArray.length > 0) {\n\n                // unsetting a nested attribute\n                var parent = joint.util.getByPath(obj, pathArray, delim);\n\n                if (parent) {\n                    delete parent[propertyToRemove];\n                }\n\n            } else {\n\n                // unsetting a primitive attribute\n                delete obj[propertyToRemove];\n            }\n\n            return obj;\n        },\n\n        flattenObject: function(obj, delim, stop) {\n\n            delim = delim || '/';\n            var ret = {};\n\n            for (var key in obj) {\n\n                if (!obj.hasOwnProperty(key)) continue;\n\n                var shouldGoDeeper = typeof obj[key] === 'object';\n                if (shouldGoDeeper && stop && stop(obj[key])) {\n                    shouldGoDeeper = false;\n                }\n\n                if (shouldGoDeeper) {\n\n                    var flatObject = this.flattenObject(obj[key], delim, stop);\n\n                    for (var flatKey in flatObject) {\n                        if (!flatObject.hasOwnProperty(flatKey)) continue;\n                        ret[key + delim + flatKey] = flatObject[flatKey];\n                    }\n\n                } else {\n\n                    ret[key] = obj[key];\n                }\n            }\n\n            return ret;\n        },\n\n        uuid: function() {\n\n            // credit: http://stackoverflow.com/posts/2117523/revisions\n\n            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n                var r = (Math.random() * 16) | 0;\n                var v = (c === 'x') ? r : (r&0x3|0x8);\n                return v.toString(16);\n            });\n        },\n\n        // Generate global unique id for obj and store it as a property of the object.\n        guid: function(obj) {\n\n            this.guid.id = this.guid.id || 1;\n            obj.id = (obj.id === undefined ? 'j_' + this.guid.id++ : obj.id);\n            return obj.id;\n        },\n\n        toKebabCase: function(string) {\n\n            return string.replace(/[A-Z]/g, '-$&').toLowerCase();\n        },\n\n        normalizeEvent: function(evt) {\n\n            var normalizedEvent = evt;\n            var touchEvt = evt.originalEvent && evt.originalEvent.changedTouches && evt.originalEvent.changedTouches[0];\n            if (touchEvt) {\n                for (var property in evt) {\n                    // copy all the properties from the input event that are not\n                    // defined on the touch event (functions included).\n                    if (touchEvt[property] === undefined) {\n                        touchEvt[property] = evt[property];\n                    }\n                }\n                normalizedEvent = touchEvt;\n            }\n\n            // IE: evt.target could be set to SVGElementInstance for SVGUseElement\n            var target = normalizedEvent.target;\n            if (target) {\n                var useElement = target.correspondingUseElement;\n                if (useElement) normalizedEvent.target = useElement;\n            }\n\n            return normalizedEvent;\n        },\n\n        nextFrame: (function() {\n\n            var raf;\n\n            if (typeof window !== 'undefined') {\n\n                raf = window.requestAnimationFrame ||\n                        window.webkitRequestAnimationFrame ||\n                        window.mozRequestAnimationFrame ||\n                        window.oRequestAnimationFrame ||\n                        window.msRequestAnimationFrame;\n            }\n\n            if (!raf) {\n\n                var lastTime = 0;\n\n                raf = function(callback) {\n\n                    var currTime = new Date().getTime();\n                    var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n                    var id = setTimeout(function() { callback(currTime + timeToCall); }, timeToCall);\n\n                    lastTime = currTime + timeToCall;\n\n                    return id;\n                };\n            }\n\n            return function(callback, context) {\n                return context\n                    ? raf(callback.bind(context))\n                    : raf(callback);\n            };\n\n        })(),\n\n        cancelFrame: (function() {\n\n            var caf;\n            var client = typeof window != 'undefined';\n\n            if (client) {\n\n                caf = window.cancelAnimationFrame ||\n                        window.webkitCancelAnimationFrame ||\n                        window.webkitCancelRequestAnimationFrame ||\n                        window.msCancelAnimationFrame ||\n                        window.msCancelRequestAnimationFrame ||\n                        window.oCancelAnimationFrame ||\n                        window.oCancelRequestAnimationFrame ||\n                        window.mozCancelAnimationFrame ||\n                        window.mozCancelRequestAnimationFrame;\n            }\n\n            caf = caf || clearTimeout;\n\n            return client ? caf.bind(window) : caf;\n\n        })(),\n\n        // ** Deprecated **\n        shapePerimeterConnectionPoint: function(linkView, view, magnet, reference) {\n\n            var bbox;\n            var spot;\n\n            if (!magnet) {\n\n                // There is no magnet, try to make the best guess what is the\n                // wrapping SVG element. This is because we want this \"smart\"\n                // connection points to work out of the box without the\n                // programmer to put magnet marks to any of the subelements.\n                // For example, we want the functoin to work on basic.Path elements\n                // without any special treatment of such elements.\n                // The code below guesses the wrapping element based on\n                // one simple assumption. The wrapping elemnet is the\n                // first child of the scalable group if such a group exists\n                // or the first child of the rotatable group if not.\n                // This makese sense because usually the wrapping element\n                // is below any other sub element in the shapes.\n                var scalable = view.$('.scalable')[0];\n                var rotatable = view.$('.rotatable')[0];\n\n                if (scalable && scalable.firstChild) {\n\n                    magnet = scalable.firstChild;\n\n                } else if (rotatable && rotatable.firstChild) {\n\n                    magnet = rotatable.firstChild;\n                }\n            }\n\n            if (magnet) {\n\n                spot = V(magnet).findIntersection(reference, linkView.paper.viewport);\n                if (!spot) {\n                    bbox = V(magnet).getBBox({ target: linkView.paper.viewport });\n                }\n\n            } else {\n\n                bbox = view.model.getBBox();\n                spot = bbox.intersectionWithLineFromCenterToPoint(reference);\n            }\n            return spot || bbox.center();\n        },\n\n        isPercentage: function(val) {\n\n            return joint.util.isString(val) && val.slice(-1) === '%';\n        },\n\n        parseCssNumeric: function(val, restrictUnits) {\n\n            function getUnit(validUnitExp) {\n\n                // one or more numbers, followed by\n                // any number of (\n                //  `.`, followed by\n                //  one or more numbers\n                // ), followed by\n                // `validUnitExp`, followed by\n                // end of string\n                var matches = new RegExp('(?:\\\\d+(?:\\\\.\\\\d+)*)(' + validUnitExp + ')$').exec(val);\n\n                if (!matches) return null;\n                return matches[1];\n            }\n\n            var number = parseFloat(val);\n\n            // if `val` cannot be parsed as a number, return `null`\n            if (Number.isNaN(number)) return null;\n\n            // else: we know `output.value`\n            var output = {};\n            output.value = number;\n\n            // determine the unit\n            var validUnitExp;\n            if (restrictUnits == null) {\n                // no restriction\n                // accept any unit, as well as no unit\n                validUnitExp = '[A-Za-z]*';\n\n            } else if (Array.isArray(restrictUnits)) {\n                // if this is an empty array, top restriction - return `null`\n                if (restrictUnits.length === 0) return null;\n\n                // else: restriction - an array of valid unit strings\n                validUnitExp = restrictUnits.join('|');\n\n            } else if (joint.util.isString(restrictUnits)) {\n                // restriction - a single valid unit string\n                validUnitExp = restrictUnits;\n            }\n            var unit = getUnit(validUnitExp);\n\n            // if we found no matches for `restrictUnits`, return `null`\n            if (unit === null) return null;\n\n            // else: we know the unit\n            output.unit = unit;\n            return output;\n        },\n\n        breakText: function(text, size, styles, opt) {\n\n            opt = opt || {};\n            styles = styles || {};\n\n            var width = size.width;\n            var height = size.height;\n\n            var svgDocument = opt.svgDocument || V('svg').node;\n            var textSpan = V('tspan').node;\n            var textElement = V('text').attr(styles).append(textSpan).node;\n            var textNode = document.createTextNode('');\n\n            // Prevent flickering\n            textElement.style.opacity = 0;\n            // Prevent FF from throwing an uncaught exception when `getBBox()`\n            // called on element that is not in the render tree (is not measurable).\n            // <tspan>.getComputedTextLength() returns always 0 in this case.\n            // Note that the `textElement` resp. `textSpan` can become hidden\n            // when it's appended to the DOM and a `display: none` CSS stylesheet\n            // rule gets applied.\n            textElement.style.display = 'block';\n            textSpan.style.display = 'block';\n\n            textSpan.appendChild(textNode);\n            svgDocument.appendChild(textElement);\n\n            if (!opt.svgDocument) {\n\n                document.body.appendChild(svgDocument);\n            }\n\n            var separator = opt.separator || ' ';\n            var eol = opt.eol || '\\n';\n\n            var words = text.split(separator);\n            var full = [];\n            var lines = [];\n            var p;\n            var lineHeight;\n\n            for (var i = 0, l = 0, len = words.length; i < len; i++) {\n\n                var word = words[i];\n\n                if (!word) continue;\n\n                if (eol && word.indexOf(eol) >= 0) {\n                    // word cotains end-of-line character\n                    if (word.length > 1) {\n                        // separate word and continue cycle\n                        var eolWords = word.split(eol);\n                        for (var j = 0, jl = eolWords.length - 1; j < jl; j++) {\n                            eolWords.splice(2 * j + 1, 0, eol);\n                        }\n                        Array.prototype.splice.apply(words, [i, 1].concat(eolWords));\n                        i--;\n                        len += eolWords.length - 1;\n                    } else {\n                        // creates new line\n                        l++;\n                    }\n                    continue;\n                }\n\n\n                textNode.data = lines[l] ? lines[l] + ' ' + word : word;\n\n                if (textSpan.getComputedTextLength() <= width) {\n\n                    // the current line fits\n                    lines[l] = textNode.data;\n\n                    if (p) {\n                        // We were partitioning. Put rest of the word onto next line\n                        full[l++] = true;\n\n                        // cancel partitioning\n                        p = 0;\n                    }\n\n                } else {\n\n                    if (!lines[l] || p) {\n\n                        var partition = !!p;\n\n                        p = word.length - 1;\n\n                        if (partition || !p) {\n\n                            // word has only one character.\n                            if (!p) {\n\n                                if (!lines[l]) {\n\n                                    // we won't fit this text within our rect\n                                    lines = [];\n\n                                    break;\n                                }\n\n                                // partitioning didn't help on the non-empty line\n                                // try again, but this time start with a new line\n\n                                // cancel partitions created\n                                words.splice(i, 2, word + words[i + 1]);\n\n                                // adjust word length\n                                len--;\n\n                                full[l++] = true;\n                                i--;\n\n                                continue;\n                            }\n\n                            // move last letter to the beginning of the next word\n                            words[i] = word.substring(0, p);\n                            words[i + 1] = word.substring(p) + words[i + 1];\n\n                        } else {\n\n                            // We initiate partitioning\n                            // split the long word into two words\n                            words.splice(i, 1, word.substring(0, p), word.substring(p));\n\n                            // adjust words length\n                            len++;\n\n                            if (l && !full[l - 1]) {\n                                // if the previous line is not full, try to fit max part of\n                                // the current word there\n                                l--;\n                            }\n                        }\n\n                        i--;\n\n                        continue;\n                    }\n\n                    l++;\n                    i--;\n                }\n\n                // if size.height is defined we have to check whether the height of the entire\n                // text exceeds the rect height\n                if (height !== undefined) {\n\n                    if (lineHeight === undefined) {\n\n                        var heightValue;\n\n                        // use the same defaults as in V.prototype.text\n                        if (styles.lineHeight === 'auto') {\n                            heightValue = { value: 1.5, unit: 'em' };\n                        } else {\n                            heightValue = joint.util.parseCssNumeric(styles.lineHeight, ['em']) || { value: 1, unit: 'em' };\n                        }\n\n                        lineHeight = heightValue.value;\n                        if (heightValue.unit === 'em' ) {\n                            lineHeight *= textElement.getBBox().height;\n                        }\n                    }\n\n                    if (lineHeight * lines.length > height) {\n\n                        // remove overflowing lines\n                        var lastL = Math.floor(height / lineHeight) - 1;\n                        lines.splice(lastL + 1);\n\n                        // add ellipsis\n                        var ellipsis = opt.ellipsis;\n                        if (!ellipsis || lastL < 0) break;\n                        if (typeof ellipsis !== 'string') ellipsis = '\\u2026';\n\n                        var lastLine = lines[lastL];\n                        var k = lastLine.length;\n                        var lastLineWithOmission, lastChar, separatorChar;\n                        do {\n                            lastChar = lastLine[k];\n                            lastLineWithOmission = lastLine.substring(0, k);\n                            if (!lastChar) {\n                                separatorChar = (typeof separator === 'string') ? separator : ' ';\n                                lastLineWithOmission += separatorChar;\n                            } else if (lastChar.match(separator)) {\n                                lastLineWithOmission += lastChar;\n                            }\n                            lastLineWithOmission += ellipsis;\n                            textNode.data = lastLineWithOmission;\n                            if (textSpan.getComputedTextLength() <= width) {\n                                lines[lastL] = lastLineWithOmission;\n                                break;\n                            }\n                            k--;\n                        } while (k >= 0);\n                        break;\n                    }\n                }\n            }\n\n            if (opt.svgDocument) {\n\n                // svg document was provided, remove the text element only\n                svgDocument.removeChild(textElement);\n\n            } else {\n\n                // clean svg document\n                document.body.removeChild(svgDocument);\n            }\n\n            return lines.join(eol);\n        },\n\n        // Sanitize HTML\n        // Based on https://gist.github.com/ufologist/5a0da51b2b9ef1b861c30254172ac3c9\n        // Parses a string into an array of DOM nodes.\n        // Then outputs it back as a string.\n        sanitizeHTML: function(html) {\n\n            // Ignores tags that are invalid inside a <div> tag (e.g. <body>, <head>)\n\n            // If documentContext (second parameter) is not specified or given as `null` or `undefined`, a new document is used.\n            // Inline events will not execute when the HTML is parsed; this includes, for example, sending GET requests for images.\n\n            // If keepScripts (last parameter) is `false`, scripts are not executed.\n            var output = $($.parseHTML('<div>' + html + '</div>', null, false));\n\n            output.find('*').each(function() { // for all nodes\n                var currentNode = this;\n\n                $.each(currentNode.attributes, function() { // for all attributes in each node\n                    var currentAttribute = this;\n\n                    var attrName = currentAttribute.name;\n                    var attrValue = currentAttribute.value;\n\n                    // Remove attribute names that start with \"on\" (e.g. onload, onerror...).\n                    // Remove attribute values that start with \"javascript:\" pseudo protocol (e.g. `href=\"javascript:alert(1)\"`).\n                    if (attrName.indexOf('on') === 0 || attrValue.indexOf('javascript:') === 0) {\n                        $(currentNode).removeAttr(attrName);\n                    }\n                });\n            });\n\n            return output.html();\n        },\n\n        // Download `blob` as file with `fileName`.\n        // Does not work in IE9.\n        downloadBlob: function(blob, fileName) {\n\n            if (window.navigator.msSaveBlob) { // requires IE 10+\n                // pulls up a save dialog\n                window.navigator.msSaveBlob(blob, fileName);\n\n            } else { // other browsers\n                // downloads directly in Chrome and Safari\n\n                // presents a save/open dialog in Firefox\n                // Firefox bug: `from` field in save dialog always shows `from:blob:`\n                // https://bugzilla.mozilla.org/show_bug.cgi?id=1053327\n\n                var url = window.URL.createObjectURL(blob);\n                var link = document.createElement('a');\n\n                link.href = url;\n                link.download = fileName;\n                document.body.appendChild(link);\n\n                link.click();\n\n                document.body.removeChild(link);\n                window.URL.revokeObjectURL(url); // mark the url for garbage collection\n            }\n        },\n\n        // Download `dataUri` as file with `fileName`.\n        // Does not work in IE9.\n        downloadDataUri: function(dataUri, fileName) {\n\n            var blob = joint.util.dataUriToBlob(dataUri);\n            joint.util.downloadBlob(blob, fileName);\n        },\n\n        // Convert an uri-encoded data component (possibly also base64-encoded) to a blob.\n        dataUriToBlob: function(dataUri) {\n\n            // first, make sure there are no newlines in the data uri\n            dataUri = dataUri.replace(/\\s/g, '');\n            dataUri = decodeURIComponent(dataUri);\n\n            var firstCommaIndex = dataUri.indexOf(','); // split dataUri as `dataTypeString`,`data`\n\n            var dataTypeString = dataUri.slice(0, firstCommaIndex); // e.g. 'data:image/jpeg;base64'\n            var mimeString = dataTypeString.split(':')[1].split(';')[0]; // e.g. 'image/jpeg'\n\n            var data = dataUri.slice(firstCommaIndex + 1);\n            var decodedString;\n            if (dataTypeString.indexOf('base64') >= 0) { // data may be encoded in base64\n                decodedString = atob(data); // decode data\n            } else {\n                // convert the decoded string to UTF-8\n                decodedString = unescape(encodeURIComponent(data));\n            }\n            // write the bytes of the string to a typed array\n            var ia = new Uint8Array(decodedString.length);\n            for (var i = 0; i < decodedString.length; i++) {\n                ia[i] = decodedString.charCodeAt(i);\n            }\n\n            return new Blob([ia], { type: mimeString }); // return the typed array as Blob\n        },\n\n        // Read an image at `url` and return it as base64-encoded data uri.\n        // The mime type of the image is inferred from the `url` file extension.\n        // If data uri is provided as `url`, it is returned back unchanged.\n        // `callback` is a method with `err` as first argument and `dataUri` as second argument.\n        // Works with IE9.\n        imageToDataUri: function(url, callback) {\n\n            if (!url || url.substr(0, 'data:'.length) === 'data:') {\n                // No need to convert to data uri if it is already in data uri.\n\n                // This not only convenient but desired. For example,\n                // IE throws a security error if data:image/svg+xml is used to render\n                // an image to the canvas and an attempt is made to read out data uri.\n                // Now if our image is already in data uri, there is no need to render it to the canvas\n                // and so we can bypass this error.\n\n                // Keep the async nature of the function.\n                return setTimeout(function() {\n                    callback(null, url);\n                }, 0);\n            }\n\n            // chrome, IE10+\n            var modernHandler = function(xhr, callback) {\n\n                if (xhr.status === 200) {\n\n                    var reader = new FileReader();\n\n                    reader.onload = function(evt) {\n                        var dataUri = evt.target.result;\n                        callback(null, dataUri);\n                    };\n\n                    reader.onerror = function() {\n                        callback(new Error('Failed to load image ' + url));\n                    };\n\n                    reader.readAsDataURL(xhr.response);\n                } else {\n                    callback(new Error('Failed to load image ' + url));\n                }\n            };\n\n            var legacyHandler = function(xhr, callback) {\n\n                var Uint8ToString = function(u8a) {\n                    var CHUNK_SZ = 0x8000;\n                    var c = [];\n                    for (var i = 0; i < u8a.length; i += CHUNK_SZ) {\n                        c.push(String.fromCharCode.apply(null, u8a.subarray(i, i + CHUNK_SZ)));\n                    }\n                    return c.join('');\n                };\n\n                if (xhr.status === 200) {\n\n                    var bytes = new Uint8Array(xhr.response);\n\n                    var suffix = (url.split('.').pop()) || 'png';\n                    var map = {\n                        'svg': 'svg+xml'\n                    };\n                    var meta = 'data:image/' + (map[suffix] || suffix) + ';base64,';\n                    var b64encoded = meta + btoa(Uint8ToString(bytes));\n                    callback(null, b64encoded);\n                } else {\n                    callback(new Error('Failed to load image ' + url));\n                }\n            };\n\n            var xhr = new XMLHttpRequest();\n\n            xhr.open('GET', url, true);\n            xhr.addEventListener('error', function() {\n                callback(new Error('Failed to load image ' + url));\n            });\n\n            xhr.responseType = window.FileReader ? 'blob' : 'arraybuffer';\n\n            xhr.addEventListener('load', function() {\n                if (window.FileReader) {\n                    modernHandler(xhr, callback);\n                } else {\n                    legacyHandler(xhr, callback);\n                }\n            });\n\n            xhr.send();\n        },\n\n        getElementBBox: function(el) {\n\n            var $el = $(el);\n            if ($el.length === 0) {\n                throw new Error('Element not found');\n            }\n\n            var element = $el[0];\n            var doc = element.ownerDocument;\n            var clientBBox = element.getBoundingClientRect();\n\n            var strokeWidthX = 0;\n            var strokeWidthY = 0;\n\n            // Firefox correction\n            if (element.ownerSVGElement) {\n\n                var vel = V(element);\n                var bbox = vel.getBBox({ target: vel.svg() });\n\n                // if FF getBoundingClientRect includes stroke-width, getBBox doesn't.\n                // To unify this across all browsers we need to adjust the final bBox with `stroke-width` value.\n                strokeWidthX = (clientBBox.width - bbox.width);\n                strokeWidthY = (clientBBox.height - bbox.height);\n            }\n\n            return  {\n                x: clientBBox.left + window.pageXOffset - doc.documentElement.offsetLeft + strokeWidthX / 2,\n                y: clientBBox.top + window.pageYOffset - doc.documentElement.offsetTop + strokeWidthY / 2,\n                width: clientBBox.width - strokeWidthX,\n                height: clientBBox.height - strokeWidthY\n            };\n        },\n\n\n        // Highly inspired by the jquery.sortElements plugin by Padolsey.\n        // See http://james.padolsey.com/javascript/sorting-elements-with-jquery/.\n        sortElements: function(elements, comparator) {\n\n            var $elements = $(elements);\n            var placements = $elements.map(function() {\n\n                var sortElement = this;\n                var parentNode = sortElement.parentNode;\n                // Since the element itself will change position, we have\n                // to have some way of storing it's original position in\n                // the DOM. The easiest way is to have a 'flag' node:\n                var nextSibling = parentNode.insertBefore(document.createTextNode(''), sortElement.nextSibling);\n\n                return function() {\n\n                    if (parentNode === this) {\n                        throw new Error('You can\\'t sort elements if any one is a descendant of another.');\n                    }\n\n                    // Insert before flag:\n                    parentNode.insertBefore(this, nextSibling);\n                    // Remove flag:\n                    parentNode.removeChild(nextSibling);\n                };\n            });\n\n            return Array.prototype.sort.call($elements, comparator).each(function(i) {\n                placements[i].call(this);\n            });\n        },\n\n        // Sets attributes on the given element and its descendants based on the selector.\n        // `attrs` object: { [SELECTOR1]: { attrs1 }, [SELECTOR2]: { attrs2}, ... } e.g. { 'input': { color : 'red' }}\n        setAttributesBySelector: function(element, attrs) {\n\n            var $element = $(element);\n\n            joint.util.forIn(attrs, function(attrs, selector) {\n                var $elements = $element.find(selector).addBack().filter(selector);\n                // Make a special case for setting classes.\n                // We do not want to overwrite any existing class.\n                if (joint.util.has(attrs, 'class')) {\n                    $elements.addClass(attrs['class']);\n                    attrs = joint.util.omit(attrs, 'class');\n                }\n                $elements.attr(attrs);\n            });\n        },\n\n        // Return a new object with all four sides (top, right, bottom, left) in it.\n        // Value of each side is taken from the given argument (either number or object).\n        // Default value for a side is 0.\n        // Examples:\n        // joint.util.normalizeSides(5) --> { top: 5, right: 5, bottom: 5, left: 5 }\n        // joint.util.normalizeSides({ horizontal: 5 }) --> { top: 0, right: 5, bottom: 0, left: 5 }\n        // joint.util.normalizeSides({ left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\n        // joint.util.normalizeSides({ horizontal: 10, left: 5 }) --> { top: 0, right: 10, bottom: 0, left: 5 }\n        // joint.util.normalizeSides({ horizontal: 0, left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\n        normalizeSides: function(box) {\n\n            if (Object(box) !== box) { // `box` is not an object\n                var val = 0; // `val` left as 0 if `box` cannot be understood as finite number\n                if (isFinite(box)) val = +box; // actually also accepts string numbers (e.g. '100')\n\n                return { top: val, right: val, bottom: val, left: val };\n            }\n\n            // `box` is an object\n            var top, right, bottom, left;\n            top = right = bottom = left = 0;\n\n            if (isFinite(box.vertical)) top = bottom = +box.vertical;\n            if (isFinite(box.horizontal)) right = left = +box.horizontal;\n\n            if (isFinite(box.top)) top = +box.top; // overwrite vertical\n            if (isFinite(box.right)) right = +box.right; // overwrite horizontal\n            if (isFinite(box.bottom)) bottom = +box.bottom; // overwrite vertical\n            if (isFinite(box.left)) left = +box.left; // overwrite horizontal\n\n            return { top: top, right: right, bottom: bottom, left: left };\n        },\n\n        timing: {\n\n            linear: function(t) {\n                return t;\n            },\n\n            quad: function(t) {\n                return t * t;\n            },\n\n            cubic: function(t) {\n                return t * t * t;\n            },\n\n            inout: function(t) {\n                if (t <= 0) return 0;\n                if (t >= 1) return 1;\n                var t2 = t * t;\n                var t3 = t2 * t;\n                return 4 * (t < .5 ? t3 : 3 * (t - t2) + t3 - .75);\n            },\n\n            exponential: function(t) {\n                return Math.pow(2, 10 * (t - 1));\n            },\n\n            bounce: function(t) {\n                for (var a = 0, b = 1; 1; a += b, b /= 2) {\n                    if (t >= (7 - 4 * a) / 11) {\n                        var q = (11 - 6 * a - 11 * t) / 4;\n                        return -q * q + b * b;\n                    }\n                }\n            },\n\n            reverse: function(f) {\n                return function(t) {\n                    return 1 - f(1 - t);\n                };\n            },\n\n            reflect: function(f) {\n                return function(t) {\n                    return .5 * (t < .5 ? f(2 * t) : (2 - f(2 - 2 * t)));\n                };\n            },\n\n            clamp: function(f, n, x) {\n                n = n || 0;\n                x = x || 1;\n                return function(t) {\n                    var r = f(t);\n                    return r < n ? n : r > x ? x : r;\n                };\n            },\n\n            back: function(s) {\n                if (!s) s = 1.70158;\n                return function(t) {\n                    return t * t * ((s + 1) * t - s);\n                };\n            },\n\n            elastic: function(x) {\n                if (!x) x = 1.5;\n                return function(t) {\n                    return Math.pow(2, 10 * (t - 1)) * Math.cos(20 * Math.PI * x / 3 * t);\n                };\n            }\n        },\n\n        interpolate: {\n\n            number: function(a, b) {\n                var d = b - a;\n                return function(t) { return a + d * t; };\n            },\n\n            object: function(a, b) {\n                var s = Object.keys(a);\n                return function(t) {\n                    var i, p;\n                    var r = {};\n                    for (i = s.length - 1; i != -1; i--) {\n                        p = s[i];\n                        r[p] = a[p] + (b[p] - a[p]) * t;\n                    }\n                    return r;\n                };\n            },\n\n            hexColor: function(a, b) {\n\n                var ca = parseInt(a.slice(1), 16);\n                var cb = parseInt(b.slice(1), 16);\n                var ra = ca & 0x0000ff;\n                var rd = (cb & 0x0000ff) - ra;\n                var ga = ca & 0x00ff00;\n                var gd = (cb & 0x00ff00) - ga;\n                var ba = ca & 0xff0000;\n                var bd = (cb & 0xff0000) - ba;\n\n                return function(t) {\n\n                    var r = (ra + rd * t) & 0x000000ff;\n                    var g = (ga + gd * t) & 0x0000ff00;\n                    var b = (ba + bd * t) & 0x00ff0000;\n\n                    return '#' + (1 << 24 | r | g | b ).toString(16).slice(1);\n                };\n            },\n\n            unit: function(a, b) {\n\n                var r = /(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/;\n                var ma = r.exec(a);\n                var mb = r.exec(b);\n                var p = mb[1].indexOf('.');\n                var f = p > 0 ? mb[1].length - p - 1 : 0;\n                a = +ma[1];\n                var d = +mb[1] - a;\n                var u = ma[2];\n\n                return function(t) {\n                    return (a + d * t).toFixed(f) + u;\n                };\n            }\n        },\n\n        // SVG filters.\n        // (values in parentheses are default values)\n        filter: {\n\n            // `color` ... outline color ('blue')\n            // `width`... outline width (1)\n            // `opacity` ... outline opacity (1)\n            // `margin` ... gap between outline and the element (2)\n            outline: function(args) {\n\n                var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology in=\"SourceAlpha\" result=\"morphedOuter\" operator=\"dilate\" radius=\"${outerRadius}\" /><feMorphology in=\"SourceAlpha\" result=\"morphedInner\" operator=\"dilate\" radius=\"${innerRadius}\" /><feComposite result=\"morphedOuterColored\" in=\"colored\" in2=\"morphedOuter\" operator=\"in\"/><feComposite operator=\"xor\" in=\"morphedOuterColored\" in2=\"morphedInner\" result=\"outline\"/><feMerge><feMergeNode in=\"outline\"/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n\n                var margin = Number.isFinite(args.margin) ? args.margin : 2;\n                var width = Number.isFinite(args.width) ? args.width : 1;\n\n                return joint.util.template(tpl)({\n                    color: args.color || 'blue',\n                    opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n                    outerRadius: margin + width,\n                    innerRadius: margin\n                });\n            },\n\n            // `color` ... color ('red')\n            // `width`... width (1)\n            // `blur` ... blur (0)\n            // `opacity` ... opacity (1)\n            highlight: function(args) {\n\n                var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology result=\"morphed\" in=\"SourceGraphic\" operator=\"dilate\" radius=\"${width}\"/><feComposite result=\"composed\" in=\"colored\" in2=\"morphed\" operator=\"in\"/><feGaussianBlur result=\"blured\" in=\"composed\" stdDeviation=\"${blur}\"/><feBlend in=\"SourceGraphic\" in2=\"blured\" mode=\"normal\"/></filter>';\n\n                return joint.util.template(tpl)({\n                    color: args.color || 'red',\n                    width: Number.isFinite(args.width) ? args.width : 1,\n                    blur: Number.isFinite(args.blur) ? args.blur : 0,\n                    opacity: Number.isFinite(args.opacity) ? args.opacity : 1\n                });\n            },\n\n            // `x` ... horizontal blur (2)\n            // `y` ... vertical blur (optional)\n            blur: function(args) {\n\n                var x = Number.isFinite(args.x) ? args.x : 2;\n\n                return joint.util.template('<filter><feGaussianBlur stdDeviation=\"${stdDeviation}\"/></filter>')({\n                    stdDeviation: Number.isFinite(args.y) ? [x, args.y] : x\n                });\n            },\n\n            // `dx` ... horizontal shift (0)\n            // `dy` ... vertical shift (0)\n            // `blur` ... blur (4)\n            // `color` ... color ('black')\n            // `opacity` ... opacity (1)\n            dropShadow: function(args) {\n\n                var tpl = 'SVGFEDropShadowElement' in window\n                    ? '<filter><feDropShadow stdDeviation=\"${blur}\" dx=\"${dx}\" dy=\"${dy}\" flood-color=\"${color}\" flood-opacity=\"${opacity}\"/></filter>'\n                    : '<filter><feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"${blur}\"/><feOffset dx=\"${dx}\" dy=\"${dy}\" result=\"offsetblur\"/><feFlood flood-color=\"${color}\"/><feComposite in2=\"offsetblur\" operator=\"in\"/><feComponentTransfer><feFuncA type=\"linear\" slope=\"${opacity}\"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n\n                return joint.util.template(tpl)({\n                    dx: args.dx || 0,\n                    dy: args.dy || 0,\n                    opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n                    color: args.color || 'black',\n                    blur: Number.isFinite(args.blur) ? args.blur : 4\n                });\n            },\n\n            // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely grayscale. A value of 0 leaves the input unchanged.\n            grayscale: function(args) {\n\n                var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n                return joint.util.template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0\"/></filter>')({\n                    a: 0.2126 + 0.7874 * (1 - amount),\n                    b: 0.7152 - 0.7152 * (1 - amount),\n                    c: 0.0722 - 0.0722 * (1 - amount),\n                    d: 0.2126 - 0.2126 * (1 - amount),\n                    e: 0.7152 + 0.2848 * (1 - amount),\n                    f: 0.0722 - 0.0722 * (1 - amount),\n                    g: 0.2126 - 0.2126 * (1 - amount),\n                    h: 0.0722 + 0.9278 * (1 - amount)\n                });\n            },\n\n            // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely sepia. A value of 0 leaves the input unchanged.\n            sepia: function(args) {\n\n                var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n                return joint.util.template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0\"/></filter>')({\n                    a: 0.393 + 0.607 * (1 - amount),\n                    b: 0.769 - 0.769 * (1 - amount),\n                    c: 0.189 - 0.189 * (1 - amount),\n                    d: 0.349 - 0.349 * (1 - amount),\n                    e: 0.686 + 0.314 * (1 - amount),\n                    f: 0.168 - 0.168 * (1 - amount),\n                    g: 0.272 - 0.272 * (1 - amount),\n                    h: 0.534 - 0.534 * (1 - amount),\n                    i: 0.131 + 0.869 * (1 - amount)\n                });\n            },\n\n            // `amount` ... the proportion of the conversion (1). A value of 0 is completely un-saturated. A value of 1 (default) leaves the input unchanged.\n            saturate: function(args) {\n\n                var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n                return joint.util.template('<filter><feColorMatrix type=\"saturate\" values=\"${amount}\"/></filter>')({\n                    amount: 1 - amount\n                });\n            },\n\n            // `angle` ...  the number of degrees around the color circle the input samples will be adjusted (0).\n            hueRotate: function(args) {\n\n                return joint.util.template('<filter><feColorMatrix type=\"hueRotate\" values=\"${angle}\"/></filter>')({\n                    angle: args.angle || 0\n                });\n            },\n\n            // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely inverted. A value of 0 leaves the input unchanged.\n            invert: function(args) {\n\n                var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n                return joint.util.template('<filter><feComponentTransfer><feFuncR type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncG type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncB type=\"table\" tableValues=\"${amount} ${amount2}\"/></feComponentTransfer></filter>')({\n                    amount: amount,\n                    amount2: 1 - amount\n                });\n            },\n\n            // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n            brightness: function(args) {\n\n                return joint.util.template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\"/><feFuncG type=\"linear\" slope=\"${amount}\"/><feFuncB type=\"linear\" slope=\"${amount}\"/></feComponentTransfer></filter>')({\n                    amount: Number.isFinite(args.amount) ? args.amount : 1\n                });\n            },\n\n            // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n            contrast: function(args) {\n\n                var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n                return joint.util.template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncG type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncB type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/></feComponentTransfer></filter>')({\n                    amount: amount,\n                    amount2: .5 - amount / 2\n                });\n            }\n        },\n\n        format: {\n\n            // Formatting numbers via the Python Format Specification Mini-language.\n            // See http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n            // Heavilly inspired by the D3.js library implementation.\n            number: function(specifier, value, locale) {\n\n                locale = locale || {\n\n                    currency: ['$', ''],\n                    decimal: '.',\n                    thousands: ',',\n                    grouping: [3]\n                };\n\n                // See Python format specification mini-language: http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n                // [[fill]align][sign][symbol][0][width][,][.precision][type]\n                var re = /(?:([^{])?([<>=^]))?([+\\- ])?([$#])?(0)?(\\d+)?(,)?(\\.-?\\d+)?([a-z%])?/i;\n\n                var match = re.exec(specifier);\n                var fill = match[1] || ' ';\n                var align = match[2] || '>';\n                var sign = match[3] || '';\n                var symbol = match[4] || '';\n                var zfill = match[5];\n                var width = +match[6];\n                var comma = match[7];\n                var precision = match[8];\n                var type = match[9];\n                var scale = 1;\n                var prefix = '';\n                var suffix = '';\n                var integer = false;\n\n                if (precision) precision = +precision.substring(1);\n\n                if (zfill || fill === '0' && align === '=') {\n                    zfill = fill = '0';\n                    align = '=';\n                    if (comma) width -= Math.floor((width - 1) / 4);\n                }\n\n                switch (type) {\n                    case 'n':\n                        comma = true; type = 'g';\n                        break;\n                    case '%':\n                        scale = 100; suffix = '%'; type = 'f';\n                        break;\n                    case 'p':\n                        scale = 100; suffix = '%'; type = 'r';\n                        break;\n                    case 'b':\n                    case 'o':\n                    case 'x':\n                    case 'X':\n                        if (symbol === '#') prefix = '0' + type.toLowerCase();\n                        break;\n                    case 'c':\n                    case 'd':\n                        integer = true; precision = 0;\n                        break;\n                    case 's':\n                        scale = -1; type = 'r';\n                        break;\n                }\n\n                if (symbol === '$') {\n                    prefix = locale.currency[0];\n                    suffix = locale.currency[1];\n                }\n\n                // If no precision is specified for `'r'`, fallback to general notation.\n                if (type == 'r' && !precision) type = 'g';\n\n                // Ensure that the requested precision is in the supported range.\n                if (precision != null) {\n                    if (type == 'g') precision = Math.max(1, Math.min(21, precision));\n                    else if (type == 'e' || type == 'f') precision = Math.max(0, Math.min(20, precision));\n                }\n\n                var zcomma = zfill && comma;\n\n                // Return the empty string for floats formatted as ints.\n                if (integer && (value % 1)) return '';\n\n                // Convert negative to positive, and record the sign prefix.\n                var negative = value < 0 || value === 0 && 1 / value < 0 ? (value = -value, '-') : sign;\n\n                var fullSuffix = suffix;\n\n                // Apply the scale, computing it from the value's exponent for si format.\n                // Preserve the existing suffix, if any, such as the currency symbol.\n                if (scale < 0) {\n                    var unit = this.prefix(value, precision);\n                    value = unit.scale(value);\n                    fullSuffix = unit.symbol + suffix;\n                } else {\n                    value *= scale;\n                }\n\n                // Convert to the desired precision.\n                value = this.convert(type, value, precision);\n\n                // Break the value into the integer part (before) and decimal part (after).\n                var i = value.lastIndexOf('.');\n                var before = i < 0 ? value : value.substring(0, i);\n                var after = i < 0 ? '' : locale.decimal + value.substring(i + 1);\n\n                function formatGroup(value) {\n\n                    var i = value.length;\n                    var t = [];\n                    var j = 0;\n                    var g = locale.grouping[0];\n                    while (i > 0 && g > 0) {\n                        t.push(value.substring(i -= g, i + g));\n                        g = locale.grouping[j = (j + 1) % locale.grouping.length];\n                    }\n                    return t.reverse().join(locale.thousands);\n                }\n\n                // If the fill character is not `'0'`, grouping is applied before padding.\n                if (!zfill && comma && locale.grouping) {\n\n                    before = formatGroup(before);\n                }\n\n                var length = prefix.length + before.length + after.length + (zcomma ? 0 : negative.length);\n                var padding = length < width ? new Array(length = width - length + 1).join(fill) : '';\n\n                // If the fill character is `'0'`, grouping is applied after padding.\n                if (zcomma) before = formatGroup(padding + before);\n\n                // Apply prefix.\n                negative += prefix;\n\n                // Rejoin integer and decimal parts.\n                value = before + after;\n\n                return (align === '<' ? negative + value + padding\n                    : align === '>' ? padding + negative + value\n                        : align === '^' ? padding.substring(0, length >>= 1) + negative + value + padding.substring(length)\n                            : negative + (zcomma ? value : padding + value)) + fullSuffix;\n            },\n\n            // Formatting string via the Python Format string.\n            // See https://docs.python.org/2/library/string.html#format-string-syntax)\n            string: function(formatString, value) {\n\n                var fieldDelimiterIndex;\n                var fieldDelimiter = '{';\n                var endPlaceholder = false;\n                var formattedStringArray = [];\n\n                while ((fieldDelimiterIndex = formatString.indexOf(fieldDelimiter)) !== -1) {\n\n                    var pieceFormatedString, formatSpec, fieldName;\n\n                    pieceFormatedString = formatString.slice(0, fieldDelimiterIndex);\n\n                    if (endPlaceholder) {\n                        formatSpec = pieceFormatedString.split(':');\n                        fieldName = formatSpec.shift().split('.');\n                        pieceFormatedString = value;\n\n                        for (var i = 0; i < fieldName.length; i++)\n                            pieceFormatedString = pieceFormatedString[fieldName[i]];\n\n                        if (formatSpec.length)\n                            pieceFormatedString = this.number(formatSpec, pieceFormatedString);\n                    }\n\n                    formattedStringArray.push(pieceFormatedString);\n\n                    formatString = formatString.slice(fieldDelimiterIndex + 1);\n                    endPlaceholder = !endPlaceholder;\n                    fieldDelimiter = (endPlaceholder) ? '}' : '{';\n                }\n                formattedStringArray.push(formatString);\n\n                return formattedStringArray.join('');\n            },\n\n            convert: function(type, value, precision) {\n\n                switch (type) {\n                    case 'b': return value.toString(2);\n                    case 'c': return String.fromCharCode(value);\n                    case 'o': return value.toString(8);\n                    case 'x': return value.toString(16);\n                    case 'X': return value.toString(16).toUpperCase();\n                    case 'g': return value.toPrecision(precision);\n                    case 'e': return value.toExponential(precision);\n                    case 'f': return value.toFixed(precision);\n                    case 'r': return (value = this.round(value, this.precision(value, precision))).toFixed(Math.max(0, Math.min(20, this.precision(value * (1 + 1e-15), precision))));\n                    default: return value + '';\n                }\n            },\n\n            round: function(value, precision) {\n\n                return precision\n                    ? Math.round(value * (precision = Math.pow(10, precision))) / precision\n                    : Math.round(value);\n            },\n\n            precision: function(value, precision) {\n\n                return precision - (value ? Math.ceil(Math.log(value) / Math.LN10) : 1);\n            },\n\n            prefix: function(value, precision) {\n\n                var prefixes = ['y', 'z', 'a', 'f', 'p', 'n', '', 'm', '', 'k', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y'].map(function(d, i) {\n                    var k = Math.pow(10, Math.abs(8 - i) * 3);\n                    return {\n                        scale: i > 8 ? function(d) { return d / k; } : function(d) { return d * k; },\n                        symbol: d\n                    };\n                });\n\n                var i = 0;\n                if (value) {\n                    if (value < 0) value *= -1;\n                    if (precision) value = this.round(value, this.precision(value, precision));\n                    i = 1 + Math.floor(1e-12 + Math.log(value) / Math.LN10);\n                    i = Math.max(-24, Math.min(24, Math.floor((i <= 0 ? i + 1 : i - 1) / 3) * 3));\n                }\n                return prefixes[8 + i / 3];\n            }\n        },\n\n        /*\n            Pre-compile the HTML to be used as a template.\n        */\n        template: function(html) {\n\n            /*\n                Must support the variation in templating syntax found here:\n                https://lodash.com/docs#template\n            */\n            var regex = /<%= ([^ ]+) %>|\\$\\{ ?([^{} ]+) ?\\}|\\{\\{([^{} ]+)\\}\\}/g;\n\n            return function(data) {\n\n                data = data || {};\n\n                return html.replace(regex, function(match) {\n\n                    var args = Array.from(arguments);\n                    var attr = args.slice(1, 4).find(function(_attr) {\n                        return !!_attr;\n                    });\n\n                    var attrArray = attr.split('.');\n                    var value = data[attrArray.shift()];\n\n                    while (value !== undefined && attrArray.length) {\n                        value = value[attrArray.shift()];\n                    }\n\n                    return value !== undefined ? value : '';\n                });\n            };\n        },\n\n        /**\n         * @param {Element} el Element, which content is intent to display in full-screen mode, 'window.top.document.body' is default.\n         */\n        toggleFullScreen: function(el) {\n\n            var topDocument = window.top.document;\n            el = el || topDocument.body;\n\n            function prefixedResult(el, prop) {\n\n                var prefixes = ['webkit', 'moz', 'ms', 'o', ''];\n                for (var i = 0; i < prefixes.length; i++) {\n                    var prefix = prefixes[i];\n                    var propName = prefix ? (prefix + prop) : (prop.substr(0, 1).toLowerCase() + prop.substr(1));\n                    if (el[propName] !== undefined) {\n                        return joint.util.isFunction(el[propName]) ? el[propName]() : el[propName];\n                    }\n                }\n            }\n\n            if (prefixedResult(topDocument, 'FullscreenElement') || prefixedResult(topDocument, 'FullScreenElement')) {\n                prefixedResult(topDocument, 'ExitFullscreen') || // Spec.\n                prefixedResult(topDocument, 'CancelFullScreen'); // Firefox\n            } else {\n                prefixedResult(el, 'RequestFullscreen') || // Spec.\n                prefixedResult(el, 'RequestFullScreen'); // Firefox\n            }\n        },\n\n        addClassNamePrefix: function(className) {\n\n            if (!className) return className;\n\n            return className.toString().split(' ').map(function(_className) {\n\n                if (_className.substr(0, joint.config.classNamePrefix.length) !== joint.config.classNamePrefix) {\n                    _className = joint.config.classNamePrefix + _className;\n                }\n\n                return _className;\n\n            }).join(' ');\n        },\n\n        removeClassNamePrefix: function(className) {\n\n            if (!className) return className;\n\n            return className.toString().split(' ').map(function(_className) {\n\n                if (_className.substr(0, joint.config.classNamePrefix.length) === joint.config.classNamePrefix) {\n                    _className = _className.substr(joint.config.classNamePrefix.length);\n                }\n\n                return _className;\n\n            }).join(' ');\n        },\n\n        wrapWith: function(object, methods, wrapper) {\n\n            if (joint.util.isString(wrapper)) {\n\n                if (!joint.util.wrappers[wrapper]) {\n                    throw new Error('Unknown wrapper: \"' + wrapper + '\"');\n                }\n\n                wrapper = joint.util.wrappers[wrapper];\n            }\n\n            if (!joint.util.isFunction(wrapper)) {\n                throw new Error('Wrapper must be a function.');\n            }\n\n            this.toArray(methods).forEach(function(method) {\n                object[method] = wrapper(object[method]);\n            });\n        },\n\n        wrappers: {\n\n            /*\n                Prepares a function with the following usage:\n\n                    fn([cell, cell, cell], opt);\n                    fn([cell, cell, cell]);\n                    fn(cell, cell, cell, opt);\n                    fn(cell, cell, cell);\n                    fn(cell);\n            */\n            cells: function(fn) {\n\n                return function() {\n\n                    var args = Array.from(arguments);\n                    var n = args.length;\n                    var cells = n > 0 && args[0] || [];\n                    var opt = n > 1 && args[n - 1] || {};\n\n                    if (!Array.isArray(cells)) {\n\n                        if (opt instanceof joint.dia.Cell) {\n                            cells = args;\n                        } else if (cells instanceof joint.dia.Cell) {\n                            if (args.length > 1) {\n                                args.pop();\n                            }\n                            cells = args;\n                        }\n                    }\n\n                    if (opt instanceof joint.dia.Cell) {\n                        opt = {};\n                    }\n\n                    return fn.call(this, cells, opt);\n                };\n            }\n        },\n\n        parseDOMJSON: function(json, namespace) {\n\n            var selectors = {};\n            var groupSelectors = {};\n            var svgNamespace = V.namespace.xmlns;\n            var ns = namespace || svgNamespace;\n            var fragment = document.createDocumentFragment();\n            var queue = [json, fragment, ns];\n            while (queue.length > 0) {\n                ns = queue.pop();\n                var parentNode = queue.pop();\n                var siblingsDef = queue.pop();\n                for (var i = 0, n = siblingsDef.length; i < n; i++) {\n                    var nodeDef = siblingsDef[i];\n                    // TagName\n                    if (!nodeDef.hasOwnProperty('tagName')) throw new Error('json-dom-parser: missing tagName');\n                    var tagName = nodeDef.tagName;\n                    // Namespace URI\n                    if (nodeDef.hasOwnProperty('namespaceURI')) ns = nodeDef.namespaceURI;\n                    var node = document.createElementNS(ns, tagName);\n                    var svg = (ns === svgNamespace);\n                    var wrapper = (svg) ? V : $;\n                    // Attributes\n                    var attributes = nodeDef.attributes;\n                    if (attributes) wrapper(node).attr(attributes);\n                    // Style\n                    var style = nodeDef.style;\n                    if (style) $(node).css(style);\n                    // ClassName\n                    if (nodeDef.hasOwnProperty('className')) {\n                        var className = nodeDef.className;\n                        if (svg) {\n                            node.className.baseVal = className;\n                        } else {\n                            node.className = className;\n                        }\n                    }\n                    // TextContent\n                    if (nodeDef.hasOwnProperty('textContent')) {\n                        node.textContent = nodeDef.textContent;\n                    }\n                    // Selector\n                    if (nodeDef.hasOwnProperty('selector')) {\n                        var nodeSelector = nodeDef.selector;\n                        if (selectors[nodeSelector]) throw new Error('json-dom-parser: selector must be unique');\n                        selectors[nodeSelector] = node;\n                        wrapper(node).attr('joint-selector', nodeSelector);\n                    }\n                    // Groups\n                    if (nodeDef.hasOwnProperty('groupSelector')) {\n                        var nodeGroups = nodeDef.groupSelector;\n                        if (!Array.isArray(nodeGroups)) nodeGroups = [nodeGroups];\n                        for (var j = 0, m = nodeGroups.length; j < m; j++) {\n                            var nodeGroup = nodeGroups[j];\n                            var group = groupSelectors[nodeGroup];\n                            if (!group) group = groupSelectors[nodeGroup] = [];\n                            group.push(node);\n                        }\n                    }\n                    parentNode.appendChild(node);\n                    // Children\n                    var childrenDef = nodeDef.children;\n                    if (Array.isArray(childrenDef)) queue.push(childrenDef, node, ns);\n                }\n            }\n            return {\n                fragment: fragment,\n                selectors: selectors,\n                groupSelectors: groupSelectors\n            };\n        },\n\n        /* global _:true */\n\n        // Deprecated\n        // Copy all the properties to the first argument from the following arguments.\n        // All the properties will be overwritten by the properties from the following\n        // arguments. Inherited properties are ignored.\n        mixin: _.assign,\n\n        // Deprecated\n        // Copy all properties to the first argument from the following\n        // arguments only in case if they don't exists in the first argument.\n        // All the function propererties in the first argument will get\n        // additional property base pointing to the extenders same named\n        // property function's call method.\n        supplement: _.defaults,\n\n        // Same as `mixin()` but deep version.\n        deepMixin: _.mixin,\n\n        // Deprecated\n        // Same as `supplement()` but deep version.\n        deepSupplement: _.defaultsDeep,\n\n        // Replacements for deprecated functions\n        assign: _.assign,\n        defaults: _.defaults,\n        // no better-named replacement for `deepMixin`\n        defaultsDeep: _.defaultsDeep,\n\n        // Lodash 3 vs 4 incompatible\n        invoke: _.invokeMap || _.invoke,\n        sortedIndex: _.sortedIndexBy || _.sortedIndex,\n        uniq: _.uniqBy || _.uniq,\n\n        clone: _.clone,\n        cloneDeep: _.cloneDeep,\n        isEmpty: _.isEmpty,\n        isEqual: _.isEqual,\n        isFunction: _.isFunction,\n        isPlainObject: _.isPlainObject,\n        toArray: _.toArray,\n        debounce: _.debounce,\n        groupBy: _.groupBy,\n        sortBy: _.sortBy,\n        flattenDeep: _.flattenDeep,\n        without: _.without,\n        difference: _.difference,\n        intersection: _.intersection,\n        union: _.union,\n        has: _.has,\n        result: _.result,\n        omit: _.omit,\n        pick: _.pick,\n        bindAll: _.bindAll,\n        forIn: _.forIn,\n        camelCase: _.camelCase,\n        uniqueId: _.uniqueId,\n\n        merge: function() {\n            if (_.mergeWith) {\n                var args = Array.from(arguments);\n                var last = args[args.length - 1];\n\n                var customizer =  this.isFunction(last) ? last : this.noop;\n                args.push(function(a,b) {\n                    var customResult = customizer(a, b);\n                    if (customResult !== undefined) {\n                        return customResult;\n                    }\n\n                    if (Array.isArray(a) && !Array.isArray(b)) {\n                        return b;\n                    }\n                });\n\n                return _.mergeWith.apply(this, args);\n            }\n            return _.merge.apply(this, arguments);\n        },\n\n        /* global _:false */\n\n        isBoolean: function(value) {\n            var toString = Object.prototype.toString;\n            return value === true || value === false || (!!value && typeof value === 'object' && toString.call(value) === '[object Boolean]');\n        },\n\n        isObject: function(value) {\n            return !!value && (typeof value === 'object' || typeof value === 'function');\n        },\n\n        isNumber: function(value) {\n            var toString = Object.prototype.toString;\n            return typeof value === 'number' || (!!value && typeof value === 'object' && toString.call(value) === '[object Number]');\n        },\n\n        isString: function(value) {\n            var toString = Object.prototype.toString;\n            return typeof value === 'string' || (!!value && typeof value === 'object' && toString.call(value) === '[object String]');\n        },\n\n        noop: function() {}\n    }\n};\n\n\njoint.mvc.View = Backbone.View.extend({\n\n    options: {},\n    theme: null,\n    themeClassNamePrefix: joint.util.addClassNamePrefix('theme-'),\n    requireSetThemeOverride: false,\n    defaultTheme: joint.config.defaultTheme,\n    children: null,\n    childNodes: null,\n\n    constructor: function(options) {\n\n        this.requireSetThemeOverride = options && !!options.theme;\n        this.options = joint.util.assign({}, this.options, options);\n\n        Backbone.View.call(this, options);\n    },\n\n    initialize: function(options) {\n\n        joint.util.bindAll(this, 'setTheme', 'onSetTheme', 'remove', 'onRemove');\n\n        joint.mvc.views[this.cid] = this;\n\n        this.setTheme(this.options.theme || this.defaultTheme);\n        this.init();\n    },\n\n    renderChildren: function(children) {\n        children || (children = this.children);\n        if (children) {\n            var namespace = V.namespace[this.svgElement ? 'xmlns' : 'xhtml'];\n            var doc = joint.util.parseDOMJSON(children, namespace);\n            this.vel.empty().append(doc.fragment);\n            this.childNodes = doc.selectors;\n        }\n        return this;\n    },\n\n    findAttribute: function(attributeName, node) {\n\n        var currentNode = node;\n\n        while (currentNode && currentNode.nodeType === 1) {\n            var attributeValue = currentNode.getAttribute(attributeName);\n            // attribute found\n            if (attributeValue) return attributeValue;\n            // do not climb up the DOM\n            if (currentNode === this.el) return null;\n            // try parent node\n            currentNode = currentNode.parentNode;\n        }\n\n        return null;\n    },\n\n    // Override the Backbone `_ensureElement()` method in order to create an\n    // svg element (e.g., `<g>`) node that wraps all the nodes of the Cell view.\n    // Expose class name setter as a separate method.\n    _ensureElement: function() {\n        if (!this.el) {\n            var tagName = joint.util.result(this, 'tagName');\n            var attrs = joint.util.assign({}, joint.util.result(this, 'attributes'));\n            if (this.id) attrs.id = joint.util.result(this, 'id');\n            this.setElement(this._createElement(tagName));\n            this._setAttributes(attrs);\n        } else {\n            this.setElement(joint.util.result(this, 'el'));\n        }\n        this._ensureElClassName();\n    },\n\n    _setAttributes: function(attrs) {\n        if (this.svgElement) {\n            this.vel.attr(attrs);\n        } else {\n            this.$el.attr(attrs);\n        }\n    },\n\n    _createElement: function(tagName) {\n        if (this.svgElement) {\n            return document.createElementNS(V.namespace.xmlns, tagName);\n        } else {\n            return document.createElement(tagName);\n        }\n    },\n\n    // Utilize an alternative DOM manipulation API by\n    // adding an element reference wrapped in Vectorizer.\n    _setElement: function(el) {\n        this.$el = el instanceof Backbone.$ ? el : Backbone.$(el);\n        this.el = this.$el[0];\n        if (this.svgElement) this.vel = V(this.el);\n    },\n\n    _ensureElClassName: function() {\n        var className = joint.util.result(this, 'className');\n        if (!className) return;\n        var prefixedClassName = joint.util.addClassNamePrefix(className);\n        // Note: className removal here kept for backwards compatibility only\n        if (this.svgElement) {\n            this.vel.removeClass(className).addClass(prefixedClassName);\n        } else {\n            this.$el.removeClass(className).addClass(prefixedClassName);\n        }\n    },\n\n    init: function() {\n        // Intentionally empty.\n        // This method is meant to be overriden.\n    },\n\n    onRender: function() {\n        // Intentionally empty.\n        // This method is meant to be overriden.\n    },\n\n    setTheme: function(theme, opt) {\n\n        opt = opt || {};\n\n        // Theme is already set, override is required, and override has not been set.\n        // Don't set the theme.\n        if (this.theme && this.requireSetThemeOverride && !opt.override) {\n            return this;\n        }\n\n        this.removeThemeClassName();\n        this.addThemeClassName(theme);\n        this.onSetTheme(this.theme/* oldTheme */, theme/* newTheme */);\n        this.theme = theme;\n\n        return this;\n    },\n\n    addThemeClassName: function(theme) {\n\n        theme = theme || this.theme;\n\n        var className = this.themeClassNamePrefix + theme;\n\n        if (this.svgElement) {\n            this.vel.addClass(className);\n        } else {\n            this.$el.addClass(className);\n        }\n\n        return this;\n    },\n\n    removeThemeClassName: function(theme) {\n\n        theme = theme || this.theme;\n\n        var className = this.themeClassNamePrefix + theme;\n\n        if (this.svgElement) {\n            this.vel.removeClass(className);\n        } else {\n            this.$el.removeClass(className);\n        }\n\n        return this;\n    },\n\n    onSetTheme: function(oldTheme, newTheme) {\n        // Intentionally empty.\n        // This method is meant to be overriden.\n    },\n\n    remove: function() {\n\n        this.onRemove();\n        this.undelegateDocumentEvents();\n\n        joint.mvc.views[this.cid] = null;\n\n        Backbone.View.prototype.remove.apply(this, arguments);\n\n        return this;\n    },\n\n    onRemove: function() {\n        // Intentionally empty.\n        // This method is meant to be overriden.\n    },\n\n    getEventNamespace: function() {\n        // Returns a per-session unique namespace\n        return '.joint-event-ns-' + this.cid;\n    },\n\n    delegateElementEvents: function(element, events, data) {\n        if (!events) return this;\n        data || (data = {});\n        var eventNS = this.getEventNamespace();\n        for (var eventName in events) {\n            var method = events[eventName];\n            if (typeof method !== 'function') method = this[method];\n            if (!method) continue;\n            $(element).on(eventName + eventNS, data, method.bind(this));\n        }\n        return this;\n    },\n\n    undelegateElementEvents: function(element) {\n        $(element).off(this.getEventNamespace());\n        return this;\n    },\n\n    delegateDocumentEvents: function(events, data) {\n        events || (events = joint.util.result(this, 'documentEvents'));\n        return this.delegateElementEvents(document, events, data);\n    },\n\n    undelegateDocumentEvents: function() {\n        return this.undelegateElementEvents(document);\n    },\n\n    eventData: function(evt, data) {\n        if (!evt) throw new Error('eventData(): event object required.');\n        var currentData = evt.data;\n        var key = '__' + this.cid + '__';\n        if (data === undefined) {\n            if (!currentData) return {};\n            return currentData[key] || {};\n        }\n        currentData || (currentData = evt.data = {});\n        currentData[key] || (currentData[key] = {});\n        joint.util.assign(currentData[key], data);\n        return this;\n    },\n\n    stopPropagation: function(evt) {\n        this.eventData(evt, { propagationStopped: true });\n        return this;\n    },\n\n    isPropagationStopped: function(evt) {\n        return !!this.eventData(evt).propagationStopped;\n    }\n\n}, {\n\n    extend: function() {\n\n        var args = Array.from(arguments);\n\n        // Deep clone the prototype and static properties objects.\n        // This prevents unexpected behavior where some properties are overwritten outside of this function.\n        var protoProps = args[0] && joint.util.assign({}, args[0]) || {};\n        var staticProps = args[1] && joint.util.assign({}, args[1]) || {};\n\n        // Need the real render method so that we can wrap it and call it later.\n        var renderFn = protoProps.render || (this.prototype && this.prototype.render) || null;\n\n        /*\n            Wrap the real render method so that:\n                .. `onRender` is always called.\n                .. `this` is always returned.\n        */\n        protoProps.render = function() {\n\n            if (typeof renderFn === 'function') {\n                // Call the original render method.\n                renderFn.apply(this, arguments);\n            }\n\n            if (this.render.__render__ === renderFn) {\n                // Should always call onRender() method.\n                // Should call it only once when renderFn is actual protoype method i.e. not the wrapper\n                this.onRender();\n            }\n\n            // Should always return itself.\n            return this;\n        };\n\n        protoProps.render.__render__ = renderFn;\n\n        return Backbone.View.extend.call(this, protoProps, staticProps);\n    }\n});\n\n\n\njoint.dia.GraphCells = Backbone.Collection.extend({\n\n    cellNamespace: joint.shapes,\n\n    initialize: function(models, opt) {\n\n        // Set the optional namespace where all model classes are defined.\n        if (opt.cellNamespace) {\n            this.cellNamespace = opt.cellNamespace;\n        }\n\n        this.graph = opt.graph;\n    },\n\n    model: function(attrs, opt) {\n\n        var collection = opt.collection;\n        var namespace = collection.cellNamespace;\n\n        // Find the model class in the namespace or use the default one.\n        var ModelClass = (attrs.type === 'link')\n            ? joint.dia.Link\n            : joint.util.getByPath(namespace, attrs.type, '.') || joint.dia.Element;\n\n        var cell = new ModelClass(attrs, opt);\n        // Add a reference to the graph. It is necessary to do this here because this is the earliest place\n        // where a new model is created from a plain JS object. For other objects, see `joint.dia.Graph>>_prepareCell()`.\n        if (!opt.dry) {\n            cell.graph = collection.graph;\n        }\n\n        return cell;\n    },\n\n    // `comparator` makes it easy to sort cells based on their `z` index.\n    comparator: function(model) {\n\n        return model.get('z') || 0;\n    }\n});\n\n\njoint.dia.Graph = Backbone.Model.extend({\n\n    _batches: {},\n\n    initialize: function(attrs, opt) {\n\n        opt = opt || {};\n\n        // Passing `cellModel` function in the options object to graph allows for\n        // setting models based on attribute objects. This is especially handy\n        // when processing JSON graphs that are in a different than JointJS format.\n        var cells = new joint.dia.GraphCells([], {\n            model: opt.cellModel,\n            cellNamespace: opt.cellNamespace,\n            graph: this\n        });\n        Backbone.Model.prototype.set.call(this, 'cells', cells);\n\n        // Make all the events fired in the `cells` collection available.\n        // to the outside world.\n        cells.on('all', this.trigger, this);\n\n        // Backbone automatically doesn't trigger re-sort if models attributes are changed later when\n        // they're already in the collection. Therefore, we're triggering sort manually here.\n        this.on('change:z', this._sortOnChangeZ, this);\n\n        // `joint.dia.Graph` keeps an internal data structure (an adjacency list)\n        // for fast graph queries. All changes that affect the structure of the graph\n        // must be reflected in the `al` object. This object provides fast answers to\n        // questions such as \"what are the neighbours of this node\" or \"what\n        // are the sibling links of this link\".\n\n        // Outgoing edges per node. Note that we use a hash-table for the list\n        // of outgoing edges for a faster lookup.\n        // [nodeId] -> Object [edgeId] -> true\n        this._out = {};\n        // Ingoing edges per node.\n        // [nodeId] -> Object [edgeId] -> true\n        this._in = {};\n        // `_nodes` is useful for quick lookup of all the elements in the graph, without\n        // having to go through the whole cells array.\n        // [node ID] -> true\n        this._nodes = {};\n        // `_edges` is useful for quick lookup of all the links in the graph, without\n        // having to go through the whole cells array.\n        // [edgeId] -> true\n        this._edges = {};\n\n        cells.on('add', this._restructureOnAdd, this);\n        cells.on('remove', this._restructureOnRemove, this);\n        cells.on('reset', this._restructureOnReset, this);\n        cells.on('change:source', this._restructureOnChangeSource, this);\n        cells.on('change:target', this._restructureOnChangeTarget, this);\n        cells.on('remove', this._removeCell, this);\n    },\n\n    _sortOnChangeZ: function() {\n\n        this.get('cells').sort();\n    },\n\n    _restructureOnAdd: function(cell) {\n\n        if (cell.isLink()) {\n            this._edges[cell.id] = true;\n            var source = cell.source();\n            var target = cell.target();\n            if (source.id) {\n                (this._out[source.id] || (this._out[source.id] = {}))[cell.id] = true;\n            }\n            if (target.id) {\n                (this._in[target.id] || (this._in[target.id] = {}))[cell.id] = true;\n            }\n        } else {\n            this._nodes[cell.id] = true;\n        }\n    },\n\n    _restructureOnRemove: function(cell) {\n\n        if (cell.isLink()) {\n            delete this._edges[cell.id];\n            var source = cell.source();\n            var target = cell.target();\n            if (source.id && this._out[source.id] && this._out[source.id][cell.id]) {\n                delete this._out[source.id][cell.id];\n            }\n            if (target.id && this._in[target.id] && this._in[target.id][cell.id]) {\n                delete this._in[target.id][cell.id];\n            }\n        } else {\n            delete this._nodes[cell.id];\n        }\n    },\n\n    _restructureOnReset: function(cells) {\n\n        // Normalize into an array of cells. The original `cells` is GraphCells Backbone collection.\n        cells = cells.models;\n\n        this._out = {};\n        this._in = {};\n        this._nodes = {};\n        this._edges = {};\n\n        cells.forEach(this._restructureOnAdd, this);\n    },\n\n    _restructureOnChangeSource: function(link) {\n\n        var prevSource = link.previous('source');\n        if (prevSource.id && this._out[prevSource.id]) {\n            delete this._out[prevSource.id][link.id];\n        }\n        var source = link.source();\n        if (source.id) {\n            (this._out[source.id] || (this._out[source.id] = {}))[link.id] = true;\n        }\n    },\n\n    _restructureOnChangeTarget: function(link) {\n\n        var prevTarget = link.previous('target');\n        if (prevTarget.id && this._in[prevTarget.id]) {\n            delete this._in[prevTarget.id][link.id];\n        }\n        var target = link.get('target');\n        if (target.id) {\n            (this._in[target.id] || (this._in[target.id] = {}))[link.id] = true;\n        }\n    },\n\n    // Return all outbound edges for the node. Return value is an object\n    // of the form: [edgeId] -> true\n    getOutboundEdges: function(node) {\n\n        return (this._out && this._out[node]) || {};\n    },\n\n    // Return all inbound edges for the node. Return value is an object\n    // of the form: [edgeId] -> true\n    getInboundEdges: function(node) {\n\n        return (this._in && this._in[node]) || {};\n    },\n\n    toJSON: function() {\n\n        // Backbone does not recursively call `toJSON()` on attributes that are themselves models/collections.\n        // It just clones the attributes. Therefore, we must call `toJSON()` on the cells collection explicitely.\n        var json = Backbone.Model.prototype.toJSON.apply(this, arguments);\n        json.cells = this.get('cells').toJSON();\n        return json;\n    },\n\n    fromJSON: function(json, opt) {\n\n        if (!json.cells) {\n\n            throw new Error('Graph JSON must contain cells array.');\n        }\n\n        return this.set(json, opt);\n    },\n\n    set: function(key, val, opt) {\n\n        var attrs;\n\n        // Handle both `key`, value and {key: value} style arguments.\n        if (typeof key === 'object') {\n            attrs = key;\n            opt = val;\n        } else {\n            (attrs = {})[key] = val;\n        }\n\n        // Make sure that `cells` attribute is handled separately via resetCells().\n        if (attrs.hasOwnProperty('cells')) {\n            this.resetCells(attrs.cells, opt);\n            attrs = joint.util.omit(attrs, 'cells');\n        }\n\n        // The rest of the attributes are applied via original set method.\n        return Backbone.Model.prototype.set.call(this, attrs, opt);\n    },\n\n    clear: function(opt) {\n\n        opt = joint.util.assign({}, opt, { clear: true });\n\n        var collection = this.get('cells');\n\n        if (collection.length === 0) return this;\n\n        this.startBatch('clear', opt);\n\n        // The elements come after the links.\n        var cells = collection.sortBy(function(cell) {\n            return cell.isLink() ? 1 : 2;\n        });\n\n        do {\n\n            // Remove all the cells one by one.\n            // Note that all the links are removed first, so it's\n            // safe to remove the elements without removing the connected\n            // links first.\n            cells.shift().remove(opt);\n\n        } while (cells.length > 0);\n\n        this.stopBatch('clear');\n\n        return this;\n    },\n\n    _prepareCell: function(cell, opt) {\n\n        var attrs;\n        if (cell instanceof Backbone.Model) {\n            attrs = cell.attributes;\n            if (!cell.graph && (!opt || !opt.dry)) {\n                // An element can not be member of more than one graph.\n                // A cell stops being the member of the graph after it's explicitly removed.\n                cell.graph = this;\n            }\n        } else {\n            // In case we're dealing with a plain JS object, we have to set the reference\n            // to the `graph` right after the actual model is created. This happens in the `model()` function\n            // of `joint.dia.GraphCells`.\n            attrs = cell;\n        }\n\n        if (!joint.util.isString(attrs.type)) {\n            throw new TypeError('dia.Graph: cell type must be a string.');\n        }\n\n        return cell;\n    },\n\n    minZIndex: function() {\n\n        var firstCell = this.get('cells').first();\n        return firstCell ? (firstCell.get('z') || 0) : 0;\n    },\n\n    maxZIndex: function() {\n\n        var lastCell = this.get('cells').last();\n        return lastCell ? (lastCell.get('z') || 0) : 0;\n    },\n\n    addCell: function(cell, opt) {\n\n        if (Array.isArray(cell)) {\n\n            return this.addCells(cell, opt);\n        }\n\n        if (cell instanceof Backbone.Model) {\n\n            if (!cell.has('z')) {\n                cell.set('z', this.maxZIndex() + 1);\n            }\n\n        } else if (cell.z === undefined) {\n\n            cell.z = this.maxZIndex() + 1;\n        }\n\n        this.get('cells').add(this._prepareCell(cell, opt), opt || {});\n\n        return this;\n    },\n\n    addCells: function(cells, opt) {\n\n        if (cells.length) {\n\n            cells = joint.util.flattenDeep(cells);\n            opt.position = cells.length;\n\n            this.startBatch('add');\n            cells.forEach(function(cell) {\n                opt.position--;\n                this.addCell(cell, opt);\n            }, this);\n            this.stopBatch('add');\n        }\n\n        return this;\n    },\n\n    // When adding a lot of cells, it is much more efficient to\n    // reset the entire cells collection in one go.\n    // Useful for bulk operations and optimizations.\n    resetCells: function(cells, opt) {\n\n        var preparedCells = joint.util.toArray(cells).map(function(cell) {\n            return this._prepareCell(cell, opt);\n        }, this);\n        this.get('cells').reset(preparedCells, opt);\n\n        return this;\n    },\n\n    removeCells: function(cells, opt) {\n\n        if (cells.length) {\n\n            this.startBatch('remove');\n            joint.util.invoke(cells, 'remove', opt);\n            this.stopBatch('remove');\n        }\n\n        return this;\n    },\n\n    _removeCell: function(cell, collection, options) {\n\n        options = options || {};\n\n        if (!options.clear) {\n            // Applications might provide a `disconnectLinks` option set to `true` in order to\n            // disconnect links when a cell is removed rather then removing them. The default\n            // is to remove all the associated links.\n            if (options.disconnectLinks) {\n\n                this.disconnectLinks(cell, options);\n\n            } else {\n\n                this.removeLinks(cell, options);\n            }\n        }\n        // Silently remove the cell from the cells collection. Silently, because\n        // `joint.dia.Cell.prototype.remove` already triggers the `remove` event which is\n        // then propagated to the graph model. If we didn't remove the cell silently, two `remove` events\n        // would be triggered on the graph model.\n        this.get('cells').remove(cell, { silent: true });\n\n        if (cell.graph === this) {\n            // Remove the element graph reference only if the cell is the member of this graph.\n            cell.graph = null;\n        }\n    },\n\n    // Get a cell by `id`.\n    getCell: function(id) {\n\n        return this.get('cells').get(id);\n    },\n\n    getCells: function() {\n\n        return this.get('cells').toArray();\n    },\n\n    getElements: function() {\n\n        return Object.keys(this._nodes).map(this.getCell, this);\n    },\n\n    getLinks: function() {\n\n        return Object.keys(this._edges).map(this.getCell, this);\n    },\n\n    getFirstCell: function() {\n\n        return this.get('cells').first();\n    },\n\n    getLastCell: function() {\n\n        return this.get('cells').last();\n    },\n\n    // Get all inbound and outbound links connected to the cell `model`.\n    getConnectedLinks: function(model, opt) {\n\n        opt = opt || {};\n\n        var inbound = opt.inbound;\n        var outbound = opt.outbound;\n        if ((inbound === undefined) && (outbound === undefined)) {\n            inbound = outbound = true;\n        }\n\n        // the final array of connected link models\n        var links = [];\n        // a hash table of connected edges of the form: [edgeId] -> true\n        // used for quick lookups to check if we already added a link\n        var edges = {};\n\n        if (outbound) {\n            joint.util.forIn(this.getOutboundEdges(model.id), function(exists, edge) {\n                if (!edges[edge]) {\n                    links.push(this.getCell(edge));\n                    edges[edge] = true;\n                }\n            }.bind(this));\n        }\n        if (inbound) {\n            joint.util.forIn(this.getInboundEdges(model.id), function(exists, edge) {\n                // skip links that were already added\n                // (those must be self-loop links)\n                // (because they are inbound and outbound edges of the same two elements)\n                if (!edges[edge]) {\n                    links.push(this.getCell(edge));\n                    edges[edge] = true;\n                }\n            }.bind(this));\n        }\n\n        // if `deep` option is `true`, check also all the links that are connected to any of the descendant cells\n        if (opt.deep) {\n\n            var embeddedCells = model.getEmbeddedCells({ deep: true });\n\n            // in the first round, we collect all the embedded elements\n            var embeddedElements = {};\n            embeddedCells.forEach(function(cell) {\n                if (cell.isElement()) {\n                    embeddedElements[cell.id] = true;\n                }\n            });\n\n            embeddedCells.forEach(function(cell) {\n                if (cell.isLink()) return;\n                if (outbound) {\n                    joint.util.forIn(this.getOutboundEdges(cell.id), function(exists, edge) {\n                        if (!edges[edge]) {\n                            var edgeCell = this.getCell(edge);\n                            var sourceId = edgeCell.source().id;\n                            var targetId = edgeCell.target().id;\n\n                            // if `includeEnclosed` option is falsy, skip enclosed links\n                            if (!opt.includeEnclosed\n                                && (sourceId && embeddedElements[sourceId])\n                                && (targetId && embeddedElements[targetId])) {\n                                return;\n                            }\n\n                            links.push(this.getCell(edge));\n                            edges[edge] = true;\n                        }\n                    }.bind(this));\n                }\n                if (inbound) {\n                    joint.util.forIn(this.getInboundEdges(cell.id), function(exists, edge) {\n                        if (!edges[edge]) {\n                            var edgeCell = this.getCell(edge);\n                            var sourceId = edgeCell.source().id;\n                            var targetId = edgeCell.target().id;\n\n                            // if `includeEnclosed` option is falsy, skip enclosed links\n                            if (!opt.includeEnclosed\n                                && (sourceId && embeddedElements[sourceId])\n                                && (targetId && embeddedElements[targetId])) {\n                                return;\n                            }\n\n                            links.push(this.getCell(edge));\n                            edges[edge] = true;\n                        }\n                    }.bind(this));\n                }\n            }, this);\n        }\n\n        return links;\n    },\n\n    getNeighbors: function(model, opt) {\n\n        opt = opt || {};\n\n        var inbound = opt.inbound;\n        var outbound = opt.outbound;\n        if (inbound === undefined && outbound === undefined) {\n            inbound = outbound = true;\n        }\n\n        var neighbors = this.getConnectedLinks(model, opt).reduce(function(res, link) {\n\n            var source = link.source();\n            var target = link.target();\n            var loop = link.hasLoop(opt);\n\n            // Discard if it is a point, or if the neighbor was already added.\n            if (inbound && joint.util.has(source, 'id') && !res[source.id]) {\n\n                var sourceElement = this.getCell(source.id);\n\n                if (loop || (sourceElement && sourceElement !== model && (!opt.deep || !sourceElement.isEmbeddedIn(model)))) {\n                    res[source.id] = sourceElement;\n                }\n            }\n\n            // Discard if it is a point, or if the neighbor was already added.\n            if (outbound && joint.util.has(target, 'id') && !res[target.id]) {\n\n                var targetElement = this.getCell(target.id);\n\n                if (loop || (targetElement && targetElement !== model && (!opt.deep || !targetElement.isEmbeddedIn(model)))) {\n                    res[target.id] = targetElement;\n                }\n            }\n\n            return res;\n        }.bind(this), {});\n\n        return joint.util.toArray(neighbors);\n    },\n\n    getCommonAncestor: function(/* cells */) {\n\n        var cellsAncestors = Array.from(arguments).map(function(cell) {\n\n            var ancestors = [];\n            var parentId = cell.get('parent');\n\n            while (parentId) {\n\n                ancestors.push(parentId);\n                parentId = this.getCell(parentId).get('parent');\n            }\n\n            return ancestors;\n\n        }, this);\n\n        cellsAncestors = cellsAncestors.sort(function(a, b) {\n            return a.length - b.length;\n        });\n\n        var commonAncestor = joint.util.toArray(cellsAncestors.shift()).find(function(ancestor) {\n            return cellsAncestors.every(function(cellAncestors) {\n                return cellAncestors.includes(ancestor);\n            });\n        });\n\n        return this.getCell(commonAncestor);\n    },\n\n    // Find the whole branch starting at `element`.\n    // If `opt.deep` is `true`, take into account embedded elements too.\n    // If `opt.breadthFirst` is `true`, use the Breadth-first search algorithm, otherwise use Depth-first search.\n    getSuccessors: function(element, opt) {\n\n        opt = opt || {};\n        var res = [];\n        // Modify the options so that it includes the `outbound` neighbors only. In other words, search forwards.\n        this.search(element, function(el) {\n            if (el !== element) {\n                res.push(el);\n            }\n        }, joint.util.assign({}, opt, { outbound: true }));\n        return res;\n    },\n\n    // Clone `cells` returning an object that maps the original cell ID to the clone. The number\n    // of clones is exactly the same as the `cells.length`.\n    // This function simply clones all the `cells`. However, it also reconstructs\n    // all the `source/target` and `parent/embed` references within the `cells`.\n    // This is the main difference from the `cell.clone()` method. The\n    // `cell.clone()` method works on one single cell only.\n    // For example, for a graph: `A --- L ---> B`, `cloneCells([A, L, B])`\n    // returns `[A2, L2, B2]` resulting to a graph: `A2 --- L2 ---> B2`, i.e.\n    // the source and target of the link `L2` is changed to point to `A2` and `B2`.\n    cloneCells: function(cells) {\n\n        cells = joint.util.uniq(cells);\n\n        // A map of the form [original cell ID] -> [clone] helping\n        // us to reconstruct references for source/target and parent/embeds.\n        // This is also the returned value.\n        var cloneMap = joint.util.toArray(cells).reduce(function(map, cell) {\n            map[cell.id] = cell.clone();\n            return map;\n        }, {});\n\n        joint.util.toArray(cells).forEach(function(cell) {\n\n            var clone = cloneMap[cell.id];\n            // assert(clone exists)\n\n            if (clone.isLink()) {\n                var source = clone.source();\n                var target = clone.target();\n                if (source.id && cloneMap[source.id]) {\n                    // Source points to an element and the element is among the clones.\n                    // => Update the source of the cloned link.\n                    clone.prop('source/id', cloneMap[source.id].id);\n                }\n                if (target.id && cloneMap[target.id]) {\n                    // Target points to an element and the element is among the clones.\n                    // => Update the target of the cloned link.\n                    clone.prop('target/id', cloneMap[target.id].id);\n                }\n            }\n\n            // Find the parent of the original cell\n            var parent = cell.get('parent');\n            if (parent && cloneMap[parent]) {\n                clone.set('parent', cloneMap[parent].id);\n            }\n\n            // Find the embeds of the original cell\n            var embeds = joint.util.toArray(cell.get('embeds')).reduce(function(newEmbeds, embed) {\n                // Embedded cells that are not being cloned can not be carried\n                // over with other embedded cells.\n                if (cloneMap[embed]) {\n                    newEmbeds.push(cloneMap[embed].id);\n                }\n                return newEmbeds;\n            }, []);\n\n            if (!joint.util.isEmpty(embeds)) {\n                clone.set('embeds', embeds);\n            }\n        });\n\n        return cloneMap;\n    },\n\n    // Clone the whole subgraph (including all the connected links whose source/target is in the subgraph).\n    // If `opt.deep` is `true`, also take into account all the embedded cells of all the subgraph cells.\n    // Return a map of the form: [original cell ID] -> [clone].\n    cloneSubgraph: function(cells, opt) {\n\n        var subgraph = this.getSubgraph(cells, opt);\n        return this.cloneCells(subgraph);\n    },\n\n    // Return `cells` and all the connected links that connect cells in the `cells` array.\n    // If `opt.deep` is `true`, return all the cells including all their embedded cells\n    // and all the links that connect any of the returned cells.\n    // For example, for a single shallow element, the result is that very same element.\n    // For two elements connected with a link: `A --- L ---> B`, the result for\n    // `getSubgraph([A, B])` is `[A, L, B]`. The same goes for `getSubgraph([L])`, the result is again `[A, L, B]`.\n    getSubgraph: function(cells, opt) {\n\n        opt = opt || {};\n\n        var subgraph = [];\n        // `cellMap` is used for a quick lookup of existance of a cell in the `cells` array.\n        var cellMap = {};\n        var elements = [];\n        var links = [];\n\n        joint.util.toArray(cells).forEach(function(cell) {\n            if (!cellMap[cell.id]) {\n                subgraph.push(cell);\n                cellMap[cell.id] = cell;\n                if (cell.isLink()) {\n                    links.push(cell);\n                } else {\n                    elements.push(cell);\n                }\n            }\n\n            if (opt.deep) {\n                var embeds = cell.getEmbeddedCells({ deep: true });\n                embeds.forEach(function(embed) {\n                    if (!cellMap[embed.id]) {\n                        subgraph.push(embed);\n                        cellMap[embed.id] = embed;\n                        if (embed.isLink()) {\n                            links.push(embed);\n                        } else {\n                            elements.push(embed);\n                        }\n                    }\n                });\n            }\n        });\n\n        links.forEach(function(link) {\n            // For links, return their source & target (if they are elements - not points).\n            var source = link.source();\n            var target = link.target();\n            if (source.id && !cellMap[source.id]) {\n                var sourceElement = this.getCell(source.id);\n                subgraph.push(sourceElement);\n                cellMap[sourceElement.id] = sourceElement;\n                elements.push(sourceElement);\n            }\n            if (target.id && !cellMap[target.id]) {\n                var targetElement = this.getCell(target.id);\n                subgraph.push(this.getCell(target.id));\n                cellMap[targetElement.id] = targetElement;\n                elements.push(targetElement);\n            }\n        }, this);\n\n        elements.forEach(function(element) {\n            // For elements, include their connected links if their source/target is in the subgraph;\n            var links = this.getConnectedLinks(element, opt);\n            links.forEach(function(link) {\n                var source = link.source();\n                var target = link.target();\n                if (!cellMap[link.id] && source.id && cellMap[source.id] && target.id && cellMap[target.id]) {\n                    subgraph.push(link);\n                    cellMap[link.id] = link;\n                }\n            });\n        }, this);\n\n        return subgraph;\n    },\n\n    // Find all the predecessors of `element`. This is a reverse operation of `getSuccessors()`.\n    // If `opt.deep` is `true`, take into account embedded elements too.\n    // If `opt.breadthFirst` is `true`, use the Breadth-first search algorithm, otherwise use Depth-first search.\n    getPredecessors: function(element, opt) {\n\n        opt = opt || {};\n        var res = [];\n        // Modify the options so that it includes the `inbound` neighbors only. In other words, search backwards.\n        this.search(element, function(el) {\n            if (el !== element) {\n                res.push(el);\n            }\n        }, joint.util.assign({}, opt, { inbound: true }));\n        return res;\n    },\n\n    // Perform search on the graph.\n    // If `opt.breadthFirst` is `true`, use the Breadth-first Search algorithm, otherwise use Depth-first search.\n    // By setting `opt.inbound` to `true`, you can reverse the direction of the search.\n    // If `opt.deep` is `true`, take into account embedded elements too.\n    // `iteratee` is a function of the form `function(element) {}`.\n    // If `iteratee` explicitely returns `false`, the searching stops.\n    search: function(element, iteratee, opt) {\n\n        opt = opt || {};\n        if (opt.breadthFirst) {\n            this.bfs(element, iteratee, opt);\n        } else {\n            this.dfs(element, iteratee, opt);\n        }\n    },\n\n    // Breadth-first search.\n    // If `opt.deep` is `true`, take into account embedded elements too.\n    // If `opt.inbound` is `true`, reverse the search direction (it's like reversing all the link directions).\n    // `iteratee` is a function of the form `function(element, distance) {}`.\n    // where `element` is the currently visited element and `distance` is the distance of that element\n    // from the root `element` passed the `bfs()`, i.e. the element we started the search from.\n    // Note that the `distance` is not the shortest or longest distance, it is simply the number of levels\n    // crossed till we visited the `element` for the first time. It is especially useful for tree graphs.\n    // If `iteratee` explicitely returns `false`, the searching stops.\n    bfs: function(element, iteratee, opt) {\n\n        opt = opt || {};\n        var visited = {};\n        var distance = {};\n        var queue = [];\n\n        queue.push(element);\n        distance[element.id] = 0;\n\n        while (queue.length > 0) {\n            var next = queue.shift();\n            if (!visited[next.id]) {\n                visited[next.id] = true;\n                if (iteratee(next, distance[next.id]) === false) return;\n                this.getNeighbors(next, opt).forEach(function(neighbor) {\n                    distance[neighbor.id] = distance[next.id] + 1;\n                    queue.push(neighbor);\n                });\n            }\n        }\n    },\n\n    // Depth-first search.\n    // If `opt.deep` is `true`, take into account embedded elements too.\n    // If `opt.inbound` is `true`, reverse the search direction (it's like reversing all the link directions).\n    // `iteratee` is a function of the form `function(element, distance) {}`.\n    // If `iteratee` explicitely returns `false`, the search stops.\n    dfs: function(element, iteratee, opt, _visited, _distance) {\n\n        opt = opt || {};\n        var visited = _visited || {};\n        var distance = _distance || 0;\n        if (iteratee(element, distance) === false) return;\n        visited[element.id] = true;\n\n        this.getNeighbors(element, opt).forEach(function(neighbor) {\n            if (!visited[neighbor.id]) {\n                this.dfs(neighbor, iteratee, opt, visited, distance + 1);\n            }\n        }, this);\n    },\n\n    // Get all the roots of the graph. Time complexity: O(|V|).\n    getSources: function() {\n\n        var sources = [];\n        joint.util.forIn(this._nodes, function(exists, node) {\n            if (!this._in[node] || joint.util.isEmpty(this._in[node])) {\n                sources.push(this.getCell(node));\n            }\n        }.bind(this));\n        return sources;\n    },\n\n    // Get all the leafs of the graph. Time complexity: O(|V|).\n    getSinks: function() {\n\n        var sinks = [];\n        joint.util.forIn(this._nodes, function(exists, node) {\n            if (!this._out[node] || joint.util.isEmpty(this._out[node])) {\n                sinks.push(this.getCell(node));\n            }\n        }.bind(this));\n        return sinks;\n    },\n\n    // Return `true` if `element` is a root. Time complexity: O(1).\n    isSource: function(element) {\n\n        return !this._in[element.id] || joint.util.isEmpty(this._in[element.id]);\n    },\n\n    // Return `true` if `element` is a leaf. Time complexity: O(1).\n    isSink: function(element) {\n\n        return !this._out[element.id] || joint.util.isEmpty(this._out[element.id]);\n    },\n\n    // Return `true` is `elementB` is a successor of `elementA`. Return `false` otherwise.\n    isSuccessor: function(elementA, elementB) {\n\n        var isSuccessor = false;\n        this.search(elementA, function(element) {\n            if (element === elementB && element !== elementA) {\n                isSuccessor = true;\n                return false;\n            }\n        }, { outbound: true });\n        return isSuccessor;\n    },\n\n    // Return `true` is `elementB` is a predecessor of `elementA`. Return `false` otherwise.\n    isPredecessor: function(elementA, elementB) {\n\n        var isPredecessor = false;\n        this.search(elementA, function(element) {\n            if (element === elementB && element !== elementA) {\n                isPredecessor = true;\n                return false;\n            }\n        }, { inbound: true });\n        return isPredecessor;\n    },\n\n    // Return `true` is `elementB` is a neighbor of `elementA`. Return `false` otherwise.\n    // `opt.deep` controls whether to take into account embedded elements as well. See `getNeighbors()`\n    // for more details.\n    // If `opt.outbound` is set to `true`, return `true` only if `elementB` is a successor neighbor.\n    // Similarly, if `opt.inbound` is set to `true`, return `true` only if `elementB` is a predecessor neighbor.\n    isNeighbor: function(elementA, elementB, opt) {\n\n        opt = opt || {};\n\n        var inbound = opt.inbound;\n        var outbound = opt.outbound;\n        if ((inbound === undefined) && (outbound === undefined)) {\n            inbound = outbound = true;\n        }\n\n        var isNeighbor = false;\n\n        this.getConnectedLinks(elementA, opt).forEach(function(link) {\n\n            var source = link.source();\n            var target = link.target();\n\n            // Discard if it is a point.\n            if (inbound && joint.util.has(source, 'id') && (source.id === elementB.id)) {\n                isNeighbor = true;\n                return false;\n            }\n\n            // Discard if it is a point, or if the neighbor was already added.\n            if (outbound && joint.util.has(target, 'id') && (target.id === elementB.id)) {\n                isNeighbor = true;\n                return false;\n            }\n        });\n\n        return isNeighbor;\n    },\n\n    // Disconnect links connected to the cell `model`.\n    disconnectLinks: function(model, opt) {\n\n        this.getConnectedLinks(model).forEach(function(link) {\n\n            link.set((link.source().id === model.id ? 'source' : 'target'), { x: 0, y: 0 }, opt);\n        });\n    },\n\n    // Remove links connected to the cell `model` completely.\n    removeLinks: function(model, opt) {\n\n        joint.util.invoke(this.getConnectedLinks(model), 'remove', opt);\n    },\n\n    // Find all elements at given point\n    findModelsFromPoint: function(p) {\n\n        return this.getElements().filter(function(el) {\n            return el.getBBox().containsPoint(p);\n        });\n    },\n\n    // Find all elements in given area\n    findModelsInArea: function(rect, opt) {\n\n        rect = g.rect(rect);\n        opt = joint.util.defaults(opt || {}, { strict: false });\n\n        var method = opt.strict ? 'containsRect' : 'intersect';\n\n        return this.getElements().filter(function(el) {\n            return rect[method](el.getBBox());\n        });\n    },\n\n    // Find all elements under the given element.\n    findModelsUnderElement: function(element, opt) {\n\n        opt = joint.util.defaults(opt || {}, { searchBy: 'bbox' });\n\n        var bbox = element.getBBox();\n        var elements = (opt.searchBy === 'bbox')\n            ? this.findModelsInArea(bbox)\n            : this.findModelsFromPoint(bbox[opt.searchBy]());\n\n        // don't account element itself or any of its descendents\n        return elements.filter(function(el) {\n            return element.id !== el.id && !el.isEmbeddedIn(element);\n        });\n    },\n\n\n    // Return bounding box of all elements.\n    getBBox: function(cells, opt) {\n\n        return this.getCellsBBox(cells || this.getElements(), opt);\n    },\n\n    // Return the bounding box of all cells in array provided.\n    // Links are being ignored.\n    getCellsBBox: function(cells, opt) {\n\n        return joint.util.toArray(cells).reduce(function(memo, cell) {\n            if (cell.isLink()) return memo;\n            var rect = cell.getBBox(opt);\n            var angle = cell.angle();\n            if (angle) rect = rect.bbox(angle);\n            if (memo) {\n                return memo.union(rect);\n            } else {\n                return rect;\n            }\n        }, null);\n    },\n\n    translate: function(dx, dy, opt) {\n\n        // Don't translate cells that are embedded in any other cell.\n        var cells = this.getCells().filter(function(cell) {\n            return !cell.isEmbedded();\n        });\n\n        joint.util.invoke(cells, 'translate', dx, dy, opt);\n\n        return this;\n    },\n\n    resize: function(width, height, opt) {\n\n        return this.resizeCells(width, height, this.getCells(), opt);\n    },\n\n    resizeCells: function(width, height, cells, opt) {\n\n        // `getBBox` method returns `null` if no elements provided.\n        // i.e. cells can be an array of links\n        var bbox = this.getCellsBBox(cells);\n        if (bbox) {\n            var sx = Math.max(width / bbox.width, 0);\n            var sy = Math.max(height / bbox.height, 0);\n            joint.util.invoke(cells, 'scale', sx, sy, bbox.origin(), opt);\n        }\n\n        return this;\n    },\n\n    startBatch: function(name, data) {\n\n        data = data || {};\n        this._batches[name] = (this._batches[name] || 0) + 1;\n\n        return this.trigger('batch:start', joint.util.assign({}, data, { batchName: name }));\n    },\n\n    stopBatch: function(name, data) {\n\n        data = data || {};\n        this._batches[name] = (this._batches[name] || 0) - 1;\n\n        return this.trigger('batch:stop', joint.util.assign({}, data, { batchName: name }));\n    },\n\n    hasActiveBatch: function(name) {\n\n        if (arguments.length === 0) {\n            return joint.util.toArray(this._batches).some(function(batches) {\n                return batches > 0;\n            });\n        }\n        if (Array.isArray(name)) {\n            return name.some(function(name) {\n                return !!this._batches[name];\n            }, this);\n        }\n        return !!this._batches[name];\n    }\n\n}, {\n\n    validations: {\n\n        multiLinks: function(graph, link) {\n\n            // Do not allow multiple links to have the same source and target.\n            var source = link.source();\n            var target = link.target();\n\n            if (source.id && target.id) {\n\n                var sourceModel = link.getSourceElement();\n                if (sourceModel) {\n\n                    var connectedLinks = graph.getConnectedLinks(sourceModel, { outbound: true });\n                    var sameLinks = connectedLinks.filter(function(_link) {\n\n                        var _source = _link.source();\n                        var _target = _link.target();\n\n                        return _source && _source.id === source.id &&\n                            (!_source.port || (_source.port === source.port)) &&\n                            _target && _target.id === target.id &&\n                            (!_target.port || (_target.port === target.port));\n\n                    });\n\n                    if (sameLinks.length > 1) {\n                        return false;\n                    }\n                }\n            }\n\n            return true;\n        },\n\n        linkPinning: function(graph, link) {\n            return link.source().id && link.target().id;\n        }\n    }\n\n});\n\njoint.util.wrapWith(joint.dia.Graph.prototype, ['resetCells', 'addCells', 'removeCells'], 'cells');\n\n(function(joint, V, g, $, util) {\n\n    function setWrapper(attrName, dimension) {\n        return function(value, refBBox) {\n            var isValuePercentage = util.isPercentage(value);\n            value = parseFloat(value);\n            if (isValuePercentage) {\n                value /= 100;\n            }\n\n            var attrs = {};\n            if (isFinite(value)) {\n                var attrValue = (isValuePercentage || value >= 0 && value <= 1)\n                    ? value * refBBox[dimension]\n                    : Math.max(value + refBBox[dimension], 0);\n                attrs[attrName] = attrValue;\n            }\n\n            return attrs;\n        };\n    }\n\n    function positionWrapper(axis, dimension, origin) {\n        return function(value, refBBox) {\n            var valuePercentage = util.isPercentage(value);\n            value = parseFloat(value);\n            if (valuePercentage) {\n                value /= 100;\n            }\n\n            var delta;\n            if (isFinite(value)) {\n                var refOrigin = refBBox[origin]();\n                if (valuePercentage || value > 0 && value < 1) {\n                    delta = refOrigin[axis] + refBBox[dimension] * value;\n                } else {\n                    delta = refOrigin[axis] + value;\n                }\n            }\n\n            var point = g.Point();\n            point[axis] = delta || 0;\n            return point;\n        };\n    }\n\n    function offsetWrapper(axis, dimension, corner) {\n        return function(value, nodeBBox) {\n            var delta;\n            if (value === 'middle') {\n                delta = nodeBBox[dimension] / 2;\n            } else if (value === corner) {\n                delta = nodeBBox[dimension];\n            } else if (isFinite(value)) {\n                // TODO: or not to do a breaking change?\n                delta = (value > -1 && value < 1) ? (-nodeBBox[dimension] * value) : -value;\n            } else if (util.isPercentage(value)) {\n                delta = nodeBBox[dimension] * parseFloat(value) / 100;\n            } else {\n                delta = 0;\n            }\n\n            var point = g.Point();\n            point[axis] = -(nodeBBox[axis] + delta);\n            return point;\n        };\n    }\n\n    function shapeWrapper(shapeConstructor, opt) {\n        var cacheName = 'joint-shape';\n        var resetOffset = opt && opt.resetOffset;\n        return function(value, refBBox, node) {\n            var $node = $(node);\n            var cache = $node.data(cacheName);\n            if (!cache || cache.value !== value) {\n                // only recalculate if value has changed\n                var cachedShape = shapeConstructor(value);\n                cache = {\n                    value: value,\n                    shape: cachedShape,\n                    shapeBBox: cachedShape.bbox()\n                };\n                $node.data(cacheName, cache);\n            }\n\n            var shape = cache.shape.clone();\n            var shapeBBox = cache.shapeBBox.clone();\n            var shapeOrigin = shapeBBox.origin();\n            var refOrigin = refBBox.origin();\n\n            shapeBBox.x = refOrigin.x;\n            shapeBBox.y = refOrigin.y;\n\n            var fitScale = refBBox.maxRectScaleToFit(shapeBBox, refOrigin);\n            // `maxRectScaleToFit` can give Infinity if width or height is 0\n            var sx = (shapeBBox.width === 0 || refBBox.width === 0) ? 1 : fitScale.sx;\n            var sy = (shapeBBox.height === 0 || refBBox.height === 0) ? 1 : fitScale.sy;\n\n            shape.scale(sx, sy, shapeOrigin);\n            if (resetOffset) {\n                shape.translate(-shapeOrigin.x, -shapeOrigin.y);\n            }\n\n            return shape;\n        };\n    }\n\n    // `d` attribute for SVGPaths\n    function dWrapper(opt) {\n        function pathConstructor(value) {\n            return new g.Path(V.normalizePathData(value));\n        }\n        var shape = shapeWrapper(pathConstructor, opt);\n        return function(value, refBBox, node) {\n            var path = shape(value, refBBox, node);\n            return {\n                d: path.serialize()\n            };\n        };\n    }\n\n    // `points` attribute for SVGPolylines and SVGPolygons\n    function pointsWrapper(opt) {\n        var shape = shapeWrapper(g.Polyline, opt);\n        return function(value, refBBox, node) {\n            var polyline = shape(value, refBBox, node);\n            return {\n                points: polyline.serialize()\n            };\n        };\n    }\n\n    function atConnectionWrapper(method, opt) {\n        var zeroVector = new g.Point(1, 0);\n        return function(value) {\n            var p, angle;\n            var tangent = this[method](value);\n            if (tangent) {\n                angle = (opt.rotate) ? tangent.vector().vectorAngle(zeroVector) : 0;\n                p = tangent.start;\n            } else {\n                p = this.path.start;\n                angle = 0;\n            }\n            if (angle === 0) return { transform: 'translate(' + p.x + ',' + p.y + ')' };\n            return { transform: 'translate(' + p.x + ',' + p.y + ') rotate(' + angle + ')' };\n        };\n    }\n\n    function isTextInUse(lineHeight, node, attrs) {\n        return (attrs.text !== undefined);\n    }\n\n    function isLinkView() {\n        return this instanceof joint.dia.LinkView;\n    }\n\n    function contextMarker(context) {\n        var marker = {};\n        // Stroke\n        // The context 'fill' is disregared here. The usual case is to use the marker with a connection\n        // (for which 'fill' attribute is set to 'none').\n        var stroke = context.stroke;\n        if (typeof stroke === 'string') {\n            marker['stroke'] = stroke;\n            marker['fill'] = stroke;\n        }\n        // Opacity\n        // Again the context 'fill-opacity' is ignored.\n        var strokeOpacity = context.strokeOpacity;\n        if (strokeOpacity === undefined) strokeOpacity = context['stroke-opacity'];\n        if (strokeOpacity === undefined) strokeOpacity = context.opacity;\n        if (strokeOpacity !== undefined) {\n            marker['stroke-opacity'] = strokeOpacity;\n            marker['fill-opacity'] = strokeOpacity;\n        }\n        return marker;\n    }\n\n    var attributesNS = joint.dia.attributes = {\n\n        xlinkHref: {\n            set: 'xlink:href'\n        },\n\n        xlinkShow: {\n            set: 'xlink:show'\n        },\n\n        xlinkRole: {\n            set: 'xlink:role'\n        },\n\n        xlinkType: {\n            set: 'xlink:type'\n        },\n\n        xlinkArcrole: {\n            set: 'xlink:arcrole'\n        },\n\n        xlinkTitle: {\n            set: 'xlink:title'\n        },\n\n        xlinkActuate: {\n            set: 'xlink:actuate'\n        },\n\n        xmlSpace: {\n            set: 'xml:space'\n        },\n\n        xmlBase: {\n            set: 'xml:base'\n        },\n\n        xmlLang: {\n            set: 'xml:lang'\n        },\n\n        preserveAspectRatio: {\n            set: 'preserveAspectRatio'\n        },\n\n        requiredExtension: {\n            set: 'requiredExtension'\n        },\n\n        requiredFeatures: {\n            set: 'requiredFeatures'\n        },\n\n        systemLanguage: {\n            set: 'systemLanguage'\n        },\n\n        externalResourcesRequired: {\n            set: 'externalResourceRequired'\n        },\n\n        filter: {\n            qualify: util.isPlainObject,\n            set: function(filter) {\n                return 'url(#' + this.paper.defineFilter(filter) + ')';\n            }\n        },\n\n        fill: {\n            qualify: util.isPlainObject,\n            set: function(fill) {\n                return 'url(#' + this.paper.defineGradient(fill) + ')';\n            }\n        },\n\n        stroke: {\n            qualify: util.isPlainObject,\n            set: function(stroke) {\n                return 'url(#' + this.paper.defineGradient(stroke) + ')';\n            }\n        },\n\n        sourceMarker: {\n            qualify: util.isPlainObject,\n            set: function(marker, refBBox, node, attrs) {\n                marker = util.assign(contextMarker(attrs), marker);\n                return { 'marker-start': 'url(#' + this.paper.defineMarker(marker) + ')' };\n            }\n        },\n\n        targetMarker: {\n            qualify: util.isPlainObject,\n            set: function(marker, refBBox, node, attrs) {\n                marker = util.assign(contextMarker(attrs), { 'transform': 'rotate(180)' }, marker);\n                return { 'marker-end': 'url(#' + this.paper.defineMarker(marker) + ')' };\n            }\n        },\n\n        vertexMarker: {\n            qualify: util.isPlainObject,\n            set: function(marker, refBBox, node, attrs) {\n                marker = util.assign(contextMarker(attrs), marker);\n                return { 'marker-mid': 'url(#' + this.paper.defineMarker(marker) + ')' };\n            }\n        },\n\n        text: {\n            qualify: function(text, node, attrs) {\n                return !attrs.textWrap || !util.isPlainObject(attrs.textWrap);\n            },\n            set: function(text, refBBox, node, attrs) {\n                var $node = $(node);\n                var cacheName = 'joint-text';\n                var cache = $node.data(cacheName);\n                var textAttrs = util.pick(attrs, 'lineHeight', 'annotations', 'textPath', 'x', 'textVerticalAnchor', 'eol');\n                var fontSize = textAttrs.fontSize = attrs['font-size'] || attrs['fontSize'];\n                var textHash = JSON.stringify([text, textAttrs]);\n                // Update the text only if there was a change in the string\n                // or any of its attributes.\n                if (cache === undefined || cache !== textHash) {\n                    // Chrome bug:\n                    // Tspans positions defined as `em` are not updated\n                    // when container `font-size` change.\n                    if (fontSize) node.setAttribute('font-size', fontSize);\n                    // Text Along Path Selector\n                    var textPath = textAttrs.textPath;\n                    if (util.isObject(textPath)) {\n                        var pathSelector = textPath.selector;\n                        if (typeof pathSelector === 'string') {\n                            var pathNode = this.findBySelector(pathSelector)[0];\n                            if (pathNode instanceof SVGPathElement) {\n                                textAttrs.textPath = util.assign({ 'xlink:href': '#' + pathNode.id }, textPath);\n                            }\n                        }\n                    }\n                    V(node).text('' + text, textAttrs);\n                    $node.data(cacheName, textHash);\n                }\n            }\n        },\n\n        textWrap: {\n            qualify: util.isPlainObject,\n            set: function(value, refBBox, node, attrs) {\n                // option `width`\n                var width = value.width || 0;\n                if (util.isPercentage(width)) {\n                    refBBox.width *= parseFloat(width) / 100;\n                } else if (width <= 0) {\n                    refBBox.width += width;\n                } else {\n                    refBBox.width = width;\n                }\n                // option `height`\n                var height = value.height || 0;\n                if (util.isPercentage(height)) {\n                    refBBox.height *= parseFloat(height) / 100;\n                } else if (height <= 0) {\n                    refBBox.height += height;\n                } else {\n                    refBBox.height = height;\n                }\n                // option `text`\n                var wrappedText;\n                var text = value.text;\n                if (text === undefined) text = attrs.text;\n                if (text !== undefined) {\n                    wrappedText = util.breakText('' + text, refBBox, {\n                        'font-weight': attrs['font-weight'] || attrs.fontWeight,\n                        'font-size': attrs['font-size'] || attrs.fontSize,\n                        'font-family': attrs['font-family'] || attrs.fontFamily,\n                        'lineHeight': attrs.lineHeight\n                    }, {\n                        // Provide an existing SVG Document here\n                        // instead of creating a temporary one over again.\n                        svgDocument: this.paper.svg,\n                        ellipsis: value.ellipsis\n                    });\n                } else {\n                    wrappedText = '';\n                }\n                joint.dia.attributes.text.set.call(this, wrappedText, refBBox, node, attrs);\n            }\n        },\n\n        title: {\n            qualify: function(title, node) {\n                // HTMLElement title is specified via an attribute (i.e. not an element)\n                return node instanceof SVGElement;\n            },\n            set: function(title, refBBox, node) {\n                var $node = $(node);\n                var cacheName = 'joint-title';\n                var cache = $node.data(cacheName);\n                if (cache === undefined || cache !== title) {\n                    $node.data(cacheName, title);\n                    // Generally <title> element should be the first child element of its parent.\n                    var firstChild = node.firstChild;\n                    if (firstChild && firstChild.tagName.toUpperCase() === 'TITLE') {\n                        // Update an existing title\n                        firstChild.textContent = title;\n                    } else {\n                        // Create a new title\n                        var titleNode = document.createElementNS(node.namespaceURI, 'title');\n                        titleNode.textContent = title;\n                        node.insertBefore(titleNode, firstChild);\n                    }\n                }\n            }\n        },\n\n        lineHeight: {\n            qualify: isTextInUse\n        },\n\n        textVerticalAnchor: {\n            qualify: isTextInUse\n        },\n\n        textPath: {\n            qualify: isTextInUse\n        },\n\n        annotations: {\n            qualify: isTextInUse\n        },\n\n        // `port` attribute contains the `id` of the port that the underlying magnet represents.\n        port: {\n            set: function(port) {\n                return (port === null || port.id === undefined) ? port : port.id;\n            }\n        },\n\n        // `style` attribute is special in the sense that it sets the CSS style of the subelement.\n        style: {\n            qualify: util.isPlainObject,\n            set: function(styles, refBBox, node) {\n                $(node).css(styles);\n            }\n        },\n\n        html: {\n            set: function(html, refBBox, node) {\n                $(node).html(html + '');\n            }\n        },\n\n        ref: {\n            // We do not set `ref` attribute directly on an element.\n            // The attribute itself does not qualify for relative positioning.\n        },\n\n        // if `refX` is in [0, 1] then `refX` is a fraction of bounding box width\n        // if `refX` is < 0 then `refX`'s absolute values is the right coordinate of the bounding box\n        // otherwise, `refX` is the left coordinate of the bounding box\n\n        refX: {\n            position: positionWrapper('x', 'width', 'origin')\n        },\n\n        refY: {\n            position: positionWrapper('y', 'height', 'origin')\n        },\n\n        // `ref-dx` and `ref-dy` define the offset of the subelement relative to the right and/or bottom\n        // coordinate of the reference element.\n\n        refDx: {\n            position: positionWrapper('x', 'width', 'corner')\n        },\n\n        refDy: {\n            position: positionWrapper('y', 'height', 'corner')\n        },\n\n        // 'ref-width'/'ref-height' defines the width/height of the subelement relatively to\n        // the reference element size\n        // val in 0..1         ref-width = 0.75 sets the width to 75% of the ref. el. width\n        // val < 0 || val > 1  ref-height = -20 sets the height to the the ref. el. height shorter by 20\n\n        refWidth: {\n            set: setWrapper('width', 'width')\n        },\n\n        refHeight: {\n            set: setWrapper('height', 'height')\n        },\n\n        refRx: {\n            set: setWrapper('rx', 'width')\n        },\n\n        refRy: {\n            set: setWrapper('ry', 'height')\n        },\n\n        refRInscribed: {\n            set: (function(attrName) {\n                var widthFn = setWrapper(attrName, 'width');\n                var heightFn = setWrapper(attrName, 'height');\n                return function(value, refBBox) {\n                    var fn = (refBBox.height > refBBox.width) ? widthFn : heightFn;\n                    return fn(value, refBBox);\n                };\n            })('r')\n        },\n\n        refRCircumscribed: {\n            set: function(value, refBBox) {\n                var isValuePercentage = util.isPercentage(value);\n                value = parseFloat(value);\n                if (isValuePercentage) {\n                    value /= 100;\n                }\n\n                var diagonalLength = Math.sqrt((refBBox.height * refBBox.height) + (refBBox.width * refBBox.width));\n\n                var rValue;\n                if (isFinite(value)) {\n                    if (isValuePercentage || value >= 0 && value <= 1) rValue = value * diagonalLength;\n                    else rValue = Math.max(value + diagonalLength, 0);\n                }\n\n                return { r: rValue };\n            }\n        },\n\n        refCx: {\n            set: setWrapper('cx', 'width')\n        },\n\n        refCy: {\n            set: setWrapper('cy', 'height')\n        },\n\n        // `x-alignment` when set to `middle` causes centering of the subelement around its new x coordinate.\n        // `x-alignment` when set to `right` uses the x coordinate as referenced to the right of the bbox.\n\n        xAlignment: {\n            offset: offsetWrapper('x', 'width', 'right')\n        },\n\n        // `y-alignment` when set to `middle` causes centering of the subelement around its new y coordinate.\n        // `y-alignment` when set to `bottom` uses the y coordinate as referenced to the bottom of the bbox.\n\n        yAlignment: {\n            offset: offsetWrapper('y', 'height', 'bottom')\n        },\n\n        resetOffset: {\n            offset: function(val, nodeBBox) {\n                return (val)\n                    ? { x: -nodeBBox.x, y: -nodeBBox.y }\n                    : { x: 0, y: 0 };\n            }\n\n        },\n\n        refDResetOffset: {\n            set: dWrapper({ resetOffset: true })\n        },\n\n        refDKeepOffset: {\n            set: dWrapper({ resetOffset: false })\n        },\n\n        refPointsResetOffset: {\n            set: pointsWrapper({ resetOffset: true })\n        },\n\n        refPointsKeepOffset: {\n            set: pointsWrapper({ resetOffset: false })\n        },\n\n        // LinkView Attributes\n\n        connection: {\n            qualify: isLinkView,\n            set: function() {\n                return { d: this.getSerializedConnection() };\n            }\n        },\n\n        atConnectionLengthKeepGradient: {\n            qualify: isLinkView,\n            set: atConnectionWrapper('getTangentAtLength', { rotate: true })\n        },\n\n        atConnectionLengthIgnoreGradient: {\n            qualify: isLinkView,\n            set: atConnectionWrapper('getTangentAtLength', { rotate: false })\n        },\n\n        atConnectionRatioKeepGradient: {\n            qualify: isLinkView,\n            set: atConnectionWrapper('getTangentAtRatio', { rotate: true })\n        },\n\n        atConnectionRatioIgnoreGradient: {\n            qualify: isLinkView,\n            set: atConnectionWrapper('getTangentAtRatio', { rotate: false })\n        }\n    };\n\n    // Aliases\n    attributesNS.refR = attributesNS.refRInscribed;\n    attributesNS.refD = attributesNS.refDResetOffset;\n    attributesNS.refPoints = attributesNS.refPointsResetOffset;\n    attributesNS.atConnectionLength = attributesNS.atConnectionLengthKeepGradient;\n    attributesNS.atConnectionRatio = attributesNS.atConnectionRatioKeepGradient;\n\n    // This allows to combine both absolute and relative positioning\n    // refX: 50%, refX2: 20\n    attributesNS.refX2 = attributesNS.refX;\n    attributesNS.refY2 = attributesNS.refY;\n    attributesNS.refWidth2 = attributesNS.refWidth;\n    attributesNS.refHeight2 = attributesNS.refHeight;\n\n    // Aliases for backwards compatibility\n    attributesNS['ref-x'] = attributesNS.refX;\n    attributesNS['ref-y'] = attributesNS.refY;\n    attributesNS['ref-dy'] = attributesNS.refDy;\n    attributesNS['ref-dx'] = attributesNS.refDx;\n    attributesNS['ref-width'] = attributesNS.refWidth;\n    attributesNS['ref-height'] = attributesNS.refHeight;\n    attributesNS['x-alignment'] = attributesNS.xAlignment;\n    attributesNS['y-alignment'] = attributesNS.yAlignment;\n\n})(joint, V, g, $, joint.util);\n\n(function(joint, util) {\n\n    var ToolView = joint.mvc.View.extend({\n        name: null,\n        tagName: 'g',\n        className: 'tool',\n        svgElement: true,\n        _visible: true,\n\n        init: function() {\n            var name = this.name;\n            if (name) this.vel.attr('data-tool-name', name);\n        },\n\n        configure: function(view, toolsView) {\n            this.relatedView = view;\n            this.paper = view.paper;\n            this.parentView = toolsView;\n            this.simulateRelatedView(this.el);\n            return this;\n        },\n\n        simulateRelatedView: function(el) {\n            if (el) el.setAttribute('model-id', this.relatedView.model.id);\n        },\n\n        getName: function() {\n            return this.name;\n        },\n\n        show: function() {\n            this.el.style.display = '';\n            this._visible = true;\n        },\n\n        hide: function() {\n            this.el.style.display = 'none';\n            this._visible = false;\n        },\n\n        isVisible: function() {\n            return !!this._visible;\n        },\n\n        focus: function() {\n            var opacity = this.options.focusOpacity;\n            if (isFinite(opacity)) this.el.style.opacity = opacity;\n            this.parentView.focusTool(this);\n        },\n\n        blur: function() {\n            this.el.style.opacity = '';\n            this.parentView.blurTool(this);\n        },\n\n        update: function() {\n            // to be overriden\n        }\n    });\n\n    var ToolsView = joint.mvc.View.extend({\n        tagName: 'g',\n        className: 'tools',\n        svgElement: true,\n        tools: null,\n        options: {\n            tools: null,\n            relatedView: null,\n            name: null,\n            component: false\n        },\n\n        configure: function(options) {\n            options = util.assign(this.options, options);\n            var tools = options.tools;\n            if (!Array.isArray(tools)) return this;\n            var relatedView = options.relatedView;\n            if (!(relatedView instanceof joint.dia.CellView)) return this;\n            var views = this.tools = [];\n            for (var i = 0, n = tools.length; i < n; i++) {\n                var tool = tools[i];\n                if (!(tool instanceof ToolView)) continue;\n                tool.configure(relatedView, this);\n                tool.render();\n                this.vel.append(tool.el);\n                views.push(tool);\n            }\n            return this;\n        },\n\n        getName: function() {\n            return this.options.name;\n        },\n\n        update: function(opt) {\n\n            opt || (opt = {});\n            var tools = this.tools;\n            if (!tools) return;\n            for (var i = 0, n = tools.length; i < n; i++) {\n                var tool = tools[i];\n                if (opt.tool !== tool.cid && tool.isVisible()) {\n                    tool.update();\n                }\n            }\n            return this;\n        },\n\n        focusTool: function(focusedTool) {\n\n            var tools = this.tools;\n            if (!tools) return this;\n            for (var i = 0, n = tools.length; i < n; i++) {\n                var tool = tools[i];\n                if (focusedTool === tool) {\n                    tool.show();\n                } else {\n                    tool.hide();\n                }\n            }\n            return this;\n        },\n\n        blurTool: function(blurredTool) {\n            var tools = this.tools;\n            if (!tools) return this;\n            for (var i = 0, n = tools.length; i < n; i++) {\n                var tool = tools[i];\n                if (tool !== blurredTool && !tool.isVisible()) {\n                    tool.show();\n                    tool.update();\n                }\n            }\n            return this;\n        },\n\n        hide: function() {\n            return this.focusTool(null);\n        },\n\n        show: function() {\n            return this.blurTool(null);\n        },\n\n        onRemove: function() {\n\n            var tools = this.tools;\n            if (!tools) return this;\n            for (var i = 0, n = tools.length; i < n; i++) {\n                tools[i].remove();\n            }\n            this.tools = null;\n        },\n\n        mount: function() {\n            var options = this.options;\n            var relatedView = options.relatedView;\n            if (relatedView) {\n                var container = (options.component) ? relatedView.el : relatedView.paper.tools;\n                container.appendChild(this.el);\n            }\n            return this;\n        }\n\n    });\n\n    joint.dia.ToolsView = ToolsView;\n    joint.dia.ToolView = ToolView;\n\n})(joint, joint.util);\n\n\n// joint.dia.Cell base model.\n// --------------------------\n\njoint.dia.Cell = Backbone.Model.extend({\n\n    // This is the same as Backbone.Model with the only difference that is uses joint.util.merge\n    // instead of just _.extend. The reason is that we want to mixin attributes set in upper classes.\n    constructor: function(attributes, options) {\n\n        var defaults;\n        var attrs = attributes || {};\n        this.cid = joint.util.uniqueId('c');\n        this.attributes = {};\n        if (options && options.collection) this.collection = options.collection;\n        if (options && options.parse) attrs = this.parse(attrs, options) || {};\n        if ((defaults = joint.util.result(this, 'defaults'))) {\n            //<custom code>\n            // Replaced the call to _.defaults with joint.util.merge.\n            attrs = joint.util.merge({}, defaults, attrs);\n            //</custom code>\n        }\n        this.set(attrs, options);\n        this.changed = {};\n        this.initialize.apply(this, arguments);\n    },\n\n    translate: function(dx, dy, opt) {\n\n        throw new Error('Must define a translate() method.');\n    },\n\n    toJSON: function() {\n\n        var defaultAttrs = this.constructor.prototype.defaults.attrs || {};\n        var attrs = this.attributes.attrs;\n        var finalAttrs = {};\n\n        // Loop through all the attributes and\n        // omit the default attributes as they are implicitly reconstructable by the cell 'type'.\n        joint.util.forIn(attrs, function(attr, selector) {\n\n            var defaultAttr = defaultAttrs[selector];\n\n            joint.util.forIn(attr, function(value, name) {\n\n                // attr is mainly flat though it might have one more level (consider the `style` attribute).\n                // Check if the `value` is object and if yes, go one level deep.\n                if (joint.util.isObject(value) && !Array.isArray(value)) {\n\n                    joint.util.forIn(value, function(value2, name2) {\n\n                        if (!defaultAttr || !defaultAttr[name] || !joint.util.isEqual(defaultAttr[name][name2], value2)) {\n\n                            finalAttrs[selector] = finalAttrs[selector] || {};\n                            (finalAttrs[selector][name] || (finalAttrs[selector][name] = {}))[name2] = value2;\n                        }\n                    });\n\n                } else if (!defaultAttr || !joint.util.isEqual(defaultAttr[name], value)) {\n                    // `value` is not an object, default attribute for such a selector does not exist\n                    // or it is different than the attribute value set on the model.\n\n                    finalAttrs[selector] = finalAttrs[selector] || {};\n                    finalAttrs[selector][name] = value;\n                }\n            });\n        });\n\n        var attributes = joint.util.cloneDeep(joint.util.omit(this.attributes, 'attrs'));\n        //var attributes = JSON.parse(JSON.stringify(_.omit(this.attributes, 'attrs')));\n        attributes.attrs = finalAttrs;\n\n        return attributes;\n    },\n\n    initialize: function(options) {\n\n        if (!options || !options.id) {\n\n            this.set('id', joint.util.uuid(), { silent: true });\n        }\n\n        this._transitionIds = {};\n\n        // Collect ports defined in `attrs` and keep collecting whenever `attrs` object changes.\n        this.processPorts();\n        this.on('change:attrs', this.processPorts, this);\n    },\n\n    /**\n     * @deprecated\n     */\n    processPorts: function() {\n\n        // Whenever `attrs` changes, we extract ports from the `attrs` object and store it\n        // in a more accessible way. Also, if any port got removed and there were links that had `target`/`source`\n        // set to that port, we remove those links as well (to follow the same behaviour as\n        // with a removed element).\n\n        var previousPorts = this.ports;\n\n        // Collect ports from the `attrs` object.\n        var ports = {};\n        joint.util.forIn(this.get('attrs'), function(attrs, selector) {\n\n            if (attrs && attrs.port) {\n\n                // `port` can either be directly an `id` or an object containing an `id` (and potentially other data).\n                if (attrs.port.id !== undefined) {\n                    ports[attrs.port.id] = attrs.port;\n                } else {\n                    ports[attrs.port] = { id: attrs.port };\n                }\n            }\n        });\n\n        // Collect ports that have been removed (compared to the previous ports) - if any.\n        // Use hash table for quick lookup.\n        var removedPorts = {};\n        joint.util.forIn(previousPorts, function(port, id) {\n\n            if (!ports[id]) removedPorts[id] = true;\n        });\n\n        // Remove all the incoming/outgoing links that have source/target port set to any of the removed ports.\n        if (this.graph && !joint.util.isEmpty(removedPorts)) {\n\n            var inboundLinks = this.graph.getConnectedLinks(this, { inbound: true });\n            inboundLinks.forEach(function(link) {\n\n                if (removedPorts[link.get('target').port]) link.remove();\n            });\n\n            var outboundLinks = this.graph.getConnectedLinks(this, { outbound: true });\n            outboundLinks.forEach(function(link) {\n\n                if (removedPorts[link.get('source').port]) link.remove();\n            });\n        }\n\n        // Update the `ports` object.\n        this.ports = ports;\n    },\n\n    remove: function(opt) {\n\n        opt = opt || {};\n\n        // Store the graph in a variable because `this.graph` won't' be accessbile after `this.trigger('remove', ...)` down below.\n        var graph = this.graph;\n        if (!graph) {\n            // The collection is a common backbone collection (not the graph collection).\n            if (this.collection) this.collection.remove(this, opt);\n            return this;\n        }\n\n        graph.startBatch('remove');\n\n        // First, unembed this cell from its parent cell if there is one.\n        var parentCell = this.getParentCell();\n        if (parentCell) parentCell.unembed(this);\n\n        // Remove also all the cells, which were embedded into this cell\n        var embeddedCells = this.getEmbeddedCells();\n        for (var i = 0, n = embeddedCells.length; i < n; i++) {\n            var embed = embeddedCells[i];\n            if (embed) embed.remove(opt);\n        }\n\n        this.trigger('remove', this, graph.attributes.cells, opt);\n\n        graph.stopBatch('remove');\n\n        return this;\n    },\n\n    toFront: function(opt) {\n\n        var graph = this.graph;\n        if (graph) {\n\n            opt = opt || {};\n\n            var z = graph.maxZIndex();\n\n            var cells;\n\n            if (opt.deep) {\n                cells = this.getEmbeddedCells({ deep: true, breadthFirst: true });\n                cells.unshift(this);\n            } else {\n                cells = [this];\n            }\n\n            z = z - cells.length + 1;\n\n            var collection = graph.get('cells');\n            var shouldUpdate = (collection.indexOf(this) !== (collection.length - cells.length));\n            if (!shouldUpdate) {\n                shouldUpdate = cells.some(function(cell, index) {\n                    return cell.get('z') !== z + index;\n                });\n            }\n\n            if (shouldUpdate) {\n                this.startBatch('to-front');\n\n                z = z + cells.length;\n\n                cells.forEach(function(cell, index) {\n                    cell.set('z', z + index, opt);\n                });\n\n                this.stopBatch('to-front');\n            }\n        }\n\n        return this;\n    },\n\n    toBack: function(opt) {\n\n        var graph = this.graph;\n        if (graph) {\n\n            opt = opt || {};\n\n            var z = graph.minZIndex();\n\n            var cells;\n\n            if (opt.deep) {\n                cells = this.getEmbeddedCells({ deep: true, breadthFirst: true });\n                cells.unshift(this);\n            } else {\n                cells = [this];\n            }\n\n            var collection = graph.get('cells');\n            var shouldUpdate = (collection.indexOf(this) !== 0);\n            if (!shouldUpdate) {\n                shouldUpdate = cells.some(function(cell, index) {\n                    return cell.get('z') !== z + index;\n                });\n            }\n\n            if (shouldUpdate) {\n                this.startBatch('to-back');\n\n                z -= cells.length;\n\n                cells.forEach(function(cell, index) {\n                    cell.set('z', z + index, opt);\n                });\n\n                this.stopBatch('to-back');\n            }\n        }\n\n        return this;\n    },\n\n    parent: function(parent, opt) {\n\n        // getter\n        if (parent === undefined) return this.get('parent');\n        // setter\n        return this.set('parent', parent, opt);\n    },\n\n    embed: function(cell, opt) {\n\n        if (this === cell || this.isEmbeddedIn(cell)) {\n\n            throw new Error('Recursive embedding not allowed.');\n\n        } else {\n\n            this.startBatch('embed');\n\n            var embeds = joint.util.assign([], this.get('embeds'));\n\n            // We keep all element ids after link ids.\n            embeds[cell.isLink() ? 'unshift' : 'push'](cell.id);\n\n            cell.parent(this.id, opt);\n            this.set('embeds', joint.util.uniq(embeds), opt);\n\n            this.stopBatch('embed');\n        }\n\n        return this;\n    },\n\n    unembed: function(cell, opt) {\n\n        this.startBatch('unembed');\n\n        cell.unset('parent', opt);\n        this.set('embeds', joint.util.without(this.get('embeds'), cell.id), opt);\n\n        this.stopBatch('unembed');\n\n        return this;\n    },\n\n    getParentCell: function() {\n\n        // unlike link.source/target, cell.parent stores id directly as a string\n        var parentId = this.parent();\n        var graph = this.graph;\n\n        return (parentId && graph && graph.getCell(parentId)) || null;\n    },\n\n    // Return an array of ancestor cells.\n    // The array is ordered from the parent of the cell\n    // to the most distant ancestor.\n    getAncestors: function() {\n\n        var ancestors = [];\n\n        if (!this.graph) {\n            return ancestors;\n        }\n\n        var parentCell = this.getParentCell();\n        while (parentCell) {\n            ancestors.push(parentCell);\n            parentCell = parentCell.getParentCell();\n        }\n\n        return ancestors;\n    },\n\n    getEmbeddedCells: function(opt) {\n\n        opt = opt || {};\n\n        // Cell models can only be retrieved when this element is part of a collection.\n        // There is no way this element knows about other cells otherwise.\n        // This also means that calling e.g. `translate()` on an element with embeds before\n        // adding it to a graph does not translate its embeds.\n        if (this.graph) {\n\n            var cells;\n\n            if (opt.deep) {\n\n                if (opt.breadthFirst) {\n\n                    // breadthFirst algorithm\n                    cells = [];\n                    var queue = this.getEmbeddedCells();\n\n                    while (queue.length > 0) {\n\n                        var parent = queue.shift();\n                        cells.push(parent);\n                        queue.push.apply(queue, parent.getEmbeddedCells());\n                    }\n\n                } else {\n\n                    // depthFirst algorithm\n                    cells = this.getEmbeddedCells();\n                    cells.forEach(function(cell) {\n                        cells.push.apply(cells, cell.getEmbeddedCells(opt));\n                    });\n                }\n\n            } else {\n\n                cells = joint.util.toArray(this.get('embeds')).map(this.graph.getCell, this.graph);\n            }\n\n            return cells;\n        }\n        return [];\n    },\n\n    isEmbeddedIn: function(cell, opt) {\n\n        var cellId = joint.util.isString(cell) ? cell : cell.id;\n        var parentId = this.parent();\n\n        opt = joint.util.defaults({ deep: true }, opt);\n\n        // See getEmbeddedCells().\n        if (this.graph && opt.deep) {\n\n            while (parentId) {\n                if (parentId === cellId) {\n                    return true;\n                }\n                parentId = this.graph.getCell(parentId).parent();\n            }\n\n            return false;\n\n        } else {\n\n            // When this cell is not part of a collection check\n            // at least whether it's a direct child of given cell.\n            return parentId === cellId;\n        }\n    },\n\n    // Whether or not the cell is embedded in any other cell.\n    isEmbedded: function() {\n\n        return !!this.parent();\n    },\n\n    // Isolated cloning. Isolated cloning has two versions: shallow and deep (pass `{ deep: true }` in `opt`).\n    // Shallow cloning simply clones the cell and returns a new cell with different ID.\n    // Deep cloning clones the cell and all its embedded cells recursively.\n    clone: function(opt) {\n\n        opt = opt || {};\n\n        if (!opt.deep) {\n            // Shallow cloning.\n\n            var clone = Backbone.Model.prototype.clone.apply(this, arguments);\n            // We don't want the clone to have the same ID as the original.\n            clone.set('id', joint.util.uuid());\n            // A shallow cloned element does not carry over the original embeds.\n            clone.unset('embeds');\n            // And can not be embedded in any cell\n            // as the clone is not part of the graph.\n            clone.unset('parent');\n\n            return clone;\n\n        } else {\n            // Deep cloning.\n\n            // For a deep clone, simply call `graph.cloneCells()` with the cell and all its embedded cells.\n            return joint.util.toArray(joint.dia.Graph.prototype.cloneCells.call(null, [this].concat(this.getEmbeddedCells({ deep: true }))));\n        }\n    },\n\n    // A convenient way to set nested properties.\n    // This method merges the properties you'd like to set with the ones\n    // stored in the cell and makes sure change events are properly triggered.\n    // You can either set a nested property with one object\n    // or use a property path.\n    // The most simple use case is:\n    // `cell.prop('name/first', 'John')` or\n    // `cell.prop({ name: { first: 'John' } })`.\n    // Nested arrays are supported too:\n    // `cell.prop('series/0/data/0/degree', 50)` or\n    // `cell.prop({ series: [ { data: [ { degree: 50 } ] } ] })`.\n    prop: function(props, value, opt) {\n\n        var delim = '/';\n        var isString = joint.util.isString(props);\n\n        if (isString || Array.isArray(props)) {\n            // Get/set an attribute by a special path syntax that delimits\n            // nested objects by the colon character.\n\n            if (arguments.length > 1) {\n\n                var path;\n                var pathArray;\n\n                if (isString) {\n                    path = props;\n                    pathArray = path.split('/');\n                } else {\n                    path = props.join(delim);\n                    pathArray = props.slice();\n                }\n\n                var property = pathArray[0];\n                var pathArrayLength = pathArray.length;\n\n                opt = opt || {};\n                opt.propertyPath = path;\n                opt.propertyValue = value;\n                opt.propertyPathArray = pathArray;\n\n                if (pathArrayLength === 1) {\n                    // Property is not nested. We can simply use `set()`.\n                    return this.set(property, value, opt);\n                }\n\n                var update = {};\n                // Initialize the nested object. Subobjects are either arrays or objects.\n                // An empty array is created if the sub-key is an integer. Otherwise, an empty object is created.\n                // Note that this imposes a limitation on object keys one can use with Inspector.\n                // Pure integer keys will cause issues and are therefore not allowed.\n                var initializer = update;\n                var prevProperty = property;\n\n                for (var i = 1; i < pathArrayLength; i++) {\n                    var pathItem = pathArray[i];\n                    var isArrayIndex = Number.isFinite(isString ? Number(pathItem) : pathItem);\n                    initializer = initializer[prevProperty] = isArrayIndex ? [] : {};\n                    prevProperty = pathItem;\n                }\n\n                // Fill update with the `value` on `path`.\n                update = joint.util.setByPath(update, pathArray, value, '/');\n\n                var baseAttributes = joint.util.merge({}, this.attributes);\n                // if rewrite mode enabled, we replace value referenced by path with\n                // the new one (we don't merge).\n                opt.rewrite && joint.util.unsetByPath(baseAttributes, path, '/');\n\n                // Merge update with the model attributes.\n                var attributes = joint.util.merge(baseAttributes, update);\n                // Finally, set the property to the updated attributes.\n                return this.set(property, attributes[property], opt);\n\n            } else {\n\n                return joint.util.getByPath(this.attributes, props, delim);\n            }\n        }\n\n        return this.set(joint.util.merge({}, this.attributes, props), value);\n    },\n\n    // A convient way to unset nested properties\n    removeProp: function(path, opt) {\n\n        // Once a property is removed from the `attrs` attribute\n        // the cellView will recognize a `dirty` flag and rerender itself\n        // in order to remove the attribute from SVG element.\n        opt = opt || {};\n        opt.dirty = true;\n\n        var pathArray = Array.isArray(path) ? path : path.split('/');\n\n        if (pathArray.length === 1) {\n            // A top level property\n            return this.unset(path, opt);\n        }\n\n        // A nested property\n        var property = pathArray[0];\n        var nestedPath = pathArray.slice(1);\n        var propertyValue = joint.util.cloneDeep(this.get(property));\n\n        joint.util.unsetByPath(propertyValue, nestedPath, '/');\n\n        return this.set(property, propertyValue, opt);\n    },\n\n    // A convenient way to set nested attributes.\n    attr: function(attrs, value, opt) {\n\n        var args = Array.from(arguments);\n        if (args.length === 0) {\n            return this.get('attrs');\n        }\n\n        if (Array.isArray(attrs)) {\n            args[0] = ['attrs'].concat(attrs);\n        } else if (joint.util.isString(attrs)) {\n            // Get/set an attribute by a special path syntax that delimits\n            // nested objects by the colon character.\n            args[0] = 'attrs/' + attrs;\n\n        } else {\n\n            args[0] = { 'attrs' : attrs };\n        }\n\n        return this.prop.apply(this, args);\n    },\n\n    // A convenient way to unset nested attributes\n    removeAttr: function(path, opt) {\n\n        if (Array.isArray(path)) {\n\n            return this.removeProp(['attrs'].concat(path));\n        }\n\n        return this.removeProp('attrs/' + path, opt);\n    },\n\n    transition: function(path, value, opt, delim) {\n\n        delim = delim || '/';\n\n        var defaults = {\n            duration: 100,\n            delay: 10,\n            timingFunction: joint.util.timing.linear,\n            valueFunction: joint.util.interpolate.number\n        };\n\n        opt = joint.util.assign(defaults, opt);\n\n        var firstFrameTime = 0;\n        var interpolatingFunction;\n\n        var setter = function(runtime) {\n\n            var id, progress, propertyValue;\n\n            firstFrameTime = firstFrameTime || runtime;\n            runtime -= firstFrameTime;\n            progress = runtime / opt.duration;\n\n            if (progress < 1) {\n                this._transitionIds[path] = id = joint.util.nextFrame(setter);\n            } else {\n                progress = 1;\n                delete this._transitionIds[path];\n            }\n\n            propertyValue = interpolatingFunction(opt.timingFunction(progress));\n\n            opt.transitionId = id;\n\n            this.prop(path, propertyValue, opt);\n\n            if (!id) this.trigger('transition:end', this, path);\n\n        }.bind(this);\n\n        var initiator = function(callback) {\n\n            this.stopTransitions(path);\n\n            interpolatingFunction = opt.valueFunction(joint.util.getByPath(this.attributes, path, delim), value);\n\n            this._transitionIds[path] = joint.util.nextFrame(callback);\n\n            this.trigger('transition:start', this, path);\n\n        }.bind(this);\n\n        return setTimeout(initiator, opt.delay, setter);\n    },\n\n    getTransitions: function() {\n\n        return Object.keys(this._transitionIds);\n    },\n\n    stopTransitions: function(path, delim) {\n\n        delim = delim || '/';\n\n        var pathArray = path && path.split(delim);\n\n        Object.keys(this._transitionIds).filter(pathArray && function(key) {\n\n            return joint.util.isEqual(pathArray, key.split(delim).slice(0, pathArray.length));\n\n        }).forEach(function(key) {\n\n            joint.util.cancelFrame(this._transitionIds[key]);\n\n            delete this._transitionIds[key];\n\n            this.trigger('transition:end', this, key);\n\n        }, this);\n\n        return this;\n    },\n\n    // A shorcut making it easy to create constructs like the following:\n    // `var el = (new joint.shapes.basic.Rect).addTo(graph)`.\n    addTo: function(graph, opt) {\n\n        graph.addCell(this, opt);\n        return this;\n    },\n\n    // A shortcut for an equivalent call: `paper.findViewByModel(cell)`\n    // making it easy to create constructs like the following:\n    // `cell.findView(paper).highlight()`\n    findView: function(paper) {\n\n        return paper.findViewByModel(this);\n    },\n\n    isElement: function() {\n\n        return false;\n    },\n\n    isLink: function() {\n\n        return false;\n    },\n\n    startBatch: function(name, opt) {\n\n        if (this.graph) { this.graph.startBatch(name, joint.util.assign({}, opt, { cell: this })); }\n        return this;\n    },\n\n    stopBatch: function(name, opt) {\n\n        if (this.graph) { this.graph.stopBatch(name, joint.util.assign({}, opt, { cell: this })); }\n        return this;\n    }\n\n}, {\n\n    getAttributeDefinition: function(attrName) {\n\n        var defNS = this.attributes;\n        var globalDefNS = joint.dia.attributes;\n        return (defNS && defNS[attrName]) || globalDefNS[attrName];\n    },\n\n    define: function(type, defaults, protoProps, staticProps) {\n\n        protoProps = joint.util.assign({\n            defaults: joint.util.defaultsDeep({ type: type }, defaults, this.prototype.defaults)\n        }, protoProps);\n\n        var Cell = this.extend(protoProps, staticProps);\n        joint.util.setByPath(joint.shapes, type, Cell, '.');\n        return Cell;\n    }\n});\n\n// joint.dia.CellView base view and controller.\n// --------------------------------------------\n\n// This is the base view and controller for `joint.dia.ElementView` and `joint.dia.LinkView`.\n\njoint.dia.CellView = joint.mvc.View.extend({\n\n    tagName: 'g',\n\n    svgElement: true,\n\n    selector: 'root',\n\n    className: function() {\n\n        var classNames = ['cell'];\n        var type = this.model.get('type');\n\n        if (type) {\n\n            type.toLowerCase().split('.').forEach(function(value, index, list) {\n                classNames.push('type-' + list.slice(0, index + 1).join('-'));\n            });\n        }\n\n        return classNames.join(' ');\n    },\n\n    attributes: function() {\n\n        return { 'model-id': this.model.id };\n    },\n\n    constructor: function(options) {\n\n        // Make sure a global unique id is assigned to this view. Store this id also to the properties object.\n        // The global unique id makes sure that the same view can be rendered on e.g. different machines and\n        // still be associated to the same object among all those clients. This is necessary for real-time\n        // collaboration mechanism.\n        options.id = options.id || joint.util.guid(this);\n\n        joint.mvc.View.call(this, options);\n    },\n\n    init: function() {\n\n        joint.util.bindAll(this, 'remove', 'update');\n\n        // Store reference to this to the <g> DOM element so that the view is accessible through the DOM tree.\n        this.$el.data('view', this);\n\n        // Add the cell's type to the view's element as a data attribute.\n        this.$el.attr('data-type', this.model.get('type'));\n\n        this.listenTo(this.model, 'change:attrs', this.onChangeAttrs);\n    },\n\n\n    parseDOMJSON: function(markup, root) {\n\n        var doc = joint.util.parseDOMJSON(markup);\n        var selectors = doc.selectors;\n        var groups = doc.groupSelectors;\n        for (var group in groups) {\n            if (selectors[group]) throw new Error('dia.CellView: ambigious group selector');\n            selectors[group] = groups[group];\n        }\n        if (root) {\n            var rootSelector = this.selector;\n            if (selectors[rootSelector]) throw new Error('dia.CellView: ambiguous root selector.');\n            selectors[rootSelector] = root;\n        }\n        return { fragment: doc.fragment, selectors: selectors };\n    },\n\n    onChangeAttrs: function(cell, attrs, opt) {\n\n        if (opt.dirty) {\n\n            // dirty flag could be set when a model attribute was removed and it needs to be cleared\n            // also from the DOM element. See cell.removeAttr().\n            return this.render();\n        }\n\n        return this.update(cell, attrs, opt);\n    },\n\n    // Return `true` if cell link is allowed to perform a certain UI `feature`.\n    // Example: `can('vertexMove')`, `can('labelMove')`.\n    can: function(feature) {\n\n        var interactive = joint.util.isFunction(this.options.interactive)\n            ? this.options.interactive(this)\n            : this.options.interactive;\n\n        return (joint.util.isObject(interactive) && interactive[feature] !== false) ||\n                (joint.util.isBoolean(interactive) && interactive !== false);\n    },\n\n    findBySelector: function(selector, root, selectors) {\n\n        root || (root = this.el);\n        selectors || (selectors = this.selectors);\n\n        // These are either descendants of `this.$el` of `this.$el` itself.\n        // `.` is a special selector used to select the wrapping `<g>` element.\n        if (!selector || selector === '.') return [root];\n        if (selectors) {\n            var nodes = selectors[selector];\n            if (nodes) {\n                if (Array.isArray(nodes)) return nodes;\n                return [nodes];\n            }\n        }\n        // Maintaining backwards compatibility\n        // e.g. `circle:first` would fail with querySelector() call\n        return $(root).find(selector).toArray();\n    },\n\n    notify: function(eventName) {\n\n        if (this.paper) {\n\n            var args = Array.prototype.slice.call(arguments, 1);\n\n            // Trigger the event on both the element itself and also on the paper.\n            this.trigger.apply(this, [eventName].concat(args));\n\n            // Paper event handlers receive the view object as the first argument.\n            this.paper.trigger.apply(this.paper, [eventName, this].concat(args));\n        }\n    },\n\n    // ** Deprecated **\n    getStrokeBBox: function(el) {\n        // Return a bounding box rectangle that takes into account stroke.\n        // Note that this is a naive and ad-hoc implementation that does not\n        // works only in certain cases and should be replaced as soon as browsers will\n        // start supporting the getStrokeBBox() SVG method.\n        // @TODO any better solution is very welcome!\n\n        var isMagnet = !!el;\n\n        el = el || this.el;\n        var bbox = V(el).getBBox({ target: this.paper.viewport });\n        var strokeWidth;\n        if (isMagnet) {\n\n            strokeWidth = V(el).attr('stroke-width');\n\n        } else {\n\n            strokeWidth = this.model.attr('rect/stroke-width') || this.model.attr('circle/stroke-width') || this.model.attr('ellipse/stroke-width') || this.model.attr('path/stroke-width');\n        }\n\n        strokeWidth = parseFloat(strokeWidth) || 0;\n\n        return g.rect(bbox).moveAndExpand({ x: -strokeWidth / 2, y: -strokeWidth / 2, width: strokeWidth, height: strokeWidth });\n    },\n\n    getBBox: function() {\n\n        return this.vel.getBBox({ target: this.paper.svg });\n    },\n\n    highlight: function(el, opt) {\n\n        el = !el ? this.el : this.$(el)[0] || this.el;\n\n        // set partial flag if the highlighted element is not the entire view.\n        opt = opt || {};\n        opt.partial = (el !== this.el);\n\n        this.notify('cell:highlight', el, opt);\n        return this;\n    },\n\n    unhighlight: function(el, opt) {\n\n        el = !el ? this.el : this.$(el)[0] || this.el;\n\n        opt = opt || {};\n        opt.partial = el != this.el;\n\n        this.notify('cell:unhighlight', el, opt);\n        return this;\n    },\n\n    // Find the closest element that has the `magnet` attribute set to `true`. If there was not such\n    // an element found, return the root element of the cell view.\n    findMagnet: function(el) {\n\n        var $el = this.$(el);\n        var $rootEl = this.$el;\n\n        if ($el.length === 0) {\n            $el = $rootEl;\n        }\n\n        do {\n\n            var magnet = $el.attr('magnet');\n            if ((magnet || $el.is($rootEl)) && magnet !== 'false') {\n                return $el[0];\n            }\n\n            $el = $el.parent();\n\n        } while ($el.length > 0);\n\n        // If the overall cell has set `magnet === false`, then return `undefined` to\n        // announce there is no magnet found for this cell.\n        // This is especially useful to set on cells that have 'ports'. In this case,\n        // only the ports have set `magnet === true` and the overall element has `magnet === false`.\n        return undefined;\n    },\n\n    // Construct a unique selector for the `el` element within this view.\n    // `prevSelector` is being collected through the recursive call.\n    // No value for `prevSelector` is expected when using this method.\n    getSelector: function(el, prevSelector) {\n\n        var selector;\n\n        if (el === this.el) {\n            if (typeof prevSelector === 'string') selector = '> ' + prevSelector;\n            return selector;\n        }\n\n        if (el) {\n\n            var nthChild = V(el).index() + 1;\n            selector = el.tagName + ':nth-child(' + nthChild + ')';\n\n            if (prevSelector) {\n                selector += ' > ' + prevSelector;\n            }\n\n            selector = this.getSelector(el.parentNode, selector);\n        }\n\n        return selector;\n    },\n\n    getLinkEnd: function(magnet, x, y, link, endType) {\n\n        var model = this.model;\n        var id = model.id;\n        var port = this.findAttribute('port', magnet);\n        // Find a unique `selector` of the element under pointer that is a magnet.\n        var selector = magnet.getAttribute('joint-selector');\n\n        var end = { id: id };\n        if (selector != null) end.magnet = selector;\n        if (port != null) {\n            end.port = port;\n            if (!model.hasPort(port) && !selector) {\n                // port created via the `port` attribute (not API)\n                end.selector = this.getSelector(magnet);\n            }\n        } else if (selector == null && this.el !== magnet) {\n            end.selector = this.getSelector(magnet);\n        }\n\n        var paper = this.paper;\n        var connectionStrategy = paper.options.connectionStrategy;\n        if (typeof connectionStrategy === 'function') {\n            var strategy = connectionStrategy.call(paper, end, this, magnet, new g.Point(x, y), link, endType);\n            if (strategy) end = strategy;\n        }\n\n        return end;\n    },\n\n    getMagnetFromLinkEnd: function(end) {\n\n        var root = this.el;\n        var port = end.port;\n        var selector = end.magnet;\n        var magnet;\n        if (port != null && this.model.hasPort(port)) {\n            magnet = this.findPortNode(port, selector) || root;\n        } else {\n            if (!selector) selector = end.selector;\n            if (!selector && port != null) {\n                // link end has only `id` and `port` property referencing\n                // a port created via the `port` attribute (not API).\n                selector = '[port=\"' + port + '\"]';\n            }\n            magnet = this.findBySelector(selector, root, this.selectors)[0];\n        }\n\n        return magnet;\n    },\n\n    getAttributeDefinition: function(attrName) {\n\n        return this.model.constructor.getAttributeDefinition(attrName);\n    },\n\n    setNodeAttributes: function(node, attrs) {\n\n        if (!joint.util.isEmpty(attrs)) {\n            if (node instanceof SVGElement) {\n                V(node).attr(attrs);\n            } else {\n                $(node).attr(attrs);\n            }\n        }\n    },\n\n    processNodeAttributes: function(node, attrs) {\n\n        var attrName, attrVal, def, i, n;\n        var normalAttrs, setAttrs, positionAttrs, offsetAttrs;\n        var relatives = [];\n        // divide the attributes between normal and special\n        for (attrName in attrs) {\n            if (!attrs.hasOwnProperty(attrName)) continue;\n            attrVal = attrs[attrName];\n            def = this.getAttributeDefinition(attrName);\n            if (def && (!joint.util.isFunction(def.qualify) || def.qualify.call(this, attrVal, node, attrs))) {\n                if (joint.util.isString(def.set)) {\n                    normalAttrs || (normalAttrs = {});\n                    normalAttrs[def.set] = attrVal;\n                }\n                if (attrVal !== null) {\n                    relatives.push(attrName, def);\n                }\n            } else {\n                normalAttrs || (normalAttrs = {});\n                normalAttrs[joint.util.toKebabCase(attrName)] = attrVal;\n            }\n        }\n\n        // handle the rest of attributes via related method\n        // from the special attributes namespace.\n        for (i = 0, n = relatives.length; i < n; i+=2) {\n            attrName = relatives[i];\n            def = relatives[i+1];\n            attrVal = attrs[attrName];\n            if (joint.util.isFunction(def.set)) {\n                setAttrs || (setAttrs = {});\n                setAttrs[attrName] = attrVal;\n            }\n            if (joint.util.isFunction(def.position)) {\n                positionAttrs || (positionAttrs = {});\n                positionAttrs[attrName] = attrVal;\n            }\n            if (joint.util.isFunction(def.offset)) {\n                offsetAttrs || (offsetAttrs = {});\n                offsetAttrs[attrName] = attrVal;\n            }\n        }\n\n        return {\n            raw: attrs,\n            normal: normalAttrs,\n            set: setAttrs,\n            position: positionAttrs,\n            offset: offsetAttrs\n        };\n    },\n\n    updateRelativeAttributes: function(node, attrs, refBBox, opt) {\n\n        opt || (opt = {});\n\n        var attrName, attrVal, def;\n        var rawAttrs = attrs.raw || {};\n        var nodeAttrs = attrs.normal || {};\n        var setAttrs = attrs.set;\n        var positionAttrs = attrs.position;\n        var offsetAttrs = attrs.offset;\n\n        for (attrName in setAttrs) {\n            attrVal = setAttrs[attrName];\n            def = this.getAttributeDefinition(attrName);\n            // SET - set function should return attributes to be set on the node,\n            // which will affect the node dimensions based on the reference bounding\n            // box. e.g. `width`, `height`, `d`, `rx`, `ry`, `points\n            var setResult = def.set.call(this, attrVal, refBBox.clone(), node, rawAttrs);\n            if (joint.util.isObject(setResult)) {\n                joint.util.assign(nodeAttrs, setResult);\n            } else if (setResult !== undefined) {\n                nodeAttrs[attrName] = setResult;\n            }\n        }\n\n        if (node instanceof HTMLElement) {\n            // TODO: setting the `transform` attribute on HTMLElements\n            // via `node.style.transform = 'matrix(...)';` would introduce\n            // a breaking change (e.g. basic.TextBlock).\n            this.setNodeAttributes(node, nodeAttrs);\n            return;\n        }\n\n        // The final translation of the subelement.\n        var nodeTransform = nodeAttrs.transform;\n        var nodeMatrix = V.transformStringToMatrix(nodeTransform);\n        var nodePosition = g.Point(nodeMatrix.e, nodeMatrix.f);\n        if (nodeTransform) {\n            nodeAttrs = joint.util.omit(nodeAttrs, 'transform');\n            nodeMatrix.e = nodeMatrix.f = 0;\n        }\n\n        // Calculate node scale determined by the scalable group\n        // only if later needed.\n        var sx, sy, translation;\n        if (positionAttrs || offsetAttrs) {\n            var nodeScale = this.getNodeScale(node, opt.scalableNode);\n            sx = nodeScale.sx;\n            sy = nodeScale.sy;\n        }\n\n        var positioned = false;\n        for (attrName in positionAttrs) {\n            attrVal = positionAttrs[attrName];\n            def = this.getAttributeDefinition(attrName);\n            // POSITION - position function should return a point from the\n            // reference bounding box. The default position of the node is x:0, y:0 of\n            // the reference bounding box or could be further specify by some\n            // SVG attributes e.g. `x`, `y`\n            translation = def.position.call(this, attrVal, refBBox.clone(), node, rawAttrs);\n            if (translation) {\n                nodePosition.offset(g.Point(translation).scale(sx, sy));\n                positioned || (positioned = true);\n            }\n        }\n\n        // The node bounding box could depend on the `size` set from the previous loop.\n        // Here we know, that all the size attributes have been already set.\n        this.setNodeAttributes(node, nodeAttrs);\n\n        var offseted = false;\n        if (offsetAttrs) {\n            // Check if the node is visible\n            var nodeClientRect = node.getBoundingClientRect();\n            if (nodeClientRect.width > 0 && nodeClientRect.height > 0) {\n                var nodeBBox = V.transformRect(node.getBBox(), nodeMatrix).scale(1 / sx, 1 / sy);\n                for (attrName in offsetAttrs) {\n                    attrVal = offsetAttrs[attrName];\n                    def = this.getAttributeDefinition(attrName);\n                    // OFFSET - offset function should return a point from the element\n                    // bounding box. The default offset point is x:0, y:0 (origin) or could be further\n                    // specify with some SVG attributes e.g. `text-anchor`, `cx`, `cy`\n                    translation = def.offset.call(this, attrVal, nodeBBox, node, rawAttrs);\n                    if (translation) {\n                        nodePosition.offset(g.Point(translation).scale(sx, sy));\n                        offseted || (offseted = true);\n                    }\n                }\n            }\n        }\n\n        // Do not touch node's transform attribute if there is no transformation applied.\n        if (nodeTransform !== undefined || positioned || offseted) {\n            // Round the coordinates to 1 decimal point.\n            nodePosition.round(1);\n            nodeMatrix.e = nodePosition.x;\n            nodeMatrix.f = nodePosition.y;\n            node.setAttribute('transform', V.matrixToTransformString(nodeMatrix));\n            // TODO: store nodeMatrix metrics?\n        }\n    },\n\n    getNodeScale: function(node, scalableNode) {\n\n        // Check if the node is a descendant of the scalable group.\n        var sx, sy;\n        if (scalableNode && scalableNode.contains(node)) {\n            var scale = scalableNode.scale();\n            sx = 1 / scale.sx;\n            sy = 1 / scale.sy;\n        } else {\n            sx = 1;\n            sy = 1;\n        }\n\n        return { sx: sx, sy: sy };\n    },\n\n    findNodesAttributes: function(attrs, root, selectorCache, selectors) {\n\n        var util = joint.util;\n        var i, n, nodeAttrs, nodeId;\n        var nodesAttrs = {};\n        var mergeIds = [];\n        for (var selector in attrs) {\n            if (!attrs.hasOwnProperty(selector)) continue;\n            var selected = selectorCache[selector] = this.findBySelector(selector, root, selectors);\n            for (i = 0, n = selected.length; i < n; i++) {\n                var node = selected[i];\n                nodeId = V.ensureId(node);\n                nodeAttrs = attrs[selector];\n                // \"unique\" selectors are selectors that referencing a single node (defined by `selector`)\n                // groupSelector referencing a single node is not \"unique\"\n                var unique = (selectors && selectors[selector] === node);\n                var prevNodeAttrs = nodesAttrs[nodeId];\n                if (prevNodeAttrs) {\n                    // Note, that nodes referenced by deprecated `CSS selectors` are not taken into account.\n                    // e.g. css:`.circle` and selector:`circle` can be applied in a random order\n                    if (!prevNodeAttrs.array) {\n                        mergeIds.push(nodeId);\n                        prevNodeAttrs.array = true;\n                        prevNodeAttrs.attributes = [prevNodeAttrs.attributes];\n                        prevNodeAttrs.selectedLength = [prevNodeAttrs.selectedLength];\n                    }\n                    var attributes = prevNodeAttrs.attributes;\n                    var selectedLength = prevNodeAttrs.selectedLength;\n                    if (unique) {\n                        // node referenced by `selector`\n                        attributes.unshift(nodeAttrs);\n                        selectedLength.unshift(-1);\n                    } else {\n                        // node referenced by `groupSelector`\n                        var sortIndex = util.sortedIndex(selectedLength, n);\n                        attributes.splice(sortIndex, 0, nodeAttrs);\n                        selectedLength.splice(sortIndex, 0, n);\n                    }\n                } else {\n                    nodesAttrs[nodeId] = {\n                        attributes: nodeAttrs,\n                        selectedLength: unique ? -1 : n,\n                        node: node,\n                        array: false\n                    };\n                }\n            }\n        }\n\n        for (i = 0, n = mergeIds.length; i < n; i++) {\n            nodeId = mergeIds[i];\n            nodeAttrs = nodesAttrs[nodeId];\n            nodeAttrs.attributes = util.merge.apply(util, [{}].concat(nodeAttrs.attributes.reverse()));\n        }\n\n        return nodesAttrs;\n    },\n\n    getEventTarget: function(evt) {\n        // Touchmove/Touchend event's target is not reflecting the element under the coordinates as mousemove does.\n        // It holds the element when a touchstart triggered.\n        var type = evt.type;\n        if (type === 'touchmove' || type === 'touchend') {\n            return document.elementFromPoint(evt.clientX, evt.clientY);\n        }\n\n        return evt.target;\n    },\n\n    // Default is to process the `model.attributes.attrs` object and set attributes on subelements based on the selectors,\n    // unless `attrs` parameter was passed.\n    updateDOMSubtreeAttributes: function(rootNode, attrs, opt) {\n\n        opt || (opt = {});\n        opt.rootBBox || (opt.rootBBox = g.Rect());\n        opt.selectors || (opt.selectors = this.selectors); // selector collection to use\n\n        // Cache table for query results and bounding box calculation.\n        // Note that `selectorCache` needs to be invalidated for all\n        // `updateAttributes` calls, as the selectors might pointing\n        // to nodes designated by an attribute or elements dynamically\n        // created.\n        var selectorCache = {};\n        var bboxCache = {};\n        var relativeItems = [];\n        var item, node, nodeAttrs, nodeData, processedAttrs;\n\n        var roAttrs = opt.roAttributes;\n        var nodesAttrs = this.findNodesAttributes(roAttrs || attrs, rootNode, selectorCache, opt.selectors);\n        // `nodesAttrs` are different from all attributes, when\n        // rendering only  attributes sent to this method.\n        var nodesAllAttrs = (roAttrs)\n            ? this.findNodesAttributes(attrs, rootNode, selectorCache, opt.selectors)\n            : nodesAttrs;\n\n        for (var nodeId in nodesAttrs) {\n            nodeData = nodesAttrs[nodeId];\n            nodeAttrs = nodeData.attributes;\n            node = nodeData.node;\n            processedAttrs = this.processNodeAttributes(node, nodeAttrs);\n\n            if (!processedAttrs.set && !processedAttrs.position && !processedAttrs.offset) {\n                // Set all the normal attributes right on the SVG/HTML element.\n                this.setNodeAttributes(node, processedAttrs.normal);\n\n            } else {\n\n                var nodeAllAttrs = nodesAllAttrs[nodeId] && nodesAllAttrs[nodeId].attributes;\n                var refSelector = (nodeAllAttrs && (nodeAttrs.ref === undefined))\n                    ? nodeAllAttrs.ref\n                    : nodeAttrs.ref;\n\n                var refNode;\n                if (refSelector) {\n                    refNode = (selectorCache[refSelector] || this.findBySelector(refSelector, rootNode, opt.selectors))[0];\n                    if (!refNode) {\n                        throw new Error('dia.ElementView: \"' + refSelector + '\" reference does not exist.');\n                    }\n                } else {\n                    refNode = null;\n                }\n\n                item = {\n                    node: node,\n                    refNode: refNode,\n                    processedAttributes: processedAttrs,\n                    allAttributes: nodeAllAttrs\n                };\n\n                // If an element in the list is positioned relative to this one, then\n                // we want to insert this one before it in the list.\n                var itemIndex = relativeItems.findIndex(function(item) {\n                    return item.refNode === node;\n                });\n\n                if (itemIndex > -1) {\n                    relativeItems.splice(itemIndex, 0, item);\n                } else {\n                    relativeItems.push(item);\n                }\n            }\n        }\n\n        for (var i = 0, n = relativeItems.length; i < n; i++) {\n            item = relativeItems[i];\n            node = item.node;\n            refNode = item.refNode;\n\n            // Find the reference element bounding box. If no reference was provided, we\n            // use the optional bounding box.\n            var refNodeId = refNode ? V.ensureId(refNode) : '';\n            var refBBox = bboxCache[refNodeId];\n            if (!refBBox) {\n                // Get the bounding box of the reference element relative to the `rotatable` `<g>` (without rotation)\n                // or to the root `<g>` element if no rotatable group present if reference node present.\n                // Uses the bounding box provided.\n                refBBox = bboxCache[refNodeId] = (refNode)\n                    ? V(refNode).getBBox({ target: (opt.rotatableNode || rootNode) })\n                    : opt.rootBBox;\n            }\n\n            if (roAttrs) {\n                // if there was a special attribute affecting the position amongst passed-in attributes\n                // we have to merge it with the rest of the element's attributes as they are necessary\n                // to update the position relatively (i.e `ref-x` && 'ref-dx')\n                processedAttrs = this.processNodeAttributes(node, item.allAttributes);\n                this.mergeProcessedAttributes(processedAttrs, item.processedAttributes);\n\n            } else {\n                processedAttrs = item.processedAttributes;\n            }\n\n            this.updateRelativeAttributes(node, processedAttrs, refBBox, opt);\n        }\n    },\n\n    mergeProcessedAttributes: function(processedAttrs, roProcessedAttrs) {\n\n        processedAttrs.set || (processedAttrs.set = {});\n        processedAttrs.position || (processedAttrs.position = {});\n        processedAttrs.offset || (processedAttrs.offset = {});\n\n        joint.util.assign(processedAttrs.set, roProcessedAttrs.set);\n        joint.util.assign(processedAttrs.position, roProcessedAttrs.position);\n        joint.util.assign(processedAttrs.offset, roProcessedAttrs.offset);\n\n        // Handle also the special transform property.\n        var transform = processedAttrs.normal && processedAttrs.normal.transform;\n        if (transform !== undefined && roProcessedAttrs.normal) {\n            roProcessedAttrs.normal.transform = transform;\n        }\n        processedAttrs.normal = roProcessedAttrs.normal;\n    },\n\n    onRemove: function() {\n        this.removeTools();\n    },\n\n    _toolsView: null,\n\n    hasTools: function(name) {\n        var toolsView = this._toolsView;\n        if (!toolsView) return false;\n        if (!name) return true;\n        return (toolsView.getName() === name);\n    },\n\n    addTools: function(toolsView) {\n\n        this.removeTools();\n\n        if (toolsView instanceof joint.dia.ToolsView) {\n            this._toolsView = toolsView;\n            toolsView.configure({ relatedView: this });\n            toolsView.listenTo(this.paper, 'tools:event', this.onToolEvent.bind(this));\n            toolsView.mount();\n        }\n        return this;\n    },\n\n    updateTools: function(opt) {\n\n        var toolsView = this._toolsView;\n        if (toolsView) toolsView.update(opt);\n        return this;\n    },\n\n    removeTools: function() {\n\n        var toolsView = this._toolsView;\n        if (toolsView) {\n            toolsView.remove();\n            this._toolsView = null;\n        }\n        return this;\n    },\n\n    hideTools: function() {\n\n        var toolsView = this._toolsView;\n        if (toolsView) toolsView.hide();\n        return this;\n    },\n\n    showTools: function() {\n\n        var toolsView = this._toolsView;\n        if (toolsView) toolsView.show();\n        return this;\n    },\n\n    onToolEvent: function(event) {\n        switch (event) {\n            case 'remove':\n                this.removeTools();\n                break;\n            case 'hide':\n                this.hideTools();\n                break;\n            case 'show':\n                this.showTools();\n                break;\n        }\n    },\n\n    // Interaction. The controller part.\n    // ---------------------------------\n\n    // Interaction is handled by the paper and delegated to the view in interest.\n    // `x` & `y` parameters passed to these functions represent the coordinates already snapped to the paper grid.\n    // If necessary, real coordinates can be obtained from the `evt` event object.\n\n    // These functions are supposed to be overriden by the views that inherit from `joint.dia.Cell`,\n    // i.e. `joint.dia.Element` and `joint.dia.Link`.\n\n    pointerdblclick: function(evt, x, y) {\n\n        this.notify('cell:pointerdblclick', evt, x, y);\n    },\n\n    pointerclick: function(evt, x, y) {\n\n        this.notify('cell:pointerclick', evt, x, y);\n    },\n\n    contextmenu: function(evt, x, y) {\n\n        this.notify('cell:contextmenu', evt, x, y);\n    },\n\n    pointerdown: function(evt, x, y) {\n\n        if (this.model.graph) {\n            this.model.startBatch('pointer');\n            this._graph = this.model.graph;\n        }\n\n        this.notify('cell:pointerdown', evt, x, y);\n    },\n\n    pointermove: function(evt, x, y) {\n\n        this.notify('cell:pointermove', evt, x, y);\n    },\n\n    pointerup: function(evt, x, y) {\n\n        this.notify('cell:pointerup', evt, x, y);\n\n        if (this._graph) {\n            // we don't want to trigger event on model as model doesn't\n            // need to be member of collection anymore (remove)\n            this._graph.stopBatch('pointer', { cell: this.model });\n            delete this._graph;\n        }\n    },\n\n    mouseover: function(evt) {\n\n        this.notify('cell:mouseover', evt);\n    },\n\n    mouseout: function(evt) {\n\n        this.notify('cell:mouseout', evt);\n    },\n\n    mouseenter: function(evt) {\n\n        this.notify('cell:mouseenter', evt);\n    },\n\n    mouseleave: function(evt) {\n\n        this.notify('cell:mouseleave', evt);\n    },\n\n    mousewheel: function(evt, x, y, delta) {\n\n        this.notify('cell:mousewheel', evt, x, y, delta);\n    },\n\n    onevent: function(evt, eventName, x, y) {\n\n        this.notify(eventName, evt, x, y);\n    },\n\n    onmagnet: function() {\n\n        // noop\n    },\n\n    magnetpointerdblclick: function() {\n\n        // noop\n    },\n\n    magnetcontextmenu: function() {\n\n        // noop\n    },\n\n    setInteractivity: function(value) {\n\n        this.options.interactive = value;\n    }\n}, {\n\n    dispatchToolsEvent: function(paper, event) {\n        if ((typeof event === 'string') && (paper instanceof joint.dia.Paper)) {\n            paper.trigger('tools:event', event);\n        }\n    }\n});\n\n\n// joint.dia.Element base model.\n// -----------------------------\n\njoint.dia.Element = joint.dia.Cell.extend({\n\n    defaults: {\n        position: { x: 0, y: 0 },\n        size: { width: 1, height: 1 },\n        angle: 0\n    },\n\n    initialize: function() {\n\n        this._initializePorts();\n        joint.dia.Cell.prototype.initialize.apply(this, arguments);\n    },\n\n    /**\n     * @abstract\n     */\n    _initializePorts: function() {\n        // implemented in ports.js\n    },\n\n    isElement: function() {\n\n        return true;\n    },\n\n    position: function(x, y, opt) {\n\n        var isSetter = joint.util.isNumber(y);\n\n        opt = (isSetter ? opt : x) || {};\n\n        // option `parentRelative` for setting the position relative to the element's parent.\n        if (opt.parentRelative) {\n\n            // Getting the parent's position requires the collection.\n            // Cell.parent() holds cell id only.\n            if (!this.graph) throw new Error('Element must be part of a graph.');\n\n            var parent = this.getParentCell();\n            var parentPosition = parent && !parent.isLink()\n                ? parent.get('position')\n                : { x: 0, y: 0 };\n        }\n\n        if (isSetter) {\n\n            if (opt.parentRelative) {\n                x += parentPosition.x;\n                y += parentPosition.y;\n            }\n\n            if (opt.deep) {\n                var currentPosition = this.get('position');\n                this.translate(x - currentPosition.x, y - currentPosition.y, opt);\n            } else {\n                this.set('position', { x: x, y: y }, opt);\n            }\n\n            return this;\n\n        } else { // Getter returns a geometry point.\n\n            var elementPosition = g.point(this.get('position'));\n\n            return opt.parentRelative\n                ? elementPosition.difference(parentPosition)\n                : elementPosition;\n        }\n    },\n\n    translate: function(tx, ty, opt) {\n\n        tx = tx || 0;\n        ty = ty || 0;\n\n        if (tx === 0 && ty === 0) {\n            // Like nothing has happened.\n            return this;\n        }\n\n        opt = opt || {};\n        // Pass the initiator of the translation.\n        opt.translateBy = opt.translateBy || this.id;\n\n        var position = this.get('position') || { x: 0, y: 0 };\n\n        if (opt.restrictedArea && opt.translateBy === this.id) {\n\n            // We are restricting the translation for the element itself only. We get\n            // the bounding box of the element including all its embeds.\n            // All embeds have to be translated the exact same way as the element.\n            var bbox = this.getBBox({ deep: true });\n            var ra = opt.restrictedArea;\n            //- - - - - - - - - - - - -> ra.x + ra.width\n            // - - - -> position.x      |\n            // -> bbox.x\n            //                   |\n            //         \n            //                 |\n            //   \n            //                  |\n            //   <-dx->                     | restricted area right border\n            //         <-width->        |    translated element\n            //   <- - bbox.width - ->        embedded element\n            var dx = position.x - bbox.x;\n            var dy = position.y - bbox.y;\n            // Find the maximal/minimal coordinates that the element can be translated\n            // while complies the restrictions.\n            var x = Math.max(ra.x + dx, Math.min(ra.x + ra.width + dx - bbox.width, position.x + tx));\n            var y = Math.max(ra.y + dy, Math.min(ra.y + ra.height + dy - bbox.height, position.y + ty));\n            // recalculate the translation taking the resctrictions into account.\n            tx = x - position.x;\n            ty = y - position.y;\n        }\n\n        var translatedPosition = {\n            x: position.x + tx,\n            y: position.y + ty\n        };\n\n        // To find out by how much an element was translated in event 'change:position' handlers.\n        opt.tx = tx;\n        opt.ty = ty;\n\n        if (opt.transition) {\n\n            if (!joint.util.isObject(opt.transition)) opt.transition = {};\n\n            this.transition('position', translatedPosition, joint.util.assign({}, opt.transition, {\n                valueFunction: joint.util.interpolate.object\n            }));\n\n        } else {\n\n            this.set('position', translatedPosition, opt);\n        }\n\n        // Recursively call `translate()` on all the embeds cells.\n        joint.util.invoke(this.getEmbeddedCells(), 'translate', tx, ty, opt);\n\n        return this;\n    },\n\n    size: function(width, height, opt) {\n\n        var currentSize = this.get('size');\n        // Getter\n        // () signature\n        if (width === undefined) {\n            return {\n                width: currentSize.width,\n                height: currentSize.height\n            };\n        }\n        // Setter\n        // (size, opt) signature\n        if (joint.util.isObject(width)) {\n            opt = height;\n            height = joint.util.isNumber(width.height) ? width.height : currentSize.height;\n            width = joint.util.isNumber(width.width) ? width.width : currentSize.width;\n        }\n\n        return this.resize(width, height, opt);\n    },\n\n    resize: function(width, height, opt) {\n\n        opt = opt || {};\n\n        this.startBatch('resize', opt);\n\n        if (opt.direction) {\n\n            var currentSize = this.get('size');\n\n            switch (opt.direction) {\n\n                case 'left':\n                case 'right':\n                    // Don't change height when resizing horizontally.\n                    height = currentSize.height;\n                    break;\n\n                case 'top':\n                case 'bottom':\n                    // Don't change width when resizing vertically.\n                    width = currentSize.width;\n                    break;\n            }\n\n            // Get the angle and clamp its value between 0 and 360 degrees.\n            var angle = g.normalizeAngle(this.get('angle') || 0);\n\n            var quadrant = {\n                'top-right': 0,\n                'right': 0,\n                'top-left': 1,\n                'top': 1,\n                'bottom-left': 2,\n                'left': 2,\n                'bottom-right': 3,\n                'bottom': 3\n            }[opt.direction];\n\n            if (opt.absolute) {\n\n                // We are taking the element's rotation into account\n                quadrant += Math.floor((angle + 45) / 90);\n                quadrant %= 4;\n            }\n\n            // This is a rectangle in size of the unrotated element.\n            var bbox = this.getBBox();\n\n            // Pick the corner point on the element, which meant to stay on its place before and\n            // after the rotation.\n            var fixedPoint = bbox[['bottomLeft', 'corner', 'topRight', 'origin'][quadrant]]();\n\n            // Find  an image of the previous indent point. This is the position, where is the\n            // point actually located on the screen.\n            var imageFixedPoint = g.point(fixedPoint).rotate(bbox.center(), -angle);\n\n            // Every point on the element rotates around a circle with the centre of rotation\n            // in the middle of the element while the whole element is being rotated. That means\n            // that the distance from a point in the corner of the element (supposed its always rect) to\n            // the center of the element doesn't change during the rotation and therefore it equals\n            // to a distance on unrotated element.\n            // We can find the distance as DISTANCE = (ELEMENTWIDTH/2)^2 + (ELEMENTHEIGHT/2)^2)^0.5.\n            var radius = Math.sqrt((width * width) + (height * height)) / 2;\n\n            // Now we are looking for an angle between x-axis and the line starting at image of fixed point\n            // and ending at the center of the element. We call this angle `alpha`.\n\n            // The image of a fixed point is located in n-th quadrant. For each quadrant passed\n            // going anti-clockwise we have to add 90 degrees. Note that the first quadrant has index 0.\n            //\n            // 3 | 2\n            // --c-- Quadrant positions around the element's center `c`\n            // 0 | 1\n            //\n            var alpha = quadrant * Math.PI / 2;\n\n            // Add an angle between the beginning of the current quadrant (line parallel with x-axis or y-axis\n            // going through the center of the element) and line crossing the indent of the fixed point and the center\n            // of the element. This is the angle we need but on the unrotated element.\n            alpha += Math.atan(quadrant % 2 == 0 ? height / width : width / height);\n\n            // Lastly we have to deduct the original angle the element was rotated by and that's it.\n            alpha -= g.toRad(angle);\n\n            // With this angle and distance we can easily calculate the centre of the unrotated element.\n            // Note that fromPolar constructor accepts an angle in radians.\n            var center = g.point.fromPolar(radius, alpha, imageFixedPoint);\n\n            // The top left corner on the unrotated element has to be half a width on the left\n            // and half a height to the top from the center. This will be the origin of rectangle\n            // we were looking for.\n            var origin = g.point(center).offset(width / -2, height / -2);\n\n            // Resize the element (before re-positioning it).\n            this.set('size', { width: width, height: height }, opt);\n\n            // Finally, re-position the element.\n            this.position(origin.x, origin.y, opt);\n\n        } else {\n\n            // Resize the element.\n            this.set('size', { width: width, height: height }, opt);\n        }\n\n        this.stopBatch('resize', opt);\n\n        return this;\n    },\n\n    scale: function(sx, sy, origin, opt) {\n\n        var scaledBBox = this.getBBox().scale(sx, sy, origin);\n        this.startBatch('scale', opt);\n        this.position(scaledBBox.x, scaledBBox.y, opt);\n        this.resize(scaledBBox.width, scaledBBox.height, opt);\n        this.stopBatch('scale');\n        return this;\n    },\n\n    fitEmbeds: function(opt) {\n\n        opt = opt || {};\n\n        // Getting the children's size and position requires the collection.\n        // Cell.get('embdes') helds an array of cell ids only.\n        if (!this.graph) throw new Error('Element must be part of a graph.');\n\n        var embeddedCells = this.getEmbeddedCells();\n\n        if (embeddedCells.length > 0) {\n\n            this.startBatch('fit-embeds', opt);\n\n            if (opt.deep) {\n                // Recursively apply fitEmbeds on all embeds first.\n                joint.util.invoke(embeddedCells, 'fitEmbeds', opt);\n            }\n\n            // Compute cell's size and position  based on the children bbox\n            // and given padding.\n            var bbox = this.graph.getCellsBBox(embeddedCells);\n            var padding = joint.util.normalizeSides(opt.padding);\n\n            // Apply padding computed above to the bbox.\n            bbox.moveAndExpand({\n                x: -padding.left,\n                y: -padding.top,\n                width: padding.right + padding.left,\n                height: padding.bottom + padding.top\n            });\n\n            // Set new element dimensions finally.\n            this.set({\n                position: { x: bbox.x, y: bbox.y },\n                size: { width: bbox.width, height: bbox.height }\n            }, opt);\n\n            this.stopBatch('fit-embeds');\n        }\n\n        return this;\n    },\n\n    // Rotate element by `angle` degrees, optionally around `origin` point.\n    // If `origin` is not provided, it is considered to be the center of the element.\n    // If `absolute` is `true`, the `angle` is considered is abslute, i.e. it is not\n    // the difference from the previous angle.\n    rotate: function(angle, absolute, origin, opt) {\n\n        if (origin) {\n\n            var center = this.getBBox().center();\n            var size = this.get('size');\n            var position = this.get('position');\n            center.rotate(origin, this.get('angle') - angle);\n            var dx = center.x - size.width / 2 - position.x;\n            var dy = center.y - size.height / 2 - position.y;\n            this.startBatch('rotate', { angle: angle, absolute: absolute, origin: origin });\n            this.position(position.x + dx, position.y + dy, opt);\n            this.rotate(angle, absolute, null, opt);\n            this.stopBatch('rotate');\n\n        } else {\n\n            this.set('angle', absolute ? angle : (this.get('angle') + angle) % 360, opt);\n        }\n\n        return this;\n    },\n\n    angle: function() {\n        return g.normalizeAngle(this.get('angle') || 0);\n    },\n\n    getBBox: function(opt) {\n\n        opt = opt || {};\n\n        if (opt.deep && this.graph) {\n\n            // Get all the embedded elements using breadth first algorithm,\n            // that doesn't use recursion.\n            var elements = this.getEmbeddedCells({ deep: true, breadthFirst: true });\n            // Add the model itself.\n            elements.push(this);\n\n            return this.graph.getCellsBBox(elements);\n        }\n\n        var position = this.get('position');\n        var size = this.get('size');\n\n        return new g.Rect(position.x, position.y, size.width, size.height);\n    }\n});\n\n// joint.dia.Element base view and controller.\n// -------------------------------------------\n\njoint.dia.ElementView = joint.dia.CellView.extend({\n\n    /**\n     * @abstract\n     */\n    _removePorts: function() {\n        // implemented in ports.js\n    },\n\n    /**\n     *\n     * @abstract\n     */\n    _renderPorts: function() {\n        // implemented in ports.js\n    },\n\n    className: function() {\n\n        var classNames = joint.dia.CellView.prototype.className.apply(this).split(' ');\n\n        classNames.push('element');\n\n        return classNames.join(' ');\n    },\n\n    metrics: null,\n\n    initialize: function() {\n\n        joint.dia.CellView.prototype.initialize.apply(this, arguments);\n\n        var model = this.model;\n\n        this.listenTo(model, 'change:position', this.translate);\n        this.listenTo(model, 'change:size', this.resize);\n        this.listenTo(model, 'change:angle', this.rotate);\n        this.listenTo(model, 'change:markup', this.render);\n\n        this._initializePorts();\n\n        this.metrics = {};\n    },\n\n    /**\n     * @abstract\n     */\n    _initializePorts: function() {\n\n    },\n\n    update: function(cell, renderingOnlyAttrs) {\n\n        this.metrics = {};\n\n        this._removePorts();\n\n        var model = this.model;\n        var modelAttrs = model.attr();\n        this.updateDOMSubtreeAttributes(this.el, modelAttrs, {\n            rootBBox: new g.Rect(model.size()),\n            selectors: this.selectors,\n            scalableNode: this.scalableNode,\n            rotatableNode: this.rotatableNode,\n            // Use rendering only attributes if they differs from the model attributes\n            roAttributes: (renderingOnlyAttrs === modelAttrs) ? null : renderingOnlyAttrs\n        });\n\n        this._renderPorts();\n    },\n\n    rotatableSelector: 'rotatable',\n    scalableSelector: 'scalable',\n    scalableNode: null,\n    rotatableNode: null,\n\n    // `prototype.markup` is rendered by default. Set the `markup` attribute on the model if the\n    // default markup is not desirable.\n    renderMarkup: function() {\n\n        var element = this.model;\n        var markup = element.get('markup') || element.markup;\n        if (!markup) throw new Error('dia.ElementView: markup required');\n        if (Array.isArray(markup)) return this.renderJSONMarkup(markup);\n        if (typeof markup === 'string') return this.renderStringMarkup(markup);\n        throw new Error('dia.ElementView: invalid markup');\n    },\n\n    renderJSONMarkup: function(markup) {\n\n        var doc = this.parseDOMJSON(markup, this.el);\n        var selectors = this.selectors = doc.selectors;\n        this.rotatableNode = V(selectors[this.rotatableSelector]) || null;\n        this.scalableNode = V(selectors[this.scalableSelector]) || null;\n        // Fragment\n        this.vel.append(doc.fragment);\n    },\n\n    renderStringMarkup: function(markup) {\n\n        var vel = this.vel;\n        vel.append(V(markup));\n        // Cache transformation groups\n        this.rotatableNode = vel.findOne('.rotatable');\n        this.scalableNode = vel.findOne('.scalable');\n\n        var selectors = this.selectors = {};\n        selectors[this.selector] = this.el;\n    },\n\n    render: function() {\n\n        this.vel.empty();\n        this.renderMarkup();\n        if (this.scalableNode) {\n            // Double update is necessary for elements with the scalable group only\n            // Note the resize() triggers the other `update`.\n            this.update();\n        }\n        this.resize();\n        if (this.rotatableNode) {\n            // Translate transformation is applied on `this.el` while the rotation transformation\n            // on `this.rotatableNode`\n            this.rotate();\n            this.translate();\n            return this;\n        }\n        this.updateTransformation();\n        return this;\n    },\n\n    resize: function() {\n\n        if (this.scalableNode) return this.sgResize.apply(this, arguments);\n        if (this.model.attributes.angle) this.rotate();\n        this.update();\n    },\n\n    translate: function() {\n\n        if (this.rotatableNode) return this.rgTranslate();\n        this.updateTransformation();\n    },\n\n    rotate: function() {\n\n        if (this.rotatableNode) return this.rgRotate();\n        this.updateTransformation();\n    },\n\n    updateTransformation: function() {\n\n        var transformation = this.getTranslateString();\n        var rotateString = this.getRotateString();\n        if (rotateString) transformation += ' ' + rotateString;\n        this.vel.attr('transform', transformation);\n    },\n\n    getTranslateString: function() {\n\n        var position = this.model.attributes.position;\n        return 'translate(' + position.x + ',' + position.y + ')';\n    },\n\n    getRotateString: function() {\n        var attributes = this.model.attributes;\n        var angle = attributes.angle;\n        if (!angle) return null;\n        var size = attributes.size;\n        return 'rotate(' + angle + ',' + (size.width / 2) + ',' + (size.height / 2) + ')';\n    },\n\n    getBBox: function(opt) {\n\n        var bbox;\n        if (opt && opt.useModelGeometry) {\n            var model = this.model;\n            bbox = model.getBBox().bbox(model.angle());\n        } else {\n            bbox = this.getNodeBBox(this.el);\n        }\n\n        return this.paper.localToPaperRect(bbox);\n    },\n\n    nodeCache: function(magnet) {\n\n        var metrics = this.metrics;\n        if (!metrics) {\n            // don't use cache\n            // it most likely a custom view with overridden update\n            return {};\n        }\n\n        var id = V.ensureId(magnet);\n\n        var value = metrics[id];\n        if (!value) value = metrics[id] = {};\n        return value;\n    },\n\n    getNodeData: function(magnet) {\n\n        var metrics = this.nodeCache(magnet);\n        if (!metrics.data) metrics.data = {};\n        return metrics.data;\n    },\n\n    getNodeBBox: function(magnet) {\n\n        var rect = this.getNodeBoundingRect(magnet);\n        var magnetMatrix = this.getNodeMatrix(magnet);\n        var translateMatrix = this.getRootTranslateMatrix();\n        var rotateMatrix = this.getRootRotateMatrix();\n        return V.transformRect(rect, translateMatrix.multiply(rotateMatrix).multiply(magnetMatrix));\n    },\n\n    getNodeBoundingRect: function(magnet) {\n\n        var metrics = this.nodeCache(magnet);\n        if (metrics.boundingRect === undefined) metrics.boundingRect = V(magnet).getBBox();\n        return new g.Rect(metrics.boundingRect);\n    },\n\n    getNodeUnrotatedBBox: function(magnet) {\n\n        var rect = this.getNodeBoundingRect(magnet);\n        var magnetMatrix = this.getNodeMatrix(magnet);\n        var translateMatrix = this.getRootTranslateMatrix();\n        return V.transformRect(rect, translateMatrix.multiply(magnetMatrix));\n    },\n\n    getNodeShape: function(magnet) {\n\n        var metrics = this.nodeCache(magnet);\n        if (metrics.geometryShape === undefined) metrics.geometryShape = V(magnet).toGeometryShape();\n        return metrics.geometryShape.clone();\n    },\n\n    getNodeMatrix: function(magnet) {\n\n        var metrics = this.nodeCache(magnet);\n        if (metrics.magnetMatrix === undefined) {\n            var target = this.rotatableNode || this.el;\n            metrics.magnetMatrix = V(magnet).getTransformToElement(target);\n        }\n        return V.createSVGMatrix(metrics.magnetMatrix);\n    },\n\n    getRootTranslateMatrix: function() {\n\n        var model = this.model;\n        var position = model.position();\n        var mt = V.createSVGMatrix().translate(position.x, position.y);\n        return mt;\n    },\n\n    getRootRotateMatrix: function() {\n\n        var mr = V.createSVGMatrix();\n        var model = this.model;\n        var angle = model.angle();\n        if (angle) {\n            var bbox = model.getBBox();\n            var cx = bbox.width / 2;\n            var cy = bbox.height / 2;\n            mr = mr.translate(cx, cy).rotate(angle).translate(-cx, -cy);\n        }\n        return mr;\n    },\n\n    // Rotatable & Scalable Group\n    // always slower, kept mainly for backwards compatibility\n\n    rgRotate: function() {\n\n        this.rotatableNode.attr('transform', this.getRotateString());\n    },\n\n    rgTranslate: function() {\n\n        this.vel.attr('transform', this.getTranslateString());\n    },\n\n    sgResize: function(cell, changed, opt) {\n\n        var model = this.model;\n        var angle = model.get('angle') || 0;\n        var size = model.get('size') || { width: 1, height: 1 };\n        var scalable = this.scalableNode;\n\n        // Getting scalable group's bbox.\n        // Due to a bug in webkit's native SVG .getBBox implementation, the bbox of groups with path children includes the paths' control points.\n        // To work around the issue, we need to check whether there are any path elements inside the scalable group.\n        var recursive = false;\n        if (scalable.node.getElementsByTagName('path').length > 0) {\n            // If scalable has at least one descendant that is a path, we need to switch to recursive bbox calculation.\n            // If there are no path descendants, group bbox calculation works and so we can use the (faster) native function directly.\n            recursive = true;\n        }\n        var scalableBBox = scalable.getBBox({ recursive: recursive });\n\n        // Make sure `scalableBbox.width` and `scalableBbox.height` are not zero which can happen if the element does not have any content. By making\n        // the width/height 1, we prevent HTML errors of the type `scale(Infinity, Infinity)`.\n        var sx = (size.width / (scalableBBox.width || 1));\n        var sy = (size.height / (scalableBBox.height || 1));\n        scalable.attr('transform', 'scale(' + sx + ',' + sy + ')');\n\n        // Now the interesting part. The goal is to be able to store the object geometry via just `x`, `y`, `angle`, `width` and `height`\n        // Order of transformations is significant but we want to reconstruct the object always in the order:\n        // resize(), rotate(), translate() no matter of how the object was transformed. For that to work,\n        // we must adjust the `x` and `y` coordinates of the object whenever we resize it (because the origin of the\n        // rotation changes). The new `x` and `y` coordinates are computed by canceling the previous rotation\n        // around the center of the resized object (which is a different origin then the origin of the previous rotation)\n        // and getting the top-left corner of the resulting object. Then we clean up the rotation back to what it originally was.\n\n        // Cancel the rotation but now around a different origin, which is the center of the scaled object.\n        var rotatable = this.rotatableNode;\n        var rotation = rotatable && rotatable.attr('transform');\n        if (rotation) {\n\n            rotatable.attr('transform', rotation + ' rotate(' + (-angle) + ',' + (size.width / 2) + ',' + (size.height / 2) + ')');\n            var rotatableBBox = scalable.getBBox({ target: this.paper.viewport });\n\n            // Store new x, y and perform rotate() again against the new rotation origin.\n            model.set('position', { x: rotatableBBox.x, y: rotatableBBox.y }, opt);\n            this.rotate();\n        }\n\n        // Update must always be called on non-rotated element. Otherwise, relative positioning\n        // would work with wrong (rotated) bounding boxes.\n        this.update();\n    },\n\n    // Embedding mode methods.\n    // -----------------------\n\n    prepareEmbedding: function(data) {\n\n        data || (data = {});\n\n        var model = data.model || this.model;\n        var paper = data.paper || this.paper;\n        var graph = paper.model;\n\n        model.startBatch('to-front');\n\n        // Bring the model to the front with all his embeds.\n        model.toFront({ deep: true, ui: true });\n\n        // Note that at this point cells in the collection are not sorted by z index (it's running in the batch, see\n        // the dia.Graph._sortOnChangeZ), so we can't assume that the last cell in the collection has the highest z.\n        var maxZ = graph.getElements().reduce(function(max, cell) {\n            return Math.max(max, cell.attributes.z || 0);\n        }, 0);\n\n        // Move to front also all the inbound and outbound links that are connected\n        // to any of the element descendant. If we bring to front only embedded elements,\n        // links connected to them would stay in the background.\n        var connectedLinks = graph.getConnectedLinks(model, { deep: true, includeEnclosed: true });\n        connectedLinks.forEach(function(link) {\n            if (link.attributes.z <= maxZ) link.set('z', maxZ + 1, { ui: true });\n        });\n\n        model.stopBatch('to-front');\n\n        // Before we start looking for suitable parent we remove the current one.\n        var parentId = model.parent();\n        if (parentId) {\n            graph.getCell(parentId).unembed(model, { ui: true });\n        }\n    },\n\n    processEmbedding: function(data) {\n\n        data || (data = {});\n\n        var model = data.model || this.model;\n        var paper = data.paper || this.paper;\n        var paperOptions = paper.options;\n\n        var candidates = [];\n        if (joint.util.isFunction(paperOptions.findParentBy)) {\n            var parents = joint.util.toArray(paperOptions.findParentBy.call(paper.model, this));\n            candidates = parents.filter(function(el) {\n                return el instanceof joint.dia.Cell && this.model.id !== el.id && !el.isEmbeddedIn(this.model);\n            }.bind(this));\n        } else {\n            candidates = paper.model.findModelsUnderElement(model, { searchBy: paperOptions.findParentBy });\n        }\n\n        if (paperOptions.frontParentOnly) {\n            // pick the element with the highest `z` index\n            candidates = candidates.slice(-1);\n        }\n\n        var newCandidateView = null;\n        var prevCandidateView = data.candidateEmbedView;\n\n        // iterate over all candidates starting from the last one (has the highest z-index).\n        for (var i = candidates.length - 1; i >= 0; i--) {\n\n            var candidate = candidates[i];\n\n            if (prevCandidateView && prevCandidateView.model.id == candidate.id) {\n\n                // candidate remains the same\n                newCandidateView = prevCandidateView;\n                break;\n\n            } else {\n\n                var view = candidate.findView(paper);\n                if (paperOptions.validateEmbedding.call(paper, this, view)) {\n\n                    // flip to the new candidate\n                    newCandidateView = view;\n                    break;\n                }\n            }\n        }\n\n        if (newCandidateView && newCandidateView != prevCandidateView) {\n            // A new candidate view found. Highlight the new one.\n            this.clearEmbedding(data);\n            data.candidateEmbedView = newCandidateView.highlight(null, { embedding: true });\n        }\n\n        if (!newCandidateView && prevCandidateView) {\n            // No candidate view found. Unhighlight the previous candidate.\n            this.clearEmbedding(data);\n        }\n    },\n\n    clearEmbedding: function(data) {\n\n        data || (data = {});\n\n        var candidateView = data.candidateEmbedView;\n        if (candidateView) {\n            // No candidate view found. Unhighlight the previous candidate.\n            candidateView.unhighlight(null, { embedding: true });\n            data.candidateEmbedView = null;\n        }\n    },\n\n    finalizeEmbedding: function(data) {\n\n        data || (data = {});\n\n        var candidateView = data.candidateEmbedView;\n        var model = data.model || this.model;\n        var paper = data.paper || this.paper;\n\n        if (candidateView) {\n\n            // We finished embedding. Candidate view is chosen to become the parent of the model.\n            candidateView.model.embed(model, { ui: true });\n            candidateView.unhighlight(null, { embedding: true });\n\n            data.candidateEmbedView = null;\n        }\n\n        joint.util.invoke(paper.model.getConnectedLinks(model, { deep: true }), 'reparent', { ui: true });\n    },\n\n    getDelegatedView: function() {\n\n        var view = this;\n        var model = view.model;\n        var paper = view.paper;\n\n        while (view) {\n            if (model.isLink()) break;\n            if (!model.isEmbedded() || view.can('stopDelegation')) return view;\n            model = model.getParentCell();\n            view = paper.findViewByModel(model);\n        }\n\n        return null;\n    },\n\n    // Interaction. The controller part.\n    // ---------------------------------\n\n    pointerdblclick: function(evt, x, y) {\n\n        joint.dia.CellView.prototype.pointerdblclick.apply(this, arguments);\n        this.notify('element:pointerdblclick', evt, x, y);\n    },\n\n    pointerclick: function(evt, x, y) {\n\n        joint.dia.CellView.prototype.pointerclick.apply(this, arguments);\n        this.notify('element:pointerclick', evt, x, y);\n    },\n\n    contextmenu: function(evt, x, y) {\n\n        joint.dia.CellView.prototype.contextmenu.apply(this, arguments);\n        this.notify('element:contextmenu', evt, x, y);\n    },\n\n    pointerdown: function(evt, x, y) {\n\n        if (this.isPropagationStopped(evt)) return;\n\n        joint.dia.CellView.prototype.pointerdown.apply(this, arguments);\n        this.notify('element:pointerdown', evt, x, y);\n\n        this.dragStart(evt, x, y);\n    },\n\n    pointermove: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n\n        switch (data.action) {\n            case 'magnet':\n                this.dragMagnet(evt, x, y);\n                break;\n            case 'move':\n                (data.delegatedView || this).drag(evt, x, y);\n            // eslint: no-fallthrough=false\n            default:\n                joint.dia.CellView.prototype.pointermove.apply(this, arguments);\n                this.notify('element:pointermove', evt, x, y);\n                break;\n        }\n\n        // Make sure the element view data is passed along.\n        // It could have been wiped out in the handlers above.\n        this.eventData(evt, data);\n    },\n\n    pointerup: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n        switch (data.action) {\n            case 'magnet':\n                this.dragMagnetEnd(evt, x, y);\n                break;\n            case 'move':\n                (data.delegatedView || this).dragEnd(evt, x, y);\n            // eslint: no-fallthrough=false\n            default:\n                this.notify('element:pointerup', evt, x, y);\n                joint.dia.CellView.prototype.pointerup.apply(this, arguments);\n        }\n\n        var magnet = data.targetMagnet;\n        if (magnet) this.magnetpointerclick(evt, magnet, x, y);\n    },\n\n    mouseover: function(evt) {\n\n        joint.dia.CellView.prototype.mouseover.apply(this, arguments);\n        this.notify('element:mouseover', evt);\n    },\n\n    mouseout: function(evt) {\n\n        joint.dia.CellView.prototype.mouseout.apply(this, arguments);\n        this.notify('element:mouseout', evt);\n    },\n\n    mouseenter: function(evt) {\n\n        joint.dia.CellView.prototype.mouseenter.apply(this, arguments);\n        this.notify('element:mouseenter', evt);\n    },\n\n    mouseleave: function(evt) {\n\n        joint.dia.CellView.prototype.mouseleave.apply(this, arguments);\n        this.notify('element:mouseleave', evt);\n    },\n\n    mousewheel: function(evt, x, y, delta) {\n\n        joint.dia.CellView.prototype.mousewheel.apply(this, arguments);\n        this.notify('element:mousewheel', evt, x, y, delta);\n    },\n\n    onmagnet: function(evt, x, y) {\n\n        this.dragMagnetStart(evt, x, y);\n    },\n\n    magnetpointerdblclick: function(evt, magnet, x, y) {\n\n        this.notify('element:magnet:pointerdblclick', evt, magnet, x, y);\n    },\n\n    magnetcontextmenu: function(evt, magnet, x, y) {\n\n        this.notify('element:magnet:contextmenu', evt, magnet, x, y);\n    },\n\n    // Drag Start Handlers\n\n    dragStart: function(evt, x, y) {\n\n        var view = this.getDelegatedView();\n        if (!view || !view.can('elementMove')) return;\n\n        this.eventData(evt, {\n            action: 'move',\n            delegatedView: view\n        });\n\n        view.eventData(evt, {\n            x: x,\n            y: y,\n            restrictedArea: this.paper.getRestrictedArea(view)\n        });\n    },\n\n    dragMagnetStart: function(evt, x, y) {\n\n        if (!this.can('addLinkFromMagnet')) return;\n\n        var magnet = evt.currentTarget;\n        var paper = this.paper;\n        this.eventData(evt, { targetMagnet: magnet });\n        evt.stopPropagation();\n\n        if (paper.options.validateMagnet(this, magnet)) {\n\n            if (paper.options.magnetThreshold <= 0) {\n                this.dragLinkStart(evt, magnet, x, y);\n            }\n\n            this.eventData(evt, { action: 'magnet' });\n            this.stopPropagation(evt);\n\n        } else {\n\n            this.pointerdown(evt, x, y);\n        }\n\n        paper.delegateDragEvents(this, evt.data);\n    },\n\n    dragLinkStart: function(evt, magnet, x, y) {\n\n        this.model.startBatch('add-link');\n\n        var linkView = this.addLinkFromMagnet(magnet, x, y);\n\n        // backwards compatiblity events\n        joint.dia.CellView.prototype.pointerdown.apply(linkView, arguments);\n        linkView.notify('link:pointerdown', evt, x, y);\n\n        linkView.eventData(evt, linkView.startArrowheadMove('target', { whenNotAllowed: 'remove' }));\n        this.eventData(evt, { linkView: linkView });\n    },\n\n    addLinkFromMagnet: function(magnet, x, y) {\n\n        var paper = this.paper;\n        var graph = paper.model;\n\n        var link = paper.getDefaultLink(this, magnet);\n        link.set({\n            source: this.getLinkEnd(magnet, x, y, link, 'source'),\n            target: { x: x, y: y }\n        }).addTo(graph, {\n            async: false,\n            ui: true\n        });\n\n        return link.findView(paper);\n    },\n\n    // Drag Handlers\n\n    drag: function(evt, x, y) {\n\n        var paper = this.paper;\n        var grid = paper.options.gridSize;\n        var element = this.model;\n        var position = element.position();\n        var data = this.eventData(evt);\n\n        // Make sure the new element's position always snaps to the current grid after\n        // translate as the previous one could be calculated with a different grid size.\n        var tx = g.snapToGrid(position.x, grid) - position.x + g.snapToGrid(x - data.x, grid);\n        var ty = g.snapToGrid(position.y, grid) - position.y + g.snapToGrid(y - data.y, grid);\n\n        element.translate(tx, ty, { restrictedArea: data.restrictedArea, ui: true });\n\n        var embedding = !!data.embedding;\n        if (paper.options.embeddingMode) {\n            if (!embedding) {\n                // Prepare the element for embedding only if the pointer moves.\n                // We don't want to do unnecessary action with the element\n                // if an user only clicks/dblclicks on it.\n                this.prepareEmbedding(data);\n                embedding = true;\n            }\n            this.processEmbedding(data);\n        }\n\n        this.eventData(evt, {\n            x: g.snapToGrid(x, grid),\n            y: g.snapToGrid(y, grid),\n            embedding: embedding\n        });\n    },\n\n    dragMagnet: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n        var linkView = data.linkView;\n        if (linkView) {\n            linkView.pointermove(evt, x, y);\n        } else {\n            var paper = this.paper;\n            var magnetThreshold = paper.options.magnetThreshold;\n            var currentTarget = this.getEventTarget(evt);\n            var targetMagnet = data.targetMagnet;\n            if (magnetThreshold === 'onleave') {\n                // magnetThreshold when the pointer leaves the magnet\n                if (targetMagnet === currentTarget || V(targetMagnet).contains(currentTarget)) return;\n            } else {\n                // magnetThreshold defined as a number of movements\n                if (paper.eventData(evt).mousemoved <= magnetThreshold) return;\n            }\n            this.dragLinkStart(evt, targetMagnet, x, y);\n        }\n    },\n\n    // Drag End Handlers\n\n    dragEnd: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n        if (data.embedding) this.finalizeEmbedding(data);\n    },\n\n    dragMagnetEnd: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n        var linkView = data.linkView;\n        if (!linkView) return;\n        linkView.pointerup(evt, x, y);\n        this.model.stopBatch('add-link');\n    },\n\n    magnetpointerclick: function(evt, magnet, x, y) {\n        var paper = this.paper;\n        if (paper.eventData(evt).mousemoved > paper.options.clickThreshold) return;\n        this.notify('element:magnet:pointerclick', evt, magnet, x, y);\n    }\n});\n\n\n// joint.dia.Link base model.\n// --------------------------\n\njoint.dia.Link = joint.dia.Cell.extend({\n\n    // The default markup for links.\n    markup: [\n        '<path class=\"connection\" stroke=\"black\" d=\"M 0 0 0 0\"/>',\n        '<path class=\"marker-source\" fill=\"black\" stroke=\"black\" d=\"M 0 0 0 0\"/>',\n        '<path class=\"marker-target\" fill=\"black\" stroke=\"black\" d=\"M 0 0 0 0\"/>',\n        '<path class=\"connection-wrap\" d=\"M 0 0 0 0\"/>',\n        '<g class=\"labels\"/>',\n        '<g class=\"marker-vertices\"/>',\n        '<g class=\"marker-arrowheads\"/>',\n        '<g class=\"link-tools\"/>'\n    ].join(''),\n\n    toolMarkup: [\n        '<g class=\"link-tool\">',\n        '<g class=\"tool-remove\" event=\"remove\">',\n        '<circle r=\"11\" />',\n        '<path transform=\"scale(.8) translate(-16, -16)\" d=\"M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z\" />',\n        '<title>Remove link.</title>',\n        '</g>',\n        '<g class=\"tool-options\" event=\"link:options\">',\n        '<circle r=\"11\" transform=\"translate(25)\"/>',\n        '<path fill=\"white\" transform=\"scale(.55) translate(29, -16)\" d=\"M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z\"/>',\n        '<title>Link options.</title>',\n        '</g>',\n        '</g>'\n    ].join(''),\n\n    doubleToolMarkup: undefined,\n\n    // The default markup for showing/removing vertices. These elements are the children of the .marker-vertices element (see `this.markup`).\n    // Only .marker-vertex and .marker-vertex-remove element have special meaning. The former is used for\n    // dragging vertices (changin their position). The latter is used for removing vertices.\n    vertexMarkup: [\n        '<g class=\"marker-vertex-group\" transform=\"translate(<%= x %>, <%= y %>)\">',\n        '<circle class=\"marker-vertex\" idx=\"<%= idx %>\" r=\"10\" />',\n        '<path class=\"marker-vertex-remove-area\" idx=\"<%= idx %>\" d=\"M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z\" transform=\"translate(5, -33)\"/>',\n        '<path class=\"marker-vertex-remove\" idx=\"<%= idx %>\" transform=\"scale(.8) translate(9.5, -37)\" d=\"M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z\">',\n        '<title>Remove vertex.</title>',\n        '</path>',\n        '</g>'\n    ].join(''),\n\n    arrowheadMarkup: [\n        '<g class=\"marker-arrowhead-group marker-arrowhead-group-<%= end %>\">',\n        '<path class=\"marker-arrowhead\" end=\"<%= end %>\" d=\"M 26 0 L 0 13 L 26 26 z\" />',\n        '</g>'\n    ].join(''),\n\n    // may be overwritten by user to change default label (its markup, attrs, position)\n    defaultLabel: undefined,\n\n    // deprecated\n    // may be overwritten by user to change default label markup\n    // lower priority than defaultLabel.markup\n    labelMarkup: undefined,\n\n    // private\n    _builtins: {\n        defaultLabel: {\n            // builtin default markup:\n            // used if neither defaultLabel.markup\n            // nor label.markup is set\n            markup: [\n                {\n                    tagName: 'rect',\n                    selector: 'rect' // faster than tagName CSS selector\n                }, {\n                    tagName: 'text',\n                    selector: 'text' // faster than tagName CSS selector\n                }\n            ],\n            // builtin default attributes:\n            // applied only if builtin default markup is used\n            attrs: {\n                text: {\n                    fill: '#000000',\n                    fontSize: 14,\n                    textAnchor: 'middle',\n                    yAlignment: 'middle',\n                    pointerEvents: 'none'\n                },\n                rect: {\n                    ref: 'text',\n                    fill: '#ffffff',\n                    rx: 3,\n                    ry: 3,\n                    refWidth: 1,\n                    refHeight: 1,\n                    refX: 0,\n                    refY: 0\n                }\n            },\n            // builtin default position:\n            // used if neither defaultLabel.position\n            // nor label.position is set\n            position: {\n                distance: 0.5\n            }\n        }\n    },\n\n    defaults: {\n        type: 'link',\n        source: {},\n        target: {}\n    },\n\n    isLink: function() {\n\n        return true;\n    },\n\n    disconnect: function(opt) {\n\n        return this.set({\n            source: { x: 0, y: 0 },\n            target: { x: 0, y: 0 }\n        }, opt);\n    },\n\n    source: function(source, args, opt) {\n\n        // getter\n        if (source === undefined) {\n            return joint.util.clone(this.get('source'));\n        }\n\n        // setter\n        var localSource;\n        var localOpt;\n\n        // `source` is a cell\n        // take only its `id` and combine with `args`\n        var isCellProvided = source instanceof joint.dia.Cell;\n        if (isCellProvided) { // three arguments\n            localSource = joint.util.clone(args) || {};\n            localSource.id = source.id;\n            localOpt = opt;\n            return this.set('source', localSource, localOpt);\n        }\n\n        // `source` is a g.Point\n        // take only its `x` and `y` and combine with `args`\n        var isPointProvided = source instanceof g.Point;\n        if (isPointProvided) { // three arguments\n            localSource = joint.util.clone(args) || {};\n            localSource.x = source.x;\n            localSource.y = source.y;\n            localOpt = opt;\n            return this.set('source', localSource, localOpt);\n        }\n\n        // `source` is an object\n        // no checking\n        // two arguments\n        localSource = source;\n        localOpt = args;\n        return this.set('source', localSource, localOpt);\n    },\n\n    target: function(target, args, opt) {\n\n        // getter\n        if (target === undefined) {\n            return joint.util.clone(this.get('target'));\n        }\n\n        // setter\n        var localTarget;\n        var localOpt;\n\n        // `target` is a cell\n        // take only its `id` argument and combine with `args`\n        var isCellProvided = target instanceof joint.dia.Cell;\n        if (isCellProvided) { // three arguments\n            localTarget = joint.util.clone(args) || {};\n            localTarget.id = target.id;\n            localOpt = opt;\n            return this.set('target', localTarget, localOpt);\n        }\n\n        // `target` is a g.Point\n        // take only its `x` and `y` and combine with `args`\n        var isPointProvided = target instanceof g.Point;\n        if (isPointProvided) { // three arguments\n            localTarget = joint.util.clone(args) || {};\n            localTarget.x = target.x;\n            localTarget.y = target.y;\n            localOpt = opt;\n            return this.set('target', localTarget, localOpt);\n        }\n\n        // `target` is an object\n        // no checking\n        // two arguments\n        localTarget = target;\n        localOpt = args;\n        return this.set('target', localTarget, localOpt);\n    },\n\n    router: function(name, args, opt) {\n\n        // getter\n        if (name === undefined) {\n            var router = this.get('router');\n            if (!router) {\n                if (this.get('manhattan')) return { name: 'orthogonal' }; // backwards compatibility\n                return null;\n            }\n            if (typeof router === 'object') return joint.util.clone(router);\n            return router; // e.g. a function\n        }\n\n        // setter\n        var isRouterProvided = ((typeof name === 'object') || (typeof name === 'function'));\n        var localRouter = isRouterProvided ? name : { name: name, args: args };\n        var localOpt = isRouterProvided ? args : opt;\n\n        return this.set('router', localRouter, localOpt);\n    },\n\n    connector: function(name, args, opt) {\n\n        // getter\n        if (name === undefined) {\n            var connector = this.get('connector');\n            if (!connector) {\n                if (this.get('smooth')) return { name: 'smooth' }; // backwards compatibility\n                return null;\n            }\n            if (typeof connector === 'object') return joint.util.clone(connector);\n            return connector; // e.g. a function\n        }\n\n        // setter\n        var isConnectorProvided = ((typeof name === 'object' || typeof name === 'function'));\n        var localConnector = isConnectorProvided ? name : { name: name, args: args };\n        var localOpt = isConnectorProvided ? args : opt;\n\n        return this.set('connector', localConnector, localOpt);\n    },\n\n    // Labels API\n\n    // A convenient way to set labels. Currently set values will be mixined with `value` if used as a setter.\n    label: function(idx, label, opt) {\n\n        var labels = this.labels();\n\n        idx = (isFinite(idx) && idx !== null) ? (idx | 0) : 0;\n        if (idx < 0) idx = labels.length + idx;\n\n        // getter\n        if (arguments.length <= 1) return this.prop(['labels', idx]);\n        // setter\n        return this.prop(['labels', idx], label, opt);\n    },\n\n    labels: function(labels, opt) {\n\n        // getter\n        if (arguments.length === 0) {\n            labels = this.get('labels');\n            if (!Array.isArray(labels)) return [];\n            return labels.slice();\n        }\n        // setter\n        if (!Array.isArray(labels)) labels = [];\n        return this.set('labels', labels, opt);\n    },\n\n    insertLabel: function(idx, label, opt) {\n\n        if (!label) throw new Error('dia.Link: no label provided');\n\n        var labels = this.labels();\n        var n = labels.length;\n        idx = (isFinite(idx) && idx !== null) ? (idx | 0) : n;\n        if (idx < 0) idx = n + idx + 1;\n\n        labels.splice(idx, 0, label);\n        return this.labels(labels, opt);\n    },\n\n    // convenience function\n    // add label to end of labels array\n    appendLabel: function(label, opt) {\n\n        return this.insertLabel(-1, label, opt);\n    },\n\n    removeLabel: function(idx, opt) {\n\n        var labels = this.labels();\n        idx = (isFinite(idx) && idx !== null) ? (idx | 0) : -1;\n\n        labels.splice(idx, 1);\n        return this.labels(labels, opt);\n    },\n\n    // Vertices API\n\n    vertex: function(idx, vertex, opt) {\n\n        var vertices = this.vertices();\n\n        idx = (isFinite(idx) && idx !== null) ? (idx | 0) : 0;\n        if (idx < 0) idx = vertices.length + idx;\n\n        // getter\n        if (arguments.length <= 1) return this.prop(['vertices', idx]);\n        // setter\n        return this.prop(['vertices', idx], vertex, opt);\n    },\n\n    vertices: function(vertices, opt) {\n\n        // getter\n        if (arguments.length === 0) {\n            vertices = this.get('vertices');\n            if (!Array.isArray(vertices)) return [];\n            return vertices.slice();\n        }\n        // setter\n        if (!Array.isArray(vertices)) vertices = [];\n        return this.set('vertices', vertices, opt);\n    },\n\n    insertVertex: function(idx, vertex, opt) {\n\n        if (!vertex) throw new Error('dia.Link: no vertex provided');\n\n        var vertices = this.vertices();\n        var n = vertices.length;\n        idx = (isFinite(idx) && idx !== null) ? (idx | 0) : n;\n        if (idx < 0) idx = n + idx + 1;\n\n        vertices.splice(idx, 0, vertex);\n        return this.vertices(vertices, opt);\n    },\n\n    removeVertex: function(idx, opt) {\n\n        var vertices = this.vertices();\n        idx = (isFinite(idx) && idx !== null) ? (idx | 0) : -1;\n\n        vertices.splice(idx, 1);\n        return this.vertices(vertices, opt);\n    },\n\n    // Transformations\n\n    translate: function(tx, ty, opt) {\n\n        // enrich the option object\n        opt = opt || {};\n        opt.translateBy = opt.translateBy || this.id;\n        opt.tx = tx;\n        opt.ty = ty;\n\n        return this.applyToPoints(function(p) {\n            return { x: (p.x || 0) + tx, y: (p.y || 0) + ty };\n        }, opt);\n    },\n\n    scale: function(sx, sy, origin, opt) {\n\n        return this.applyToPoints(function(p) {\n            return g.point(p).scale(sx, sy, origin).toJSON();\n        }, opt);\n    },\n\n    applyToPoints: function(fn, opt) {\n\n        if (!joint.util.isFunction(fn)) {\n            throw new TypeError('dia.Link: applyToPoints expects its first parameter to be a function.');\n        }\n\n        var attrs = {};\n\n        var source = this.source();\n        if (!source.id) {\n            attrs.source = fn(source);\n        }\n\n        var target = this.target();\n        if (!target.id) {\n            attrs.target = fn(target);\n        }\n\n        var vertices = this.vertices();\n        if (vertices.length > 0) {\n            attrs.vertices = vertices.map(fn);\n        }\n\n        return this.set(attrs, opt);\n    },\n\n    reparent: function(opt) {\n\n        var newParent;\n\n        if (this.graph) {\n\n            var source = this.getSourceElement();\n            var target = this.getTargetElement();\n            var prevParent = this.getParentCell();\n\n            if (source && target) {\n                if (source === target || source.isEmbeddedIn(target)) {\n                    newParent = target;\n                } else if (target.isEmbeddedIn(source)) {\n                    newParent = source;\n                } else {\n                    newParent = this.graph.getCommonAncestor(source, target);\n                }\n            }\n\n            if (prevParent && (!newParent || newParent.id !== prevParent.id)) {\n                // Unembed the link if source and target has no common ancestor\n                // or common ancestor changed\n                prevParent.unembed(this, opt);\n            }\n\n            if (newParent) {\n                newParent.embed(this, opt);\n            }\n        }\n\n        return newParent;\n    },\n\n    hasLoop: function(opt) {\n\n        opt = opt || {};\n\n        var sourceId = this.source().id;\n        var targetId = this.target().id;\n\n        if (!sourceId || !targetId) {\n            // Link \"pinned\" to the paper does not have a loop.\n            return false;\n        }\n\n        var loop = sourceId === targetId;\n\n        // Note that there in the deep mode a link can have a loop,\n        // even if it connects only a parent and its embed.\n        // A loop \"target equals source\" is valid in both shallow and deep mode.\n        if (!loop && opt.deep && this.graph) {\n\n            var sourceElement = this.getSourceElement();\n            var targetElement = this.getTargetElement();\n\n            loop = sourceElement.isEmbeddedIn(targetElement) || targetElement.isEmbeddedIn(sourceElement);\n        }\n\n        return loop;\n    },\n\n    // unlike source(), this method returns null if source is a point\n    getSourceElement: function() {\n\n        var source = this.source();\n        var graph = this.graph;\n\n        return (source && source.id && graph && graph.getCell(source.id)) || null;\n    },\n\n    // unlike target(), this method returns null if target is a point\n    getTargetElement: function() {\n\n        var target = this.target();\n        var graph = this.graph;\n\n        return (target && target.id && graph && graph.getCell(target.id)) || null;\n    },\n\n    // Returns the common ancestor for the source element,\n    // target element and the link itself.\n    getRelationshipAncestor: function() {\n\n        var connectionAncestor;\n\n        if (this.graph) {\n\n            var cells = [\n                this,\n                this.getSourceElement(), // null if source is a point\n                this.getTargetElement() // null if target is a point\n            ].filter(function(item) {\n                return !!item;\n            });\n\n            connectionAncestor = this.graph.getCommonAncestor.apply(this.graph, cells);\n        }\n\n        return connectionAncestor || null;\n    },\n\n    // Is source, target and the link itself embedded in a given cell?\n    isRelationshipEmbeddedIn: function(cell) {\n\n        var cellId = (joint.util.isString(cell) || joint.util.isNumber(cell)) ? cell : cell.id;\n        var ancestor = this.getRelationshipAncestor();\n\n        return !!ancestor && (ancestor.id === cellId || ancestor.isEmbeddedIn(cellId));\n    },\n\n    // Get resolved default label.\n    _getDefaultLabel: function() {\n\n        var defaultLabel = this.get('defaultLabel') || this.defaultLabel || {};\n\n        var label = {};\n        label.markup = defaultLabel.markup || this.get('labelMarkup') || this.labelMarkup;\n        label.position = defaultLabel.position;\n        label.attrs = defaultLabel.attrs;\n        label.size = defaultLabel.size;\n\n        return label;\n    }\n}, {\n\n    endsEqual: function(a, b) {\n\n        var portsEqual = a.port === b.port || !a.port && !b.port;\n        return a.id === b.id && portsEqual;\n    }\n});\n\n\n// joint.dia.Link base view and controller.\n// ----------------------------------------\n\njoint.dia.LinkView = joint.dia.CellView.extend({\n\n    className: function() {\n\n        var classNames = joint.dia.CellView.prototype.className.apply(this).split(' ');\n\n        classNames.push('link');\n\n        return classNames.join(' ');\n    },\n\n    options: {\n\n        shortLinkLength: 105,\n        doubleLinkTools: false,\n        longLinkLength: 155,\n        linkToolsOffset: 40,\n        doubleLinkToolsOffset: 65,\n        sampleInterval: 50,\n    },\n\n    _labelCache: null,\n    _labelSelectors: null,\n    _markerCache: null,\n    _V: null,\n    _dragData: null, // deprecated\n\n    metrics: null,\n    decimalsRounding: 2,\n\n    initialize: function(options) {\n\n        joint.dia.CellView.prototype.initialize.apply(this, arguments);\n\n        // create methods in prototype, so they can be accessed from any instance and\n        // don't need to be create over and over\n        if (typeof this.constructor.prototype.watchSource !== 'function') {\n            this.constructor.prototype.watchSource = this.createWatcher('source');\n            this.constructor.prototype.watchTarget = this.createWatcher('target');\n        }\n\n        // `_.labelCache` is a mapping of indexes of labels in the `this.get('labels')` array to\n        // `<g class=\"label\">` nodes wrapped by Vectorizer. This allows for quick access to the\n        // nodes in `updateLabelPosition()` in order to update the label positions.\n        this._labelCache = {};\n\n        // a cache of label selectors\n        this._labelSelectors = {};\n\n        // keeps markers bboxes and positions again for quicker access\n        this._markerCache = {};\n\n        // cache of default markup nodes\n        this._V = {},\n\n        // connection path metrics\n        this.metrics = {},\n\n        // bind events\n        this.startListening();\n    },\n\n    startListening: function() {\n\n        var model = this.model;\n\n        this.listenTo(model, 'change:markup', this.render);\n        this.listenTo(model, 'change:smooth change:manhattan change:router change:connector', this.update);\n        this.listenTo(model, 'change:toolMarkup', this.onToolsChange);\n        this.listenTo(model, 'change:labels change:labelMarkup', this.onLabelsChange);\n        this.listenTo(model, 'change:vertices change:vertexMarkup', this.onVerticesChange);\n        this.listenTo(model, 'change:source', this.onSourceChange);\n        this.listenTo(model, 'change:target', this.onTargetChange);\n    },\n\n    onSourceChange: function(cell, source, opt) {\n\n        // Start watching the new source model.\n        this.watchSource(cell, source);\n        // This handler is called when the source attribute is changed.\n        // This can happen either when someone reconnects the link (or moves arrowhead),\n        // or when an embedded link is translated by its ancestor.\n        // 1. Always do update.\n        // 2. Do update only if the opposite end ('target') is also a point.\n        var model = this.model;\n        if (!opt.translateBy || !model.get('target').id || !source.id) {\n            this.update(model, null, opt);\n        }\n    },\n\n    onTargetChange: function(cell, target, opt) {\n\n        // Start watching the new target model.\n        this.watchTarget(cell, target);\n        // See `onSourceChange` method.\n        var model = this.model;\n        if (!opt.translateBy || (model.get('source').id && !target.id && joint.util.isEmpty(model.get('vertices')))) {\n            this.update(model, null, opt);\n        }\n    },\n\n    onVerticesChange: function(cell, changed, opt) {\n\n        this.renderVertexMarkers();\n\n        // If the vertices have been changed by a translation we do update only if the link was\n        // the only link that was translated. If the link was translated via another element which the link\n        // is embedded in, this element will be translated as well and that triggers an update.\n        // Note that all embeds in a model are sorted - first comes links, then elements.\n        if (!opt.translateBy || opt.translateBy === this.model.id || this.model.hasLoop()) {\n            // Vertices were changed (not as a reaction on translate)\n            // or link.translate() was called or\n            this.update(cell, null, opt);\n        }\n    },\n\n    onToolsChange: function() {\n\n        this.renderTools().updateToolsPosition();\n    },\n\n    onLabelsChange: function(link, labels, opt) {\n\n        var requireRender = true;\n\n        var previousLabels = this.model.previous('labels');\n\n        if (previousLabels) {\n            // Here is an optimalization for cases when we know, that change does\n            // not require rerendering of all labels.\n            if (('propertyPathArray' in opt) && ('propertyValue' in opt)) {\n                // The label is setting by `prop()` method\n                var pathArray = opt.propertyPathArray || [];\n                var pathLength = pathArray.length;\n                if (pathLength > 1) {\n                    // We are changing a single label here e.g. 'labels/0/position'\n                    var labelExists = !!previousLabels[pathArray[1]];\n                    if (labelExists) {\n                        if (pathLength === 2) {\n                            // We are changing the entire label. Need to check if the\n                            // markup is also being changed.\n                            requireRender = ('markup' in Object(opt.propertyValue));\n                        } else if (pathArray[2] !== 'markup') {\n                            // We are changing a label property but not the markup\n                            requireRender = false;\n                        }\n                    }\n                }\n            }\n        }\n\n        if (requireRender) {\n            this.renderLabels();\n        } else {\n            this.updateLabels();\n        }\n\n        this.updateLabelPositions();\n    },\n\n    // Rendering.\n    // ----------\n\n    render: function() {\n\n        this.vel.empty();\n        this._V = {};\n        this.renderMarkup();\n        // rendering labels has to be run after the link is appended to DOM tree. (otherwise <Text> bbox\n        // returns zero values)\n        this.renderLabels();\n        // start watching the ends of the link for changes\n        var model = this.model;\n        this.watchSource(model, model.source())\n            .watchTarget(model, model.target())\n            .update();\n\n        return this;\n    },\n\n    renderMarkup: function() {\n\n        var link = this.model;\n        var markup = link.get('markup') || link.markup;\n        if (!markup) throw new Error('dia.LinkView: markup required');\n        if (Array.isArray(markup)) return this.renderJSONMarkup(markup);\n        if (typeof markup === 'string') return this.renderStringMarkup(markup);\n        throw new Error('dia.LinkView: invalid markup');\n    },\n\n    renderJSONMarkup: function(markup) {\n\n        var doc = this.parseDOMJSON(markup, this.el);\n        // Selectors\n        this.selectors = doc.selectors;\n        // Fragment\n        this.vel.append(doc.fragment);\n    },\n\n    renderStringMarkup: function(markup) {\n\n        // A special markup can be given in the `properties.markup` property. This might be handy\n        // if e.g. arrowhead markers should be `<image>` elements or any other element than `<path>`s.\n        // `.connection`, `.connection-wrap`, `.marker-source` and `.marker-target` selectors\n        // of elements with special meaning though. Therefore, those classes should be preserved in any\n        // special markup passed in `properties.markup`.\n        var children = V(markup);\n        // custom markup may contain only one children\n        if (!Array.isArray(children)) children = [children];\n        // Cache all children elements for quicker access.\n        var cache = this._V; // vectorized markup;\n        for (var i = 0, n = children.length; i < n; i++) {\n            var child = children[i];\n            var className = child.attr('class');\n            if (className) {\n                // Strip the joint class name prefix, if there is one.\n                className = joint.util.removeClassNamePrefix(className);\n                cache[$.camelCase(className)] = child;\n            }\n        }\n        // partial rendering\n        this.renderTools();\n        this.renderVertexMarkers();\n        this.renderArrowheadMarkers();\n        this.vel.append(children);\n    },\n\n    _getLabelMarkup: function(labelMarkup) {\n\n        if (!labelMarkup) return undefined;\n\n        if (Array.isArray(labelMarkup)) return this.parseDOMJSON(labelMarkup, null);\n        if (typeof labelMarkup === 'string') return this._getLabelStringMarkup(labelMarkup);\n        throw new Error('dia.linkView: invalid label markup');\n    },\n\n    _getLabelStringMarkup: function(labelMarkup) {\n\n        var children = V(labelMarkup);\n        var fragment = document.createDocumentFragment();\n\n        if (!Array.isArray(children)) {\n            fragment.appendChild(children.node);\n\n        } else {\n            for (var i = 0, n = children.length; i < n; i++) {\n                var currentChild = children[i].node;\n                fragment.appendChild(currentChild);\n            }\n        }\n\n        return { fragment: fragment, selectors: {}}; // no selectors\n    },\n\n    // Label markup fragment may come wrapped in <g class=\"label\" />, or not.\n    // If it doesn't, add the <g /> container here.\n    _normalizeLabelMarkup: function(markup) {\n\n        if (!markup) return undefined;\n\n        var fragment = markup.fragment;\n        if (!(markup.fragment instanceof DocumentFragment) || !markup.fragment.hasChildNodes()) throw new Error('dia.LinkView: invalid label markup.');\n\n        var vNode;\n        var childNodes = fragment.childNodes;\n\n        if ((childNodes.length > 1) || childNodes[0].nodeName.toUpperCase() !== 'G') {\n            // default markup fragment is not wrapped in <g />\n            // add a <g /> container\n            vNode = V('g').append(fragment);\n        } else {\n            vNode = V(childNodes[0]);\n        }\n\n        vNode.addClass('label');\n\n        return { node: vNode.node, selectors: markup.selectors };\n    },\n\n    renderLabels: function() {\n\n        var cache = this._V;\n        var vLabels = cache.labels;\n        var labelCache = this._labelCache = {};\n        var labelSelectors = this._labelSelectors = {};\n        var model = this.model;\n        var labels = model.attributes.labels || [];\n        var labelsCount = labels.length;\n\n        if (labelsCount === 0) {\n            if (vLabels) vLabels.remove();\n            return this;\n        }\n\n        if (vLabels) {\n            vLabels.empty();\n        }  else {\n            // there is no label container in the markup but some labels are defined\n            // add a <g class=\"labels\" /> container\n            vLabels = cache.labels = V('g').addClass('labels');\n        }\n\n        var container = vLabels.node;\n\n        for (var i = 0; i < labelsCount; i++) {\n\n            var label = labels[i];\n            var labelMarkup = this._normalizeLabelMarkup(this._getLabelMarkup(label.markup));\n            var labelNode;\n            var selectors;\n            if (labelMarkup) {\n\n                labelNode = labelMarkup.node;\n                selectors = labelMarkup.selectors;\n\n            } else {\n\n                var builtinDefaultLabel =  model._builtins.defaultLabel;\n                var builtinDefaultLabelMarkup = this._normalizeLabelMarkup(this._getLabelMarkup(builtinDefaultLabel.markup));\n                var defaultLabel = model._getDefaultLabel();\n                var defaultLabelMarkup = this._normalizeLabelMarkup(this._getLabelMarkup(defaultLabel.markup));\n                var defaultMarkup = defaultLabelMarkup || builtinDefaultLabelMarkup;\n\n                labelNode = defaultMarkup.node;\n                selectors = defaultMarkup.selectors;\n            }\n\n            labelNode.setAttribute('label-idx', i); // assign label-idx\n            container.appendChild(labelNode);\n            labelCache[i] = labelNode; // cache node for `updateLabels()` so it can just update label node positions\n\n            var rootSelector = this.selector;\n            if (selectors[rootSelector]) throw new Error('dia.LinkView: ambiguous label root selector.');\n            selectors[rootSelector] = labelNode;\n\n            labelSelectors[i] = selectors; // cache label selectors for `updateLabels()`\n        }\n\n        if (!container.parentNode) {\n            this.el.appendChild(container);\n        }\n\n        this.updateLabels();\n\n        return this;\n    },\n\n    // merge default label attrs into label attrs\n    // keep `undefined` or `null` because `{}` means something else\n    _mergeLabelAttrs: function(hasCustomMarkup, labelAttrs, defaultLabelAttrs, builtinDefaultLabelAttrs) {\n\n        if (labelAttrs === null) return null;\n        if (labelAttrs === undefined) {\n\n            if (defaultLabelAttrs === null) return null;\n            if (defaultLabelAttrs === undefined) {\n\n                if (hasCustomMarkup) return undefined;\n                return builtinDefaultLabelAttrs;\n            }\n\n            if (hasCustomMarkup) return defaultLabelAttrs;\n            return joint.util.merge({}, builtinDefaultLabelAttrs, defaultLabelAttrs);\n        }\n\n        if (hasCustomMarkup) return joint.util.merge({}, defaultLabelAttrs, labelAttrs);\n        return joint.util.merge({}, builtinDefaultLabelAttrs, defaultLabelAttrs, labelAttrs);\n    },\n\n    updateLabels: function() {\n\n        if (!this._V.labels) return this;\n\n        var model = this.model;\n        var labels = model.get('labels') || [];\n        var canLabelMove = this.can('labelMove');\n\n        var builtinDefaultLabel = model._builtins.defaultLabel;\n        var builtinDefaultLabelAttrs = builtinDefaultLabel.attrs;\n\n        var defaultLabel = model._getDefaultLabel();\n        var defaultLabelMarkup = defaultLabel.markup;\n        var defaultLabelAttrs = defaultLabel.attrs;\n\n        for (var i = 0, n = labels.length; i < n; i++) {\n\n            var labelNode = this._labelCache[i];\n            labelNode.setAttribute('cursor', (canLabelMove ? 'move' : 'default'));\n\n            var selectors = this._labelSelectors[i];\n\n            var label = labels[i];\n            var labelMarkup = label.markup;\n            var labelAttrs = label.attrs;\n\n            var attrs = this._mergeLabelAttrs(\n                (labelMarkup || defaultLabelMarkup),\n                labelAttrs,\n                defaultLabelAttrs,\n                builtinDefaultLabelAttrs\n            );\n\n            this.updateDOMSubtreeAttributes(labelNode, attrs, {\n                rootBBox: new g.Rect(label.size),\n                selectors: selectors\n            });\n        }\n\n        return this;\n    },\n\n    renderTools: function() {\n\n        if (!this._V.linkTools) return this;\n\n        // Tools are a group of clickable elements that manipulate the whole link.\n        // A good example of this is the remove tool that removes the whole link.\n        // Tools appear after hovering the link close to the `source` element/point of the link\n        // but are offset a bit so that they don't cover the `marker-arrowhead`.\n\n        var $tools = $(this._V.linkTools.node).empty();\n        var toolTemplate = joint.util.template(this.model.get('toolMarkup') || this.model.toolMarkup);\n        var tool = V(toolTemplate());\n\n        $tools.append(tool.node);\n\n        // Cache the tool node so that the `updateToolsPosition()` can update the tool position quickly.\n        this._toolCache = tool;\n\n        // If `doubleLinkTools` is enabled, we render copy of the tools on the other side of the\n        // link as well but only if the link is longer than `longLinkLength`.\n        if (this.options.doubleLinkTools) {\n\n            var tool2;\n            if (this.model.get('doubleToolMarkup') || this.model.doubleToolMarkup) {\n                toolTemplate = joint.util.template(this.model.get('doubleToolMarkup') || this.model.doubleToolMarkup);\n                tool2 = V(toolTemplate());\n            } else {\n                tool2 = tool.clone();\n            }\n\n            $tools.append(tool2.node);\n            this._tool2Cache = tool2;\n        }\n\n        return this;\n    },\n\n    renderVertexMarkers: function() {\n\n        if (!this._V.markerVertices) return this;\n\n        var $markerVertices = $(this._V.markerVertices.node).empty();\n\n        // A special markup can be given in the `properties.vertexMarkup` property. This might be handy\n        // if default styling (elements) are not desired. This makes it possible to use any\n        // SVG elements for .marker-vertex and .marker-vertex-remove tools.\n        var markupTemplate = joint.util.template(this.model.get('vertexMarkup') || this.model.vertexMarkup);\n\n        this.model.vertices().forEach(function(vertex, idx) {\n\n            $markerVertices.append(V(markupTemplate(joint.util.assign({ idx: idx }, vertex))).node);\n        });\n\n        return this;\n    },\n\n    renderArrowheadMarkers: function() {\n\n        // Custom markups might not have arrowhead markers. Therefore, jump of this function immediately if that's the case.\n        if (!this._V.markerArrowheads) return this;\n\n        var $markerArrowheads = $(this._V.markerArrowheads.node);\n\n        $markerArrowheads.empty();\n\n        // A special markup can be given in the `properties.vertexMarkup` property. This might be handy\n        // if default styling (elements) are not desired. This makes it possible to use any\n        // SVG elements for .marker-vertex and .marker-vertex-remove tools.\n        var markupTemplate = joint.util.template(this.model.get('arrowheadMarkup') || this.model.arrowheadMarkup);\n\n        this._V.sourceArrowhead = V(markupTemplate({ end: 'source' }));\n        this._V.targetArrowhead = V(markupTemplate({ end: 'target' }));\n\n        $markerArrowheads.append(this._V.sourceArrowhead.node, this._V.targetArrowhead.node);\n\n        return this;\n    },\n\n    // Updating.\n    // ---------\n\n    // Default is to process the `attrs` object and set attributes on subelements based on the selectors.\n    update: function(model, attributes, opt) {\n\n        opt || (opt = {});\n\n        // update the link path\n        this.updateConnection(opt);\n\n        // update SVG attributes defined by 'attrs/'.\n        this.updateDOMSubtreeAttributes(this.el, this.model.attr(), { selectors: this.selectors });\n\n        this.updateDefaultConnectionPath();\n\n        // update the label position etc.\n        this.updateLabelPositions();\n        this.updateToolsPosition();\n        this.updateArrowheadMarkers();\n\n        this.updateTools(opt);\n        // Local perpendicular flag (as opposed to one defined on paper).\n        // Could be enabled inside a connector/router. It's valid only\n        // during the update execution.\n        this.options.perpendicular = null;\n        // Mark that postponed update has been already executed.\n        this.updatePostponed = false;\n\n        return this;\n    },\n\n    removeRedundantLinearVertices: function(opt) {\n        var link = this.model;\n        var vertices = link.vertices();\n        var conciseVertices = [];\n        var n = vertices.length;\n        var m = 0;\n        for (var i = 0; i < n; i++) {\n            var current = new g.Point(vertices[i]).round();\n            var prev = new g.Point(conciseVertices[m - 1] || this.sourceAnchor).round();\n            if (prev.equals(current)) continue;\n            var next = new g.Point(vertices[i + 1] || this.targetAnchor).round();\n            if (prev.equals(next)) continue;\n            var line = new g.Line(prev, next);\n            if (line.pointOffset(current) === 0) continue;\n            conciseVertices.push(vertices[i]);\n            m++;\n        }\n        if (n === m) return 0;\n        link.vertices(conciseVertices, opt);\n        return (n - m);\n    },\n\n    updateDefaultConnectionPath: function() {\n\n        var cache = this._V;\n\n        if (cache.connection) {\n            cache.connection.attr('d', this.getSerializedConnection());\n        }\n\n        if (cache.connectionWrap) {\n            cache.connectionWrap.attr('d', this.getSerializedConnection());\n        }\n\n        if (cache.markerSource && cache.markerTarget) {\n            this._translateAndAutoOrientArrows(cache.markerSource, cache.markerTarget);\n        }\n    },\n\n    getEndView: function(type) {\n        switch (type) {\n            case 'source':\n                return this.sourceView || null;\n            case 'target':\n                return this.targetView || null;\n            default:\n                throw new Error('dia.LinkView: type parameter required.');\n        }\n    },\n\n    getEndAnchor: function(type) {\n        switch (type) {\n            case 'source':\n                return new g.Point(this.sourceAnchor);\n            case 'target':\n                return new g.Point(this.targetAnchor);\n            default:\n                throw new Error('dia.LinkView: type parameter required.');\n        }\n    },\n\n    getEndMagnet: function(type) {\n        switch (type) {\n            case 'source':\n                var sourceView = this.sourceView;\n                if (!sourceView) break;\n                return this.sourceMagnet || sourceView.el;\n            case 'target':\n                var targetView = this.targetView;\n                if (!targetView) break;\n                return this.targetMagnet || targetView.el;\n            default:\n                throw new Error('dia.LinkView: type parameter required.');\n        }\n        return null;\n    },\n\n    updateConnection: function(opt) {\n\n        opt = opt || {};\n\n        var model = this.model;\n        var route, path;\n\n        if (opt.translateBy && model.isRelationshipEmbeddedIn(opt.translateBy)) {\n            // The link is being translated by an ancestor that will\n            // shift source point, target point and all vertices\n            // by an equal distance.\n            var tx = opt.tx || 0;\n            var ty = opt.ty || 0;\n\n            route = (new g.Polyline(this.route)).translate(tx, ty).points;\n\n            // translate source and target connection and marker points.\n            this._translateConnectionPoints(tx, ty);\n\n            // translate the path itself\n            path = this.path;\n            path.translate(tx, ty);\n\n        } else {\n\n            var vertices = model.vertices();\n            // 1. Find Anchors\n\n            var anchors = this.findAnchors(vertices);\n            var sourceAnchor = this.sourceAnchor = anchors.source;\n            var targetAnchor = this.targetAnchor = anchors.target;\n\n            // 2. Find Route\n            route = this.findRoute(vertices, opt);\n\n            // 3. Find Connection Points\n            var connectionPoints = this.findConnectionPoints(route, sourceAnchor, targetAnchor);\n            var sourcePoint = this.sourcePoint = connectionPoints.source;\n            var targetPoint = this.targetPoint = connectionPoints.target;\n\n            // 3b. Find Marker Connection Point - Backwards Compatibility\n            var markerPoints = this.findMarkerPoints(route, sourcePoint, targetPoint);\n\n            // 4. Find Connection\n            path = this.findPath(route, markerPoints.source || sourcePoint, markerPoints.target || targetPoint);\n        }\n\n        this.route = route;\n        this.path = path;\n        this.metrics = {};\n    },\n\n    findMarkerPoints: function(route, sourcePoint, targetPoint) {\n\n        var firstWaypoint = route[0];\n        var lastWaypoint = route[route.length - 1];\n\n        // Move the source point by the width of the marker taking into account\n        // its scale around x-axis. Note that scale is the only transform that\n        // makes sense to be set in `.marker-source` attributes object\n        // as all other transforms (translate/rotate) will be replaced\n        // by the `translateAndAutoOrient()` function.\n        var cache = this._markerCache;\n        // cache source and target points\n        var sourceMarkerPoint, targetMarkerPoint;\n\n        if (this._V.markerSource) {\n\n            cache.sourceBBox = cache.sourceBBox || this._V.markerSource.getBBox();\n            sourceMarkerPoint = g.point(sourcePoint).move(\n                firstWaypoint || targetPoint,\n                cache.sourceBBox.width * this._V.markerSource.scale().sx * -1\n            ).round();\n        }\n\n        if (this._V.markerTarget) {\n\n            cache.targetBBox = cache.targetBBox || this._V.markerTarget.getBBox();\n            targetMarkerPoint = g.point(targetPoint).move(\n                lastWaypoint || sourcePoint,\n                cache.targetBBox.width * this._V.markerTarget.scale().sx * -1\n            ).round();\n        }\n\n        // if there was no markup for the marker, use the connection point.\n        cache.sourcePoint = sourceMarkerPoint || sourcePoint.clone();\n        cache.targetPoint = targetMarkerPoint || targetPoint.clone();\n\n        return {\n            source: sourceMarkerPoint,\n            target: targetMarkerPoint\n        };\n    },\n\n    findAnchors: function(vertices) {\n\n        var model = this.model;\n        var firstVertex = vertices[0];\n        var lastVertex = vertices[vertices.length - 1];\n        var sourceDef = model.get('source');\n        var targetDef = model.get('target');\n        var sourceView = this.sourceView;\n        var targetView = this.targetView;\n        var sourceMagnet, targetMagnet;\n\n        // Anchor Source\n        var sourceAnchor;\n        if (sourceView) {\n            sourceMagnet = (this.sourceMagnet || sourceView.el);\n            var sourceAnchorRef;\n            if (firstVertex) {\n                sourceAnchorRef = new g.Point(firstVertex);\n            } else if (targetView) {\n                // TODO: the source anchor reference is not a point, how to deal with this?\n                sourceAnchorRef = this.targetMagnet || targetView.el;\n            } else {\n                sourceAnchorRef = new g.Point(targetDef);\n            }\n            sourceAnchor = this.getAnchor(sourceDef.anchor, sourceView, sourceMagnet, sourceAnchorRef, 'source');\n        } else {\n            sourceAnchor = new g.Point(sourceDef);\n        }\n\n        // Anchor Target\n        var targetAnchor;\n        if (targetView) {\n            targetMagnet = (this.targetMagnet || targetView.el);\n            var targetAnchorRef = new g.Point(lastVertex || sourceAnchor);\n            targetAnchor = this.getAnchor(targetDef.anchor, targetView, targetMagnet, targetAnchorRef, 'target');\n        } else {\n            targetAnchor = new g.Point(targetDef);\n        }\n\n        // Con\n        return {\n            source: sourceAnchor,\n            target: targetAnchor\n        };\n    },\n\n    findConnectionPoints: function(route, sourceAnchor, targetAnchor) {\n\n        var firstWaypoint = route[0];\n        var lastWaypoint = route[route.length - 1];\n        var model = this.model;\n        var sourceDef = model.get('source');\n        var targetDef = model.get('target');\n        var sourceView = this.sourceView;\n        var targetView = this.targetView;\n        var paperOptions = this.paper.options;\n        var sourceMagnet, targetMagnet;\n\n        // Connection Point Source\n        var sourcePoint;\n        if (sourceView) {\n            sourceMagnet = (this.sourceMagnet || sourceView.el);\n            var sourceConnectionPointDef = sourceDef.connectionPoint || paperOptions.defaultConnectionPoint;\n            var sourcePointRef = firstWaypoint || targetAnchor;\n            var sourceLine = new g.Line(sourcePointRef, sourceAnchor);\n            sourcePoint = this.getConnectionPoint(sourceConnectionPointDef, sourceView, sourceMagnet, sourceLine, 'source');\n        } else {\n            sourcePoint = sourceAnchor;\n        }\n        // Connection Point Target\n        var targetPoint;\n        if (targetView) {\n            targetMagnet = (this.targetMagnet || targetView.el);\n            var targetConnectionPointDef = targetDef.connectionPoint || paperOptions.defaultConnectionPoint;\n            var targetPointRef = lastWaypoint || sourceAnchor;\n            var targetLine = new g.Line(targetPointRef, targetAnchor);\n            targetPoint = this.getConnectionPoint(targetConnectionPointDef, targetView, targetMagnet, targetLine, 'target');\n        } else {\n            targetPoint = targetAnchor;\n        }\n\n        return {\n            source: sourcePoint,\n            target: targetPoint\n        };\n    },\n\n    getAnchor: function(anchorDef, cellView, magnet, ref, endType) {\n\n        if (!anchorDef) {\n            var paperOptions = this.paper.options;\n            if (paperOptions.perpendicularLinks || this.options.perpendicular) {\n                // Backwards compatibility\n                // If `perpendicularLinks` flag is set on the paper and there are vertices\n                // on the link, then try to find a connection point that makes the link perpendicular\n                // even though the link won't point to the center of the targeted object.\n                anchorDef = { name: 'perpendicular' };\n            } else {\n                anchorDef = paperOptions.defaultAnchor;\n            }\n        }\n\n        if (!anchorDef) throw new Error('Anchor required.');\n        var anchorFn;\n        if (typeof anchorDef === 'function') {\n            anchorFn = anchorDef;\n        } else {\n            var anchorName = anchorDef.name;\n            anchorFn = joint.anchors[anchorName];\n            if (typeof anchorFn !== 'function') throw new Error('Unknown anchor: ' + anchorName);\n        }\n        var anchor = anchorFn.call(this, cellView, magnet, ref, anchorDef.args || {}, endType, this);\n        if (anchor) return anchor.round(this.decimalsRounding);\n        return new g.Point();\n    },\n\n\n    getConnectionPoint: function(connectionPointDef, view, magnet, line, endType) {\n\n        var connectionPoint;\n        var anchor = line.end;\n        // Backwards compatibility\n        var paperOptions = this.paper.options;\n        if (typeof paperOptions.linkConnectionPoint === 'function') {\n            var linkConnectionMagnet = (magnet === view.el) ? undefined : magnet;\n            connectionPoint = paperOptions.linkConnectionPoint(this, view, linkConnectionMagnet, line.start, endType);\n            if (connectionPoint) return connectionPoint;\n        }\n\n        if (!connectionPointDef) return anchor;\n        var connectionPointFn;\n        if (typeof connectionPointDef === 'function') {\n            connectionPointFn = connectionPointDef;\n        } else {\n            var connectionPointName = connectionPointDef.name;\n            connectionPointFn = joint.connectionPoints[connectionPointName];\n            if (typeof connectionPointFn !== 'function') throw new Error('Unknown connection point: ' + connectionPointName);\n        }\n        connectionPoint = connectionPointFn.call(this, line, view, magnet, connectionPointDef.args || {}, endType, this);\n        if (connectionPoint) return connectionPoint.round(this.decimalsRounding);\n        return anchor;\n    },\n\n    _translateConnectionPoints: function(tx, ty) {\n\n        var cache = this._markerCache;\n\n        cache.sourcePoint.offset(tx, ty);\n        cache.targetPoint.offset(tx, ty);\n        this.sourcePoint.offset(tx, ty);\n        this.targetPoint.offset(tx, ty);\n        this.sourceAnchor.offset(tx, ty);\n        this.targetAnchor.offset(tx, ty);\n    },\n\n    // if label position is a number, normalize it to a position object\n    // this makes sure that label positions can be merged properly\n    _normalizeLabelPosition: function(labelPosition) {\n\n        if (typeof labelPosition === 'number') return { distance: labelPosition, offset: null, args: null };\n        return labelPosition;\n    },\n\n    updateLabelPositions: function() {\n\n        if (!this._V.labels) return this;\n\n        var path = this.path;\n        if (!path) return this;\n\n        // This method assumes all the label nodes are stored in the `this._labelCache` hash table\n        // by their indices in the `this.get('labels')` array. This is done in the `renderLabels()` method.\n\n        var model = this.model;\n        var labels = model.get('labels') || [];\n        if (!labels.length) return this;\n\n        var builtinDefaultLabel = model._builtins.defaultLabel;\n        var builtinDefaultLabelPosition = builtinDefaultLabel.position;\n\n        var defaultLabel = model._getDefaultLabel();\n        var defaultLabelPosition = this._normalizeLabelPosition(defaultLabel.position);\n\n        var defaultPosition = joint.util.merge({}, builtinDefaultLabelPosition, defaultLabelPosition);\n\n        for (var idx = 0, n = labels.length; idx < n; idx++) {\n\n            var label = labels[idx];\n            var labelPosition = this._normalizeLabelPosition(label.position);\n\n            var position = joint.util.merge({}, defaultPosition, labelPosition);\n\n            var labelPoint = this.getLabelCoordinates(position);\n            this._labelCache[idx].setAttribute('transform', 'translate(' + labelPoint.x + ', ' + labelPoint.y + ')');\n        }\n\n        return this;\n    },\n\n    updateToolsPosition: function() {\n\n        if (!this._V.linkTools) return this;\n\n        // Move the tools a bit to the target position but don't cover the `sourceArrowhead` marker.\n        // Note that the offset is hardcoded here. The offset should be always\n        // more than the `this.$('.marker-arrowhead[end=\"source\"]')[0].bbox().width` but looking\n        // this up all the time would be slow.\n\n        var scale = '';\n        var offset = this.options.linkToolsOffset;\n        var connectionLength = this.getConnectionLength();\n\n        // Firefox returns connectionLength=NaN in odd cases (for bezier curves).\n        // In that case we won't update tools position at all.\n        if (!Number.isNaN(connectionLength)) {\n\n            // If the link is too short, make the tools half the size and the offset twice as low.\n            if (connectionLength < this.options.shortLinkLength) {\n                scale = 'scale(.5)';\n                offset /= 2;\n            }\n\n            var toolPosition = this.getPointAtLength(offset);\n\n            this._toolCache.attr('transform', 'translate(' + toolPosition.x + ', ' + toolPosition.y + ') ' + scale);\n\n            if (this.options.doubleLinkTools && connectionLength >= this.options.longLinkLength) {\n\n                var doubleLinkToolsOffset = this.options.doubleLinkToolsOffset || offset;\n\n                toolPosition = this.getPointAtLength(connectionLength - doubleLinkToolsOffset);\n                this._tool2Cache.attr('transform', 'translate(' + toolPosition.x + ', ' + toolPosition.y + ') ' + scale);\n                this._tool2Cache.attr('visibility', 'visible');\n\n            } else if (this.options.doubleLinkTools) {\n\n                this._tool2Cache.attr('visibility', 'hidden');\n            }\n        }\n\n        return this;\n    },\n\n    updateArrowheadMarkers: function() {\n\n        if (!this._V.markerArrowheads) return this;\n\n        // getting bbox of an element with `display=\"none\"` in IE9 ends up with access violation\n        if ($.css(this._V.markerArrowheads.node, 'display') === 'none') return this;\n\n        var sx = this.getConnectionLength() < this.options.shortLinkLength ? .5 : 1;\n        this._V.sourceArrowhead.scale(sx);\n        this._V.targetArrowhead.scale(sx);\n\n        this._translateAndAutoOrientArrows(this._V.sourceArrowhead, this._V.targetArrowhead);\n\n        return this;\n    },\n\n    // Returns a function observing changes on an end of the link. If a change happens and new end is a new model,\n    // it stops listening on the previous one and starts listening to the new one.\n    createWatcher: function(endType) {\n\n        // create handler for specific end type (source|target).\n        var onModelChange = function(endModel, opt) {\n            this.onEndModelChange(endType, endModel, opt);\n        };\n\n        function watchEndModel(link, end) {\n\n            end = end || {};\n\n            var endModel = null;\n            var previousEnd = link.previous(endType) || {};\n\n            if (previousEnd.id) {\n                this.stopListening(this.paper.getModelById(previousEnd.id), 'change', onModelChange);\n            }\n\n            if (end.id) {\n                // If the observed model changes, it caches a new bbox and do the link update.\n                endModel = this.paper.getModelById(end.id);\n                this.listenTo(endModel, 'change', onModelChange);\n            }\n\n            onModelChange.call(this, endModel, { cacheOnly: true });\n\n            return this;\n        }\n\n        return watchEndModel;\n    },\n\n    onEndModelChange: function(endType, endModel, opt) {\n\n        var doUpdate = !opt.cacheOnly;\n        var model = this.model;\n        var end = model.get(endType) || {};\n\n        if (endModel) {\n\n            var selector = this.constructor.makeSelector(end);\n            var oppositeEndType = endType == 'source' ? 'target' : 'source';\n            var oppositeEnd = model.get(oppositeEndType) || {};\n            var endId = end.id;\n            var oppositeEndId = oppositeEnd.id;\n            var oppositeSelector = oppositeEndId && this.constructor.makeSelector(oppositeEnd);\n\n            // Caching end models bounding boxes.\n            // If `opt.handleBy` equals the client-side ID of this link view and it is a loop link, then we already cached\n            // the bounding boxes in the previous turn (e.g. for loop link, the change:source event is followed\n            // by change:target and so on change:source, we already chached the bounding boxes of - the same - element).\n            if (opt.handleBy === this.cid && (endId === oppositeEndId) && selector == oppositeSelector) {\n\n                // Source and target elements are identical. We're dealing with a loop link. We are handling `change` event for the\n                // second time now. There is no need to calculate bbox and find magnet element again.\n                // It was calculated already for opposite link end.\n                this[endType + 'View'] = this[oppositeEndType + 'View'];\n                this[endType + 'Magnet'] = this[oppositeEndType + 'Magnet'];\n\n            } else if (opt.translateBy) {\n                // `opt.translateBy` optimizes the way we calculate bounding box of the source/target element.\n                // If `opt.translateBy` is an ID of the element that was originally translated.\n\n                // Noop\n\n            } else {\n                // The slowest path, source/target could have been rotated or resized or any attribute\n                // that affects the bounding box of the view might have been changed.\n\n                var connectedModel = this.paper.model.getCell(endId);\n                if (!connectedModel) throw new Error('LinkView: invalid ' + endType + ' cell.');\n                var connectedView = connectedModel.findView(this.paper);\n                if (connectedView) {\n                    var connectedMagnet = connectedView.getMagnetFromLinkEnd(end);\n                    if (connectedMagnet === connectedView.el) connectedMagnet = null;\n                    this[endType + 'View'] = connectedView;\n                    this[endType + 'Magnet'] = connectedMagnet;\n                } else {\n                    // the view is not rendered yet\n                    this[endType + 'View'] = this[endType + 'Magnet'] = null;\n                }\n            }\n\n            if (opt.handleBy === this.cid && opt.translateBy &&\n                model.isEmbeddedIn(endModel) &&\n                !joint.util.isEmpty(model.get('vertices'))) {\n                // Loop link whose element was translated and that has vertices (that need to be translated with\n                // the parent in which my element is embedded).\n                // If the link is embedded, has a loop and vertices and the end model\n                // has been translated, do not update yet. There are vertices still to be updated (change:vertices\n                // event will come in the next turn).\n                doUpdate = false;\n            }\n\n            if (!this.updatePostponed && oppositeEndId) {\n                // The update was not postponed (that can happen e.g. on the first change event) and the opposite\n                // end is a model (opposite end is the opposite end of the link we're just updating, e.g. if\n                // we're reacting on change:source event, the oppositeEnd is the target model).\n\n                var oppositeEndModel = this.paper.getModelById(oppositeEndId);\n\n                // Passing `handleBy` flag via event option.\n                // Note that if we are listening to the same model for event 'change' twice.\n                // The same event will be handled by this method also twice.\n                if (end.id === oppositeEnd.id) {\n                    // We're dealing with a loop link. Tell the handlers in the next turn that they should update\n                    // the link instead of me. (We know for sure there will be a next turn because\n                    // loop links react on at least two events: change on the source model followed by a change on\n                    // the target model).\n                    if (!opt.translateBy || joint.util.isEmpty(model.get('vertices')) || !model.isEmbeddedIn(opt.translateBy)) {\n                        opt.handleBy = this.cid;\n                    } else {\n                        doUpdate = false;\n                    }\n                }\n\n                if (doUpdate && (opt.handleBy === this.cid || (opt.translateBy && oppositeEndModel.isEmbeddedIn(opt.translateBy)))) {\n\n                    // Here are two options:\n                    // - Source and target are connected to the same model (not necessarily the same port).\n                    // - Both end models are translated by the same ancestor. We know that opposite end\n                    //   model will be translated in the next turn as well.\n                    // In both situations there will be more changes on the model that trigger an\n                    // update. So there is no need to update the linkView yet.\n                    this.updatePostponed = true;\n                    doUpdate = false;\n                }\n            }\n\n        } else {\n\n            // the link end is a point ~ rect 1x1\n            this[endType + 'View'] = this[endType + 'Magnet'] = null;\n        }\n\n        if (doUpdate) {\n            this.update(model, null, opt);\n        }\n    },\n\n    _translateAndAutoOrientArrows: function(sourceArrow, targetArrow) {\n\n        // Make the markers \"point\" to their sticky points being auto-oriented towards\n        // `targetPosition`/`sourcePosition`. And do so only if there is a markup for them.\n        var route = joint.util.toArray(this.route);\n        if (sourceArrow) {\n            sourceArrow.translateAndAutoOrient(\n                this.sourcePoint,\n                route[0] || this.targetPoint,\n                this.paper.viewport\n            );\n        }\n\n        if (targetArrow) {\n            targetArrow.translateAndAutoOrient(\n                this.targetPoint,\n                route[route.length - 1] || this.sourcePoint,\n                this.paper.viewport\n            );\n        }\n    },\n\n    _getDefaultLabelPositionArgs: function() {\n\n        var defaultLabel = this.model._getDefaultLabel();\n        var defaultLabelPosition = defaultLabel.position || {};\n        return defaultLabelPosition.args;\n    },\n\n    _getLabelPositionArgs: function(idx) {\n\n        var labelPosition = this.model.label(idx).position || {};\n        return labelPosition.args;\n    },\n\n    // merge default label position args into label position args\n    // keep `undefined` or `null` because `{}` means something else\n    _mergeLabelPositionArgs: function(labelPositionArgs, defaultLabelPositionArgs) {\n\n        if (labelPositionArgs === null) return null;\n        if (labelPositionArgs === undefined) {\n\n            if (defaultLabelPositionArgs === null) return null;\n            return defaultLabelPositionArgs;\n        }\n\n        return joint.util.merge({}, defaultLabelPositionArgs, labelPositionArgs);\n    },\n\n    // Add default label at given position at end of `labels` array.\n    // Assigns relative coordinates by default.\n    // `opt.absoluteDistance` forces absolute coordinates.\n    // `opt.reverseDistance` forces reverse absolute coordinates (if absoluteDistance = true).\n    // `opt.absoluteOffset` forces absolute coordinates for offset.\n    addLabel: function(x, y, opt) {\n\n        // accept input in form `{ x, y }, opt` or `x, y, opt`\n        var isPointProvided = (typeof x !== 'number');\n        var localX = isPointProvided ? x.x : x;\n        var localY = isPointProvided ? x.y : y;\n        var localOpt = isPointProvided ? y : opt;\n\n        var defaultLabelPositionArgs = this._getDefaultLabelPositionArgs();\n        var labelPositionArgs = localOpt;\n        var positionArgs = this._mergeLabelPositionArgs(labelPositionArgs, defaultLabelPositionArgs);\n\n        var label = { position: this.getLabelPosition(localX, localY, positionArgs) };\n        var idx = -1;\n        this.model.insertLabel(idx, label, localOpt);\n        return idx;\n    },\n\n    // Add a new vertex at calculated index to the `vertices` array.\n    addVertex: function(x, y, opt) {\n\n        // accept input in form `{ x, y }, opt` or `x, y, opt`\n        var isPointProvided = (typeof x !== 'number');\n        var localX = isPointProvided ? x.x : x;\n        var localY = isPointProvided ? x.y : y;\n        var localOpt = isPointProvided ? y : opt;\n\n        var vertex = { x: localX, y: localY };\n        var idx = this.getVertexIndex(localX, localY);\n        this.model.insertVertex(idx, vertex, localOpt);\n        return idx;\n    },\n\n    // Send a token (an SVG element, usually a circle) along the connection path.\n    // Example: `link.findView(paper).sendToken(V('circle', { r: 7, fill: 'green' }).node)`\n    // `opt.duration` is optional and is a time in milliseconds that the token travels from the source to the target of the link. Default is `1000`.\n    // `opt.directon` is optional and it determines whether the token goes from source to target or other way round (`reverse`)\n    // `opt.connection` is an optional selector to the connection path.\n    // `callback` is optional and is a function to be called once the token reaches the target.\n    sendToken: function(token, opt, callback) {\n\n        function onAnimationEnd(vToken, callback) {\n            return function() {\n                vToken.remove();\n                if (typeof callback === 'function') {\n                    callback();\n                }\n            };\n        }\n\n        var duration, isReversed, selector;\n        if (joint.util.isObject(opt)) {\n            duration = opt.duration;\n            isReversed = (opt.direction === 'reverse');\n            selector = opt.connection;\n        } else {\n            // Backwards compatibility\n            duration = opt;\n            isReversed = false;\n            selector = null;\n        }\n\n        duration = duration || 1000;\n\n        var animationAttributes = {\n            dur: duration + 'ms',\n            repeatCount: 1,\n            calcMode: 'linear',\n            fill: 'freeze'\n        };\n\n        if (isReversed) {\n            animationAttributes.keyPoints = '1;0';\n            animationAttributes.keyTimes = '0;1';\n        }\n\n        var vToken = V(token);\n        var connection;\n        if (typeof selector === 'string') {\n            // Use custom connection path.\n            connection = this.findBySelector(selector, this.el, this.selectors)[0];\n        } else {\n            // Select connection path automatically.\n            var cache = this._V;\n            connection = (cache.connection) ? cache.connection.node : this.el.querySelector('path');\n        }\n\n        if (!(connection instanceof SVGPathElement)) {\n            throw new Error('dia.LinkView: token animation requires a valid connection path.');\n        }\n\n        vToken\n            .appendTo(this.paper.viewport)\n            .animateAlongPath(animationAttributes, connection);\n\n        setTimeout(onAnimationEnd(vToken, callback), duration);\n    },\n\n    findRoute: function(vertices) {\n\n        vertices || (vertices = []);\n\n        var namespace = joint.routers;\n        var router = this.model.router();\n        var defaultRouter = this.paper.options.defaultRouter;\n\n        if (!router) {\n            if (defaultRouter) router = defaultRouter;\n            else return vertices.map(g.Point, g); // no router specified\n        }\n\n        var routerFn = joint.util.isFunction(router) ? router : namespace[router.name];\n        if (!joint.util.isFunction(routerFn)) {\n            throw new Error('dia.LinkView: unknown router: \"' + router.name + '\".');\n        }\n\n        var args = router.args || {};\n\n        var route = routerFn.call(\n            this, // context\n            vertices, // vertices\n            args, // options\n            this // linkView\n        );\n\n        if (!route) return vertices.map(g.Point, g);\n        return route;\n    },\n\n    // Return the `d` attribute value of the `<path>` element representing the link\n    // between `source` and `target`.\n    findPath: function(route, sourcePoint, targetPoint) {\n\n        var namespace = joint.connectors;\n        var connector = this.model.connector();\n        var defaultConnector = this.paper.options.defaultConnector;\n\n        if (!connector) {\n            connector = defaultConnector || {};\n        }\n\n        var connectorFn = joint.util.isFunction(connector) ? connector : namespace[connector.name];\n        if (!joint.util.isFunction(connectorFn)) {\n            throw new Error('dia.LinkView: unknown connector: \"' + connector.name + '\".');\n        }\n\n        var args = joint.util.clone(connector.args || {});\n        args.raw = true; // Request raw g.Path as the result.\n\n        var path = connectorFn.call(\n            this, // context\n            sourcePoint, // start point\n            targetPoint, // end point\n            route, // vertices\n            args, // options\n            this // linkView\n        );\n\n        if (typeof path === 'string') {\n            // Backwards compatibility for connectors not supporting `raw` option.\n            path = new g.Path(V.normalizePathData(path));\n        }\n\n        return path;\n    },\n\n    // Public API.\n    // -----------\n\n    getConnection: function() {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.clone();\n    },\n\n    getSerializedConnection: function() {\n\n        var path = this.path;\n        if (!path) return null;\n\n        var metrics = this.metrics;\n        if (metrics.hasOwnProperty('data')) return metrics.data;\n        var data = path.serialize();\n        metrics.data = data;\n        return data;\n    },\n\n    getConnectionSubdivisions: function() {\n\n        var path = this.path;\n        if (!path) return null;\n\n        var metrics = this.metrics;\n        if (metrics.hasOwnProperty('segmentSubdivisions')) return metrics.segmentSubdivisions;\n        var subdivisions = path.getSegmentSubdivisions();\n        metrics.segmentSubdivisions = subdivisions;\n        return subdivisions;\n    },\n\n    getConnectionLength: function() {\n\n        var path = this.path;\n        if (!path) return 0;\n\n        var metrics = this.metrics;\n        if (metrics.hasOwnProperty('length')) return metrics.length;\n        var length = path.length({ segmentSubdivisions: this.getConnectionSubdivisions() });\n        metrics.length = length;\n        return length;\n    },\n\n    getPointAtLength: function(length) {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.pointAtLength(length, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    getPointAtRatio: function(ratio) {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.pointAt(ratio, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    getTangentAtLength: function(length) {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.tangentAtLength(length, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    getTangentAtRatio: function(ratio) {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.tangentAt(ratio, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    getClosestPoint: function(point) {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.closestPoint(point, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    getClosestPointLength: function(point) {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.closestPointLength(point, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    getClosestPointRatio: function(point) {\n\n        var path = this.path;\n        if (!path) return null;\n\n        return path.closestPointNormalizedLength(point, { segmentSubdivisions: this.getConnectionSubdivisions() });\n    },\n\n    // accepts options `absoluteDistance: boolean`, `reverseDistance: boolean`, `absoluteOffset: boolean`\n    // to move beyond connection endpoints, absoluteOffset has to be set\n    getLabelPosition: function(x, y, opt) {\n\n        var position = {};\n\n        var localOpt = opt || {};\n        if (opt) position.args = opt;\n\n        var isDistanceRelative = !localOpt.absoluteDistance; // relative by default\n        var isDistanceAbsoluteReverse = (localOpt.absoluteDistance && localOpt.reverseDistance); // non-reverse by default\n        var isOffsetAbsolute = localOpt.absoluteOffset; // offset is non-absolute by default\n\n        var path = this.path;\n        var pathOpt = { segmentSubdivisions: this.getConnectionSubdivisions() };\n\n        var labelPoint = new g.Point(x, y);\n        var t = path.closestPointT(labelPoint, pathOpt);\n\n        // GET DISTANCE:\n\n        var labelDistance = path.lengthAtT(t, pathOpt);\n        if (isDistanceRelative) labelDistance = (labelDistance / this.getConnectionLength()) || 0; // fix to prevent NaN for 0 length\n        if (isDistanceAbsoluteReverse) labelDistance = (-1 * (this.getConnectionLength() - labelDistance)) || 1; // fix for end point (-0 => 1)\n\n        position.distance = labelDistance;\n\n        // GET OFFSET:\n        // use absolute offset if:\n        // - opt.absoluteOffset is true,\n        // - opt.absoluteOffset is not true but there is no tangent\n\n        var tangent;\n        if (!isOffsetAbsolute) tangent = path.tangentAtT(t);\n\n        var labelOffset;\n        if (tangent) {\n            labelOffset = tangent.pointOffset(labelPoint);\n\n        } else {\n            var closestPoint = path.pointAtT(t);\n            var labelOffsetDiff = labelPoint.difference(closestPoint);\n            labelOffset = { x: labelOffsetDiff.x, y: labelOffsetDiff.y };\n        }\n\n        position.offset = labelOffset;\n\n        return position;\n    },\n\n    getLabelCoordinates: function(labelPosition) {\n\n        var labelDistance;\n        if (typeof labelPosition === 'number') labelDistance = labelPosition;\n        else if (typeof labelPosition.distance === 'number') labelDistance = labelPosition.distance;\n        else throw new Error('dia.LinkView: invalid label position distance.');\n\n        var isDistanceRelative = ((labelDistance > 0) && (labelDistance <= 1));\n\n        var labelOffset = 0;\n        var labelOffsetCoordinates = { x: 0, y: 0 };\n        if (labelPosition.offset) {\n            var positionOffset = labelPosition.offset;\n            if (typeof positionOffset === 'number') labelOffset = positionOffset;\n            if (positionOffset.x) labelOffsetCoordinates.x = positionOffset.x;\n            if (positionOffset.y) labelOffsetCoordinates.y = positionOffset.y;\n        }\n\n        var isOffsetAbsolute = ((labelOffsetCoordinates.x !== 0) || (labelOffsetCoordinates.y !== 0) || labelOffset === 0);\n\n        var path = this.path;\n        var pathOpt = { segmentSubdivisions: this.getConnectionSubdivisions() };\n\n        var distance = isDistanceRelative ? (labelDistance * this.getConnectionLength()) : labelDistance;\n\n        var point;\n\n        if (isOffsetAbsolute) {\n            point = path.pointAtLength(distance, pathOpt);\n            point.offset(labelOffsetCoordinates);\n\n        } else {\n            var tangent = path.tangentAtLength(distance, pathOpt);\n\n            if (tangent) {\n                tangent.rotate(tangent.start, -90);\n                tangent.setLength(labelOffset);\n                point = tangent.end;\n\n            } else {\n                // fallback - the connection has zero length\n                point = path.start;\n            }\n        }\n\n        return point;\n    },\n\n    getVertexIndex: function(x, y) {\n\n        var model = this.model;\n        var vertices = model.vertices();\n\n        var vertexLength = this.getClosestPointLength(new g.Point(x, y));\n\n        var idx = 0;\n        for (var n = vertices.length; idx < n; idx++) {\n            var currentVertex = vertices[idx];\n            var currentVertexLength = this.getClosestPointLength(currentVertex);\n            if (vertexLength < currentVertexLength) break;\n        }\n\n        return idx;\n    },\n\n    // Interaction. The controller part.\n    // ---------------------------------\n\n    pointerdblclick: function(evt, x, y) {\n\n        joint.dia.CellView.prototype.pointerdblclick.apply(this, arguments);\n        this.notify('link:pointerdblclick', evt, x, y);\n    },\n\n    pointerclick: function(evt, x, y) {\n\n        joint.dia.CellView.prototype.pointerclick.apply(this, arguments);\n        this.notify('link:pointerclick', evt, x, y);\n    },\n\n    contextmenu: function(evt, x, y) {\n\n        joint.dia.CellView.prototype.contextmenu.apply(this, arguments);\n        this.notify('link:contextmenu', evt, x, y);\n    },\n\n    pointerdown: function(evt, x, y) {\n\n        joint.dia.CellView.prototype.pointerdown.apply(this, arguments);\n        this.notify('link:pointerdown', evt, x, y);\n\n        // Backwards compatibility for the default markup\n        var className = evt.target.getAttribute('class');\n        switch (className) {\n\n            case 'marker-vertex':\n                this.dragVertexStart(evt, x, y);\n                return;\n\n            case 'marker-vertex-remove':\n            case 'marker-vertex-remove-area':\n                this.dragVertexRemoveStart(evt, x, y);\n                return;\n\n            case 'marker-arrowhead':\n                this.dragArrowheadStart(evt, x, y);\n                return;\n\n            case 'connection':\n            case 'connection-wrap':\n                this.dragConnectionStart(evt, x, y);\n                return;\n\n            case 'marker-source':\n            case 'marker-target':\n                return;\n        }\n\n        this.dragStart(evt, x, y);\n    },\n\n    pointermove: function(evt, x, y) {\n\n        // Backwards compatibility\n        var dragData = this._dragData;\n        if (dragData) this.eventData(evt, dragData);\n\n        var data = this.eventData(evt);\n        switch (data.action) {\n\n            case 'vertex-move':\n                this.dragVertex(evt, x, y);\n                break;\n\n            case 'label-move':\n                this.dragLabel(evt, x, y);\n                break;\n\n            case 'arrowhead-move':\n                this.dragArrowhead(evt, x, y);\n                break;\n\n            case 'move':\n                this.drag(evt, x, y);\n                break;\n        }\n\n        // Backwards compatibility\n        if (dragData) joint.util.assign(dragData, this.eventData(evt));\n\n        joint.dia.CellView.prototype.pointermove.apply(this, arguments);\n        this.notify('link:pointermove', evt, x, y);\n    },\n\n    pointerup: function(evt, x, y) {\n\n        // Backwards compatibility\n        var dragData = this._dragData;\n        if (dragData) {\n            this.eventData(evt, dragData);\n            this._dragData = null;\n        }\n\n        var data = this.eventData(evt);\n        switch (data.action) {\n\n            case 'vertex-move':\n                this.dragVertexEnd(evt, x, y);\n                break;\n\n            case 'label-move':\n                this.dragLabelEnd(evt, x, y);\n                break;\n\n            case 'arrowhead-move':\n                this.dragArrowheadEnd(evt, x, y);\n                break;\n\n            case 'move':\n                this.dragEnd(evt, x, y);\n        }\n\n        this.notify('link:pointerup', evt, x, y);\n        joint.dia.CellView.prototype.pointerup.apply(this, arguments);\n    },\n\n    mouseover: function(evt) {\n\n        joint.dia.CellView.prototype.mouseover.apply(this, arguments);\n        this.notify('link:mouseover', evt);\n    },\n\n    mouseout: function(evt) {\n\n        joint.dia.CellView.prototype.mouseout.apply(this, arguments);\n        this.notify('link:mouseout', evt);\n    },\n\n    mouseenter: function(evt) {\n\n        joint.dia.CellView.prototype.mouseenter.apply(this, arguments);\n        this.notify('link:mouseenter', evt);\n    },\n\n    mouseleave: function(evt) {\n\n        joint.dia.CellView.prototype.mouseleave.apply(this, arguments);\n        this.notify('link:mouseleave', evt);\n    },\n\n    mousewheel: function(evt, x, y, delta) {\n\n        joint.dia.CellView.prototype.mousewheel.apply(this, arguments);\n        this.notify('link:mousewheel', evt, x, y, delta);\n    },\n\n    onevent: function(evt, eventName, x, y) {\n\n        // Backwards compatibility\n        var linkTool = V(evt.target).findParentByClass('link-tool', this.el);\n        if (linkTool) {\n            // No further action to be executed\n            evt.stopPropagation();\n\n            // Allow `interactive.useLinkTools=false`\n            if (this.can('useLinkTools')) {\n                if (eventName === 'remove') {\n                    // Built-in remove event\n                    this.model.remove({ ui: true });\n                    // Do not trigger link pointerdown\n                    return;\n\n                } else {\n                    // link:options and other custom events inside the link tools\n                    this.notify(eventName, evt, x, y);\n                }\n            }\n\n            joint.dia.CellView.prototype.pointerdown.apply(this, arguments);\n            this.notify('link:pointerdown', evt, x, y);\n\n        } else {\n            joint.dia.CellView.prototype.onevent.apply(this, arguments);\n        }\n    },\n\n    onlabel: function(evt, x, y) {\n\n        joint.dia.CellView.prototype.pointerdown.apply(this, arguments);\n        this.notify('link:pointerdown', evt, x, y);\n\n        this.dragLabelStart(evt, x, y);\n\n        var stopPropagation = this.eventData(evt).stopPropagation;\n        if (stopPropagation) evt.stopPropagation();\n    },\n\n    // Drag Start Handlers\n\n    dragConnectionStart: function(evt, x, y) {\n\n        if (!this.can('vertexAdd')) return;\n\n        // Store the index at which the new vertex has just been placed.\n        // We'll be update the very same vertex position in `pointermove()`.\n        var vertexIdx = this.addVertex({ x: x, y: y }, { ui: true });\n        this.eventData(evt, {\n            action: 'vertex-move',\n            vertexIdx: vertexIdx\n        });\n    },\n\n    dragLabelStart: function(evt, x, y) {\n\n        if (!this.can('labelMove')) {\n            // Backwards compatibility:\n            // If labels can't be dragged no default action is triggered.\n            this.eventData(evt, { stopPropagation: true });\n            return;\n        }\n\n        var labelNode = evt.currentTarget;\n        var labelIdx = parseInt(labelNode.getAttribute('label-idx'), 10);\n\n        var defaultLabelPositionArgs = this._getDefaultLabelPositionArgs();\n        var labelPositionArgs = this._getLabelPositionArgs(labelIdx);\n        var positionArgs = this._mergeLabelPositionArgs(labelPositionArgs, defaultLabelPositionArgs);\n\n        this.eventData(evt, {\n            action: 'label-move',\n            labelIdx: labelIdx,\n            positionArgs: positionArgs,\n            stopPropagation: true\n        });\n\n        this.paper.delegateDragEvents(this, evt.data);\n    },\n\n    dragVertexStart: function(evt, x, y) {\n\n        if (!this.can('vertexMove')) return;\n\n        var vertexNode = evt.target;\n        var vertexIdx = parseInt(vertexNode.getAttribute('idx'), 10);\n        this.eventData(evt, {\n            action: 'vertex-move',\n            vertexIdx: vertexIdx\n        });\n    },\n\n    dragVertexRemoveStart: function(evt, x, y) {\n\n        if (!this.can('vertexRemove')) return;\n\n        var removeNode = evt.target;\n        var vertexIdx = parseInt(removeNode.getAttribute('idx'), 10);\n        this.model.removeVertex(vertexIdx);\n    },\n\n    dragArrowheadStart: function(evt, x, y) {\n\n        if (!this.can('arrowheadMove')) return;\n\n        var arrowheadNode = evt.target;\n        var arrowheadType = arrowheadNode.getAttribute('end');\n        var data = this.startArrowheadMove(arrowheadType, { ignoreBackwardsCompatibility: true });\n\n        this.eventData(evt, data);\n    },\n\n    dragStart: function(evt, x, y) {\n\n        if (!this.can('linkMove')) return;\n\n        this.eventData(evt, {\n            action: 'move',\n            dx: x,\n            dy: y\n        });\n    },\n\n    // Drag Handlers\n\n    dragLabel: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n        var label = { position: this.getLabelPosition(x, y, data.positionArgs) };\n        this.model.label(data.labelIdx, label);\n    },\n\n    dragVertex: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n        this.model.vertex(data.vertexIdx, { x: x, y: y }, { ui: true });\n    },\n\n    dragArrowhead: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n\n        if (this.paper.options.snapLinks) {\n\n            this._snapArrowhead(x, y, data);\n\n        } else {\n\n            this._connectArrowhead(this.getEventTarget(evt), x, y, data);\n        }\n    },\n\n    drag: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n        this.model.translate(x - data.dx, y - data.dy, { ui: true });\n        this.eventData(evt, {\n            dx: x,\n            dy: y\n        });\n    },\n\n    // Drag End Handlers\n\n    dragLabelEnd: function() {\n        // noop\n    },\n\n    dragVertexEnd: function() {\n        // noop\n    },\n\n    dragArrowheadEnd: function(evt, x, y) {\n\n        var data = this.eventData(evt);\n        var paper = this.paper;\n\n        if (paper.options.snapLinks) {\n            this._snapArrowheadEnd(data);\n        } else {\n            this._connectArrowheadEnd(data, x, y);\n        }\n\n        if (!paper.linkAllowed(this)) {\n            // If the changed link is not allowed, revert to its previous state.\n            this._disallow(data);\n        } else {\n            this._finishEmbedding(data);\n            this._notifyConnectEvent(data, evt);\n        }\n\n        this._afterArrowheadMove(data);\n\n        // mouseleave event is not triggered due to changing pointer-events to `none`.\n        if (!this.vel.contains(evt.target)) {\n            this.mouseleave(evt);\n        }\n    },\n\n    dragEnd: function() {\n        // noop\n    },\n\n    _disallow: function(data) {\n\n        switch (data.whenNotAllowed) {\n\n            case 'remove':\n                this.model.remove({ ui: true });\n                break;\n\n            case 'revert':\n            default:\n                this.model.set(data.arrowhead, data.initialEnd, { ui: true });\n                break;\n        }\n    },\n\n    _finishEmbedding: function(data) {\n\n        // Reparent the link if embedding is enabled\n        if (this.paper.options.embeddingMode && this.model.reparent()) {\n            // Make sure we don't reverse to the original 'z' index (see afterArrowheadMove()).\n            data.z = null;\n        }\n    },\n\n    _notifyConnectEvent: function(data, evt) {\n\n        var arrowhead = data.arrowhead;\n        var initialEnd = data.initialEnd;\n        var currentEnd = this.model.prop(arrowhead);\n        var endChanged = currentEnd && !joint.dia.Link.endsEqual(initialEnd, currentEnd);\n        if (endChanged) {\n            var paper = this.paper;\n            if (initialEnd.id) {\n                this.notify('link:disconnect', evt, paper.findViewByModel(initialEnd.id), data.initialMagnet, arrowhead);\n            }\n            if (currentEnd.id) {\n                this.notify('link:connect', evt, paper.findViewByModel(currentEnd.id), data.magnetUnderPointer, arrowhead);\n            }\n        }\n    },\n\n    _snapArrowhead: function(x, y, data) {\n\n        // checking view in close area of the pointer\n\n        var r = this.paper.options.snapLinks.radius || 50;\n        var viewsInArea = this.paper.findViewsInArea({ x: x - r, y: y - r, width: 2 * r, height: 2 * r });\n\n        var prevClosestView = data.closestView || null;\n        var prevClosestMagnet = data.closestMagnet || null;\n\n        data.closestView = data.closestMagnet = null;\n\n        var distance;\n        var minDistance = Number.MAX_VALUE;\n        var pointer = g.point(x, y);\n        var paper = this.paper;\n\n        viewsInArea.forEach(function(view) {\n\n            // skip connecting to the element in case '.': { magnet: false } attribute present\n            if (view.el.getAttribute('magnet') !== 'false') {\n\n                // find distance from the center of the model to pointer coordinates\n                distance = view.model.getBBox().center().distance(pointer);\n\n                // the connection is looked up in a circle area by `distance < r`\n                if (distance < r && distance < minDistance) {\n\n                    if (prevClosestMagnet === view.el || paper.options.validateConnection.apply(\n                        paper, data.validateConnectionArgs(view, null)\n                    )) {\n                        minDistance = distance;\n                        data.closestView = view;\n                        data.closestMagnet = view.el;\n                    }\n                }\n            }\n\n            view.$('[magnet]').each(function(index, magnet) {\n\n                var bbox = view.getNodeBBox(magnet);\n\n                distance = pointer.distance({\n                    x: bbox.x + bbox.width / 2,\n                    y: bbox.y + bbox.height / 2\n                });\n\n                if (distance < r && distance < minDistance) {\n\n                    if (prevClosestMagnet === magnet || paper.options.validateConnection.apply(\n                        paper, data.validateConnectionArgs(view, magnet)\n                    )) {\n                        minDistance = distance;\n                        data.closestView = view;\n                        data.closestMagnet = magnet;\n                    }\n                }\n\n            }.bind(this));\n\n        }, this);\n\n        var end;\n        var closestView = data.closestView;\n        var closestMagnet = data.closestMagnet;\n        var endType = data.arrowhead;\n        var newClosestMagnet = (prevClosestMagnet !== closestMagnet);\n        if (prevClosestView && newClosestMagnet) {\n            prevClosestView.unhighlight(prevClosestMagnet, {\n                connecting: true,\n                snapping: true\n            });\n        }\n\n        if (closestView) {\n\n            if (!newClosestMagnet) return;\n\n            closestView.highlight(closestMagnet, {\n                connecting: true,\n                snapping: true\n            });\n            end = closestView.getLinkEnd(closestMagnet, x, y, this.model, endType);\n\n        } else {\n            end = { x: x, y: y };\n        }\n\n        this.model.set(endType, end || { x: x, y: y }, { ui: true });\n    },\n\n    _snapArrowheadEnd: function(data) {\n\n        // Finish off link snapping.\n        // Everything except view unhighlighting was already done on pointermove.\n        var closestView = data.closestView;\n        var closestMagnet = data.closestMagnet;\n        if (closestView && closestMagnet) {\n\n            closestView.unhighlight(closestMagnet, { connecting: true, snapping: true });\n            data.magnetUnderPointer = closestView.findMagnet(closestMagnet);\n        }\n\n        data.closestView = data.closestMagnet = null;\n    },\n\n    _connectArrowhead: function(target, x, y, data) {\n\n        // checking views right under the pointer\n\n        if (data.eventTarget !== target) {\n            // Unhighlight the previous view under pointer if there was one.\n            if (data.magnetUnderPointer) {\n                data.viewUnderPointer.unhighlight(data.magnetUnderPointer, {\n                    connecting: true\n                });\n            }\n\n            data.viewUnderPointer = this.paper.findView(target);\n            if (data.viewUnderPointer) {\n                // If we found a view that is under the pointer, we need to find the closest\n                // magnet based on the real target element of the event.\n                data.magnetUnderPointer = data.viewUnderPointer.findMagnet(target);\n\n                if (data.magnetUnderPointer && this.paper.options.validateConnection.apply(\n                    this.paper,\n                    data.validateConnectionArgs(data.viewUnderPointer, data.magnetUnderPointer)\n                )) {\n                    // If there was no magnet found, do not highlight anything and assume there\n                    // is no view under pointer we're interested in reconnecting to.\n                    // This can only happen if the overall element has the attribute `'.': { magnet: false }`.\n                    if (data.magnetUnderPointer) {\n                        data.viewUnderPointer.highlight(data.magnetUnderPointer, {\n                            connecting: true\n                        });\n                    }\n                } else {\n                    // This type of connection is not valid. Disregard this magnet.\n                    data.magnetUnderPointer = null;\n                }\n            } else {\n                // Make sure we'll unset previous magnet.\n                data.magnetUnderPointer = null;\n            }\n        }\n\n        data.eventTarget = target;\n\n        this.model.set(data.arrowhead, { x: x, y: y }, { ui: true });\n    },\n\n    _connectArrowheadEnd: function(data, x, y) {\n\n        var view = data.viewUnderPointer;\n        var magnet = data.magnetUnderPointer;\n        if (!magnet || !view) return;\n\n        view.unhighlight(magnet, { connecting: true });\n\n        var endType = data.arrowhead;\n        var end = view.getLinkEnd(magnet, x, y, this.model, endType);\n        this.model.set(endType, end, { ui: true });\n    },\n\n    _beforeArrowheadMove: function(data) {\n\n        data.z = this.model.get('z');\n        this.model.toFront();\n\n        // Let the pointer propagate throught the link view elements so that\n        // the `evt.target` is another element under the pointer, not the link itself.\n        this.el.style.pointerEvents = 'none';\n\n        if (this.paper.options.markAvailable) {\n            this._markAvailableMagnets(data);\n        }\n    },\n\n    _afterArrowheadMove: function(data) {\n\n        if (data.z !== null) {\n            this.model.set('z', data.z, { ui: true });\n            data.z = null;\n        }\n\n        // Put `pointer-events` back to its original value. See `startArrowheadMove()` for explanation.\n        // Value `auto` doesn't work in IE9. We force to use `visiblePainted` instead.\n        // See `https://developer.mozilla.org/en-US/docs/Web/CSS/pointer-events`.\n        this.el.style.pointerEvents = 'visiblePainted';\n\n        if (this.paper.options.markAvailable) {\n            this._unmarkAvailableMagnets(data);\n        }\n    },\n\n    _createValidateConnectionArgs: function(arrowhead) {\n        // It makes sure the arguments for validateConnection have the following form:\n        // (source view, source magnet, target view, target magnet and link view)\n        var args = [];\n\n        args[4] = arrowhead;\n        args[5] = this;\n\n        var oppositeArrowhead;\n        var i = 0;\n        var j = 0;\n\n        if (arrowhead === 'source') {\n            i = 2;\n            oppositeArrowhead = 'target';\n        } else {\n            j = 2;\n            oppositeArrowhead = 'source';\n        }\n\n        var end = this.model.get(oppositeArrowhead);\n\n        if (end.id) {\n            var view = args[i] = this.paper.findViewByModel(end.id);\n            var magnet = view.getMagnetFromLinkEnd(end);\n            if (magnet === view.el) magnet = undefined;\n            args[i + 1] = magnet;\n        }\n\n        function validateConnectionArgs(cellView, magnet) {\n            args[j] = cellView;\n            args[j + 1] = cellView.el === magnet ? undefined : magnet;\n            return args;\n        }\n\n        return validateConnectionArgs;\n    },\n\n    _markAvailableMagnets: function(data) {\n\n        function isMagnetAvailable(view, magnet) {\n            var paper = view.paper;\n            var validate = paper.options.validateConnection;\n            return validate.apply(paper, this.validateConnectionArgs(view, magnet));\n        }\n\n        var paper = this.paper;\n        var elements = paper.model.getElements();\n        data.marked = {};\n\n        for (var i = 0, n = elements.length; i < n; i++) {\n            var view = elements[i].findView(paper);\n\n            if (!view) {\n                continue;\n            }\n\n            var magnets = Array.prototype.slice.call(view.el.querySelectorAll('[magnet]'));\n            if (view.el.getAttribute('magnet') !== 'false') {\n                // Element wrapping group is also a magnet\n                magnets.push(view.el);\n            }\n\n            var availableMagnets = magnets.filter(isMagnetAvailable.bind(data, view));\n\n            if (availableMagnets.length > 0) {\n                // highlight all available magnets\n                for (var j = 0, m = availableMagnets.length; j < m; j++) {\n                    view.highlight(availableMagnets[j], { magnetAvailability: true });\n                }\n                // highlight the entire view\n                view.highlight(null, { elementAvailability: true });\n\n                data.marked[view.model.id] = availableMagnets;\n            }\n        }\n    },\n\n    _unmarkAvailableMagnets: function(data) {\n\n        var markedKeys = Object.keys(data.marked);\n        var id;\n        var markedMagnets;\n\n        for (var i = 0, n = markedKeys.length; i < n; i++) {\n            id = markedKeys[i];\n            markedMagnets = data.marked[id];\n\n            var view = this.paper.findViewByModel(id);\n            if (view) {\n                for (var j = 0, m = markedMagnets.length; j < m; j++) {\n                    view.unhighlight(markedMagnets[j], { magnetAvailability: true });\n                }\n                view.unhighlight(null, { elementAvailability: true });\n            }\n        }\n\n        data.marked = null;\n    },\n\n    startArrowheadMove: function(end, opt) {\n\n        opt || (opt = {});\n\n        // Allow to delegate events from an another view to this linkView in order to trigger arrowhead\n        // move without need to click on the actual arrowhead dom element.\n        var data = {\n            action: 'arrowhead-move',\n            arrowhead: end,\n            whenNotAllowed: opt.whenNotAllowed || 'revert',\n            initialMagnet: this[end + 'Magnet'] || (this[end + 'View'] ? this[end + 'View'].el : null),\n            initialEnd: joint.util.clone(this.model.get(end)),\n            validateConnectionArgs: this._createValidateConnectionArgs(end)\n        };\n\n        this._beforeArrowheadMove(data);\n\n        if (opt.ignoreBackwardsCompatibility !== true) {\n            this._dragData = data;\n        }\n\n        return data;\n    }\n}, {\n\n    makeSelector: function(end) {\n\n        var selector = '';\n        // `port` has a higher precendence over `selector`. This is because the selector to the magnet\n        // might change while the name of the port can stay the same.\n        if (end.port) {\n            selector += '[port=\"' + end.port + '\"]';\n        } else if (end.selector) {\n            selector +=  end.selector;\n        }\n\n        return selector;\n    }\n\n});\n\n\nObject.defineProperty(joint.dia.LinkView.prototype, 'sourceBBox', {\n\n    enumerable: true,\n\n    get: function() {\n        var sourceView = this.sourceView;\n        var sourceMagnet = this.sourceMagnet;\n        if (sourceView) {\n            if (!sourceMagnet) sourceMagnet = sourceView.el;\n            return sourceView.getNodeBBox(sourceMagnet);\n        }\n        var sourceDef = this.model.source();\n        return new g.Rect(sourceDef.x, sourceDef.y, 1, 1);\n    }\n\n});\n\nObject.defineProperty(joint.dia.LinkView.prototype, 'targetBBox', {\n\n    enumerable: true,\n\n    get: function() {\n        var targetView = this.targetView;\n        var targetMagnet = this.targetMagnet;\n        if (targetView) {\n            if (!targetMagnet) targetMagnet = targetView.el;\n            return targetView.getNodeBBox(targetMagnet);\n        }\n        var targetDef = this.model.target();\n        return new g.Rect(targetDef.x, targetDef.y, 1, 1);\n    }\n});\n\n\njoint.dia.Paper = joint.mvc.View.extend({\n\n    className: 'paper',\n\n    options: {\n\n        width: 800,\n        height: 600,\n        origin: { x: 0, y: 0 }, // x,y coordinates in top-left corner\n        gridSize: 1,\n\n        // Whether or not to draw the grid lines on the paper's DOM element.\n        // e.g drawGrid: true, drawGrid: { color: 'red', thickness: 2 }\n        drawGrid: false,\n\n        // Whether or not to draw the background on the paper's DOM element.\n        // e.g. background: { color: 'lightblue', image: '/paper-background.png', repeat: 'flip-xy' }\n        background: false,\n\n        perpendicularLinks: false,\n        elementView: joint.dia.ElementView,\n        linkView: joint.dia.LinkView,\n        snapLinks: false, // false, true, { radius: value }\n\n        // When set to FALSE, an element may not have more than 1 link with the same source and target element.\n        multiLinks: true,\n\n        // For adding custom guard logic.\n        guard: function(evt, view) {\n\n            // FALSE means the event isn't guarded.\n            return false;\n        },\n\n        highlighting: {\n            'default': {\n                name: 'stroke',\n                options: {\n                    padding: 3\n                }\n            },\n            magnetAvailability: {\n                name: 'addClass',\n                options: {\n                    className: 'available-magnet'\n                }\n            },\n            elementAvailability: {\n                name: 'addClass',\n                options: {\n                    className: 'available-cell'\n                }\n            }\n        },\n\n        // Prevent the default context menu from being displayed.\n        preventContextMenu: true,\n\n        // Prevent the default action for blank:pointer<action>.\n        preventDefaultBlankAction: true,\n\n        // Restrict the translation of elements by given bounding box.\n        // Option accepts a boolean:\n        //  true - the translation is restricted to the paper area\n        //  false - no restrictions\n        // A method:\n        // restrictTranslate: function(elementView) {\n        //     var parentId = elementView.model.get('parent');\n        //     return parentId && this.model.getCell(parentId).getBBox();\n        // },\n        // Or a bounding box:\n        // restrictTranslate: { x: 10, y: 10, width: 790, height: 590 }\n        restrictTranslate: false,\n\n        // Marks all available magnets with 'available-magnet' class name and all available cells with\n        // 'available-cell' class name. Marks them when dragging a link is started and unmark\n        // when the dragging is stopped.\n        markAvailable: false,\n\n        // Defines what link model is added to the graph after an user clicks on an active magnet.\n        // Value could be the Backbone.model or a function returning the Backbone.model\n        // defaultLink: function(elementView, magnet) { return condition ? new customLink1() : new customLink2() }\n        defaultLink: new joint.dia.Link,\n\n        // A connector that is used by links with no connector defined on the model.\n        // e.g. { name: 'rounded', args: { radius: 5 }} or a function\n        defaultConnector: { name: 'normal' },\n\n        // A router that is used by links with no router defined on the model.\n        // e.g. { name: 'oneSide', args: { padding: 10 }} or a function\n        defaultRouter: { name: 'normal' },\n\n        defaultAnchor: { name: 'center' },\n\n        defaultConnectionPoint: { name: 'bbox' },\n\n        /* CONNECTING */\n\n        connectionStrategy: null,\n\n        // Check whether to add a new link to the graph when user clicks on an a magnet.\n        validateMagnet: function(cellView, magnet) {\n            return magnet.getAttribute('magnet') !== 'passive';\n        },\n\n        // Check whether to allow or disallow the link connection while an arrowhead end (source/target)\n        // being changed.\n        validateConnection: function(cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\n            return (end === 'target' ? cellViewT : cellViewS) instanceof joint.dia.ElementView;\n        },\n\n        /* EMBEDDING */\n\n        // Enables embedding. Reparents the dragged element with elements under it and makes sure that\n        // all links and elements are visible taken the level of embedding into account.\n        embeddingMode: false,\n\n        // Check whether to allow or disallow the element embedding while an element being translated.\n        validateEmbedding: function(childView, parentView) {\n            // by default all elements can be in relation child-parent\n            return true;\n        },\n\n        // Determines the way how a cell finds a suitable parent when it's dragged over the paper.\n        // The cell with the highest z-index (visually on the top) will be chosen.\n        findParentBy: 'bbox', // 'bbox'|'center'|'origin'|'corner'|'topRight'|'bottomLeft'\n\n        // If enabled only the element on the very front is taken into account for the embedding.\n        // If disabled the elements under the dragged view are tested one by one\n        // (from front to back) until a valid parent found.\n        frontParentOnly: true,\n\n        // Interactive flags. See online docs for the complete list of interactive flags.\n        interactive: {\n            labelMove: false\n        },\n\n        // When set to true the links can be pinned to the paper.\n        // i.e. link source/target can be a point e.g. link.get('source') ==> { x: 100, y: 100 };\n        linkPinning: true,\n\n        // Custom validation after an interaction with a link ends.\n        // Recognizes a function. If `false` is returned, the link is disallowed (removed or reverted)\n        // (linkView, paper) => boolean\n        allowLink: null,\n\n        // Allowed number of mousemove events after which the pointerclick event will be still triggered.\n        clickThreshold: 0,\n\n        // Number of required mousemove events before the first pointermove event will be triggered.\n        moveThreshold: 0,\n\n        // Number of required mousemove events before the a link is created out of the magnet.\n        // Or string `onleave` so the link is created when the pointer leaves the magnet\n        magnetThreshold: 0,\n\n        // The namespace, where all the cell views are defined.\n        cellViewNamespace: joint.shapes,\n\n        // The namespace, where all the cell views are defined.\n        highlighterNamespace: joint.highlighters\n    },\n\n    events: {\n        'dblclick': 'pointerdblclick',\n        'contextmenu': 'contextmenu',\n        'mousedown': 'pointerdown',\n        'touchstart': 'pointerdown',\n        'mouseover': 'mouseover',\n        'mouseout': 'mouseout',\n        'mouseenter': 'mouseenter',\n        'mouseleave': 'mouseleave',\n        'mousewheel': 'mousewheel',\n        'DOMMouseScroll': 'mousewheel',\n        'mouseenter .joint-cell': 'mouseenter',\n        'mouseleave .joint-cell': 'mouseleave',\n        'mouseenter .joint-tools': 'mouseenter',\n        'mouseleave .joint-tools': 'mouseleave',\n        'mousedown .joint-cell [event]': 'onevent', // interaction with cell with `event` attribute set\n        'touchstart .joint-cell [event]': 'onevent',\n        'mousedown .joint-cell [magnet]': 'onmagnet', // interaction with cell with `magnet` attribute set\n        'touchstart .joint-cell [magnet]': 'onmagnet',\n        'dblclick .joint-cell [magnet]': 'magnetpointerdblclick',\n        'contextmenu .joint-cell [magnet]': 'magnetcontextmenu',\n        'mousedown .joint-link .label': 'onlabel', // interaction with link label\n        'touchstart .joint-link .label': 'onlabel',\n        'dragstart .joint-cell image': 'onImageDragStart' // firefox fix\n    },\n\n    documentEvents: {\n        'mousemove': 'pointermove',\n        'touchmove': 'pointermove',\n        'mouseup': 'pointerup',\n        'touchend': 'pointerup',\n        'touchcancel': 'pointerup'\n    },\n\n    _highlights: {},\n\n    init: function() {\n\n        joint.util.bindAll(this, 'pointerup');\n\n        var model = this.model = this.options.model || new joint.dia.Graph;\n\n        this.setGrid(this.options.drawGrid);\n        this.cloneOptions();\n        this.render();\n        this.setDimensions();\n\n        this.listenTo(model, 'add', this.onCellAdded)\n            .listenTo(model, 'remove', this.removeView)\n            .listenTo(model, 'reset', this.resetViews)\n            .listenTo(model, 'sort', this._onSort)\n            .listenTo(model, 'batch:stop', this._onBatchStop);\n\n        this.on('cell:highlight', this.onCellHighlight)\n            .on('cell:unhighlight', this.onCellUnhighlight)\n            .on('scale translate', this.update);\n\n        // Hash of all cell views.\n        this._views = {};\n        // Reference to the paper owner document\n        this.$document = $(this.el.ownerDocument);\n    },\n\n    cloneOptions: function() {\n\n        var options = this.options;\n\n        // This is a fix for the case where two papers share the same options.\n        // Changing origin.x for one paper would change the value of origin.x for the other.\n        // This prevents that behavior.\n        options.origin = joint.util.assign({}, options.origin);\n        options.defaultConnector = joint.util.assign({}, options.defaultConnector);\n        // Return the default highlighting options into the user specified options.\n        options.highlighting = joint.util.defaultsDeep(\n            {},\n            options.highlighting,\n            this.constructor.prototype.options.highlighting\n        );\n    },\n\n    render: function() {\n\n        this.$el.empty();\n\n        this.svg = V('svg').attr({ width: '100%', height: '100%' }).node;\n        this.viewport = V('g').addClass(joint.util.addClassNamePrefix('viewport')).node;\n        this.defs = V('defs').node;\n        this.tools = V('g').addClass(joint.util.addClassNamePrefix('tools-container')).node;\n        // Append `<defs>` element to the SVG document. This is useful for filters and gradients.\n        // It's desired to have the defs defined before the viewport (e.g. to make a PDF document pick up defs properly).\n        V(this.svg).append([this.defs, this.viewport, this.tools]);\n\n        this.$background = $('<div/>').addClass(joint.util.addClassNamePrefix('paper-background'));\n        if (this.options.background) {\n            this.drawBackground(this.options.background);\n        }\n\n        this.$grid = $('<div/>').addClass(joint.util.addClassNamePrefix('paper-grid'));\n        if (this.options.drawGrid) {\n            this.drawGrid();\n        }\n\n        this.$el.append(this.$background, this.$grid, this.svg);\n\n        return this;\n    },\n\n    update: function() {\n\n        if (this.options.drawGrid) {\n            this.drawGrid();\n        }\n\n        if (this._background) {\n            this.updateBackgroundImage(this._background);\n        }\n\n        return this;\n    },\n\n    // For storing the current transformation matrix (CTM) of the paper's viewport.\n    _viewportMatrix: null,\n\n    // For verifying whether the CTM is up-to-date. The viewport transform attribute\n    // could have been manipulated directly.\n    _viewportTransformString: null,\n\n    matrix: function(ctm) {\n\n        var viewport = this.viewport;\n\n        // Getter:\n        if (ctm === undefined) {\n\n            var transformString = viewport.getAttribute('transform');\n\n            if ((this._viewportTransformString || null) === transformString) {\n                // It's ok to return the cached matrix. The transform attribute has not changed since\n                // the matrix was stored.\n                ctm = this._viewportMatrix;\n            } else {\n                // The viewport transform attribute has changed. Measure the matrix and cache again.\n                ctm = viewport.getCTM();\n                this._viewportMatrix = ctm;\n                this._viewportTransformString = transformString;\n            }\n\n            // Clone the cached current transformation matrix.\n            // If no matrix previously stored the identity matrix is returned.\n            return V.createSVGMatrix(ctm);\n        }\n\n        // Setter:\n        ctm = V.createSVGMatrix(ctm);\n        var ctmString = V.matrixToTransformString(ctm);\n        viewport.setAttribute('transform', ctmString);\n        this.tools.setAttribute('transform', ctmString);\n\n        this._viewportMatrix = ctm;\n        this._viewportTransformString = viewport.getAttribute('transform');\n\n        return this;\n    },\n\n    clientMatrix: function() {\n\n        return V.createSVGMatrix(this.viewport.getScreenCTM());\n    },\n\n    _sortDelayingBatches: ['add', 'to-front', 'to-back'],\n\n    _onSort: function() {\n        if (!this.model.hasActiveBatch(this._sortDelayingBatches)) {\n            this.sortViews();\n        }\n    },\n\n    _onBatchStop: function(data) {\n        var name = data && data.batchName;\n        if (this._sortDelayingBatches.includes(name) &&\n            !this.model.hasActiveBatch(this._sortDelayingBatches)) {\n            this.sortViews();\n        }\n    },\n\n    onRemove: function() {\n\n        //clean up all DOM elements/views to prevent memory leaks\n        this.removeViews();\n    },\n\n    getComputedSize: function() {\n\n        var util = joint.util;\n        var options = this.options;\n        var w = options.width;\n        var h = options.height;\n        if (!util.isNumber(w)) w = this.el.clientWidth;\n        if (!util.isNumber(h)) h = this.el.clientHeight;\n        return { width: w, height: h };\n    },\n\n    setDimensions: function(width, height) {\n\n        var util = joint.util;\n        var options = this.options;\n        var w = (width === undefined) ? options.width : width;\n        var h = (height === undefined) ? options.height : height;\n        this.options.width = w;\n        this.options.height = h;\n        if (util.isNumber(w)) w = Math.round(w);\n        if (util.isNumber(h)) h = Math.round(h);\n        this.$el.css({\n            width: (w === null) ? '' : w,\n            height: (h === null) ? '' : h\n        });\n        var computedSize = this.getComputedSize();\n        this.trigger('resize', computedSize.width, computedSize.height);\n    },\n\n    setOrigin: function(ox, oy) {\n\n        return this.translate(ox || 0, oy || 0, { absolute: true });\n    },\n\n    // Expand/shrink the paper to fit the content. Snap the width/height to the grid\n    // defined in `gridWidth`, `gridHeight`. `padding` adds to the resulting width/height of the paper.\n    // When options { fitNegative: true } it also translates the viewport in order to make all\n    // the content visible.\n    fitToContent: function(gridWidth, gridHeight, padding, opt) { // alternatively function(opt)\n\n        if (joint.util.isObject(gridWidth)) {\n            // first parameter is an option object\n            opt = gridWidth;\n            gridWidth = opt.gridWidth || 1;\n            gridHeight = opt.gridHeight || 1;\n            padding = opt.padding || 0;\n\n        } else {\n\n            opt = opt || {};\n            gridWidth = gridWidth || 1;\n            gridHeight = gridHeight || 1;\n            padding = padding || 0;\n        }\n\n        padding = joint.util.normalizeSides(padding);\n\n        // Calculate the paper size to accomodate all the graph's elements.\n        var bbox = V(this.viewport).getBBox();\n\n        var currentScale = this.scale();\n        var currentTranslate = this.translate();\n\n        bbox.x *= currentScale.sx;\n        bbox.y *= currentScale.sy;\n        bbox.width *= currentScale.sx;\n        bbox.height *= currentScale.sy;\n\n        var calcWidth = Math.max(Math.ceil((bbox.width + bbox.x) / gridWidth), 1) * gridWidth;\n        var calcHeight = Math.max(Math.ceil((bbox.height + bbox.y) / gridHeight), 1) * gridHeight;\n\n        var tx = 0;\n        var ty = 0;\n\n        if ((opt.allowNewOrigin == 'negative' && bbox.x < 0) || (opt.allowNewOrigin == 'positive' && bbox.x >= 0) || opt.allowNewOrigin == 'any') {\n            tx = Math.ceil(-bbox.x / gridWidth) * gridWidth;\n            tx += padding.left;\n            calcWidth += tx;\n        }\n\n        if ((opt.allowNewOrigin == 'negative' && bbox.y < 0) || (opt.allowNewOrigin == 'positive' && bbox.y >= 0) || opt.allowNewOrigin == 'any') {\n            ty = Math.ceil(-bbox.y / gridHeight) * gridHeight;\n            ty += padding.top;\n            calcHeight += ty;\n        }\n\n        calcWidth += padding.right;\n        calcHeight += padding.bottom;\n\n        // Make sure the resulting width and height are greater than minimum.\n        calcWidth = Math.max(calcWidth, opt.minWidth || 0);\n        calcHeight = Math.max(calcHeight, opt.minHeight || 0);\n\n        // Make sure the resulting width and height are lesser than maximum.\n        calcWidth = Math.min(calcWidth, opt.maxWidth || Number.MAX_VALUE);\n        calcHeight = Math.min(calcHeight, opt.maxHeight || Number.MAX_VALUE);\n\n        var computedSize = this.getComputedSize();\n        var dimensionChange = calcWidth != computedSize.width || calcHeight != computedSize.height;\n        var originChange = tx != currentTranslate.tx || ty != currentTranslate.ty;\n\n        // Change the dimensions only if there is a size discrepency or an origin change\n        if (originChange) {\n            this.translate(tx, ty);\n        }\n        if (dimensionChange) {\n            this.setDimensions(calcWidth, calcHeight);\n        }\n    },\n\n    scaleContentToFit: function(opt) {\n\n        var contentBBox = this.getContentBBox();\n\n        if (!contentBBox.width || !contentBBox.height) return;\n\n        opt = opt || {};\n\n        joint.util.defaults(opt, {\n            padding: 0,\n            preserveAspectRatio: true,\n            scaleGrid: null,\n            minScale: 0,\n            maxScale: Number.MAX_VALUE\n            //minScaleX\n            //minScaleY\n            //maxScaleX\n            //maxScaleY\n            //fittingBBox\n        });\n\n        var padding = opt.padding;\n\n        var minScaleX = opt.minScaleX || opt.minScale;\n        var maxScaleX = opt.maxScaleX || opt.maxScale;\n        var minScaleY = opt.minScaleY || opt.minScale;\n        var maxScaleY = opt.maxScaleY || opt.maxScale;\n\n        var fittingBBox;\n        if (opt.fittingBBox) {\n            fittingBBox = opt.fittingBBox;\n        } else {\n            var currentTranslate = this.translate();\n            var computedSize = this.getComputedSize();\n            fittingBBox = {\n                x: currentTranslate.tx,\n                y: currentTranslate.ty,\n                width: computedSize.width,\n                height: computedSize.height\n            };\n        }\n\n        fittingBBox = new g.Rect(fittingBBox).inflate(-padding);\n\n        var currentScale = this.scale();\n\n        var newSx = fittingBBox.width / contentBBox.width * currentScale.sx;\n        var newSy = fittingBBox.height / contentBBox.height * currentScale.sy;\n\n        if (opt.preserveAspectRatio) {\n            newSx = newSy = Math.min(newSx, newSy);\n        }\n\n        // snap scale to a grid\n        if (opt.scaleGrid) {\n\n            var gridSize = opt.scaleGrid;\n\n            newSx = gridSize * Math.floor(newSx / gridSize);\n            newSy = gridSize * Math.floor(newSy / gridSize);\n        }\n\n        // scale min/max boundaries\n        newSx = Math.min(maxScaleX, Math.max(minScaleX, newSx));\n        newSy = Math.min(maxScaleY, Math.max(minScaleY, newSy));\n\n        this.scale(newSx, newSy);\n\n        var contentTranslation = this.getContentBBox();\n\n        var newOx = fittingBBox.x - contentTranslation.x;\n        var newOy = fittingBBox.y - contentTranslation.y;\n\n        this.translate(newOx, newOy);\n    },\n\n    // Return the dimensions of the content area in local units (without transformations).\n    getContentArea: function() {\n\n        return V(this.viewport).getBBox();\n    },\n\n    // Return the dimensions of the content bbox in client units (as it appears on screen).\n    getContentBBox: function() {\n\n        var crect = this.viewport.getBoundingClientRect();\n\n        // Using Screen CTM was the only way to get the real viewport bounding box working in both\n        // Google Chrome and Firefox.\n        var clientCTM = this.clientMatrix();\n\n        // for non-default origin we need to take the viewport translation into account\n        var currentTranslate = this.translate();\n\n        return new g.Rect({\n            x: crect.left - clientCTM.e + currentTranslate.tx,\n            y: crect.top - clientCTM.f + currentTranslate.ty,\n            width: crect.width,\n            height: crect.height\n        });\n    },\n\n    // Returns a geometry rectangle represeting the entire\n    // paper area (coordinates from the left paper border to the right one\n    // and the top border to the bottom one).\n    getArea: function() {\n\n        return this.paperToLocalRect(this.getComputedSize());\n    },\n\n    getRestrictedArea: function() {\n\n        var restrictedArea;\n\n        if (joint.util.isFunction(this.options.restrictTranslate)) {\n            // A method returning a bounding box\n            restrictedArea = this.options.restrictTranslate.apply(this, arguments);\n        } else if (this.options.restrictTranslate === true) {\n            // The paper area\n            restrictedArea = this.getArea();\n        } else {\n            // Either false or a bounding box\n            restrictedArea = this.options.restrictTranslate || null;\n        }\n\n        return restrictedArea;\n    },\n\n    createViewForModel: function(cell) {\n\n        // A class taken from the paper options.\n        var optionalViewClass;\n\n        // A default basic class (either dia.ElementView or dia.LinkView)\n        var defaultViewClass;\n\n        // A special class defined for this model in the corresponding namespace.\n        // e.g. joint.shapes.basic.Rect searches for joint.shapes.basic.RectView\n        var namespace = this.options.cellViewNamespace;\n        var type = cell.get('type') + 'View';\n        var namespaceViewClass = joint.util.getByPath(namespace, type, '.');\n\n        if (cell.isLink()) {\n            optionalViewClass = this.options.linkView;\n            defaultViewClass = joint.dia.LinkView;\n        } else {\n            optionalViewClass = this.options.elementView;\n            defaultViewClass = joint.dia.ElementView;\n        }\n\n        // a) the paper options view is a class (deprecated)\n        //  1. search the namespace for a view\n        //  2. if no view was found, use view from the paper options\n        // b) the paper options view is a function\n        //  1. call the function from the paper options\n        //  2. if no view was return, search the namespace for a view\n        //  3. if no view was found, use the default\n        var ViewClass = (optionalViewClass.prototype instanceof Backbone.View)\n            ? namespaceViewClass || optionalViewClass\n            : optionalViewClass.call(this, cell) || namespaceViewClass || defaultViewClass;\n\n        return new ViewClass({\n            model: cell,\n            interactive: this.options.interactive\n        });\n    },\n\n    onCellAdded: function(cell, graph, opt) {\n\n        if (this.options.async && opt.async !== false && joint.util.isNumber(opt.position)) {\n\n            this._asyncCells = this._asyncCells || [];\n            this._asyncCells.push(cell);\n\n            if (opt.position == 0) {\n\n                if (this._frameId) throw new Error('another asynchronous rendering in progress');\n\n                this.asyncRenderViews(this._asyncCells, opt);\n                delete this._asyncCells;\n            }\n\n        } else {\n\n            this.renderView(cell);\n        }\n    },\n\n    removeView: function(cell) {\n\n        var view = this._views[cell.id];\n\n        if (view) {\n            view.remove();\n            delete this._views[cell.id];\n        }\n\n        return view;\n    },\n\n    renderView: function(cell) {\n\n        var view = this._views[cell.id] = this.createViewForModel(cell);\n\n        this.viewport.appendChild(view.el);\n        view.paper = this;\n        view.render();\n\n        return view;\n    },\n\n    onImageDragStart: function() {\n        // This is the only way to prevent image dragging in Firefox that works.\n        // Setting -moz-user-select: none, draggable=\"false\" attribute or user-drag: none didn't help.\n\n        return false;\n    },\n\n    beforeRenderViews: function(cells) {\n\n        // Make sure links are always added AFTER elements.\n        // They wouldn't find their sources/targets in the DOM otherwise.\n        cells.sort(function(a) { return (a.isLink()) ? 1 : -1; });\n\n        return cells;\n    },\n\n    afterRenderViews: function() {\n\n        this.sortViews();\n    },\n\n    resetViews: function(cellsCollection, opt) {\n\n        // clearing views removes any event listeners\n        this.removeViews();\n\n        var cells = cellsCollection.models.slice();\n\n        // `beforeRenderViews()` can return changed cells array (e.g sorted).\n        cells = this.beforeRenderViews(cells, opt) || cells;\n\n        this.cancelRenderViews();\n\n        if (this.options.async) {\n\n            this.asyncRenderViews(cells, opt);\n            // Sort the cells once all elements rendered (see asyncRenderViews()).\n\n        } else {\n\n            for (var i = 0, n = cells.length; i < n; i++) {\n                this.renderView(cells[i]);\n            }\n\n            // Sort the cells in the DOM manually as we might have changed the order they\n            // were added to the DOM (see above).\n            this.sortViews();\n        }\n    },\n\n    cancelRenderViews: function() {\n        if (this._frameId) {\n            joint.util.cancelFrame(this._frameId);\n            delete this._frameId;\n        }\n    },\n\n    removeViews: function() {\n\n        joint.util.invoke(this._views, 'remove');\n\n        this._views = {};\n    },\n\n    asyncBatchAdded: joint.util.noop,\n\n    asyncRenderViews: function(cells, opt) {\n\n        if (this._frameId) {\n\n            var batchSize = (this.options.async && this.options.async.batchSize) || 50;\n            var batchCells = cells.splice(0, batchSize);\n\n            batchCells.forEach(function(cell) {\n\n                // The cell has to be part of the graph.\n                // There is a chance in asynchronous rendering\n                // that a cell was removed before it's rendered to the paper.\n                if (cell.graph === this.model) this.renderView(cell);\n\n            }, this);\n\n            this.asyncBatchAdded();\n        }\n\n        if (!cells.length) {\n\n            // No cells left to render.\n            delete this._frameId;\n            this.afterRenderViews(opt);\n            this.trigger('render:done', opt);\n\n        } else {\n\n            // Schedule a next batch to render.\n            this._frameId = joint.util.nextFrame(function() {\n                this.asyncRenderViews(cells, opt);\n            }, this);\n        }\n    },\n\n    sortViews: function() {\n\n        // Run insertion sort algorithm in order to efficiently sort DOM elements according to their\n        // associated model `z` attribute.\n\n        var $cells = $(this.viewport).children('[model-id]');\n        var cells = this.model.get('cells');\n\n        joint.util.sortElements($cells, function(a, b) {\n\n            var cellA = cells.get($(a).attr('model-id'));\n            var cellB = cells.get($(b).attr('model-id'));\n\n            return (cellA.get('z') || 0) > (cellB.get('z') || 0) ? 1 : -1;\n        });\n    },\n\n    MIN_SCALE: 1e-6,\n\n    scale: function(sx, sy, ox, oy) {\n\n        // getter\n        if (sx === undefined) {\n            return V.matrixToScale(this.matrix());\n        }\n\n        // setter\n        if (sy === undefined) {\n            sy = sx;\n        }\n        if (ox === undefined) {\n            ox = 0;\n            oy = 0;\n        }\n\n        var translate = this.translate();\n\n        if (ox || oy || translate.tx || translate.ty) {\n            var newTx = translate.tx - ox * (sx - 1);\n            var newTy = translate.ty - oy * (sy - 1);\n            this.translate(newTx, newTy);\n        }\n\n        sx = Math.max(sx || 0, this.MIN_SCALE);\n        sy = Math.max(sy || 0, this.MIN_SCALE);\n\n        var ctm = this.matrix();\n        ctm.a = sx;\n        ctm.d = sy;\n\n        this.matrix(ctm);\n\n        this.trigger('scale', sx, sy, ox, oy);\n\n        return this;\n    },\n\n    // Experimental - do not use in production.\n    rotate: function(angle, cx, cy) {\n\n        // getter\n        if (angle === undefined) {\n            return V.matrixToRotate(this.matrix());\n        }\n\n        // setter\n\n        // If the origin is not set explicitely, rotate around the center. Note that\n        // we must use the plain bounding box (`this.el.getBBox()` instead of the one that gives us\n        // the real bounding box (`bbox()`) including transformations).\n        if (cx === undefined) {\n            var bbox = this.viewport.getBBox();\n            cx = bbox.width / 2;\n            cy = bbox.height / 2;\n        }\n\n        var ctm = this.matrix().translate(cx,cy).rotate(angle).translate(-cx,-cy);\n        this.matrix(ctm);\n\n        return this;\n    },\n\n    translate: function(tx, ty) {\n\n        // getter\n        if (tx === undefined) {\n            return V.matrixToTranslate(this.matrix());\n        }\n\n        // setter\n\n        var ctm = this.matrix();\n        ctm.e = tx || 0;\n        ctm.f = ty || 0;\n\n        this.matrix(ctm);\n\n        var newTranslate = this.translate();\n        var origin = this.options.origin;\n        origin.x = newTranslate.tx;\n        origin.y = newTranslate.ty;\n\n        this.trigger('translate', newTranslate.tx, newTranslate.ty);\n\n        if (this.options.drawGrid) {\n            this.drawGrid();\n        }\n\n        return this;\n    },\n\n    // Find the first view climbing up the DOM tree starting at element `el`. Note that `el` can also\n    // be a selector or a jQuery object.\n    findView: function($el) {\n\n        var el = joint.util.isString($el)\n            ? this.viewport.querySelector($el)\n            : $el instanceof $ ? $el[0] : $el;\n\n        var id = this.findAttribute('model-id', el);\n        if (id) return this._views[id];\n\n        return undefined;\n    },\n\n    // Find a view for a model `cell`. `cell` can also be a string or number representing a model `id`.\n    findViewByModel: function(cell) {\n\n        var id = (joint.util.isString(cell) || joint.util.isNumber(cell)) ? cell : (cell && cell.id);\n\n        return this._views[id];\n    },\n\n    // Find all views at given point\n    findViewsFromPoint: function(p) {\n\n        p = new g.Point(p);\n\n        var views = this.model.getElements().map(this.findViewByModel, this);\n\n        return views.filter(function(view) {\n            return view && view.vel.getBBox({ target: this.viewport }).containsPoint(p);\n        }, this);\n    },\n\n    // Find all views in given area\n    findViewsInArea: function(rect, opt) {\n\n        opt = joint.util.defaults(opt || {}, { strict: false });\n        rect = new g.Rect(rect);\n\n        var views = this.model.getElements().map(this.findViewByModel, this);\n        var method = opt.strict ? 'containsRect' : 'intersect';\n\n        return views.filter(function(view) {\n            return view && rect[method](view.vel.getBBox({ target: this.viewport }));\n        }, this);\n    },\n\n    removeTools: function() {\n        joint.dia.CellView.dispatchToolsEvent(this, 'remove');\n        return this;\n    },\n\n    hideTools: function() {\n        joint.dia.CellView.dispatchToolsEvent(this, 'hide');\n        return this;\n    },\n\n    showTools: function() {\n        joint.dia.CellView.dispatchToolsEvent(this, 'show');\n        return this;\n    },\n\n    getModelById: function(id) {\n\n        return this.model.getCell(id);\n    },\n\n    snapToGrid: function(x, y) {\n\n        // Convert global coordinates to the local ones of the `viewport`. Otherwise,\n        // improper transformation would be applied when the viewport gets transformed (scaled/rotated).\n        return this.clientToLocalPoint(x, y).snapToGrid(this.options.gridSize);\n    },\n\n    localToPaperPoint: function(x, y) {\n        // allow `x` to be a point and `y` undefined\n        var localPoint = new g.Point(x, y);\n        var paperPoint = V.transformPoint(localPoint, this.matrix());\n        return paperPoint;\n    },\n\n    localToPaperRect: function(x, y, width, height) {\n        // allow `x` to be a rectangle and rest arguments undefined\n        var localRect = new g.Rect(x, y, width, height);\n        var paperRect = V.transformRect(localRect, this.matrix());\n        return paperRect;\n    },\n\n    paperToLocalPoint: function(x, y) {\n        // allow `x` to be a point and `y` undefined\n        var paperPoint = new g.Point(x, y);\n        var localPoint = V.transformPoint(paperPoint, this.matrix().inverse());\n        return localPoint;\n    },\n\n    paperToLocalRect: function(x, y, width, height) {\n        // allow `x` to be a rectangle and rest arguments undefined\n        var paperRect = new g.Rect(x, y, width, height);\n        var localRect = V.transformRect(paperRect, this.matrix().inverse());\n        return localRect;\n    },\n\n    localToClientPoint: function(x, y) {\n        // allow `x` to be a point and `y` undefined\n        var localPoint = new g.Point(x, y);\n        var clientPoint = V.transformPoint(localPoint, this.clientMatrix());\n        return clientPoint;\n    },\n\n    localToClientRect: function(x, y, width, height) {\n        // allow `x` to be a point and `y` undefined\n        var localRect = new g.Rect(x, y, width, height);\n        var clientRect = V.transformRect(localRect, this.clientMatrix());\n        return clientRect;\n    },\n\n    // Transform client coordinates to the paper local coordinates.\n    // Useful when you have a mouse event object and you'd like to get coordinates\n    // inside the paper that correspond to `evt.clientX` and `evt.clientY` point.\n    // Example: var localPoint = paper.clientToLocalPoint({ x: evt.clientX, y: evt.clientY });\n    clientToLocalPoint: function(x, y) {\n        // allow `x` to be a point and `y` undefined\n        var clientPoint = new g.Point(x, y);\n        var localPoint = V.transformPoint(clientPoint, this.clientMatrix().inverse());\n        return localPoint;\n    },\n\n    clientToLocalRect: function(x, y, width, height) {\n        // allow `x` to be a point and `y` undefined\n        var clientRect = new g.Rect(x, y, width, height);\n        var localRect = V.transformRect(clientRect, this.clientMatrix().inverse());\n        return localRect;\n    },\n\n    localToPagePoint: function(x, y) {\n\n        return this.localToPaperPoint(x, y).offset(this.pageOffset());\n    },\n\n    localToPageRect: function(x, y, width, height) {\n\n        return this.localToPaperRect(x, y, width, height).offset(this.pageOffset());\n    },\n\n    pageToLocalPoint: function(x, y) {\n\n        var pagePoint = new g.Point(x, y);\n        var paperPoint = pagePoint.difference(this.pageOffset());\n        return this.paperToLocalPoint(paperPoint);\n    },\n\n    pageToLocalRect: function(x, y, width, height) {\n\n        var pageOffset = this.pageOffset();\n        var paperRect = new g.Rect(x, y, width, height);\n        paperRect.x -= pageOffset.x;\n        paperRect.y -= pageOffset.y;\n        return this.paperToLocalRect(paperRect);\n    },\n\n    clientOffset: function() {\n\n        var clientRect = this.svg.getBoundingClientRect();\n        return new g.Point(clientRect.left, clientRect.top);\n    },\n\n    pageOffset: function() {\n\n        return this.clientOffset().offset(window.scrollX, window.scrollY);\n    },\n\n    linkAllowed: function(linkView) {\n\n        if (!(linkView instanceof joint.dia.LinkView)) {\n            throw new Error('Must provide a linkView.');\n        }\n\n        var link = linkView.model;\n        var paperOptions = this.options;\n        var graph = this.model;\n        var ns = graph.constructor.validations;\n\n        if (!paperOptions.multiLinks) {\n            if (!ns.multiLinks.call(this, graph, link)) return false;\n        }\n\n        if (!paperOptions.linkPinning) {\n            // Link pinning is not allowed and the link is not connected to the target.\n            if (!ns.linkPinning.call(this, graph, link)) return false;\n        }\n\n        if (typeof paperOptions.allowLink === 'function') {\n            if (!paperOptions.allowLink.call(this, linkView, this)) return false;\n        }\n\n        return true;\n    },\n\n    getDefaultLink: function(cellView, magnet) {\n\n        return joint.util.isFunction(this.options.defaultLink)\n            // default link is a function producing link model\n            ? this.options.defaultLink.call(this, cellView, magnet)\n            // default link is the Backbone model\n            : this.options.defaultLink.clone();\n    },\n\n    // Cell highlighting.\n    // ------------------\n\n    resolveHighlighter: function(opt) {\n\n        opt = opt || {};\n        var highlighterDef = opt.highlighter;\n        var paperOpt = this.options;\n\n        /*\n            Expecting opt.highlighter to have the following structure:\n            {\n                name: 'highlighter-name',\n                options: {\n                    some: 'value'\n                }\n            }\n        */\n        if (highlighterDef === undefined) {\n\n            // check for built-in types\n            var type = ['embedding', 'connecting', 'magnetAvailability', 'elementAvailability'].find(function(type) {\n                return !!opt[type];\n            });\n\n            highlighterDef = (type && paperOpt.highlighting[type]) || paperOpt.highlighting['default'];\n        }\n\n        // Do nothing if opt.highlighter is falsey.\n        // This allows the case to not highlight cell(s) in certain cases.\n        // For example, if you want to NOT highlight when embedding elements.\n        if (!highlighterDef) return false;\n\n        // Allow specifying a highlighter by name.\n        if (joint.util.isString(highlighterDef)) {\n            highlighterDef = {\n                name: highlighterDef\n            };\n        }\n\n        var name = highlighterDef.name;\n        var highlighter = paperOpt.highlighterNamespace[name];\n\n        // Highlighter validation\n        if (!highlighter) {\n            throw new Error('Unknown highlighter (\"' + name + '\")');\n        }\n        if (typeof highlighter.highlight !== 'function') {\n            throw new Error('Highlighter (\"' + name + '\") is missing required highlight() method');\n        }\n        if (typeof highlighter.unhighlight !== 'function') {\n            throw new Error('Highlighter (\"' + name + '\") is missing required unhighlight() method');\n        }\n\n        return {\n            highlighter: highlighter,\n            options: highlighterDef.options || {},\n            name: name\n        };\n    },\n\n    onCellHighlight: function(cellView, magnetEl, opt) {\n\n        opt = this.resolveHighlighter(opt);\n        if (!opt) return;\n        if (!magnetEl.id) {\n            magnetEl.id = V.uniqueId();\n        }\n\n        var key = opt.name + magnetEl.id + JSON.stringify(opt.options);\n        if (!this._highlights[key]) {\n\n            var highlighter = opt.highlighter;\n            highlighter.highlight(cellView, magnetEl, joint.util.assign({}, opt.options));\n\n            this._highlights[key] = {\n                cellView: cellView,\n                magnetEl: magnetEl,\n                opt: opt.options,\n                highlighter: highlighter\n            };\n        }\n    },\n\n    onCellUnhighlight: function(cellView, magnetEl, opt) {\n\n        opt = this.resolveHighlighter(opt);\n        if (!opt) return;\n\n        var key = opt.name + magnetEl.id + JSON.stringify(opt.options);\n        var highlight = this._highlights[key];\n        if (highlight) {\n\n            // Use the cellView and magnetEl that were used by the highlighter.highlight() method.\n            highlight.highlighter.unhighlight(highlight.cellView, highlight.magnetEl, highlight.opt);\n\n            this._highlights[key] = null;\n        }\n    },\n\n    // Interaction.\n    // ------------\n\n    pointerdblclick: function(evt) {\n\n        evt.preventDefault();\n\n        // magnetpointerdblclick can stop propagation\n\n        evt = joint.util.normalizeEvent(evt);\n\n        var view = this.findView(evt.target);\n        if (this.guard(evt, view)) return;\n\n        var localPoint = this.snapToGrid({ x: evt.clientX, y: evt.clientY });\n\n        if (view) {\n            view.pointerdblclick(evt, localPoint.x, localPoint.y);\n\n        } else {\n            this.trigger('blank:pointerdblclick', evt, localPoint.x, localPoint.y);\n        }\n    },\n\n    pointerclick: function(evt) {\n\n        // magnetpointerclick can stop propagation\n\n        var data = this.eventData(evt);\n        // Trigger event only if mouse has not moved.\n        if (data.mousemoved <= this.options.clickThreshold) {\n\n            evt = joint.util.normalizeEvent(evt);\n\n            var view = this.findView(evt.target);\n            if (this.guard(evt, view)) return;\n\n            var localPoint = this.snapToGrid({ x: evt.clientX, y: evt.clientY });\n\n            if (view) {\n                view.pointerclick(evt, localPoint.x, localPoint.y);\n\n            } else {\n                this.trigger('blank:pointerclick', evt, localPoint.x, localPoint.y);\n            }\n        }\n    },\n\n    contextmenu: function(evt) {\n\n        if (this.options.preventContextMenu) evt.preventDefault();\n\n        evt = joint.util.normalizeEvent(evt);\n\n        var view = this.findView(evt.target);\n        if (this.guard(evt, view)) return;\n\n        var localPoint = this.snapToGrid({ x: evt.clientX, y: evt.clientY });\n\n        if (view) {\n            view.contextmenu(evt, localPoint.x, localPoint.y);\n\n        } else {\n            this.trigger('blank:contextmenu', evt, localPoint.x, localPoint.y);\n        }\n    },\n\n    pointerdown: function(evt) {\n\n        // onmagnet stops propagation when `addLinkFromMagnet` is allowed\n        // onevent can stop propagation\n\n        evt = joint.util.normalizeEvent(evt);\n\n        var view = this.findView(evt.target);\n        if (this.guard(evt, view)) return;\n\n        var localPoint = this.snapToGrid({ x: evt.clientX, y: evt.clientY });\n\n        if (view) {\n\n            evt.preventDefault();\n            view.pointerdown(evt, localPoint.x, localPoint.y);\n\n        } else {\n\n            if (this.options.preventDefaultBlankAction) evt.preventDefault();\n\n            this.trigger('blank:pointerdown', evt, localPoint.x, localPoint.y);\n        }\n\n        this.delegateDragEvents(view, evt.data);\n    },\n\n    pointermove: function(evt) {\n\n        // mouse moved counter\n        var data = this.eventData(evt);\n        data.mousemoved || (data.mousemoved = 0);\n        var mousemoved = ++data.mousemoved;\n\n        if (mousemoved <= this.options.moveThreshold) return;\n\n        evt = joint.util.normalizeEvent(evt);\n\n        var localPoint = this.snapToGrid({ x: evt.clientX, y: evt.clientY });\n\n        var view = data.sourceView;\n        if (view) {\n            view.pointermove(evt, localPoint.x, localPoint.y);\n        } else {\n            this.trigger('blank:pointermove', evt, localPoint.x, localPoint.y);\n        }\n\n        this.eventData(evt, data);\n    },\n\n    pointerup: function(evt) {\n\n        this.undelegateDocumentEvents();\n\n        var normalizedEvt = joint.util.normalizeEvent(evt);\n\n        var localPoint = this.snapToGrid({ x: normalizedEvt.clientX, y: normalizedEvt.clientY });\n\n        var view = this.eventData(evt).sourceView;\n        if (view) {\n            view.pointerup(normalizedEvt, localPoint.x, localPoint.y);\n        } else {\n            this.trigger('blank:pointerup', normalizedEvt, localPoint.x, localPoint.y);\n        }\n\n        if (!normalizedEvt.isPropagationStopped()) {\n            this.pointerclick($.Event(evt, { type: 'click', data: evt.data }));\n        }\n\n        evt.stopImmediatePropagation();\n        this.delegateEvents();\n    },\n\n    mouseover: function(evt) {\n\n        evt = joint.util.normalizeEvent(evt);\n\n        var view = this.findView(evt.target);\n        if (this.guard(evt, view)) return;\n\n        if (view) {\n            view.mouseover(evt);\n\n        } else {\n            if (this.el === evt.target) return; // prevent border of paper from triggering this\n            this.trigger('blank:mouseover', evt);\n        }\n    },\n\n    mouseout: function(evt) {\n\n        evt = joint.util.normalizeEvent(evt);\n\n        var view = this.findView(evt.target);\n        if (this.guard(evt, view)) return;\n\n        if (view) {\n            view.mouseout(evt);\n\n        } else {\n            if (this.el === evt.target) return; // prevent border of paper from triggering this\n            this.trigger('blank:mouseout', evt);\n        }\n    },\n\n    mouseenter: function(evt) {\n\n        evt = joint.util.normalizeEvent(evt);\n\n        var view = this.findView(evt.target);\n        if (this.guard(evt, view)) return;\n        var relatedView = this.findView(evt.relatedTarget);\n        if (view) {\n            // mouse moved from tool over view?\n            if (relatedView === view) return;\n            view.mouseenter(evt);\n        } else {\n            if (relatedView) return;\n            // `paper` (more descriptive), not `blank`\n            this.trigger('paper:mouseenter', evt);\n        }\n    },\n\n    mouseleave: function(evt) {\n\n        evt = joint.util.normalizeEvent(evt);\n\n        var view = this.findView(evt.target);\n        if (this.guard(evt, view)) return;\n        var relatedView = this.findView(evt.relatedTarget);\n        if (view) {\n            // mouse moved from view over tool?\n            if (relatedView === view) return;\n            view.mouseleave(evt);\n        } else {\n            if (relatedView) return;\n            // `paper` (more descriptive), not `blank`\n            this.trigger('paper:mouseleave', evt);\n        }\n    },\n\n    mousewheel: function(evt) {\n\n        evt = joint.util.normalizeEvent(evt);\n\n        var view = this.findView(evt.target);\n        if (this.guard(evt, view)) return;\n\n        var originalEvent = evt.originalEvent;\n        var localPoint = this.snapToGrid({ x: originalEvent.clientX, y: originalEvent.clientY });\n        var delta = Math.max(-1, Math.min(1, (originalEvent.wheelDelta || -originalEvent.detail)));\n\n        if (view) {\n            view.mousewheel(evt, localPoint.x, localPoint.y, delta);\n\n        } else {\n            this.trigger('blank:mousewheel', evt, localPoint.x, localPoint.y, delta);\n        }\n    },\n\n    onevent: function(evt) {\n\n        var eventNode = evt.currentTarget;\n        var eventName = eventNode.getAttribute('event');\n        if (eventName) {\n            var view = this.findView(eventNode);\n            if (view) {\n\n                evt = joint.util.normalizeEvent(evt);\n                if (this.guard(evt, view)) return;\n\n                var localPoint = this.snapToGrid({ x: evt.clientX, y: evt.clientY });\n                view.onevent(evt, eventName, localPoint.x, localPoint.y);\n            }\n        }\n    },\n\n    magnetEvent: function(evt, handler) {\n\n        var magnetNode = evt.currentTarget;\n        var magnetValue = magnetNode.getAttribute('magnet');\n        if (magnetValue) {\n            var view = this.findView(magnetNode);\n            if (view) {\n                evt = joint.util.normalizeEvent(evt);\n                if (this.guard(evt, view)) return;\n                var localPoint = this.snapToGrid(evt.clientX, evt.clientY);\n                handler.call(this, view, evt, magnetNode, localPoint.x, localPoint.y);\n            }\n        }\n    },\n\n    onmagnet: function(evt) {\n\n        this.magnetEvent(evt, function(view, evt, _, x, y) {\n            view.onmagnet(evt, x, y);\n        });\n    },\n\n\n    magnetpointerdblclick: function(evt) {\n\n        this.magnetEvent(evt, function(view, evt, magnet, x, y) {\n            view.magnetpointerdblclick(evt, magnet, x, y);\n        });\n    },\n\n    magnetcontextmenu: function(evt) {\n\n        if (this.options.preventContextMenu) evt.preventDefault();\n        this.magnetEvent(evt, function(view, evt, magnet, x, y) {\n            view.magnetcontextmenu(evt, magnet, x, y);\n        });\n    },\n\n    onlabel: function(evt) {\n\n        var labelNode = evt.currentTarget;\n        var view = this.findView(labelNode);\n        if (view) {\n\n            evt = joint.util.normalizeEvent(evt);\n            if (this.guard(evt, view)) return;\n\n            var localPoint = this.snapToGrid(evt.clientX, evt.clientY);\n            view.onlabel(evt, localPoint.x, localPoint.y);\n        }\n    },\n\n    delegateDragEvents: function(view, data) {\n\n        data || (data = {});\n        this.eventData({ data: data }, { sourceView: view || null, mousemoved: 0 });\n        this.delegateDocumentEvents(null, data);\n        this.undelegateEvents();\n    },\n\n    // Guard the specified event. If the event is not interesting, guard returns `true`.\n    // Otherwise, it returns `false`.\n    guard: function(evt, view) {\n\n        if (evt.type === 'mousedown' && evt.button === 2) {\n            // handled as `contextmenu` type\n            return true;\n        }\n\n        if (this.options.guard && this.options.guard(evt, view)) {\n            return true;\n        }\n\n        if (evt.data && evt.data.guarded !== undefined) {\n            return evt.data.guarded;\n        }\n\n        if (view && view.model && (view.model instanceof joint.dia.Cell)) {\n            return false;\n        }\n\n        if (this.svg === evt.target || this.el === evt.target || $.contains(this.svg, evt.target)) {\n            return false;\n        }\n\n        return true;    // Event guarded. Paper should not react on it in any way.\n    },\n\n    setGridSize: function(gridSize) {\n\n        this.options.gridSize = gridSize;\n\n        if (this.options.drawGrid) {\n            this.drawGrid();\n        }\n\n        return this;\n    },\n\n    clearGrid: function() {\n\n        if (this.$grid) {\n            this.$grid.css('backgroundImage', 'none');\n        }\n        return this;\n    },\n\n    _getGriRefs: function() {\n\n        if (!this._gridCache) {\n\n            this._gridCache = {\n                root: V('svg', { width: '100%', height: '100%' }, V('defs')),\n                patterns: {},\n                add: function(id, vel) {\n                    V(this.root.node.childNodes[0]).append(vel);\n                    this.patterns[id] = vel;\n                    this.root.append(V('rect', { width: '100%', height: '100%', fill: 'url(#' + id + ')' }));\n                },\n                get: function(id) {\n                    return  this.patterns[id];\n                },\n                exist: function(id) {\n                    return this.patterns[id] !== undefined;\n                }\n            };\n        }\n\n        return this._gridCache;\n    },\n\n    setGrid: function(drawGrid) {\n\n        this.clearGrid();\n\n        this._gridCache = null;\n        this._gridSettings = [];\n\n        var optionsList = Array.isArray(drawGrid) ? drawGrid : [drawGrid || {}];\n        optionsList.forEach(function(item) {\n            this._gridSettings.push.apply(this._gridSettings, this._resolveDrawGridOption(item));\n        }, this);\n        return this;\n    },\n\n    _resolveDrawGridOption: function(opt) {\n\n        var namespace = this.constructor.gridPatterns;\n        if (joint.util.isString(opt) && Array.isArray(namespace[opt])) {\n            return namespace[opt].map(function(item) {\n                return joint.util.assign({}, item);\n            });\n        }\n\n        var options = opt || { args: [{}] };\n        var isArray = Array.isArray(options);\n        var name = options.name;\n\n        if (!isArray && !name && !options.markup ) {\n            name = 'dot';\n        }\n\n        if (name && Array.isArray(namespace[name])) {\n            var pattern = namespace[name].map(function(item) {\n                return joint.util.assign({}, item);\n            });\n\n            var args = Array.isArray(options.args) ? options.args : [options.args || {}];\n\n            joint.util.defaults(args[0], joint.util.omit(opt, 'args'));\n            for (var i = 0; i < args.length; i++) {\n                if (pattern[i]) {\n                    joint.util.assign(pattern[i], args[i]);\n                }\n            }\n            return pattern;\n        }\n\n        return isArray ? options : [options];\n    },\n\n    drawGrid: function(opt) {\n\n        var gridSize = this.options.gridSize;\n        if (gridSize <= 1) {\n            return this.clearGrid();\n        }\n\n        var localOptions = Array.isArray(opt) ? opt : [opt];\n\n        var ctm = this.matrix();\n        var refs = this._getGriRefs();\n\n        this._gridSettings.forEach(function(gridLayerSetting, index) {\n\n            var id = 'pattern_'  + index;\n            var options = joint.util.merge(gridLayerSetting, localOptions[index], {\n                sx: ctm.a || 1,\n                sy: ctm.d || 1,\n                ox: ctm.e || 0,\n                oy: ctm.f || 0\n            });\n\n            options.width = gridSize * (ctm.a || 1) * (options.scaleFactor || 1);\n            options.height = gridSize * (ctm.d || 1) * (options.scaleFactor || 1);\n\n            if (!refs.exist(id)) {\n                refs.add(id, V('pattern', { id: id, patternUnits: 'userSpaceOnUse' }, V(options.markup)));\n            }\n\n            var patternDefVel = refs.get(id);\n\n            if (joint.util.isFunction(options.update)) {\n                options.update(patternDefVel.node.childNodes[0], options);\n            }\n\n            var x = options.ox % options.width;\n            if (x < 0) x += options.width;\n\n            var y = options.oy % options.height;\n            if (y < 0) y += options.height;\n\n            patternDefVel.attr({\n                x: x,\n                y: y,\n                width: options.width,\n                height: options.height\n            });\n        });\n\n        var patternUri = new XMLSerializer().serializeToString(refs.root.node);\n        patternUri = 'url(data:image/svg+xml;base64,' + btoa(patternUri) + ')';\n\n        this.$grid.css('backgroundImage', patternUri);\n\n        return this;\n    },\n\n    updateBackgroundImage: function(opt) {\n\n        opt = opt || {};\n\n        var backgroundPosition = opt.position || 'center';\n        var backgroundSize = opt.size || 'auto auto';\n\n        var currentScale = this.scale();\n        var currentTranslate = this.translate();\n\n        // backgroundPosition\n        if (joint.util.isObject(backgroundPosition)) {\n            var x = currentTranslate.tx + (currentScale.sx * (backgroundPosition.x || 0));\n            var y = currentTranslate.ty + (currentScale.sy * (backgroundPosition.y || 0));\n            backgroundPosition = x + 'px ' + y + 'px';\n        }\n\n        // backgroundSize\n        if (joint.util.isObject(backgroundSize)) {\n            backgroundSize = new g.Rect(backgroundSize).scale(currentScale.sx, currentScale.sy);\n            backgroundSize = backgroundSize.width + 'px ' + backgroundSize.height + 'px';\n        }\n\n        this.$background.css({\n            backgroundSize: backgroundSize,\n            backgroundPosition: backgroundPosition\n        });\n    },\n\n    drawBackgroundImage: function(img, opt) {\n\n        // Clear the background image if no image provided\n        if (!(img instanceof HTMLImageElement)) {\n            this.$background.css('backgroundImage', '');\n            return;\n        }\n\n        opt = opt || {};\n\n        var backgroundImage;\n        var backgroundSize = opt.size;\n        var backgroundRepeat = opt.repeat || 'no-repeat';\n        var backgroundOpacity = opt.opacity || 1;\n        var backgroundQuality = Math.abs(opt.quality) || 1;\n        var backgroundPattern = this.constructor.backgroundPatterns[joint.util.camelCase(backgroundRepeat)];\n\n        if (joint.util.isFunction(backgroundPattern)) {\n            // 'flip-x', 'flip-y', 'flip-xy', 'watermark' and custom\n            img.width *= backgroundQuality;\n            img.height *= backgroundQuality;\n            var canvas = backgroundPattern(img, opt);\n            if (!(canvas instanceof HTMLCanvasElement)) {\n                throw new Error('dia.Paper: background pattern must return an HTML Canvas instance');\n            }\n\n            backgroundImage = canvas.toDataURL('image/png');\n            backgroundRepeat = 'repeat';\n            if (joint.util.isObject(backgroundSize)) {\n                // recalculate the tile size if an object passed in\n                backgroundSize.width *= canvas.width / img.width;\n                backgroundSize.height *= canvas.height / img.height;\n            } else if (backgroundSize === undefined) {\n                // calcule the tile size if no provided\n                opt.size = {\n                    width: canvas.width / backgroundQuality,\n                    height: canvas.height / backgroundQuality\n                };\n            }\n        } else {\n            // backgroundRepeat:\n            // no-repeat', 'round', 'space', 'repeat', 'repeat-x', 'repeat-y'\n            backgroundImage = img.src;\n            if (backgroundSize === undefined) {\n                // pass the image size for  the backgroundSize if no size provided\n                opt.size = {\n                    width: img.width,\n                    height: img.height\n                };\n            }\n        }\n\n        this.$background.css({\n            opacity: backgroundOpacity,\n            backgroundRepeat: backgroundRepeat,\n            backgroundImage: 'url(' + backgroundImage + ')'\n        });\n\n        this.updateBackgroundImage(opt);\n    },\n\n    updateBackgroundColor: function(color) {\n\n        this.$el.css('backgroundColor', color || '');\n    },\n\n    drawBackground: function(opt) {\n\n        opt = opt || {};\n\n        this.updateBackgroundColor(opt.color);\n\n        if (opt.image) {\n            opt = this._background = joint.util.cloneDeep(opt);\n            var img = document.createElement('img');\n            img.onload = this.drawBackgroundImage.bind(this, img, opt);\n            img.src = opt.image;\n        } else {\n            this.drawBackgroundImage(null);\n            this._background = null;\n        }\n\n        return this;\n    },\n\n    setInteractivity: function(value) {\n\n        this.options.interactive = value;\n\n        joint.util.invoke(this._views, 'setInteractivity', value);\n    },\n\n    // Paper definitions.\n    // ------------------\n\n    isDefined: function(defId) {\n\n        return !!this.svg.getElementById(defId);\n    },\n\n    defineFilter: function(filter) {\n\n        if (!joint.util.isObject(filter)) {\n            throw new TypeError('dia.Paper: defineFilter() requires 1. argument to be an object.');\n        }\n\n        var filterId = filter.id;\n        var name = filter.name;\n        // Generate a hash code from the stringified filter definition. This gives us\n        // a unique filter ID for different definitions.\n        if (!filterId) {\n            filterId = name + this.svg.id + joint.util.hashCode(JSON.stringify(filter));\n        }\n        // If the filter already exists in the document,\n        // we're done and we can just use it (reference it using `url()`).\n        // If not, create one.\n        if (!this.isDefined(filterId)) {\n\n            var namespace = joint.util.filter;\n            var filterSVGString = namespace[name] && namespace[name](filter.args || {});\n            if (!filterSVGString) {\n                throw new Error('Non-existing filter ' + name);\n            }\n\n            // Set the filter area to be 3x the bounding box of the cell\n            // and center the filter around the cell.\n            var filterAttrs = joint.util.assign({\n                filterUnits: 'objectBoundingBox',\n                x: -1,\n                y: -1,\n                width: 3,\n                height: 3\n            }, filter.attrs, {\n                id: filterId\n            });\n\n            V(filterSVGString, filterAttrs).appendTo(this.defs);\n        }\n\n        return filterId;\n    },\n\n    defineGradient: function(gradient) {\n\n        if (!joint.util.isObject(gradient)) {\n            throw new TypeError('dia.Paper: defineGradient() requires 1. argument to be an object.');\n        }\n\n        var gradientId = gradient.id;\n        var type = gradient.type;\n        var stops = gradient.stops;\n        // Generate a hash code from the stringified filter definition. This gives us\n        // a unique filter ID for different definitions.\n        if (!gradientId) {\n            gradientId = type + this.svg.id + joint.util.hashCode(JSON.stringify(gradient));\n        }\n        // If the gradient already exists in the document,\n        // we're done and we can just use it (reference it using `url()`).\n        // If not, create one.\n        if (!this.isDefined(gradientId)) {\n\n            var stopTemplate = joint.util.template('<stop offset=\"${offset}\" stop-color=\"${color}\" stop-opacity=\"${opacity}\"/>');\n            var gradientStopsStrings = joint.util.toArray(stops).map(function(stop) {\n                return stopTemplate({\n                    offset: stop.offset,\n                    color: stop.color,\n                    opacity: Number.isFinite(stop.opacity) ? stop.opacity : 1\n                });\n            });\n\n            var gradientSVGString = [\n                '<' + type + '>',\n                gradientStopsStrings.join(''),\n                '</' + type + '>'\n            ].join('');\n\n            var gradientAttrs = joint.util.assign({ id: gradientId }, gradient.attrs);\n\n            V(gradientSVGString, gradientAttrs).appendTo(this.defs);\n        }\n\n        return gradientId;\n    },\n\n    defineMarker: function(marker) {\n\n        if (!joint.util.isObject(marker)) {\n            throw new TypeError('dia.Paper: defineMarker() requires 1. argument to be an object.');\n        }\n\n        var markerId = marker.id;\n\n        // Generate a hash code from the stringified filter definition. This gives us\n        // a unique filter ID for different definitions.\n        if (!markerId) {\n            markerId = this.svg.id + joint.util.hashCode(JSON.stringify(marker));\n        }\n\n        if (!this.isDefined(markerId)) {\n\n            var attrs = joint.util.omit(marker, 'type', 'userSpaceOnUse');\n            var pathMarker = V('marker', {\n                id: markerId,\n                orient: 'auto',\n                overflow: 'visible',\n                markerUnits: marker.markerUnits || 'userSpaceOnUse'\n            }, [\n                V(marker.type || 'path', attrs)\n            ]);\n\n            pathMarker.appendTo(this.defs);\n        }\n\n        return markerId;\n    }\n}, {\n\n    backgroundPatterns: {\n\n        flipXy: function(img) {\n            // d b\n            // q p\n\n            var canvas = document.createElement('canvas');\n            var imgWidth = img.width;\n            var imgHeight = img.height;\n\n            canvas.width = 2 * imgWidth;\n            canvas.height = 2 * imgHeight;\n\n            var ctx = canvas.getContext('2d');\n            // top-left image\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n            // xy-flipped bottom-right image\n            ctx.setTransform(-1, 0, 0, -1, canvas.width, canvas.height);\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n            // x-flipped top-right image\n            ctx.setTransform(-1, 0, 0, 1, canvas.width, 0);\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n            // y-flipped bottom-left image\n            ctx.setTransform(1, 0, 0, -1, 0, canvas.height);\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n\n            return canvas;\n        },\n\n        flipX: function(img) {\n            // d b\n            // d b\n\n            var canvas = document.createElement('canvas');\n            var imgWidth = img.width;\n            var imgHeight = img.height;\n\n            canvas.width = imgWidth * 2;\n            canvas.height = imgHeight;\n\n            var ctx = canvas.getContext('2d');\n            // left image\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n            // flipped right image\n            ctx.translate(2 * imgWidth, 0);\n            ctx.scale(-1, 1);\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n\n            return canvas;\n        },\n\n        flipY: function(img) {\n            // d d\n            // q q\n\n            var canvas = document.createElement('canvas');\n            var imgWidth = img.width;\n            var imgHeight = img.height;\n\n            canvas.width = imgWidth;\n            canvas.height = imgHeight * 2;\n\n            var ctx = canvas.getContext('2d');\n            // top image\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n            // flipped bottom image\n            ctx.translate(0, 2 * imgHeight);\n            ctx.scale(1, -1);\n            ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n\n            return canvas;\n        },\n\n        watermark: function(img, opt) {\n            //   d\n            // d\n\n            opt = opt || {};\n\n            var imgWidth = img.width;\n            var imgHeight = img.height;\n\n            var canvas = document.createElement('canvas');\n            canvas.width = imgWidth * 3;\n            canvas.height = imgHeight * 3;\n\n            var ctx = canvas.getContext('2d');\n            var angle = joint.util.isNumber(opt.watermarkAngle) ? -opt.watermarkAngle : -20;\n            var radians = g.toRad(angle);\n            var stepX = canvas.width / 4;\n            var stepY = canvas.height / 4;\n\n            for (var i = 0; i < 4; i ++) {\n                for (var j = 0; j < 4; j++) {\n                    if ((i + j) % 2 > 0) {\n                        // reset the current transformations\n                        ctx.setTransform(1, 0, 0, 1, (2 * i - 1) * stepX, (2 * j - 1)  * stepY);\n                        ctx.rotate(radians);\n                        ctx.drawImage(img, -imgWidth / 2, -imgHeight / 2, imgWidth, imgHeight);\n                    }\n                }\n            }\n\n            return canvas;\n        }\n    },\n\n    gridPatterns: {\n        dot: [{\n            color: '#AAAAAA',\n            thickness: 1,\n            markup: 'rect',\n            update: function(el, opt) {\n                V(el).attr({\n                    width: opt.thickness * opt.sx,\n                    height: opt.thickness * opt.sy,\n                    fill: opt.color\n                });\n            }\n        }],\n        fixedDot: [{\n            color: '#AAAAAA',\n            thickness: 1,\n            markup: 'rect',\n            update: function(el, opt) {\n                var size = opt.sx <= 1 ? opt.thickness * opt.sx : opt.thickness;\n                V(el).attr({ width: size, height: size, fill: opt.color });\n            }\n        }],\n        mesh: [{\n            color: '#AAAAAA',\n            thickness: 1,\n            markup: 'path',\n            update: function(el, opt) {\n\n                var d;\n                var width = opt.width;\n                var height = opt.height;\n                var thickness = opt.thickness;\n\n                if (width - thickness >= 0 && height - thickness >= 0) {\n                    d = ['M', width, 0, 'H0 M0 0 V0', height].join(' ');\n                } else {\n                    d = 'M 0 0 0 0';\n                }\n\n                V(el).attr({ 'd': d, stroke: opt.color, 'stroke-width': opt.thickness });\n            }\n        }],\n        doubleMesh: [{\n            color: '#AAAAAA',\n            thickness: 1,\n            markup: 'path',\n            update: function(el, opt) {\n\n                var d;\n                var width = opt.width;\n                var height = opt.height;\n                var thickness = opt.thickness;\n\n                if (width - thickness >= 0 && height - thickness >= 0) {\n                    d = ['M', width, 0, 'H0 M0 0 V0', height].join(' ');\n                } else {\n                    d = 'M 0 0 0 0';\n                }\n\n                V(el).attr({ 'd': d, stroke: opt.color, 'stroke-width': opt.thickness });\n            }\n        }, {\n            color: '#000000',\n            thickness: 3,\n            scaleFactor: 4,\n            markup: 'path',\n            update: function(el, opt) {\n\n                var d;\n                var width = opt.width;\n                var height = opt.height;\n                var thickness = opt.thickness;\n\n                if (width - thickness >= 0 && height - thickness >= 0) {\n                    d = ['M', width, 0, 'H0 M0 0 V0', height].join(' ');\n                } else {\n                    d = 'M 0 0 0 0';\n                }\n\n                V(el).attr({ 'd': d, stroke: opt.color, 'stroke-width': opt.thickness });\n            }\n        }]\n    }\n});\n\n(function(joint, util) {\n\n    var PortData = function(data) {\n\n        var clonedData = util.cloneDeep(data) || {};\n        this.ports = [];\n        this.groups = {};\n        this.portLayoutNamespace = joint.layout.Port;\n        this.portLabelLayoutNamespace = joint.layout.PortLabel;\n\n        this._init(clonedData);\n    };\n\n    PortData.prototype = {\n\n        getPorts: function() {\n            return this.ports;\n        },\n\n        getGroup: function(name) {\n            return this.groups[name] || {};\n        },\n\n        getPortsByGroup: function(groupName) {\n\n            return this.ports.filter(function(port) {\n                return port.group === groupName;\n            });\n        },\n\n        getGroupPortsMetrics: function(groupName, elBBox) {\n\n            var group = this.getGroup(groupName);\n            var ports = this.getPortsByGroup(groupName);\n\n            var groupPosition = group.position || {};\n            var groupPositionName = groupPosition.name;\n            var namespace = this.portLayoutNamespace;\n            if (!namespace[groupPositionName]) {\n                groupPositionName = 'left';\n            }\n\n            var groupArgs = groupPosition.args || {};\n            var portsArgs = ports.map(function(port) {\n                return port && port.position && port.position.args;\n            });\n            var groupPortTransformations = namespace[groupPositionName](portsArgs, elBBox, groupArgs);\n\n            var accumulator = {\n                ports: ports,\n                result: []\n            };\n\n            util.toArray(groupPortTransformations).reduce(function(res, portTransformation, index) {\n                var port = res.ports[index];\n                res.result.push({\n                    portId: port.id,\n                    portTransformation: portTransformation,\n                    labelTransformation: this._getPortLabelLayout(port, g.Point(portTransformation), elBBox),\n                    portAttrs: port.attrs,\n                    portSize: port.size,\n                    labelSize: port.label.size\n                });\n                return res;\n            }.bind(this), accumulator);\n\n            return accumulator.result;\n        },\n\n        _getPortLabelLayout: function(port, portPosition, elBBox) {\n\n            var namespace = this.portLabelLayoutNamespace;\n            var labelPosition = port.label.position.name || 'left';\n\n            if (namespace[labelPosition]) {\n                return namespace[labelPosition](portPosition, elBBox, port.label.position.args);\n            }\n\n            return null;\n        },\n\n        _init: function(data) {\n\n            // prepare groups\n            if (util.isObject(data.groups)) {\n                var groups = Object.keys(data.groups);\n                for (var i = 0, n = groups.length; i < n; i++) {\n                    var key = groups[i];\n                    this.groups[key] = this._evaluateGroup(data.groups[key]);\n                }\n            }\n\n            // prepare ports\n            var ports = util.toArray(data.items);\n            for (var j = 0, m = ports.length; j < m; j++) {\n                this.ports.push(this._evaluatePort(ports[j]));\n            }\n        },\n\n        _evaluateGroup: function(group) {\n\n            return util.merge(group, {\n                position: this._getPosition(group.position, true),\n                label: this._getLabel(group, true)\n            });\n        },\n\n        _evaluatePort: function(port) {\n\n            var evaluated = util.assign({}, port);\n\n            var group = this.getGroup(port.group);\n\n            evaluated.markup = evaluated.markup || group.markup;\n            evaluated.attrs = util.merge({}, group.attrs, evaluated.attrs);\n            evaluated.position = this._createPositionNode(group, evaluated);\n            evaluated.label = util.merge({}, group.label, this._getLabel(evaluated));\n            evaluated.z = this._getZIndex(group, evaluated);\n            evaluated.size = util.assign({}, group.size, evaluated.size);\n\n            return evaluated;\n        },\n\n        _getZIndex: function(group, port) {\n\n            if (util.isNumber(port.z)) {\n                return port.z;\n            }\n            if (util.isNumber(group.z) || group.z === 'auto') {\n                return group.z;\n            }\n            return 'auto';\n        },\n\n        _createPositionNode: function(group, port) {\n\n            return util.merge({\n                name: 'left',\n                args: {}\n            }, group.position, { args: port.args });\n        },\n\n        _getPosition: function(position, setDefault) {\n\n            var args = {};\n            var positionName;\n\n            if (util.isFunction(position)) {\n                positionName = 'fn';\n                args.fn = position;\n            } else if (util.isString(position)) {\n                positionName = position;\n            } else if (position === undefined) {\n                positionName = setDefault ? 'left' : null;\n            } else if (Array.isArray(position)) {\n                positionName = 'absolute';\n                args.x = position[0];\n                args.y = position[1];\n            } else if (util.isObject(position)) {\n                positionName = position.name;\n                util.assign(args, position.args);\n            }\n\n            var result = { args: args };\n\n            if (positionName) {\n                result.name = positionName;\n            }\n            return result;\n        },\n\n        _getLabel: function(item, setDefaults) {\n\n            var label = item.label || {};\n\n            var ret = label;\n            ret.position = this._getPosition(label.position, setDefaults);\n\n            return ret;\n        }\n    };\n\n    util.assign(joint.dia.Element.prototype, {\n\n        _initializePorts: function() {\n\n            this._createPortData();\n            this.on('change:ports', function() {\n\n                this._processRemovedPort();\n                this._createPortData();\n            }, this);\n        },\n\n        /**\n         * remove links tied wiht just removed element\n         * @private\n         */\n        _processRemovedPort: function() {\n\n            var current = this.get('ports') || {};\n            var currentItemsMap = {};\n\n            util.toArray(current.items).forEach(function(item) {\n                currentItemsMap[item.id] = true;\n            });\n\n            var previous = this.previous('ports') || {};\n            var removed = {};\n\n            util.toArray(previous.items).forEach(function(item) {\n                if (!currentItemsMap[item.id]) {\n                    removed[item.id] = true;\n                }\n            });\n\n            var graph = this.graph;\n            if (graph && !util.isEmpty(removed)) {\n\n                var inboundLinks = graph.getConnectedLinks(this, { inbound: true });\n                inboundLinks.forEach(function(link) {\n\n                    if (removed[link.get('target').port]) link.remove();\n                });\n\n                var outboundLinks = graph.getConnectedLinks(this, { outbound: true });\n                outboundLinks.forEach(function(link) {\n\n                    if (removed[link.get('source').port]) link.remove();\n                });\n            }\n        },\n\n        /**\n         * @returns {boolean}\n         */\n        hasPorts: function() {\n\n            var ports = this.prop('ports/items');\n            return Array.isArray(ports) && ports.length > 0;\n        },\n\n        /**\n         * @param {string} id\n         * @returns {boolean}\n         */\n        hasPort: function(id) {\n\n            return this.getPortIndex(id) !== -1;\n        },\n\n        /**\n         * @returns {Array<object>}\n         */\n        getPorts: function() {\n\n            return util.cloneDeep(this.prop('ports/items')) || [];\n        },\n\n        /**\n         * @param {string} id\n         * @returns {object}\n         */\n        getPort: function(id) {\n\n            return util.cloneDeep(util.toArray(this.prop('ports/items')).find(function(port) {\n                return port.id && port.id === id;\n            }));\n        },\n\n        /**\n         * @param {string} groupName\n         * @returns {Object<portId, {x: number, y: number, angle: number}>}\n         */\n        getPortsPositions: function(groupName) {\n\n            var portsMetrics = this._portSettingsData.getGroupPortsMetrics(groupName, g.Rect(this.size()));\n\n            return portsMetrics.reduce(function(positions, metrics) {\n                var transformation = metrics.portTransformation;\n                positions[metrics.portId] = {\n                    x: transformation.x,\n                    y: transformation.y,\n                    angle: transformation.angle\n                };\n                return positions;\n            }, {});\n        },\n\n        /**\n         * @param {string|Port} port port id or port\n         * @returns {number} port index\n         */\n        getPortIndex: function(port) {\n\n            var id = util.isObject(port) ? port.id : port;\n\n            if (!this._isValidPortId(id)) {\n                return -1;\n            }\n\n            return util.toArray(this.prop('ports/items')).findIndex(function(item) {\n                return item.id === id;\n            });\n        },\n\n        /**\n         * @param {object} port\n         * @param {object} [opt]\n         * @returns {joint.dia.Element}\n         */\n        addPort: function(port, opt) {\n\n            if (!util.isObject(port) || Array.isArray(port)) {\n                throw new Error('Element: addPort requires an object.');\n            }\n\n            var ports = util.assign([], this.prop('ports/items'));\n            ports.push(port);\n            this.prop('ports/items', ports, opt);\n\n            return this;\n        },\n\n        /**\n         * @param {string} portId\n         * @param {string|object=} path\n         * @param {*=} value\n         * @param {object=} opt\n         * @returns {joint.dia.Element}\n         */\n        portProp: function(portId, path, value, opt) {\n\n            var index = this.getPortIndex(portId);\n\n            if (index === -1) {\n                throw new Error('Element: unable to find port with id ' + portId);\n            }\n\n            var args = Array.prototype.slice.call(arguments, 1);\n            if (Array.isArray(path)) {\n                args[0] = ['ports', 'items', index].concat(path);\n            } else if (util.isString(path)) {\n\n                // Get/set an attribute by a special path syntax that delimits\n                // nested objects by the colon character.\n                args[0] = ['ports/items/', index, '/', path].join('');\n\n            } else {\n\n                args = ['ports/items/' + index];\n                if (util.isPlainObject(path)) {\n                    args.push(path);\n                    args.push(value);\n                }\n            }\n\n            return this.prop.apply(this, args);\n        },\n\n        _validatePorts: function() {\n\n            var portsAttr = this.get('ports') || {};\n\n            var errorMessages = [];\n            portsAttr = portsAttr || {};\n            var ports = util.toArray(portsAttr.items);\n\n            ports.forEach(function(p) {\n\n                if (typeof p !== 'object') {\n                    errorMessages.push('Element: invalid port ', p);\n                }\n\n                if (!this._isValidPortId(p.id)) {\n                    p.id = util.uuid();\n                }\n            }, this);\n\n            if (joint.util.uniq(ports, 'id').length !== ports.length) {\n                errorMessages.push('Element: found id duplicities in ports.');\n            }\n\n            return errorMessages;\n        },\n\n        /**\n         * @param {string} id port id\n         * @returns {boolean}\n         * @private\n         */\n        _isValidPortId: function(id) {\n\n            return id !== null && id !== undefined && !util.isObject(id);\n        },\n\n        addPorts: function(ports, opt) {\n\n            if (ports.length) {\n                this.prop('ports/items', util.assign([], this.prop('ports/items')).concat(ports), opt);\n            }\n\n            return this;\n        },\n\n        removePort: function(port, opt) {\n\n            var options = opt || {};\n            var ports = util.assign([], this.prop('ports/items'));\n\n            var index = this.getPortIndex(port);\n\n            if (index !== -1) {\n                ports.splice(index, 1);\n                options.rewrite = true;\n                this.prop('ports/items', ports, options);\n            }\n\n            return this;\n        },\n\n        removePorts: function(portsForRemoval, opt) {\n\n            var options;\n\n            if (Array.isArray(portsForRemoval)) {\n                options = opt || {};\n\n                if (portsForRemoval.length) {\n                    options.rewrite = true;\n                    var currentPorts = util.assign([], this.prop('ports/items'));\n                    var remainingPorts = currentPorts.filter(function(cp) {\n                        return !portsForRemoval.some(function(rp) {\n                            var rpId = util.isObject(rp) ? rp.id : rp;\n                            return cp.id === rpId;\n                        });\n                    });\n                    this.prop('ports/items', remainingPorts, options);\n                }\n            } else {\n                options = portsForRemoval || {};\n                options.rewrite = true;\n                this.prop('ports/items', [], options);\n            }\n\n            return this;\n        },\n\n        /**\n         * @private\n         */\n        _createPortData: function() {\n\n            var err = this._validatePorts();\n\n            if (err.length > 0) {\n                this.set('ports', this.previous('ports'));\n                throw new Error(err.join(' '));\n            }\n\n            var prevPortData;\n\n            if (this._portSettingsData) {\n\n                prevPortData = this._portSettingsData.getPorts();\n            }\n\n            this._portSettingsData = new PortData(this.get('ports'));\n\n            var curPortData = this._portSettingsData.getPorts();\n\n            if (prevPortData) {\n\n                var added = curPortData.filter(function(item) {\n                    if (!prevPortData.find(function(prevPort) { return prevPort.id === item.id;})) {\n                        return item;\n                    }\n                });\n\n                var removed = prevPortData.filter(function(item) {\n                    if (!curPortData.find(function(curPort) { return curPort.id === item.id;})) {\n                        return item;\n                    }\n                });\n\n                if (removed.length > 0) {\n                    this.trigger('ports:remove', this, removed);\n                }\n\n                if (added.length > 0) {\n                    this.trigger('ports:add', this, added);\n                }\n            }\n        }\n    });\n\n    util.assign(joint.dia.ElementView.prototype, {\n\n        portContainerMarkup: 'g',\n        portMarkup: [{\n            tagName: 'circle',\n            selector: 'circle',\n            attributes: {\n                'r': 10,\n                'fill': '#FFFFFF',\n                'stroke': '#000000'\n            }\n        }],\n        portLabelMarkup: [{\n            tagName: 'text',\n            selector: 'text',\n            attributes: {\n                'fill': '#000000'\n            }\n        }],\n        /** @type {Object<string, {portElement: Vectorizer, portLabelElement: Vectorizer}>} */\n        _portElementsCache: null,\n\n        /**\n         * @private\n         */\n        _initializePorts: function() {\n\n            this._portElementsCache = {};\n\n            this.listenTo(this.model, 'change:ports', function() {\n\n                this._refreshPorts();\n            });\n        },\n\n        /**\n         * @typedef {Object} Port\n         *\n         * @property {string} id\n         * @property {Object} position\n         * @property {Object} label\n         * @property {Object} attrs\n         * @property {string} markup\n         * @property {string} group\n         */\n\n        /**\n         * @private\n         */\n        _refreshPorts: function() {\n\n            this._removePorts();\n            this._portElementsCache = {};\n\n            this._renderPorts();\n        },\n\n        /**\n         * @private\n         */\n        _renderPorts: function() {\n\n            // references to rendered elements without z-index\n            var elementReferences = [];\n            var elem = this._getContainerElement();\n\n            for (var i = 0, count = elem.node.childNodes.length; i < count; i++) {\n                elementReferences.push(elem.node.childNodes[i]);\n            }\n\n            var portsGropsByZ = util.groupBy(this.model._portSettingsData.getPorts(), 'z');\n            var withoutZKey = 'auto';\n\n            // render non-z first\n            util.toArray(portsGropsByZ[withoutZKey]).forEach(function(port) {\n                var portElement = this._getPortElement(port);\n                elem.append(portElement);\n                elementReferences.push(portElement);\n            }, this);\n\n            var groupNames = Object.keys(portsGropsByZ);\n            for (var k = 0; k < groupNames.length; k++) {\n                var groupName = groupNames[k];\n                if (groupName !== withoutZKey) {\n                    var z = parseInt(groupName, 10);\n                    this._appendPorts(portsGropsByZ[groupName], z, elementReferences);\n                }\n            }\n\n            this._updatePorts();\n        },\n\n        /**\n         * @returns {V}\n         * @private\n         */\n        _getContainerElement: function() {\n\n            return this.rotatableNode || this.vel;\n        },\n\n        /**\n         * @param {Array<Port>}ports\n         * @param {number} z\n         * @param refs\n         * @private\n         */\n        _appendPorts: function(ports, z, refs) {\n\n            var containerElement = this._getContainerElement();\n            var portElements = util.toArray(ports).map(this._getPortElement, this);\n\n            if (refs[z] || z < 0) {\n                V(refs[Math.max(z, 0)]).before(portElements);\n            } else {\n                containerElement.append(portElements);\n            }\n        },\n\n        /**\n         * Try to get element from cache,\n         * @param port\n         * @returns {*}\n         * @private\n         */\n        _getPortElement: function(port) {\n\n            if (this._portElementsCache[port.id]) {\n                return this._portElementsCache[port.id].portElement;\n            }\n            return this._createPortElement(port);\n        },\n\n        findPortNode: function(portId, selector) {\n            var portCache = this._portElementsCache[portId];\n            if (!portCache) return null;\n            var portRoot = portCache.portContentElement.node;\n            var portSelectors = portCache.portContentSelectors;\n            return this.findBySelector(selector, portRoot, portSelectors)[0];\n        },\n\n        /**\n         * @private\n         */\n        _updatePorts: function() {\n\n            // layout ports without group\n            this._updatePortGroup(undefined);\n            // layout ports with explicit group\n            var groupsNames = Object.keys(this.model._portSettingsData.groups);\n            groupsNames.forEach(this._updatePortGroup, this);\n        },\n\n        /**\n         * @private\n         */\n        _removePorts: function() {\n            util.invoke(this._portElementsCache, 'portElement.remove');\n        },\n\n        /**\n         * @param {Port} port\n         * @returns {V}\n         * @private\n         */\n        _createPortElement: function(port) {\n\n            var portElement;\n            var labelElement;\n\n            var portContainerElement = V(this.portContainerMarkup).addClass('joint-port');\n\n            var portMarkup = this._getPortMarkup(port);\n            var portSelectors;\n            if (Array.isArray(portMarkup)) {\n                var portDoc = this.parseDOMJSON(portMarkup, portContainerElement.node);\n                var portFragment = portDoc.fragment;\n                if (portFragment.childNodes.length > 1) {\n                    portElement = V('g').append(portFragment);\n                } else {\n                    portElement = V(portFragment.firstChild);\n                }\n                portSelectors = portDoc.selectors;\n            } else {\n                portElement = V(portMarkup);\n                if (Array.isArray(portElement)) {\n                    portElement = V('g').append(portElement);\n                }\n            }\n\n            if (!portElement) {\n                throw new Error('ElementView: Invalid port markup.');\n            }\n\n            portElement.attr({\n                'port': port.id,\n                'port-group': port.group\n            });\n\n            var labelMarkup = this._getPortLabelMarkup(port.label);\n            var labelSelectors;\n            if (Array.isArray(labelMarkup)) {\n                var labelDoc = this.parseDOMJSON(labelMarkup, portContainerElement.node);\n                var labelFragment = labelDoc.fragment;\n                if (labelFragment.childNodes.length > 1) {\n                    labelElement = V('g').append(labelFragment);\n                } else {\n                    labelElement = V(labelFragment.firstChild);\n                }\n                labelSelectors = labelDoc.selectors;\n            } else {\n                labelElement = V(labelMarkup);\n                if (Array.isArray(labelElement)) {\n                    labelElement = V('g').append(labelElement);\n                }\n            }\n\n            if (!labelElement) {\n                throw new Error('ElementView: Invalid port label markup.');\n            }\n\n            var portContainerSelectors;\n            if (portSelectors && labelSelectors) {\n                for (var key in labelSelectors) {\n                    if (portSelectors[key] && key !== this.selector) throw new Error('ElementView: selectors within port must be unique.');\n                }\n                portContainerSelectors = util.assign({}, portSelectors, labelSelectors);\n            } else {\n                portContainerSelectors = portSelectors || labelSelectors;\n            }\n\n            portContainerElement.append([\n                portElement.addClass('joint-port-body'),\n                labelElement.addClass('joint-port-label')\n            ]);\n\n            this._portElementsCache[port.id] = {\n                portElement: portContainerElement,\n                portLabelElement: labelElement,\n                portSelectors: portContainerSelectors,\n                portLabelSelectors: labelSelectors,\n                portContentElement: portElement,\n                portContentSelectors: portSelectors\n            };\n\n            return portContainerElement;\n        },\n\n        /**\n         * @param {string=} groupName\n         * @private\n         */\n        _updatePortGroup: function(groupName) {\n\n            var elementBBox = g.Rect(this.model.size());\n            var portsMetrics = this.model._portSettingsData.getGroupPortsMetrics(groupName, elementBBox);\n\n            for (var i = 0, n = portsMetrics.length; i < n; i++) {\n                var metrics = portsMetrics[i];\n                var portId = metrics.portId;\n                var cached = this._portElementsCache[portId] || {};\n                var portTransformation = metrics.portTransformation;\n                this.applyPortTransform(cached.portElement, portTransformation);\n                this.updateDOMSubtreeAttributes(cached.portElement.node, metrics.portAttrs, {\n                    rootBBox: new g.Rect(metrics.portSize),\n                    selectors: cached.portSelectors\n                });\n\n                var labelTransformation = metrics.labelTransformation;\n                if (labelTransformation) {\n                    this.applyPortTransform(cached.portLabelElement, labelTransformation, (-portTransformation.angle || 0));\n                    this.updateDOMSubtreeAttributes(cached.portLabelElement.node, labelTransformation.attrs, {\n                        rootBBox: new g.Rect(metrics.labelSize),\n                        selectors: cached.portLabelSelectors\n                    });\n                }\n            }\n        },\n\n        /**\n         * @param {Vectorizer} element\n         * @param {{dx:number, dy:number, angle: number, attrs: Object, x:number: y:number}} transformData\n         * @param {number=} initialAngle\n         * @constructor\n         */\n        applyPortTransform: function(element, transformData, initialAngle) {\n\n            var matrix = V.createSVGMatrix()\n                .rotate(initialAngle || 0)\n                .translate(transformData.x || 0, transformData.y || 0)\n                .rotate(transformData.angle || 0);\n\n            element.transform(matrix, { absolute: true });\n        },\n\n        /**\n         * @param {Port} port\n         * @returns {string}\n         * @private\n         */\n        _getPortMarkup: function(port) {\n\n            return port.markup || this.model.get('portMarkup') || this.model.portMarkup || this.portMarkup;\n        },\n\n        /**\n         * @param {Object} label\n         * @returns {string}\n         * @private\n         */\n        _getPortLabelMarkup: function(label) {\n\n            return label.markup || this.model.get('portLabelMarkup') || this.model.portLabelMarkup || this.portLabelMarkup;\n        }\n\n    });\n}(joint, joint.util));\n\njoint.dia.Element.define('basic.Generic', {\n    attrs: {\n        '.': { fill: '#ffffff', stroke: 'none' }\n    }\n});\n\njoint.shapes.basic.Generic.define('basic.Rect', {\n    attrs: {\n        'rect': {\n            fill: '#ffffff',\n            stroke: '#000000',\n            width: 100,\n            height: 60\n        },\n        'text': {\n            fill: '#000000',\n            text: '',\n            'font-size': 14,\n            'ref-x': .5,\n            'ref-y': .5,\n            'text-anchor': 'middle',\n            'y-alignment': 'middle',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><rect/></g><text/></g>'\n});\n\njoint.shapes.basic.TextView = joint.dia.ElementView.extend({\n\n    initialize: function() {\n        joint.dia.ElementView.prototype.initialize.apply(this, arguments);\n        // The element view is not automatically rescaled to fit the model size\n        // when the attribute 'attrs' is changed.\n        this.listenTo(this.model, 'change:attrs', this.resize);\n    }\n});\n\njoint.shapes.basic.Generic.define('basic.Text', {\n    attrs: {\n        'text': {\n            'font-size': 18,\n            fill: '#000000'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><text/></g></g>',\n});\n\njoint.shapes.basic.Generic.define('basic.Circle', {\n    size: { width: 60, height: 60 },\n    attrs: {\n        'circle': {\n            fill: '#ffffff',\n            stroke: '#000000',\n            r: 30,\n            cx: 30,\n            cy: 30\n        },\n        'text': {\n            'font-size': 14,\n            text: '',\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-y': .5,\n            'y-alignment': 'middle',\n            fill: '#000000',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><circle/></g><text/></g>',\n});\n\njoint.shapes.basic.Generic.define('basic.Ellipse', {\n    size: { width: 60, height: 40 },\n    attrs: {\n        'ellipse': {\n            fill: '#ffffff',\n            stroke: '#000000',\n            rx: 30,\n            ry: 20,\n            cx: 30,\n            cy: 20\n        },\n        'text': {\n            'font-size': 14,\n            text: '',\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-y': .5,\n            'y-alignment': 'middle',\n            fill: '#000000',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><ellipse/></g><text/></g>',\n});\n\njoint.shapes.basic.Generic.define('basic.Polygon', {\n    size: { width: 60, height: 40 },\n    attrs: {\n        'polygon': {\n            fill: '#ffffff',\n            stroke: '#000000'\n        },\n        'text': {\n            'font-size': 14,\n            text: '',\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-dy': 20,\n            'y-alignment': 'middle',\n            fill: '#000000',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><polygon/></g><text/></g>',\n});\n\njoint.shapes.basic.Generic.define('basic.Polyline', {\n    size: { width: 60, height: 40 },\n    attrs: {\n        'polyline': {\n            fill: '#ffffff',\n            stroke: '#000000'\n        },\n        'text': {\n            'font-size': 14,\n            text: '',\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-dy': 20,\n            'y-alignment': 'middle',\n            fill: '#000000',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><polyline/></g><text/></g>',\n});\n\njoint.shapes.basic.Generic.define('basic.Image', {\n    attrs: {\n        'text': {\n            'font-size': 14,\n            text: '',\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-dy': 20,\n            'y-alignment': 'middle',\n            fill: '#000000',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><image/></g><text/></g>',\n});\n\njoint.shapes.basic.Generic.define('basic.Path', {\n    size: { width: 60, height: 60 },\n    attrs: {\n        'path': {\n            fill: '#ffffff',\n            stroke: '#000000'\n        },\n        'text': {\n            'font-size': 14,\n            text: '',\n            'text-anchor': 'middle',\n            'ref': 'path',\n            'ref-x': .5,\n            'ref-dy': 10,\n            fill: '#000000',\n            'font-family': 'Arial, helvetica, sans-serif'\n        }\n    }\n\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><path/></g><text/></g>',\n});\n\njoint.shapes.basic.Path.define('basic.Rhombus', {\n    attrs: {\n        'path': {\n            d: 'M 30 0 L 60 30 30 60 0 30 z'\n        },\n        'text': {\n            'ref-y': .5,\n            'ref-dy': null,\n            'y-alignment': 'middle'\n        }\n    }\n});\n\n\n/**\n * @deprecated use the port api instead\n */\n// PortsModelInterface is a common interface for shapes that have ports. This interface makes it easy\n// to create new shapes with ports functionality. It is assumed that the new shapes have\n// `inPorts` and `outPorts` array properties. Only these properties should be used to set ports.\n// In other words, using this interface, it is no longer recommended to set ports directly through the\n// `attrs` object.\n\n// Usage:\n// joint.shapes.custom.MyElementWithPorts = joint.shapes.basic.Path.extend(_.extend({}, joint.shapes.basic.PortsModelInterface, {\n//     getPortAttrs: function(portName, index, total, selector, type) {\n//         var attrs = {};\n//         var portClass = 'port' + index;\n//         var portSelector = selector + '>.' + portClass;\n//         var portTextSelector = portSelector + '>text';\n//         var portBodySelector = portSelector + '>.port-body';\n//\n//         attrs[portTextSelector] = { text: portName };\n//         attrs[portBodySelector] = { port: { id: portName || _.uniqueId(type) , type: type } };\n//         attrs[portSelector] = { ref: 'rect', 'ref-y': (index + 0.5) * (1 / total) };\n//\n//         if (selector === '.outPorts') { attrs[portSelector]['ref-dx'] = 0; }\n//\n//         return attrs;\n//     }\n//}));\njoint.shapes.basic.PortsModelInterface = {\n\n    initialize: function() {\n\n        this.updatePortsAttrs();\n        this.on('change:inPorts change:outPorts', this.updatePortsAttrs, this);\n\n        // Call the `initialize()` of the parent.\n        this.constructor.__super__.constructor.__super__.initialize.apply(this, arguments);\n    },\n\n    updatePortsAttrs: function(eventName) {\n\n        if (this._portSelectors) {\n\n            var newAttrs = joint.util.omit(this.get('attrs'), this._portSelectors);\n            this.set('attrs', newAttrs, { silent: true });\n        }\n\n        // This holds keys to the `attrs` object for all the port specific attribute that\n        // we set in this method. This is necessary in order to remove previously set\n        // attributes for previous ports.\n        this._portSelectors = [];\n\n        var attrs = {};\n\n        joint.util.toArray(this.get('inPorts')).forEach(function(portName, index, ports) {\n            var portAttributes = this.getPortAttrs(portName, index, ports.length, '.inPorts', 'in');\n            this._portSelectors = this._portSelectors.concat(Object.keys(portAttributes));\n            joint.util.assign(attrs, portAttributes);\n        }, this);\n\n        joint.util.toArray(this.get('outPorts')).forEach(function(portName, index, ports) {\n            var portAttributes = this.getPortAttrs(portName, index, ports.length, '.outPorts', 'out');\n            this._portSelectors = this._portSelectors.concat(Object.keys(portAttributes));\n            joint.util.assign(attrs, portAttributes);\n        }, this);\n\n        // Silently set `attrs` on the cell so that noone knows the attrs have changed. This makes sure\n        // that, for example, command manager does not register `change:attrs` command but only\n        // the important `change:inPorts`/`change:outPorts` command.\n        this.attr(attrs, { silent: true });\n        // Manually call the `processPorts()` method that is normally called on `change:attrs` (that we just made silent).\n        this.processPorts();\n        // Let the outside world (mainly the `ModelView`) know that we're done configuring the `attrs` object.\n        this.trigger('process:ports');\n    },\n\n    getPortSelector: function(name) {\n\n        var selector = '.inPorts';\n        var index = this.get('inPorts').indexOf(name);\n\n        if (index < 0) {\n            selector = '.outPorts';\n            index = this.get('outPorts').indexOf(name);\n\n            if (index < 0) throw new Error('getPortSelector(): Port doesn\\'t exist.');\n        }\n\n        return selector + '>g:nth-child(' + (index + 1) + ')>.port-body';\n    }\n};\n\njoint.shapes.basic.PortsViewInterface = {\n\n    initialize: function() {\n\n        // `Model` emits the `process:ports` whenever it's done configuring the `attrs` object for ports.\n        this.listenTo(this.model, 'process:ports', this.update);\n\n        joint.dia.ElementView.prototype.initialize.apply(this, arguments);\n    },\n\n    update: function() {\n\n        // First render ports so that `attrs` can be applied to those newly created DOM elements\n        // in `ElementView.prototype.update()`.\n        this.renderPorts();\n        joint.dia.ElementView.prototype.update.apply(this, arguments);\n    },\n\n    renderPorts: function() {\n\n        var $inPorts = this.$('.inPorts').empty();\n        var $outPorts = this.$('.outPorts').empty();\n\n        var portTemplate = joint.util.template(this.model.portMarkup);\n\n        var ports = joint.util.toArray(this.model.ports);\n        ports.filter(function(p) {\n            return p.type === 'in';\n        }).forEach(function(port, index) {\n\n            $inPorts.append(V(portTemplate({ id: index, port: port })).node);\n        });\n\n        ports.filter(function(p) {\n            return p.type === 'out';\n        }).forEach(function(port, index) {\n\n            $outPorts.append(V(portTemplate({ id: index, port: port })).node);\n        });\n    }\n};\n\njoint.shapes.basic.Generic.define('basic.TextBlock', {\n    // see joint.css for more element styles\n    attrs: {\n        rect: {\n            fill: '#ffffff',\n            stroke: '#000000',\n            width: 80,\n            height: 100\n        },\n        text: {\n            fill: '#000000',\n            'font-size': 14,\n            'font-family': 'Arial, helvetica, sans-serif'\n        },\n        '.content': {\n            text: '',\n            'ref-x': .5,\n            'ref-y': .5,\n            'y-alignment': 'middle',\n            'x-alignment': 'middle'\n        }\n    },\n\n    content: ''\n}, {\n    markup: [\n        '<g class=\"rotatable\">',\n        '<g class=\"scalable\"><rect/></g>',\n        joint.env.test('svgforeignobject') ? '<foreignObject class=\"fobj\"><body xmlns=\"http://www.w3.org/1999/xhtml\"><div class=\"content\"/></body></foreignObject>' : '<text class=\"content\"/>',\n        '</g>'\n    ].join(''),\n\n    initialize: function() {\n\n        this.listenTo(this, 'change:size', this.updateSize);\n        this.listenTo(this, 'change:content', this.updateContent);\n        this.updateSize(this, this.get('size'));\n        this.updateContent(this, this.get('content'));\n        joint.shapes.basic.Generic.prototype.initialize.apply(this, arguments);\n    },\n\n    updateSize: function(cell, size) {\n\n        // Selector `foreignObject' doesn't work across all browsers, we're using class selector instead.\n        // We have to clone size as we don't want attributes.div.style to be same object as attributes.size.\n        this.attr({\n            '.fobj': joint.util.assign({}, size),\n            div: {\n                style: joint.util.assign({}, size)\n            }\n        });\n    },\n\n    updateContent: function(cell, content) {\n\n        if (joint.env.test('svgforeignobject')) {\n\n            // Content element is a <div> element.\n            this.attr({\n                '.content': {\n                    html: joint.util.sanitizeHTML(content)\n                }\n            });\n\n        } else {\n\n            // Content element is a <text> element.\n            // SVG elements don't have innerHTML attribute.\n            this.attr({\n                '.content': {\n                    text: content\n                }\n            });\n        }\n    },\n\n    // Here for backwards compatibility:\n    setForeignObjectSize: function() {\n\n        this.updateSize.apply(this, arguments);\n    },\n\n    // Here for backwards compatibility:\n    setDivContent: function() {\n\n        this.updateContent.apply(this, arguments);\n    }\n});\n\n// TextBlockView implements the fallback for IE when no foreignObject exists and\n// the text needs to be manually broken.\njoint.shapes.basic.TextBlockView = joint.dia.ElementView.extend({\n\n    initialize: function() {\n\n        joint.dia.ElementView.prototype.initialize.apply(this, arguments);\n\n        // Keep this for backwards compatibility:\n        this.noSVGForeignObjectElement = !joint.env.test('svgforeignobject');\n\n        if (!joint.env.test('svgforeignobject')) {\n\n            this.listenTo(this.model, 'change:content change:size', function(cell) {\n                // avoiding pass of extra paramters\n                this.updateContent(cell);\n            });\n        }\n    },\n\n    update: function(cell, renderingOnlyAttrs) {\n\n        var model = this.model;\n\n        if (!joint.env.test('svgforeignobject')) {\n\n            // Update everything but the content first.\n            var noTextAttrs = joint.util.omit(renderingOnlyAttrs || model.get('attrs'), '.content');\n            joint.dia.ElementView.prototype.update.call(this, model, noTextAttrs);\n\n            if (!renderingOnlyAttrs || joint.util.has(renderingOnlyAttrs, '.content')) {\n                // Update the content itself.\n                this.updateContent(model, renderingOnlyAttrs);\n            }\n\n        } else {\n\n            joint.dia.ElementView.prototype.update.call(this, model, renderingOnlyAttrs);\n        }\n    },\n\n    updateContent: function(cell, renderingOnlyAttrs) {\n\n        // Create copy of the text attributes\n        var textAttrs = joint.util.merge({}, (renderingOnlyAttrs || cell.get('attrs'))['.content']);\n\n        textAttrs = joint.util.omit(textAttrs, 'text');\n\n        // Break the content to fit the element size taking into account the attributes\n        // set on the model.\n        var text = joint.util.breakText(cell.get('content'), cell.get('size'), textAttrs, {\n            // measuring sandbox svg document\n            svgDocument: this.paper.svg\n        });\n\n        // Create a new attrs with same structure as the model attrs { text: { *textAttributes* }}\n        var attrs = joint.util.setByPath({}, '.content', textAttrs, '/');\n\n        // Replace text attribute with the one we just processed.\n        attrs['.content'].text = text;\n\n        // Update the view using renderingOnlyAttributes parameter.\n        joint.dia.ElementView.prototype.update.call(this, cell, attrs);\n    }\n});\n\n(function(dia, util, env, V) {\n\n    'use strict';\n\n    // ELEMENTS\n\n    var Element = dia.Element;\n\n    Element.define('standard.Rectangle', {\n        attrs: {\n            body: {\n                refWidth: '100%',\n                refHeight: '100%',\n                strokeWidth: 2,\n                stroke: '#000000',\n                fill: '#FFFFFF'\n            },\n            label: {\n                textVerticalAnchor: 'middle',\n                textAnchor: 'middle',\n                refX: '50%',\n                refY: '50%',\n                fontSize: 14,\n                fill: '#333333'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'rect',\n            selector: 'body',\n        }, {\n            tagName: 'text',\n            selector: 'label'\n        }]\n    });\n\n    Element.define('standard.Circle', {\n        attrs: {\n            body: {\n                refCx: '50%',\n                refCy: '50%',\n                refR: '50%',\n                strokeWidth: 2,\n                stroke: '#333333',\n                fill: '#FFFFFF'\n            },\n            label: {\n                textVerticalAnchor: 'middle',\n                textAnchor: 'middle',\n                refX: '50%',\n                refY: '50%',\n                fontSize: 14,\n                fill: '#333333'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'circle',\n            selector: 'body'\n        }, {\n            tagName: 'text',\n            selector: 'label'\n        }]\n    });\n\n    Element.define('standard.Ellipse', {\n        attrs: {\n            body: {\n                refCx: '50%',\n                refCy: '50%',\n                refRx: '50%',\n                refRy: '50%',\n                strokeWidth: 2,\n                stroke: '#333333',\n                fill: '#FFFFFF'\n            },\n            label: {\n                textVerticalAnchor: 'middle',\n                textAnchor: 'middle',\n                refX: '50%',\n                refY: '50%',\n                fontSize: 14,\n                fill: '#333333'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'ellipse',\n            selector: 'body'\n        }, {\n            tagName: 'text',\n            selector: 'label'\n        }]\n    });\n\n    Element.define('standard.Path', {\n        attrs: {\n            body: {\n                refD: 'M 0 0 L 10 0 10 10 0 10 Z',\n                strokeWidth: 2,\n                stroke: '#333333',\n                fill: '#FFFFFF'\n            },\n            label: {\n                textVerticalAnchor: 'middle',\n                textAnchor: 'middle',\n                refX: '50%',\n                refY: '50%',\n                fontSize: 14,\n                fill: '#333333'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'path',\n            selector: 'body'\n        }, {\n            tagName: 'text',\n            selector: 'label'\n        }]\n    });\n\n    Element.define('standard.Polygon', {\n        attrs: {\n            body: {\n                refPoints: '0 0 10 0 10 10 0 10',\n                strokeWidth: 2,\n                stroke: '#333333',\n                fill: '#FFFFFF'\n            },\n            label: {\n                textVerticalAnchor: 'middle',\n                textAnchor: 'middle',\n                refX: '50%',\n                refY: '50%',\n                fontSize: 14,\n                fill: '#333333'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'polygon',\n            selector: 'body'\n        }, {\n            tagName: 'text',\n            selector: 'label'\n        }]\n    });\n\n    Element.define('standard.Polyline', {\n        attrs: {\n            body: {\n                refPoints: '0 0 10 0 10 10 0 10 0 0',\n                strokeWidth: 2,\n                stroke: '#333333',\n                fill: '#FFFFFF'\n            },\n            label: {\n                textVerticalAnchor: 'middle',\n                textAnchor: 'middle',\n                refX: '50%',\n                refY: '50%',\n                fontSize: 14,\n                fill: '#333333'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'polyline',\n            selector: 'body'\n        }, {\n            tagName: 'text',\n            selector: 'label'\n        }]\n    });\n\n    Element.define('standard.Image', {\n        attrs: {\n            image: {\n                refWidth: '100%',\n                refHeight: '100%',\n                // xlinkHref: '[URL]'\n            },\n            label: {\n                textVerticalAnchor: 'top',\n                textAnchor: 'middle',\n                refX: '50%',\n                refY: '100%',\n                refY2: 10,\n                fontSize: 14,\n                fill: '#333333'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'image',\n            selector: 'image'\n        }, {\n            tagName: 'text',\n            selector: 'label'\n        }]\n    });\n\n    Element.define('standard.BorderedImage', {\n        attrs: {\n            border: {\n                refWidth: '100%',\n                refHeight: '100%',\n                stroke: '#333333',\n                strokeWidth: 2\n            },\n            background: {\n                refWidth: -1,\n                refHeight: -1,\n                x: 0.5,\n                y: 0.5,\n                fill: '#FFFFFF'\n            },\n            image: {\n                // xlinkHref: '[URL]'\n                refWidth: -1,\n                refHeight: -1,\n                x: 0.5,\n                y: 0.5\n            },\n            label: {\n                textVerticalAnchor: 'top',\n                textAnchor: 'middle',\n                refX: '50%',\n                refY: '100%',\n                refY2: 10,\n                fontSize: 14,\n                fill: '#333333'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'rect',\n            selector: 'background',\n            attributes: {\n                'stroke': 'none'\n            }\n        }, {\n            tagName: 'image',\n            selector: 'image'\n        }, {\n            tagName: 'rect',\n            selector: 'border',\n            attributes: {\n                'fill': 'none'\n            }\n        }, {\n            tagName: 'text',\n            selector: 'label'\n        }]\n    });\n\n    Element.define('standard.EmbeddedImage', {\n        attrs: {\n            body: {\n                refWidth: '100%',\n                refHeight: '100%',\n                stroke: '#333333',\n                fill: '#FFFFFF',\n                strokeWidth: 2\n            },\n            image: {\n                // xlinkHref: '[URL]'\n                refWidth: '30%',\n                refHeight: -20,\n                x: 10,\n                y: 10,\n                preserveAspectRatio: 'xMidYMin'\n            },\n            label: {\n                textVerticalAnchor: 'top',\n                textAnchor: 'left',\n                refX: '30%',\n                refX2: 20, // 10 + 10\n                refY: 10,\n                fontSize: 14,\n                fill: '#333333'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'rect',\n            selector: 'body'\n        }, {\n            tagName: 'image',\n            selector: 'image'\n        }, {\n            tagName: 'text',\n            selector: 'label'\n        }]\n    });\n\n    Element.define('standard.InscribedImage', {\n        attrs: {\n            border: {\n                refRx: '50%',\n                refRy: '50%',\n                refCx: '50%',\n                refCy: '50%',\n                stroke: '#333333',\n                strokeWidth: 2\n            },\n            background: {\n                refRx: '50%',\n                refRy: '50%',\n                refCx: '50%',\n                refCy: '50%',\n                fill: '#FFFFFF'\n            },\n            image: {\n                // The image corners touch the border when its size is Math.sqrt(2) / 2 = 0.707.. ~= 70%\n                refWidth: '68%',\n                refHeight: '68%',\n                // The image offset is calculated as (100% - 68%) / 2\n                refX: '16%',\n                refY: '16%',\n                preserveAspectRatio: 'xMidYMid'\n                // xlinkHref: '[URL]'\n            },\n            label: {\n                textVerticalAnchor: 'top',\n                textAnchor: 'middle',\n                refX: '50%',\n                refY: '100%',\n                refY2: 10,\n                fontSize: 14,\n                fill: '#333333'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'ellipse',\n            selector: 'background'\n        }, {\n            tagName: 'image',\n            selector: 'image'\n        }, {\n            tagName: 'ellipse',\n            selector: 'border',\n            attributes: {\n                'fill': 'none'\n            }\n        }, {\n            tagName: 'text',\n            selector: 'label'\n        }]\n    });\n\n    Element.define('standard.HeaderedRectangle', {\n        attrs: {\n            body: {\n                refWidth: '100%',\n                refHeight: '100%',\n                strokeWidth: 2,\n                stroke: '#000000',\n                fill: '#FFFFFF'\n            },\n            header: {\n                refWidth: '100%',\n                height: 30,\n                strokeWidth: 2,\n                stroke: '#000000',\n                fill: '#FFFFFF'\n            },\n            headerText: {\n                textVerticalAnchor: 'middle',\n                textAnchor: 'middle',\n                refX: '50%',\n                refY: 15,\n                fontSize: 16,\n                fill: '#333333'\n            },\n            bodyText: {\n                textVerticalAnchor: 'middle',\n                textAnchor: 'middle',\n                refX: '50%',\n                refY: '50%',\n                refY2: 15,\n                fontSize: 14,\n                fill: '#333333'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'rect',\n            selector: 'body'\n        }, {\n            tagName: 'rect',\n            selector: 'header'\n        }, {\n            tagName: 'text',\n            selector: 'headerText'\n        }, {\n            tagName: 'text',\n            selector: 'bodyText'\n        }]\n    });\n\n    var CYLINDER_TILT = 10;\n\n    joint.dia.Element.define('standard.Cylinder', {\n        attrs: {\n            body: {\n                lateralArea: CYLINDER_TILT,\n                fill: '#FFFFFF',\n                stroke: '#333333',\n                strokeWidth: 2\n            },\n            top: {\n                refCx: '50%',\n                cy: CYLINDER_TILT,\n                refRx: '50%',\n                ry: CYLINDER_TILT,\n                fill: '#FFFFFF',\n                stroke: '#333333',\n                strokeWidth: 2\n            },\n            label: {\n                textVerticalAnchor: 'middle',\n                textAnchor: 'middle',\n                refX: '50%',\n                refY: '100%',\n                refY2: 15,\n                fontSize: 14,\n                fill: '#333333'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'path',\n            selector: 'body'\n        }, {\n            tagName: 'ellipse',\n            selector: 'top'\n        }, {\n            tagName: 'text',\n            selector: 'label'\n        }],\n\n        topRy: function(t, opt) {\n            // getter\n            if (t === undefined) return this.attr('body/lateralArea');\n\n            // setter\n            var isPercentage = util.isPercentage(t);\n\n            var bodyAttrs = { lateralArea: t };\n            var topAttrs = isPercentage\n                ? { refCy: t, refRy: t, cy: null, ry: null }\n                : { refCy: null, refRy: null, cy: t, ry: t };\n\n            return this.attr({ body: bodyAttrs, top: topAttrs }, opt);\n        }\n\n    }, {\n        attributes: {\n            lateralArea: {\n                set: function(t, refBBox) {\n                    var isPercentage = util.isPercentage(t);\n                    if (isPercentage) t = parseFloat(t) / 100;\n\n                    var x = refBBox.x;\n                    var y = refBBox.y;\n                    var w = refBBox.width;\n                    var h = refBBox.height;\n\n                    // curve control point variables\n                    var rx = w / 2;\n                    var ry = isPercentage ? (h * t) : t;\n\n                    var kappa = V.KAPPA;\n                    var cx = kappa * rx;\n                    var cy = kappa * (isPercentage ? (h * t) : t);\n\n                    // shape variables\n                    var xLeft = x;\n                    var xCenter = x + (w / 2);\n                    var xRight = x + w;\n\n                    var ySideTop = y + ry;\n                    var yCurveTop = ySideTop - ry;\n                    var ySideBottom = y + h - ry;\n                    var yCurveBottom = y + h;\n\n                    // return calculated shape\n                    var data = [\n                        'M', xLeft, ySideTop,\n                        'L', xLeft, ySideBottom,\n                        'C', x, (ySideBottom + cy), (xCenter - cx), yCurveBottom, xCenter, yCurveBottom,\n                        'C', (xCenter + cx), yCurveBottom, xRight, (ySideBottom + cy), xRight, ySideBottom,\n                        'L', xRight, ySideTop,\n                        'C', xRight, (ySideTop - cy), (xCenter + cx), yCurveTop, xCenter, yCurveTop,\n                        'C', (xCenter - cx), yCurveTop, xLeft, (ySideTop - cy), xLeft, ySideTop,\n                        'Z'\n                    ];\n                    return { d: data.join(' ') };\n                }\n            }\n        }\n    });\n\n    var foLabelMarkup = {\n        tagName: 'foreignObject',\n        selector: 'foreignObject',\n        attributes: {\n            'overflow': 'hidden'\n        },\n        children: [{\n            tagName: 'div',\n            namespaceURI: 'http://www.w3.org/1999/xhtml',\n            selector: 'label',\n            style: {\n                width: '100%',\n                height: '100%',\n                position: 'static',\n                backgroundColor: 'transparent',\n                textAlign: 'center',\n                margin: 0,\n                padding: '0px 5px',\n                boxSizing: 'border-box',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center'\n            }\n        }]\n    };\n\n    var svgLabelMarkup = {\n        tagName: 'text',\n        selector: 'label',\n        attributes: {\n            'text-anchor': 'middle'\n        }\n    };\n\n    var labelMarkup = (env.test('svgforeignobject')) ? foLabelMarkup : svgLabelMarkup;\n\n    Element.define('standard.TextBlock', {\n        attrs: {\n            body: {\n                refWidth: '100%',\n                refHeight: '100%',\n                stroke: '#333333',\n                fill: '#ffffff',\n                strokeWidth: 2\n            },\n            foreignObject: {\n                refWidth: '100%',\n                refHeight: '100%'\n            },\n            label: {\n                style: {\n                    fontSize: 14\n                }\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'rect',\n            selector: 'body'\n        }, labelMarkup]\n    }, {\n        attributes: {\n            text: {\n                set: function(text, refBBox, node, attrs) {\n                    if (node instanceof HTMLElement) {\n                        node.textContent = text;\n                    } else {\n                        // No foreign object\n                        var style = attrs.style || {};\n                        var wrapValue = { text: text, width: -5, height: '100%' };\n                        var wrapAttrs = util.assign({ textVerticalAnchor: 'middle' }, style);\n                        dia.attributes.textWrap.set.call(this, wrapValue, refBBox, node, wrapAttrs);\n                        return { fill: style.color || null };\n                    }\n                },\n                position: function(text, refBBox, node) {\n                    // No foreign object\n                    if (node instanceof SVGElement) return refBBox.center();\n                }\n            }\n        }\n    });\n\n    // LINKS\n\n    var Link = dia.Link;\n\n    Link.define('standard.Link', {\n        attrs: {\n            line: {\n                connection: true,\n                stroke: '#333333',\n                strokeWidth: 2,\n                strokeLinejoin: 'round',\n                targetMarker: {\n                    type: 'path',\n                    d: 'M 10 -5 0 0 10 5 z'\n                }\n            },\n            wrapper: {\n                connection: true,\n                strokeWidth: 10,\n                strokeLinejoin: 'round'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'path',\n            selector: 'wrapper',\n            attributes: {\n                'fill': 'none',\n                'cursor': 'pointer',\n                'stroke': 'transparent'\n            }\n        }, {\n            tagName: 'path',\n            selector: 'line',\n            attributes: {\n                'fill': 'none',\n                'pointer-events': 'none'\n            }\n        }]\n    });\n\n    Link.define('standard.DoubleLink', {\n        attrs: {\n            line: {\n                connection: true,\n                stroke: '#DDDDDD',\n                strokeWidth: 4,\n                strokeLinejoin: 'round',\n                targetMarker: {\n                    type: 'path',\n                    stroke: '#000000',\n                    d: 'M 10 -3 10 -10 -2 0 10 10 10 3'\n                }\n            },\n            outline: {\n                connection: true,\n                stroke: '#000000',\n                strokeWidth: 6,\n                strokeLinejoin: 'round'\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'path',\n            selector: 'outline',\n            attributes: {\n                'fill': 'none'\n            }\n        }, {\n            tagName: 'path',\n            selector: 'line',\n            attributes: {\n                'fill': 'none'\n            }\n        }]\n    });\n\n    Link.define('standard.ShadowLink', {\n        attrs: {\n            line: {\n                connection: true,\n                stroke: '#FF0000',\n                strokeWidth: 20,\n                strokeLinejoin: 'round',\n                targetMarker: {\n                    'type': 'path',\n                    'stroke': 'none',\n                    'd': 'M 0 -10 -10 0 0 10 z'\n                },\n                sourceMarker: {\n                    'type': 'path',\n                    'stroke': 'none',\n                    'd': 'M -10 -10 0 0 -10 10 0 10 0 -10 z'\n                }\n            },\n            shadow: {\n                connection: true,\n                refX: 3,\n                refY: 6,\n                stroke: '#000000',\n                strokeOpacity: 0.2,\n                strokeWidth: 20,\n                strokeLinejoin: 'round',\n                targetMarker: {\n                    'type': 'path',\n                    'd': 'M 0 -10 -10 0 0 10 z',\n                    'stroke': 'none'\n                },\n                sourceMarker: {\n                    'type': 'path',\n                    'stroke': 'none',\n                    'd': 'M -10 -10 0 0 -10 10 0 10 0 -10 z'\n                }\n            }\n        }\n    }, {\n        markup: [{\n            tagName: 'path',\n            selector: 'shadow',\n            attributes: {\n                'fill': 'none'\n            }\n        }, {\n            tagName: 'path',\n            selector: 'line',\n            attributes: {\n                'fill': 'none'\n            }\n        }]\n    });\n\n\n})(joint.dia, joint.util, joint.env, V);\n\njoint.routers.manhattan = (function(g, joint, util) {\n\n    'use strict';\n\n    var config = {\n\n        // size of the step to find a route (the grid of the manhattan pathfinder)\n        step: 10,\n\n        // the number of route finding loops that cause the router to abort\n        // returns fallback route instead\n        maximumLoops: 2000,\n\n        // the number of decimal places to round floating point coordinates\n        precision: 1,\n\n        // maximum change of direction\n        maxAllowedDirectionChange: 90,\n\n        // should the router use perpendicular linkView option?\n        // does not connect anchor of element but rather a point close-by that is orthogonal\n        // this looks much better\n        perpendicular: true,\n\n        // should the source and/or target not be considered as obstacles?\n        excludeEnds: [], // 'source', 'target'\n\n        // should certain types of elements not be considered as obstacles?\n        excludeTypes: ['basic.Text'],\n\n        // possible starting directions from an element\n        startDirections: ['top', 'right', 'bottom', 'left'],\n\n        // possible ending directions to an element\n        endDirections: ['top', 'right', 'bottom', 'left'],\n\n        // specify the directions used above and what they mean\n        directionMap: {\n            top: { x: 0, y: -1 },\n            right: { x: 1, y: 0 },\n            bottom: { x: 0, y: 1 },\n            left: { x: -1, y: 0 }\n        },\n\n        // cost of an orthogonal step\n        cost: function() {\n\n            return this.step;\n        },\n\n        // an array of directions to find next points on the route\n        // different from start/end directions\n        directions: function() {\n\n            var step = this.step;\n            var cost = this.cost();\n\n            return [\n                { offsetX: step  , offsetY: 0     , cost: cost },\n                { offsetX: 0     , offsetY: step  , cost: cost },\n                { offsetX: -step , offsetY: 0     , cost: cost },\n                { offsetX: 0     , offsetY: -step , cost: cost }\n            ];\n        },\n\n        // a penalty received for direction change\n        penalties: function() {\n\n            return {\n                0: 0,\n                45: this.step / 2,\n                90: this.step / 2\n            };\n        },\n\n        // padding applied on the element bounding boxes\n        paddingBox: function() {\n\n            var step = this.step;\n\n            return {\n                x: -step,\n                y: -step,\n                width: 2 * step,\n                height: 2 * step\n            };\n        },\n\n        // a router to use when the manhattan router fails\n        // (one of the partial routes returns null)\n        fallbackRouter: function(vertices, opt, linkView) {\n\n            if (!util.isFunction(joint.routers.orthogonal)) {\n                throw new Error('Manhattan requires the orthogonal router as default fallback.');\n            }\n\n            return joint.routers.orthogonal(vertices, util.assign({}, config, opt), linkView);\n        },\n\n        /* Deprecated */\n        // a simple route used in situations when main routing method fails\n        // (exceed max number of loop iterations, inaccessible)\n        fallbackRoute: function(from, to, opt) {\n\n            return null; // null result will trigger the fallbackRouter\n\n            // left for reference:\n            /*// Find an orthogonal route ignoring obstacles.\n\n            var point = ((opt.previousDirAngle || 0) % 180 === 0)\n                    ? new g.Point(from.x, to.y)\n                    : new g.Point(to.x, from.y);\n\n            return [point];*/\n        },\n\n        // if a function is provided, it's used to route the link while dragging an end\n        // i.e. function(from, to, opt) { return []; }\n        draggingRoute: null\n    };\n\n    // HELPER CLASSES //\n\n    // Map of obstacles\n    // Helper structure to identify whether a point lies inside an obstacle.\n    function ObstacleMap(opt) {\n\n        this.map = {};\n        this.options = opt;\n        // tells how to divide the paper when creating the elements map\n        this.mapGridSize = 100;\n    }\n\n    ObstacleMap.prototype.build = function(graph, link) {\n\n        var opt = this.options;\n\n        // source or target element could be excluded from set of obstacles\n        var excludedEnds = util.toArray(opt.excludeEnds).reduce(function(res, item) {\n\n            var end = link.get(item);\n            if (end) {\n                var cell = graph.getCell(end.id);\n                if (cell) {\n                    res.push(cell);\n                }\n            }\n\n            return res;\n        }, []);\n\n        // Exclude any embedded elements from the source and the target element.\n        var excludedAncestors = [];\n\n        var source = graph.getCell(link.get('source').id);\n        if (source) {\n            excludedAncestors = util.union(excludedAncestors, source.getAncestors().map(function(cell) { return cell.id; }));\n        }\n\n        var target = graph.getCell(link.get('target').id);\n        if (target) {\n            excludedAncestors = util.union(excludedAncestors, target.getAncestors().map(function(cell) { return cell.id; }));\n        }\n\n        // Builds a map of all elements for quicker obstacle queries (i.e. is a point contained\n        // in any obstacle?) (a simplified grid search).\n        // The paper is divided into smaller cells, where each holds information about which\n        // elements belong to it. When we query whether a point lies inside an obstacle we\n        // don't need to go through all obstacles, we check only those in a particular cell.\n        var mapGridSize = this.mapGridSize;\n\n        graph.getElements().reduce(function(map, element) {\n\n            var isExcludedType = util.toArray(opt.excludeTypes).includes(element.get('type'));\n            var isExcludedEnd = excludedEnds.find(function(excluded) { return excluded.id === element.id; });\n            var isExcludedAncestor = excludedAncestors.includes(element.id);\n\n            var isExcluded = isExcludedType || isExcludedEnd || isExcludedAncestor;\n            if (!isExcluded) {\n                var bbox = element.getBBox().moveAndExpand(opt.paddingBox);\n\n                var origin = bbox.origin().snapToGrid(mapGridSize);\n                var corner = bbox.corner().snapToGrid(mapGridSize);\n\n                for (var x = origin.x; x <= corner.x; x += mapGridSize) {\n                    for (var y = origin.y; y <= corner.y; y += mapGridSize) {\n                        var gridKey = x + '@' + y;\n                        map[gridKey] = map[gridKey] || [];\n                        map[gridKey].push(bbox);\n                    }\n                }\n            }\n\n            return map;\n        }, this.map);\n\n        return this;\n    };\n\n    ObstacleMap.prototype.isPointAccessible = function(point) {\n\n        var mapKey = point.clone().snapToGrid(this.mapGridSize).toString();\n\n        return util.toArray(this.map[mapKey]).every( function(obstacle) {\n            return !obstacle.containsPoint(point);\n        });\n    };\n\n    // Sorted Set\n    // Set of items sorted by given value.\n    function SortedSet() {\n        this.items = [];\n        this.hash = {};\n        this.values = {};\n        this.OPEN = 1;\n        this.CLOSE = 2;\n    }\n\n    SortedSet.prototype.add = function(item, value) {\n\n        if (this.hash[item]) {\n            // item removal\n            this.items.splice(this.items.indexOf(item), 1);\n        } else {\n            this.hash[item] = this.OPEN;\n        }\n\n        this.values[item] = value;\n\n        var index = joint.util.sortedIndex(this.items, item, function(i) {\n            return this.values[i];\n        }.bind(this));\n\n        this.items.splice(index, 0, item);\n    };\n\n    SortedSet.prototype.remove = function(item) {\n\n        this.hash[item] = this.CLOSE;\n    };\n\n    SortedSet.prototype.isOpen = function(item) {\n\n        return this.hash[item] === this.OPEN;\n    };\n\n    SortedSet.prototype.isClose = function(item) {\n\n        return this.hash[item] === this.CLOSE;\n    };\n\n    SortedSet.prototype.isEmpty = function() {\n\n        return this.items.length === 0;\n    };\n\n    SortedSet.prototype.pop = function() {\n\n        var item =  this.items.shift();\n        this.remove(item);\n        return item;\n    };\n\n    // HELPERS //\n\n    // return source bbox\n    function getSourceBBox(linkView, opt) {\n\n        // expand by padding box\n        if (opt && opt.paddingBox) return linkView.sourceBBox.clone().moveAndExpand(opt.paddingBox);\n\n        return linkView.sourceBBox.clone();\n    }\n\n    // return target bbox\n    function getTargetBBox(linkView, opt) {\n\n        // expand by padding box\n        if (opt && opt.paddingBox) return linkView.targetBBox.clone().moveAndExpand(opt.paddingBox);\n\n        return linkView.targetBBox.clone();\n    }\n\n    // return source anchor\n    function getSourceAnchor(linkView, opt) {\n\n        if (linkView.sourceAnchor) return linkView.sourceAnchor;\n\n        // fallback: center of bbox\n        var sourceBBox = getSourceBBox(linkView, opt);\n        return sourceBBox.center();\n    }\n\n    // return target anchor\n    function getTargetAnchor(linkView, opt) {\n\n        if (linkView.targetAnchor) return linkView.targetAnchor;\n\n        // fallback: center of bbox\n        var targetBBox = getTargetBBox(linkView, opt);\n        return targetBBox.center(); // default\n    }\n\n    // returns a direction index from start point to end point\n    // corrects for grid deformation between start and end\n    function getDirectionAngle(start, end, numDirections, grid, opt) {\n\n        var quadrant = 360 / numDirections;\n        var angleTheta = start.theta(fixAngleEnd(start, end, grid, opt));\n        var normalizedAngle = g.normalizeAngle(angleTheta + (quadrant / 2));\n        return quadrant * Math.floor(normalizedAngle / quadrant);\n    }\n\n    // helper function for getDirectionAngle()\n    // corrects for grid deformation\n    // (if a point is one grid steps away from another in both dimensions,\n    // it is considered to be 45 degrees away, even if the real angle is different)\n    // this causes visible angle discrepancies if `opt.step` is much larger than `paper.gridSize`\n    function fixAngleEnd(start, end, grid, opt) {\n\n        var step = opt.step;\n\n        var diffX = end.x - start.x;\n        var diffY = end.y - start.y;\n\n        var gridStepsX = diffX / grid.x;\n        var gridStepsY = diffY / grid.y;\n\n        var distanceX = gridStepsX * step;\n        var distanceY = gridStepsY * step;\n\n        return new g.Point(start.x + distanceX, start.y + distanceY);\n    }\n\n    // return the change in direction between two direction angles\n    function getDirectionChange(angle1, angle2) {\n\n        var directionChange = Math.abs(angle1 - angle2);\n        return (directionChange > 180) ? (360 - directionChange) : directionChange;\n    }\n\n    // fix direction offsets according to current grid\n    function getGridOffsets(directions, grid, opt) {\n\n        var step = opt.step;\n\n        util.toArray(opt.directions).forEach(function(direction) {\n\n            direction.gridOffsetX = (direction.offsetX / step) * grid.x;\n            direction.gridOffsetY = (direction.offsetY / step) * grid.y;\n        });\n    }\n\n    // get grid size in x and y dimensions, adapted to source and target positions\n    function getGrid(step, source, target) {\n\n        return {\n            source: source.clone(),\n            x: getGridDimension(target.x - source.x, step),\n            y: getGridDimension(target.y - source.y, step)\n        };\n    }\n\n    // helper function for getGrid()\n    function getGridDimension(diff, step) {\n\n        // return step if diff = 0\n        if (!diff) return step;\n\n        var absDiff = Math.abs(diff);\n        var numSteps = Math.round(absDiff / step);\n\n        // return absDiff if less than one step apart\n        if (!numSteps) return absDiff;\n\n        // otherwise, return corrected step\n        var roundedDiff = numSteps * step;\n        var remainder = absDiff - roundedDiff;\n        var stepCorrection = remainder / numSteps;\n\n        return step + stepCorrection;\n    }\n\n    // return a clone of point snapped to grid\n    function snapToGrid(point, grid) {\n\n        var source = grid.source;\n\n        var snappedX = g.snapToGrid(point.x - source.x, grid.x) + source.x;\n        var snappedY = g.snapToGrid(point.y - source.y, grid.y) + source.y;\n\n        return new g.Point(snappedX, snappedY);\n    }\n\n    // round the point to opt.precision\n    function round(point, precision) {\n\n        return point.round(precision);\n    }\n\n    // snap to grid and then round the point\n    function align(point, grid, precision) {\n\n        return round(snapToGrid(point.clone(), grid), precision);\n    }\n\n    // return a string representing the point\n    // string is rounded in both dimensions\n    function getKey(point) {\n\n        return point.clone().toString();\n    }\n\n    // return a normalized vector from given point\n    // used to determine the direction of a difference of two points\n    function normalizePoint(point) {\n\n        return new g.Point(\n            point.x === 0 ? 0 : Math.abs(point.x) / point.x,\n            point.y === 0 ? 0 : Math.abs(point.y) / point.y\n        );\n    }\n\n    // PATHFINDING //\n\n    // reconstructs a route by concatenating points with their parents\n    function reconstructRoute(parents, points, tailPoint, from, to, grid, opt) {\n\n        var route = [];\n\n        var prevDiff = normalizePoint(to.difference(tailPoint));\n\n        // tailPoint is assumed to be aligned already\n        var currentKey = getKey(tailPoint);\n        var parent = parents[currentKey];\n\n        var point;\n        while (parent) {\n\n            // point is assumed to be aligned already\n            point = points[currentKey];\n\n            var diff = normalizePoint(point.difference(parent));\n            if (!diff.equals(prevDiff)) {\n                route.unshift(point);\n                prevDiff = diff;\n            }\n\n            // parent is assumed to be aligned already\n            currentKey = getKey(parent);\n            parent = parents[currentKey];\n        }\n\n        // leadPoint is assumed to be aligned already\n        var leadPoint = points[currentKey];\n\n        var fromDiff = normalizePoint(leadPoint.difference(from));\n        if (!fromDiff.equals(prevDiff)) {\n            route.unshift(leadPoint);\n        }\n\n        return route;\n    }\n\n    // heuristic method to determine the distance between two points\n    function estimateCost(from, endPoints) {\n\n        var min = Infinity;\n\n        for (var i = 0, len = endPoints.length; i < len; i++) {\n            var cost = from.manhattanDistance(endPoints[i]);\n            if (cost < min) min = cost;\n        }\n\n        return min;\n    }\n\n    // find points around the bbox taking given directions into account\n    // lines are drawn from anchor in given directions, intersections recorded\n    // if anchor is outside bbox, only those directions that intersect get a rect point\n    // the anchor itself is returned as rect point (representing some directions)\n    // (since those directions are unobstructed by the bbox)\n    function getRectPoints(anchor, bbox, directionList, grid, opt) {\n\n        var precision = opt.precision;\n        var directionMap = opt.directionMap;\n\n        var anchorCenterVector = anchor.difference(bbox.center());\n\n        var keys = util.isObject(directionMap) ? Object.keys(directionMap) : [];\n        var dirList = util.toArray(directionList);\n        var rectPoints = keys.reduce(function(res, key) {\n\n            if (dirList.includes(key)) {\n                var direction = directionMap[key];\n\n                // create a line that is guaranteed to intersect the bbox if bbox is in the direction\n                // even if anchor lies outside of bbox\n                var endpoint = new g.Point(\n                    anchor.x + direction.x * (Math.abs(anchorCenterVector.x) + bbox.width),\n                    anchor.y + direction.y * (Math.abs(anchorCenterVector.y) + bbox.height)\n                );\n                var intersectionLine = new g.Line(anchor, endpoint);\n\n                // get the farther intersection, in case there are two\n                // (that happens if anchor lies next to bbox)\n                var intersections = intersectionLine.intersect(bbox) || [];\n                var numIntersections = intersections.length;\n                var farthestIntersectionDistance;\n                var farthestIntersection = null;\n                for (var i = 0; i < numIntersections; i++) {\n                    var currentIntersection = intersections[i];\n                    var distance = anchor.squaredDistance(currentIntersection);\n                    if ((farthestIntersectionDistance === undefined) || (distance > farthestIntersectionDistance)) {\n                        farthestIntersectionDistance = distance;\n                        farthestIntersection = currentIntersection;\n                    }\n                }\n\n                // if an intersection was found in this direction, it is our rectPoint\n                if (farthestIntersection) {\n                    var point = align(farthestIntersection, grid, precision);\n\n                    // if the rectPoint lies inside the bbox, offset it by one more step\n                    if (bbox.containsPoint(point)) {\n                        point = align(point.offset(direction.x * grid.x, direction.y * grid.y), grid, precision);\n                    }\n\n                    // then add the point to the result array\n                    // aligned\n                    res.push(point);\n                }\n            }\n\n            return res;\n        }, []);\n\n        // if anchor lies outside of bbox, add it to the array of points\n        if (!bbox.containsPoint(anchor)) {\n            // aligned\n            rectPoints.push(align(anchor, grid, precision));\n        }\n\n        return rectPoints;\n    }\n\n    // finds the route between two points/rectangles (`from`, `to`) implementing A* algorithm\n    // rectangles get rect points assigned by getRectPoints()\n    function findRoute(from, to, map, opt) {\n\n        var precision = opt.precision;\n\n        // Get grid for this route.\n\n        var sourceAnchor, targetAnchor;\n\n        if (from instanceof g.Rect) { // `from` is sourceBBox\n            sourceAnchor = round(getSourceAnchor(this, opt).clone(), precision);\n        } else {\n            sourceAnchor = round(from.clone(), precision);\n        }\n\n        if (to instanceof g.Rect) { // `to` is targetBBox\n            targetAnchor = round(getTargetAnchor(this, opt).clone(), precision);\n        } else {\n            targetAnchor = round(to.clone(), precision);\n        }\n\n        var grid = getGrid(opt.step, sourceAnchor, targetAnchor);\n\n        // Get pathfinding points.\n\n        var start, end; // aligned with grid by definition\n        var startPoints, endPoints; // assumed to be aligned with grid already\n\n        // set of points we start pathfinding from\n        if (from instanceof g.Rect) { // `from` is sourceBBox\n            start = sourceAnchor;\n            startPoints = getRectPoints(start, from, opt.startDirections, grid, opt);\n\n        } else {\n            start = sourceAnchor;\n            startPoints = [start];\n        }\n\n        // set of points we want the pathfinding to finish at\n        if (to instanceof g.Rect) { // `to` is targetBBox\n            end = targetAnchor;\n            endPoints = getRectPoints(targetAnchor, to, opt.endDirections, grid, opt);\n\n        } else {\n            end = targetAnchor;\n            endPoints = [end];\n        }\n\n        // take into account only accessible rect points (those not under obstacles)\n        startPoints = startPoints.filter(map.isPointAccessible, map);\n        endPoints = endPoints.filter(map.isPointAccessible, map);\n\n        // Check that there is an accessible route point on both sides.\n        // Otherwise, use fallbackRoute().\n        if (startPoints.length > 0 && endPoints.length > 0) {\n\n            // The set of tentative points to be evaluated, initially containing the start points.\n            // Rounded to nearest integer for simplicity.\n            var openSet = new SortedSet();\n            // Keeps reference to actual points for given elements of the open set.\n            var points = {};\n            // Keeps reference to a point that is immediate predecessor of given element.\n            var parents = {};\n            // Cost from start to a point along best known path.\n            var costs = {};\n\n            for (var i = 0, n = startPoints.length; i < n; i++) {\n                // startPoint is assumed to be aligned already\n                var startPoint = startPoints[i];\n\n                var key = getKey(startPoint);\n\n                openSet.add(key, estimateCost(startPoint, endPoints));\n                points[key] = startPoint;\n                costs[key] = 0;\n            }\n\n            var previousRouteDirectionAngle = opt.previousDirectionAngle; // undefined for first route\n            var isPathBeginning = (previousRouteDirectionAngle === undefined);\n\n            // directions\n            var direction, directionChange;\n            var directions = opt.directions;\n            getGridOffsets(directions, grid, opt);\n\n            var numDirections = directions.length;\n\n            var endPointsKeys = util.toArray(endPoints).reduce(function(res, endPoint) {\n                // endPoint is assumed to be aligned already\n\n                var key = getKey(endPoint);\n                res.push(key);\n                return res;\n            }, []);\n\n            // main route finding loop\n            var loopsRemaining = opt.maximumLoops;\n            while (!openSet.isEmpty() && loopsRemaining > 0) {\n\n                // remove current from the open list\n                var currentKey = openSet.pop();\n                var currentPoint = points[currentKey];\n                var currentParent = parents[currentKey];\n                var currentCost = costs[currentKey];\n\n                var isRouteBeginning = (currentParent === undefined); // undefined for route starts\n                var isStart = currentPoint.equals(start); // (is source anchor or `from` point) = can leave in any direction\n\n                var previousDirectionAngle;\n                if (!isRouteBeginning) previousDirectionAngle = getDirectionAngle(currentParent, currentPoint, numDirections, grid, opt); // a vertex on the route\n                else if (!isPathBeginning) previousDirectionAngle = previousRouteDirectionAngle; // beginning of route on the path\n                else if (!isStart) previousDirectionAngle = getDirectionAngle(start, currentPoint, numDirections, grid, opt); // beginning of path, start rect point\n                else previousDirectionAngle = null; // beginning of path, source anchor or `from` point\n\n                // check if we reached any endpoint\n                if (endPointsKeys.indexOf(currentKey) >= 0) {\n                    opt.previousDirectionAngle = previousDirectionAngle;\n                    return reconstructRoute(parents, points, currentPoint, start, end, grid, opt);\n                }\n\n                // go over all possible directions and find neighbors\n                for (i = 0; i < numDirections; i++) {\n                    direction = directions[i];\n\n                    var directionAngle = direction.angle;\n                    directionChange = getDirectionChange(previousDirectionAngle, directionAngle);\n\n                    // if the direction changed rapidly, don't use this point\n                    // any direction is allowed for starting points\n                    if (!(isPathBeginning && isStart) && directionChange > opt.maxAllowedDirectionChange) continue;\n\n                    var neighborPoint = align(currentPoint.clone().offset(direction.gridOffsetX, direction.gridOffsetY), grid, precision);\n                    var neighborKey = getKey(neighborPoint);\n\n                    // Closed points from the openSet were already evaluated.\n                    if (openSet.isClose(neighborKey) || !map.isPointAccessible(neighborPoint)) continue;\n\n                    // We can only enter end points at an acceptable angle.\n                    if (endPointsKeys.indexOf(neighborKey) >= 0) { // neighbor is an end point\n\n                        var isNeighborEnd = neighborPoint.equals(end); // (is target anchor or `to` point) = can be entered in any direction\n\n                        if (!isNeighborEnd) {\n                            var endDirectionAngle = getDirectionAngle(neighborPoint, end, numDirections, grid, opt);\n                            var endDirectionChange = getDirectionChange(directionAngle, endDirectionAngle);\n\n                            if (endDirectionChange > opt.maxAllowedDirectionChange) continue;\n                        }\n                    }\n\n                    // The current direction is ok.\n\n                    var neighborCost = direction.cost;\n                    var neighborPenalty = isStart ? 0 : opt.penalties[directionChange]; // no penalties for start point\n                    var costFromStart = currentCost + neighborCost + neighborPenalty;\n\n                    if (!openSet.isOpen(neighborKey) || (costFromStart < costs[neighborKey])) {\n                        // neighbor point has not been processed yet\n                        // or the cost of the path from start is lower than previously calculated\n\n                        points[neighborKey] = neighborPoint;\n                        parents[neighborKey] = currentPoint;\n                        costs[neighborKey] = costFromStart;\n                        openSet.add(neighborKey, costFromStart + estimateCost(neighborPoint, endPoints));\n                    }\n                }\n\n                loopsRemaining--;\n            }\n        }\n\n        // no route found (`to` point either wasn't accessible or finding route took\n        // way too much calculation)\n        return opt.fallbackRoute.call(this, start, end, opt);\n    }\n\n    // resolve some of the options\n    function resolveOptions(opt) {\n\n        opt.directions = util.result(opt, 'directions');\n        opt.penalties = util.result(opt, 'penalties');\n        opt.paddingBox = util.result(opt, 'paddingBox');\n        opt.padding = util.result(opt, 'padding');\n\n        if (opt.padding) {\n            // if both provided, opt.padding wins over opt.paddingBox\n            var sides = util.normalizeSides(opt.padding);\n            opt.paddingBox = {\n                x: -sides.left,\n                y: -sides.top,\n                width: sides.left + sides.right,\n                height: sides.top + sides.bottom\n            };\n        }\n\n        util.toArray(opt.directions).forEach(function(direction) {\n\n            var point1 = new g.Point(0, 0);\n            var point2 = new g.Point(direction.offsetX, direction.offsetY);\n\n            direction.angle = g.normalizeAngle(point1.theta(point2));\n        });\n    }\n\n    // initialization of the route finding\n    function router(vertices, opt, linkView) {\n\n        resolveOptions(opt);\n\n        // enable/disable linkView perpendicular option\n        linkView.options.perpendicular = !!opt.perpendicular;\n\n        var sourceBBox = getSourceBBox(linkView, opt);\n        var targetBBox = getTargetBBox(linkView, opt);\n\n        var sourceAnchor = getSourceAnchor(linkView, opt);\n        //var targetAnchor = getTargetAnchor(linkView, opt);\n\n        // pathfinding\n        var map = (new ObstacleMap(opt)).build(linkView.paper.model, linkView.model);\n        var oldVertices = util.toArray(vertices).map(g.Point);\n        var newVertices = [];\n        var tailPoint = sourceAnchor; // the origin of first route's grid, does not need snapping\n\n        // find a route by concatenating all partial routes (routes need to pass through vertices)\n        // source -> vertex[1] -> ... -> vertex[n] -> target\n        var to, from;\n\n        for (var i = 0, len = oldVertices.length; i <= len; i++) {\n\n            var partialRoute = null;\n\n            from = to || sourceBBox;\n            to = oldVertices[i];\n\n            if (!to) {\n                // this is the last iteration\n                // we ran through all vertices in oldVertices\n                // 'to' is not a vertex.\n\n                to = targetBBox;\n\n                // If the target is a point (i.e. it's not an element), we\n                // should use dragging route instead of main routing method if it has been provided.\n                var isEndingAtPoint = !linkView.model.get('source').id || !linkView.model.get('target').id;\n\n                if (isEndingAtPoint && util.isFunction(opt.draggingRoute)) {\n                    // Make sure we are passing points only (not rects).\n                    var dragFrom = (from === sourceBBox) ? sourceAnchor : from;\n                    var dragTo = to.origin();\n\n                    partialRoute = opt.draggingRoute.call(linkView, dragFrom, dragTo, opt);\n                }\n            }\n\n            // if partial route has not been calculated yet use the main routing method to find one\n            partialRoute = partialRoute || findRoute.call(linkView, from, to, map, opt);\n\n            if (partialRoute === null) { // the partial route cannot be found\n                return opt.fallbackRouter(vertices, opt, linkView);\n            }\n\n            var leadPoint = partialRoute[0];\n\n            // remove the first point if the previous partial route had the same point as last\n            if (leadPoint && leadPoint.equals(tailPoint)) partialRoute.shift();\n\n            // save tailPoint for next iteration\n            tailPoint = partialRoute[partialRoute.length - 1] || tailPoint;\n\n            Array.prototype.push.apply(newVertices, partialRoute);\n        }\n\n        return newVertices;\n    }\n\n    // public function\n    return function(vertices, opt, linkView) {\n\n        return router(vertices, util.assign({}, config, opt), linkView);\n    };\n\n})(g, joint, joint.util);\n\njoint.routers.metro = (function(util) {\n\n    var config = {\n\n        maxAllowedDirectionChange: 45,\n\n        // cost of a diagonal step\n        diagonalCost: function() {\n\n            var step = this.step;\n            return Math.ceil(Math.sqrt(step * step << 1));\n        },\n\n        // an array of directions to find next points on the route\n        // different from start/end directions\n        directions: function() {\n\n            var step = this.step;\n            var cost = this.cost();\n            var diagonalCost = this.diagonalCost();\n\n            return [\n                { offsetX: step  , offsetY: 0     , cost: cost },\n                { offsetX: step  , offsetY: step  , cost: diagonalCost },\n                { offsetX: 0     , offsetY: step  , cost: cost },\n                { offsetX: -step , offsetY: step  , cost: diagonalCost },\n                { offsetX: -step , offsetY: 0     , cost: cost },\n                { offsetX: -step , offsetY: -step , cost: diagonalCost },\n                { offsetX: 0     , offsetY: -step , cost: cost },\n                { offsetX: step  , offsetY: -step , cost: diagonalCost }\n            ];\n        },\n\n        // a simple route used in situations when main routing method fails\n        // (exceed max number of loop iterations, inaccessible)\n        fallbackRoute: function(from, to, opt) {\n\n            // Find a route which breaks by 45 degrees ignoring all obstacles.\n\n            var theta = from.theta(to);\n\n            var route = [];\n\n            var a = { x: to.x, y: from.y };\n            var b = { x: from.x, y: to.y };\n\n            if (theta % 180 > 90) {\n                var t = a;\n                a = b;\n                b = t;\n            }\n\n            var p1 = (theta % 90) < 45 ? a : b;\n            var l1 = new g.Line(from, p1);\n\n            var alpha = 90 * Math.ceil(theta / 90);\n\n            var p2 = g.Point.fromPolar(l1.squaredLength(), g.toRad(alpha + 135), p1);\n            var l2 = new g.Line(to, p2);\n\n            var intersectionPoint = l1.intersection(l2);\n            var point = intersectionPoint ? intersectionPoint : to;\n\n            var directionFrom = intersectionPoint ? point : from;\n\n            var quadrant = 360 / opt.directions.length;\n            var angleTheta = directionFrom.theta(to);\n            var normalizedAngle = g.normalizeAngle(angleTheta + (quadrant / 2));\n            var directionAngle = quadrant * Math.floor(normalizedAngle / quadrant);\n\n            opt.previousDirectionAngle = directionAngle;\n\n            if (point) route.push(point.round());\n            route.push(to);\n\n            return route;\n        }\n    };\n\n    // public function\n    return function(vertices, opt, linkView) {\n\n        if (!util.isFunction(joint.routers.manhattan)) {\n            throw new Error('Metro requires the manhattan router.');\n        }\n\n        return joint.routers.manhattan(vertices, util.assign({}, config, opt), linkView);\n    };\n\n})(joint.util);\n\n// Does not make any changes to vertices.\n// Returns the arguments that are passed to it, unchanged.\njoint.routers.normal = function(vertices, opt, linkView) {\n\n    return vertices;\n};\n\n// Routes the link always to/from a certain side\n//\n// Arguments:\n//   padding ... gap between the element and the first vertex. :: Default 40.\n//   side ... 'left' | 'right' | 'top' | 'bottom' :: Default 'bottom'.\n//\njoint.routers.oneSide = function(vertices, opt, linkView) {\n\n    var side = opt.side || 'bottom';\n    var padding = joint.util.normalizeSides(opt.padding || 40);\n\n    // LinkView contains cached source an target bboxes.\n    // Note that those are Geometry rectangle objects.\n    var sourceBBox = linkView.sourceBBox;\n    var targetBBox = linkView.targetBBox;\n    var sourcePoint = sourceBBox.center();\n    var targetPoint = targetBBox.center();\n\n    var coordinate, dimension, direction;\n\n    switch (side) {\n        case 'bottom':\n            direction = 1;\n            coordinate = 'y';\n            dimension = 'height';\n            break;\n        case 'top':\n            direction = -1;\n            coordinate = 'y';\n            dimension = 'height';\n            break;\n        case 'left':\n            direction = -1;\n            coordinate = 'x';\n            dimension = 'width';\n            break;\n        case 'right':\n            direction = 1;\n            coordinate = 'x';\n            dimension = 'width';\n            break;\n        default:\n            throw new Error('Router: invalid side');\n    }\n\n    // move the points from the center of the element to outside of it.\n    sourcePoint[coordinate] += direction * (sourceBBox[dimension] / 2 + padding[side]);\n    targetPoint[coordinate] += direction * (targetBBox[dimension] / 2 + padding[side]);\n\n    // make link orthogonal (at least the first and last vertex).\n    if ((direction * (sourcePoint[coordinate] - targetPoint[coordinate])) > 0) {\n        targetPoint[coordinate] = sourcePoint[coordinate];\n    } else {\n        sourcePoint[coordinate] = targetPoint[coordinate];\n    }\n\n    return [sourcePoint].concat(vertices, targetPoint);\n};\n\njoint.routers.orthogonal = (function(util) {\n\n    // bearing -> opposite bearing\n    var opposites = {\n        N: 'S',\n        S: 'N',\n        E: 'W',\n        W: 'E'\n    };\n\n    // bearing -> radians\n    var radians = {\n        N: -Math.PI / 2 * 3,\n        S: -Math.PI / 2,\n        E: 0,\n        W: Math.PI\n    };\n\n    // HELPERS //\n\n    // returns a point `p` where lines p,p1 and p,p2 are perpendicular and p is not contained\n    // in the given box\n    function freeJoin(p1, p2, bbox) {\n\n        var p = new g.Point(p1.x, p2.y);\n        if (bbox.containsPoint(p)) p = new g.Point(p2.x, p1.y);\n        // kept for reference\n        // if (bbox.containsPoint(p)) p = null;\n\n        return p;\n    }\n\n    // returns either width or height of a bbox based on the given bearing\n    function getBBoxSize(bbox, bearing) {\n\n        return bbox[(bearing === 'W' || bearing === 'E') ? 'width' : 'height'];\n    }\n\n    // simple bearing method (calculates only orthogonal cardinals)\n    function getBearing(from, to) {\n\n        if (from.x === to.x) return (from.y > to.y) ? 'N' : 'S';\n        if (from.y === to.y) return (from.x > to.x) ? 'W' : 'E';\n        return null;\n    }\n\n    // transform point to a rect\n    function getPointBox(p) {\n\n        return new g.Rect(p.x, p.y, 0, 0);\n    }\n\n    function getPaddingBox(opt) {\n\n        // if both provided, opt.padding wins over opt.elementPadding\n        var sides = util.normalizeSides(opt.padding || opt.elementPadding || 20);\n\n        return {\n            x: -sides.left,\n            y: -sides.top,\n            width: sides.left + sides.right,\n            height: sides.top + sides.bottom\n        };\n    }\n\n    // return source bbox\n    function getSourceBBox(linkView, opt) {\n\n        return linkView.sourceBBox.clone().moveAndExpand(getPaddingBox(opt));\n    }\n\n    // return target bbox\n    function getTargetBBox(linkView, opt) {\n\n        return linkView.targetBBox.clone().moveAndExpand(getPaddingBox(opt));\n    }\n\n    // return source anchor\n    function getSourceAnchor(linkView, opt) {\n\n        if (linkView.sourceAnchor) return linkView.sourceAnchor;\n\n        // fallback: center of bbox\n        var sourceBBox = getSourceBBox(linkView, opt);\n        return sourceBBox.center();\n    }\n\n    // return target anchor\n    function getTargetAnchor(linkView, opt) {\n\n        if (linkView.targetAnchor) return linkView.targetAnchor;\n\n        // fallback: center of bbox\n        var targetBBox = getTargetBBox(linkView, opt);\n        return targetBBox.center(); // default\n    }\n\n    // PARTIAL ROUTERS //\n\n    function vertexVertex(from, to, bearing) {\n\n        var p1 = new g.Point(from.x, to.y);\n        var p2 = new g.Point(to.x, from.y);\n        var d1 = getBearing(from, p1);\n        var d2 = getBearing(from, p2);\n        var opposite = opposites[bearing];\n\n        var p = (d1 === bearing || (d1 !== opposite && (d2 === opposite || d2 !== bearing))) ? p1 : p2;\n\n        return { points: [p], direction: getBearing(p, to) };\n    }\n\n    function elementVertex(from, to, fromBBox) {\n\n        var p = freeJoin(from, to, fromBBox);\n\n        return { points: [p], direction: getBearing(p, to) };\n    }\n\n    function vertexElement(from, to, toBBox, bearing) {\n\n        var route = {};\n\n        var points = [new g.Point(from.x, to.y), new g.Point(to.x, from.y)];\n        var freePoints = points.filter(function(pt) { return !toBBox.containsPoint(pt); });\n        var freeBearingPoints = freePoints.filter(function(pt) { return getBearing(pt, from) !== bearing; });\n\n        var p;\n\n        if (freeBearingPoints.length > 0) {\n            // Try to pick a point which bears the same direction as the previous segment.\n\n            p = freeBearingPoints.filter(function(pt) { return getBearing(from, pt) === bearing; }).pop();\n            p = p || freeBearingPoints[0];\n\n            route.points = [p];\n            route.direction = getBearing(p, to);\n\n        } else {\n            // Here we found only points which are either contained in the element or they would create\n            // a link segment going in opposite direction from the previous one.\n            // We take the point inside element and move it outside the element in the direction the\n            // route is going. Now we can join this point with the current end (using freeJoin).\n\n            p = util.difference(points, freePoints)[0];\n\n            var p2 = (new g.Point(to)).move(p, -getBBoxSize(toBBox, bearing) / 2);\n            var p1 = freeJoin(p2, from, toBBox);\n\n            route.points = [p1, p2];\n            route.direction = getBearing(p2, to);\n        }\n\n        return route;\n    }\n\n    function elementElement(from, to, fromBBox, toBBox) {\n\n        var route = elementVertex(to, from, toBBox);\n        var p1 = route.points[0];\n\n        if (fromBBox.containsPoint(p1)) {\n\n            route = elementVertex(from, to, fromBBox);\n            var p2 = route.points[0];\n\n            if (toBBox.containsPoint(p2)) {\n\n                var fromBorder = (new g.Point(from)).move(p2, -getBBoxSize(fromBBox, getBearing(from, p2)) / 2);\n                var toBorder = (new g.Point(to)).move(p1, -getBBoxSize(toBBox, getBearing(to, p1)) / 2);\n                var mid = (new g.Line(fromBorder, toBorder)).midpoint();\n\n                var startRoute = elementVertex(from, mid, fromBBox);\n                var endRoute = vertexVertex(mid, to, startRoute.direction);\n\n                route.points = [startRoute.points[0], endRoute.points[0]];\n                route.direction = endRoute.direction;\n            }\n        }\n\n        return route;\n    }\n\n    // Finds route for situations where one element is inside the other.\n    // Typically the route is directed outside the outer element first and\n    // then back towards the inner element.\n    function insideElement(from, to, fromBBox, toBBox, bearing) {\n\n        var route = {};\n        var boundary = fromBBox.union(toBBox).inflate(1);\n\n        // start from the point which is closer to the boundary\n        var reversed = boundary.center().distance(to) > boundary.center().distance(from);\n        var start = reversed ? to : from;\n        var end = reversed ? from : to;\n\n        var p1, p2, p3;\n\n        if (bearing) {\n            // Points on circle with radius equals 'W + H` are always outside the rectangle\n            // with width W and height H if the center of that circle is the center of that rectangle.\n            p1 = g.Point.fromPolar(boundary.width + boundary.height, radians[bearing], start);\n            p1 = boundary.pointNearestToPoint(p1).move(p1, -1);\n\n        } else {\n            p1 = boundary.pointNearestToPoint(start).move(start, 1);\n        }\n\n        p2 = freeJoin(p1, end, boundary);\n\n        if (p1.round().equals(p2.round())) {\n            p2 = g.Point.fromPolar(boundary.width + boundary.height, g.toRad(p1.theta(start)) + Math.PI / 2, end);\n            p2 = boundary.pointNearestToPoint(p2).move(end, 1).round();\n            p3 = freeJoin(p1, p2, boundary);\n            route.points = reversed ? [p2, p3, p1] : [p1, p3, p2];\n\n        } else {\n            route.points = reversed ? [p2, p1] : [p1, p2];\n        }\n\n        route.direction = reversed ? getBearing(p1, to) : getBearing(p2, to);\n\n        return route;\n    }\n\n    // MAIN ROUTER //\n\n    // Return points through which a connection needs to be drawn in order to obtain an orthogonal link\n    // routing from source to target going through `vertices`.\n    function router(vertices, opt, linkView) {\n\n        var sourceBBox = getSourceBBox(linkView, opt);\n        var targetBBox = getTargetBBox(linkView, opt);\n\n        var sourceAnchor = getSourceAnchor(linkView, opt);\n        var targetAnchor = getTargetAnchor(linkView, opt);\n\n        // if anchor lies outside of bbox, the bbox expands to include it\n        sourceBBox = sourceBBox.union(getPointBox(sourceAnchor));\n        targetBBox = targetBBox.union(getPointBox(targetAnchor));\n\n        vertices = util.toArray(vertices).map(g.Point);\n        vertices.unshift(sourceAnchor);\n        vertices.push(targetAnchor);\n\n        var bearing; // bearing of previous route segment\n\n        var orthogonalVertices = []; // the array of found orthogonal vertices to be returned\n        for (var i = 0, max = vertices.length - 1; i < max; i++) {\n\n            var route = null;\n\n            var from = vertices[i];\n            var to = vertices[i + 1];\n\n            var isOrthogonal = !!getBearing(from, to);\n\n            if (i === 0) { // source\n\n                if (i + 1 === max) { // route source -> target\n\n                    // Expand one of the elements by 1px to detect situations when the two\n                    // elements are positioned next to each other with no gap in between.\n                    if (sourceBBox.intersect(targetBBox.clone().inflate(1))) {\n                        route = insideElement(from, to, sourceBBox, targetBBox);\n\n                    } else if (!isOrthogonal) {\n                        route = elementElement(from, to, sourceBBox, targetBBox);\n                    }\n\n                } else { // route source -> vertex\n\n                    if (sourceBBox.containsPoint(to)) {\n                        route = insideElement(from, to, sourceBBox, getPointBox(to).moveAndExpand(getPaddingBox(opt)));\n\n                    } else if (!isOrthogonal) {\n                        route = elementVertex(from, to, sourceBBox);\n                    }\n                }\n\n            } else if (i + 1 === max) { // route vertex -> target\n\n                // prevent overlaps with previous line segment\n                var isOrthogonalLoop = isOrthogonal && getBearing(to, from) === bearing;\n\n                if (targetBBox.containsPoint(from) || isOrthogonalLoop) {\n                    route = insideElement(from, to, getPointBox(from).moveAndExpand(getPaddingBox(opt)), targetBBox, bearing);\n\n                } else if (!isOrthogonal) {\n                    route = vertexElement(from, to, targetBBox, bearing);\n                }\n\n            } else if (!isOrthogonal) { // route vertex -> vertex\n                route = vertexVertex(from, to, bearing);\n            }\n\n            // applicable to all routes:\n\n            // set bearing for next iteration\n            if (route) {\n                Array.prototype.push.apply(orthogonalVertices, route.points);\n                bearing = route.direction;\n\n            } else {\n                // orthogonal route and not looped\n                bearing = getBearing(from, to);\n            }\n\n            // push `to` point to identified orthogonal vertices array\n            if (i + 1 < max) {\n                orthogonalVertices.push(to);\n            }\n        }\n\n        return orthogonalVertices;\n    }\n\n    return router;\n\n})(joint.util);\n\njoint.connectors.normal = function(sourcePoint, targetPoint, route, opt) {\n\n    var raw = opt && opt.raw;\n    var points = [sourcePoint].concat(route).concat([targetPoint]);\n\n    var polyline = new g.Polyline(points);\n    var path = new g.Path(polyline);\n\n    return (raw) ? path : path.serialize();\n};\n\njoint.connectors.rounded = function(sourcePoint, targetPoint, route, opt) {\n\n    opt || (opt = {});\n\n    var offset = opt.radius || 10;\n    var raw = opt.raw;\n    var path = new g.Path();\n    var segment;\n\n    segment = g.Path.createSegment('M', sourcePoint);\n    path.appendSegment(segment);\n\n    var _13 = 1 / 3;\n    var _23 = 2 / 3;\n\n    var curr;\n    var prev, next;\n    var prevDistance, nextDistance;\n    var startMove, endMove;\n    var roundedStart, roundedEnd;\n    var control1, control2;\n\n    for (var index = 0, n = route.length; index < n; index++) {\n\n        curr = new g.Point(route[index]);\n\n        prev = route[index - 1] || sourcePoint;\n        next = route[index + 1] || targetPoint;\n\n        prevDistance = nextDistance || (curr.distance(prev) / 2);\n        nextDistance = curr.distance(next) / 2;\n\n        startMove = -Math.min(offset, prevDistance);\n        endMove = -Math.min(offset, nextDistance);\n\n        roundedStart = curr.clone().move(prev, startMove).round();\n        roundedEnd = curr.clone().move(next, endMove).round();\n\n        control1 = new g.Point((_13 * roundedStart.x) + (_23 * curr.x), (_23 * curr.y) + (_13 * roundedStart.y));\n        control2 = new g.Point((_13 * roundedEnd.x) + (_23 * curr.x), (_23 * curr.y) + (_13 * roundedEnd.y));\n\n        segment = g.Path.createSegment('L', roundedStart);\n        path.appendSegment(segment);\n\n        segment = g.Path.createSegment('C', control1, control2, roundedEnd);\n        path.appendSegment(segment);\n    }\n\n    segment = g.Path.createSegment('L', targetPoint);\n    path.appendSegment(segment);\n\n    return (raw) ? path : path.serialize();\n};\n\njoint.connectors.smooth = function(sourcePoint, targetPoint, route, opt) {\n\n    var raw = opt && opt.raw;\n    var path;\n\n    if (route && route.length !== 0) {\n\n        var points = [sourcePoint].concat(route).concat([targetPoint]);\n        var curves = g.Curve.throughPoints(points);\n\n        path = new g.Path(curves);\n\n    } else {\n        // if we have no route, use a default cubic bezier curve\n        // cubic bezier requires two control points\n        // the control points have `x` midway between source and target\n        // this produces an S-like curve\n\n        path = new g.Path();\n\n        var segment;\n\n        segment = g.Path.createSegment('M', sourcePoint);\n        path.appendSegment(segment);\n\n        if ((Math.abs(sourcePoint.x - targetPoint.x)) >= (Math.abs(sourcePoint.y - targetPoint.y))) {\n            var controlPointX = (sourcePoint.x + targetPoint.x) / 2;\n\n            segment = g.Path.createSegment('C', controlPointX, sourcePoint.y, controlPointX, targetPoint.y, targetPoint.x, targetPoint.y);\n            path.appendSegment(segment);\n\n        } else {\n            var controlPointY = (sourcePoint.y + targetPoint.y) / 2;\n\n            segment = g.Path.createSegment('C', sourcePoint.x, controlPointY, targetPoint.x, controlPointY, targetPoint.x, targetPoint.y);\n            path.appendSegment(segment);\n\n        }\n    }\n\n    return (raw) ? path : path.serialize();\n};\n\njoint.connectors.jumpover = (function(g, util) {\n\n    // default size of jump if not specified in options\n    var JUMP_SIZE = 5;\n\n    // available jump types\n    // first one taken as default\n    var JUMP_TYPES = ['arc', 'gap', 'cubic'];\n\n    // takes care of math. error for case when jump is too close to end of line\n    var CLOSE_PROXIMITY_PADDING = 1;\n\n    // list of connector types not to jump over.\n    var IGNORED_CONNECTORS = ['smooth'];\n\n    /**\n     * Transform start/end and route into series of lines\n     * @param {g.point} sourcePoint start point\n     * @param {g.point} targetPoint end point\n     * @param {g.point[]} route optional list of route\n     * @return {g.line[]} [description]\n     */\n    function createLines(sourcePoint, targetPoint, route) {\n        // make a flattened array of all points\n        var points = [].concat(sourcePoint, route, targetPoint);\n        return points.reduce(function(resultLines, point, idx) {\n            // if there is a next point, make a line with it\n            var nextPoint = points[idx + 1];\n            if (nextPoint != null) {\n                resultLines[idx] = g.line(point, nextPoint);\n            }\n            return resultLines;\n        }, []);\n    }\n\n    function setupUpdating(jumpOverLinkView) {\n        var updateList = jumpOverLinkView.paper._jumpOverUpdateList;\n\n        // first time setup for this paper\n        if (updateList == null) {\n            updateList = jumpOverLinkView.paper._jumpOverUpdateList = [];\n            jumpOverLinkView.paper.on('cell:pointerup', updateJumpOver);\n            jumpOverLinkView.paper.model.on('reset', function() {\n                updateList = jumpOverLinkView.paper._jumpOverUpdateList = [];\n            });\n        }\n\n        // add this link to a list so it can be updated when some other link is updated\n        if (updateList.indexOf(jumpOverLinkView) < 0) {\n            updateList.push(jumpOverLinkView);\n\n            // watch for change of connector type or removal of link itself\n            // to remove the link from a list of jump over connectors\n            jumpOverLinkView.listenToOnce(jumpOverLinkView.model, 'change:connector remove', function() {\n                updateList.splice(updateList.indexOf(jumpOverLinkView), 1);\n            });\n        }\n    }\n\n    /**\n     * Handler for a batch:stop event to force\n     * update of all registered links with jump over connector\n     * @param {object} batchEvent optional object with info about batch\n     */\n    function updateJumpOver() {\n        var updateList = this._jumpOverUpdateList;\n        for (var i = 0; i < updateList.length; i++) {\n            updateList[i].update();\n        }\n    }\n\n    /**\n     * Utility function to collect all intersection poinst of a single\n     * line against group of other lines.\n     * @param {g.line} line where to find points\n     * @param {g.line[]} crossCheckLines lines to cross\n     * @return {g.point[]} list of intersection points\n     */\n    function findLineIntersections(line, crossCheckLines) {\n        return util.toArray(crossCheckLines).reduce(function(res, crossCheckLine) {\n            var intersection = line.intersection(crossCheckLine);\n            if (intersection) {\n                res.push(intersection);\n            }\n            return res;\n        }, []);\n    }\n\n    /**\n     * Sorting function for list of points by their distance.\n     * @param {g.point} p1 first point\n     * @param {g.point} p2 second point\n     * @return {number} squared distance between points\n     */\n    function sortPoints(p1, p2) {\n        return g.line(p1, p2).squaredLength();\n    }\n\n    /**\n     * Split input line into multiple based on intersection points.\n     * @param {g.line} line input line to split\n     * @param {g.point[]} intersections poinst where to split the line\n     * @param {number} jumpSize the size of jump arc (length empty spot on a line)\n     * @return {g.line[]} list of lines being split\n     */\n    function createJumps(line, intersections, jumpSize) {\n        return intersections.reduce(function(resultLines, point, idx) {\n            // skipping points that were merged with the previous line\n            // to make bigger arc over multiple lines that are close to each other\n            if (point.skip === true) {\n                return resultLines;\n            }\n\n            // always grab the last line from buffer and modify it\n            var lastLine = resultLines.pop() || line;\n\n            // calculate start and end of jump by moving by a given size of jump\n            var jumpStart = g.point(point).move(lastLine.start, -(jumpSize));\n            var jumpEnd = g.point(point).move(lastLine.start, +(jumpSize));\n\n            // now try to look at the next intersection point\n            var nextPoint = intersections[idx + 1];\n            if (nextPoint != null) {\n                var distance = jumpEnd.distance(nextPoint);\n                if (distance <= jumpSize) {\n                    // next point is close enough, move the jump end by this\n                    // difference and mark the next point to be skipped\n                    jumpEnd = nextPoint.move(lastLine.start, distance);\n                    nextPoint.skip = true;\n                }\n            } else {\n                // this block is inside of `else` as an optimization so the distance is\n                // not calculated when we know there are no other intersection points\n                var endDistance = jumpStart.distance(lastLine.end);\n                // if the end is too close to possible jump, draw remaining line instead of a jump\n                if (endDistance < jumpSize * 2 + CLOSE_PROXIMITY_PADDING) {\n                    resultLines.push(lastLine);\n                    return resultLines;\n                }\n            }\n\n            var startDistance = jumpEnd.distance(lastLine.start);\n            if (startDistance < jumpSize * 2 + CLOSE_PROXIMITY_PADDING) {\n                // if the start of line is too close to jump, draw that line instead of a jump\n                resultLines.push(lastLine);\n                return resultLines;\n            }\n\n            // finally create a jump line\n            var jumpLine = g.line(jumpStart, jumpEnd);\n            // it's just simple line but with a `isJump` property\n            jumpLine.isJump = true;\n\n            resultLines.push(\n                g.line(lastLine.start, jumpStart),\n                jumpLine,\n                g.line(jumpEnd, lastLine.end)\n            );\n            return resultLines;\n        }, []);\n    }\n\n    /**\n     * Assemble `D` attribute of a SVG path by iterating given lines.\n     * @param {g.line[]} lines source lines to use\n     * @param {number} jumpSize the size of jump arc (length empty spot on a line)\n     * @return {string}\n     */\n    function buildPath(lines, jumpSize, jumpType) {\n\n        var path = new g.Path();\n        var segment;\n\n        // first move to the start of a first line\n        segment = g.Path.createSegment('M', lines[0].start);\n        path.appendSegment(segment);\n\n        // make a paths from lines\n        joint.util.toArray(lines).forEach(function(line, index) {\n\n            if (line.isJump) {\n                var angle, diff;\n\n                var control1, control2;\n\n                if (jumpType === 'arc') { // approximates semicircle with 2 curves\n                    angle = -90;\n                    // determine rotation of arc based on difference between points\n                    diff = line.start.difference(line.end);\n                    // make sure the arc always points up (or right)\n                    var xAxisRotate = Number((diff.x < 0) || (diff.x === 0 && diff.y < 0));\n                    if (xAxisRotate) angle += 180;\n\n                    var midpoint = line.midpoint();\n                    var centerLine = new g.Line(midpoint, line.end).rotate(midpoint, angle);\n\n                    var halfLine;\n\n                    // first half\n                    halfLine = new g.Line(line.start, midpoint);\n\n                    control1 = halfLine.pointAt(2 / 3).rotate(line.start, angle);\n                    control2 = centerLine.pointAt(1 / 3).rotate(centerLine.end, -angle);\n\n                    segment = g.Path.createSegment('C', control1, control2, centerLine.end);\n                    path.appendSegment(segment);\n\n                    // second half\n                    halfLine = new g.Line(midpoint, line.end);\n\n                    control1 = centerLine.pointAt(1 / 3).rotate(centerLine.end, angle);\n                    control2 = halfLine.pointAt(1 / 3).rotate(line.end, -angle);\n\n                    segment = g.Path.createSegment('C', control1, control2, line.end);\n                    path.appendSegment(segment);\n\n                } else if (jumpType === 'gap') {\n                    segment = g.Path.createSegment('M', line.end);\n                    path.appendSegment(segment);\n\n                } else if (jumpType === 'cubic') { // approximates semicircle with 1 curve\n                    angle = line.start.theta(line.end);\n\n                    var xOffset = jumpSize * 0.6;\n                    var yOffset = jumpSize * 1.35;\n\n                    // determine rotation of arc based on difference between points\n                    diff = line.start.difference(line.end);\n                    // make sure the arc always points up (or right)\n                    xAxisRotate = Number((diff.x < 0) || (diff.x === 0 && diff.y < 0));\n                    if (xAxisRotate) yOffset *= -1;\n\n                    control1 = g.Point(line.start.x + xOffset, line.start.y + yOffset).rotate(line.start, angle);\n                    control2 = g.Point(line.end.x - xOffset, line.end.y + yOffset).rotate(line.end, angle);\n\n                    segment = g.Path.createSegment('C', control1, control2, line.end);\n                    path.appendSegment(segment);\n                }\n\n            } else {\n                segment = g.Path.createSegment('L', line.end);\n                path.appendSegment(segment);\n            }\n        });\n\n        return path;\n    }\n\n    /**\n     * Actual connector function that will be run on every update.\n     * @param {g.point} sourcePoint start point of this link\n     * @param {g.point} targetPoint end point of this link\n     * @param {g.point[]} route of this link\n     * @param {object} opt options\n     * @property {number} size optional size of a jump arc\n     * @return {string} created `D` attribute of SVG path\n     */\n    return function(sourcePoint, targetPoint, route, opt) { // eslint-disable-line max-params\n\n        setupUpdating(this);\n\n        var raw = opt.raw;\n        var jumpSize = opt.size || JUMP_SIZE;\n        var jumpType = opt.jump && ('' + opt.jump).toLowerCase();\n        var ignoreConnectors = opt.ignoreConnectors || IGNORED_CONNECTORS;\n\n        // grab the first jump type as a default if specified one is invalid\n        if (JUMP_TYPES.indexOf(jumpType) === -1) {\n            jumpType = JUMP_TYPES[0];\n        }\n\n        var paper = this.paper;\n        var graph = paper.model;\n        var allLinks = graph.getLinks();\n\n        // there is just one link, draw it directly\n        if (allLinks.length === 1) {\n            return buildPath(\n                createLines(sourcePoint, targetPoint, route),\n                jumpSize, jumpType\n            );\n        }\n\n        var thisModel = this.model;\n        var thisIndex = allLinks.indexOf(thisModel);\n        var defaultConnector = paper.options.defaultConnector || {};\n\n        // not all links are meant to be jumped over.\n        var links = allLinks.filter(function(link, idx) {\n\n            var connector = link.get('connector') || defaultConnector;\n\n            // avoid jumping over links with connector type listed in `ignored connectors`.\n            if (util.toArray(ignoreConnectors).includes(connector.name)) {\n                return false;\n            }\n            // filter out links that are above this one and  have the same connector type\n            // otherwise there would double hoops for each intersection\n            if (idx > thisIndex) {\n                return connector.name !== 'jumpover';\n            }\n            return true;\n        });\n\n        // find views for all links\n        var linkViews = links.map(function(link) {\n            return paper.findViewByModel(link);\n        });\n\n        // create lines for this link\n        var thisLines = createLines(\n            sourcePoint,\n            targetPoint,\n            route\n        );\n\n        // create lines for all other links\n        var linkLines = linkViews.map(function(linkView) {\n            if (linkView == null) {\n                return [];\n            }\n            if (linkView === this) {\n                return thisLines;\n            }\n            return createLines(\n                linkView.sourcePoint,\n                linkView.targetPoint,\n                linkView.route\n            );\n        }, this);\n\n        // transform lines for this link by splitting with jump lines at\n        // points of intersection with other links\n        var jumpingLines = thisLines.reduce(function(resultLines, thisLine) {\n            // iterate all links and grab the intersections with this line\n            // these are then sorted by distance so the line can be split more easily\n\n            var intersections = links.reduce(function(res, link, i) {\n                // don't intersection with itself\n                if (link !== thisModel) {\n\n                    var lineIntersections = findLineIntersections(thisLine, linkLines[i]);\n                    res.push.apply(res, lineIntersections);\n                }\n                return res;\n            }, []).sort(function(a, b) {\n                return sortPoints(thisLine.start, a) - sortPoints(thisLine.start, b);\n            });\n\n            if (intersections.length > 0) {\n                // split the line based on found intersection points\n                resultLines.push.apply(resultLines, createJumps(thisLine, intersections, jumpSize));\n            } else {\n                // without any intersection the line goes uninterrupted\n                resultLines.push(thisLine);\n            }\n            return resultLines;\n        }, []);\n\n        var path = buildPath(jumpingLines, jumpSize, jumpType);\n        return (raw) ? path : path.serialize();\n    };\n}(g, joint.util));\n\n(function(g, joint, util) {\n\n    function portTransformAttrs(point, angle, opt) {\n\n        var trans = point.toJSON();\n\n        trans.angle = angle || 0;\n\n        return joint.util.defaults({}, opt, trans);\n    }\n\n    function lineLayout(ports, p1, p2) {\n        return ports.map(function(port, index, ports) {\n            var p = this.pointAt(((index + 0.5) / ports.length));\n            // `dx`,`dy` per port offset option\n            if (port.dx || port.dy) {\n                p.offset(port.dx || 0, port.dy || 0);\n            }\n\n            return portTransformAttrs(p.round(), 0, port);\n        }, g.line(p1, p2));\n    }\n\n    function ellipseLayout(ports, elBBox, startAngle, stepFn) {\n\n        var center = elBBox.center();\n        var ratio = elBBox.width / elBBox.height;\n        var p1 = elBBox.topMiddle();\n\n        var ellipse = g.Ellipse.fromRect(elBBox);\n\n        return ports.map(function(port, index, ports) {\n\n            var angle = startAngle + stepFn(index, ports.length);\n            var p2 = p1.clone()\n                .rotate(center, -angle)\n                .scale(ratio, 1, center);\n\n            var theta = port.compensateRotation ? -ellipse.tangentTheta(p2) : 0;\n\n            // `dx`,`dy` per port offset option\n            if (port.dx || port.dy) {\n                p2.offset(port.dx || 0, port.dy || 0);\n            }\n\n            // `dr` delta radius option\n            if (port.dr) {\n                p2.move(center, port.dr);\n            }\n\n            return portTransformAttrs(p2.round(), theta, port);\n        });\n    }\n\n    // Creates a point stored in arguments\n    function argPoint(bbox, args) {\n\n        var x = args.x;\n        if (util.isString(x)) {\n            x = parseFloat(x) / 100 * bbox.width;\n        }\n\n        var y = args.y;\n        if (util.isString(y)) {\n            y = parseFloat(y) / 100 * bbox.height;\n        }\n\n        return g.point(x || 0, y || 0);\n    }\n\n    joint.layout.Port = {\n\n        /**\n         * @param {Array<Object>} ports\n         * @param {g.Rect} elBBox\n         * @param {Object=} opt opt Group options\n         * @returns {Array<g.Point>}\n         */\n        absolute: function(ports, elBBox, opt) {\n            //TODO v.talas angle\n            return ports.map(argPoint.bind(null, elBBox));\n        },\n\n        /**\n         * @param {Array<Object>} ports\n         * @param {g.Rect} elBBox\n         * @param {Object=} opt opt Group options\n         * @returns {Array<g.Point>}\n         */\n        fn: function(ports, elBBox, opt) {\n            return opt.fn(ports, elBBox, opt);\n        },\n\n        /**\n         * @param {Array<Object>} ports\n         * @param {g.Rect} elBBox\n         * @param {Object=} opt opt Group options\n         * @returns {Array<g.Point>}\n         */\n        line: function(ports, elBBox, opt) {\n\n            var start = argPoint(elBBox, opt.start || elBBox.origin());\n            var end = argPoint(elBBox, opt.end || elBBox.corner());\n\n            return lineLayout(ports, start, end);\n        },\n\n        /**\n         * @param {Array<Object>} ports\n         * @param {g.Rect} elBBox\n         * @param {Object=} opt opt Group options\n         * @returns {Array<g.Point>}\n         */\n        left: function(ports, elBBox, opt) {\n            return lineLayout(ports, elBBox.origin(), elBBox.bottomLeft());\n        },\n\n        /**\n         * @param {Array<Object>} ports\n         * @param {g.Rect} elBBox\n         * @param {Object=} opt opt Group options\n         * @returns {Array<g.Point>}\n         */\n        right: function(ports, elBBox, opt) {\n            return lineLayout(ports, elBBox.topRight(), elBBox.corner());\n        },\n\n        /**\n         * @param {Array<Object>} ports\n         * @param {g.Rect} elBBox\n         * @param {Object=} opt opt Group options\n         * @returns {Array<g.Point>}\n         */\n        top: function(ports, elBBox, opt) {\n            return lineLayout(ports, elBBox.origin(), elBBox.topRight());\n        },\n\n        /**\n         * @param {Array<Object>} ports\n         * @param {g.Rect} elBBox\n         * @param {Object=} opt opt Group options\n         * @returns {Array<g.Point>}\n         */\n        bottom: function(ports, elBBox, opt) {\n            return lineLayout(ports, elBBox.bottomLeft(), elBBox.corner());\n        },\n\n        /**\n         * @param {Array<Object>} ports\n         * @param {g.Rect} elBBox\n         * @param {Object=} opt Group options\n         * @returns {Array<g.Point>}\n         */\n        ellipseSpread: function(ports, elBBox, opt) {\n\n            var startAngle = opt.startAngle || 0;\n            var stepAngle = opt.step || 360 / ports.length;\n\n            return ellipseLayout(ports, elBBox, startAngle, function(index) {\n                return index * stepAngle;\n            });\n        },\n\n        /**\n         * @param {Array<Object>} ports\n         * @param {g.Rect} elBBox\n         * @param {Object=} opt Group options\n         * @returns {Array<g.Point>}\n         */\n        ellipse: function(ports, elBBox, opt) {\n\n            var startAngle = opt.startAngle || 0;\n            var stepAngle = opt.step || 20;\n\n            return ellipseLayout(ports, elBBox, startAngle, function(index, count) {\n                return (index + 0.5 - count / 2) * stepAngle;\n            });\n        }\n    };\n\n})(g, joint, joint.util);\n\n(function(g, joint, util) {\n\n    function labelAttributes(opt1, opt2) {\n\n        return util.defaultsDeep({}, opt1, opt2, {\n            x: 0,\n            y: 0,\n            angle: 0,\n            attrs: {\n                '.': {\n                    y: '0',\n                    'text-anchor': 'start'\n                }\n            }\n        });\n\n    }\n\n    function outsideLayout(portPosition, elBBox, autoOrient, opt) {\n\n        opt = util.defaults({}, opt, { offset: 15 });\n        var angle = elBBox.center().theta(portPosition);\n        var x = getBBoxAngles(elBBox);\n\n        var tx, ty, y, textAnchor;\n        var offset = opt.offset;\n        var orientAngle = 0;\n\n        if (angle < x[1] || angle > x[2]) {\n            y = '.3em';\n            tx = offset;\n            ty = 0;\n            textAnchor = 'start';\n        } else if (angle < x[0]) {\n            y = '0';\n            tx = 0;\n            ty = -offset;\n            if (autoOrient) {\n                orientAngle = -90;\n                textAnchor = 'start';\n            } else {\n                textAnchor = 'middle';\n            }\n        } else if (angle < x[3]) {\n            y = '.3em';\n            tx = -offset;\n            ty = 0;\n            textAnchor = 'end';\n        } else {\n            y = '.6em';\n            tx = 0;\n            ty = offset;\n            if (autoOrient) {\n                orientAngle = 90;\n                textAnchor = 'start';\n            } else {\n                textAnchor = 'middle';\n            }\n        }\n\n        var round = Math.round;\n        return labelAttributes({\n            x: round(tx),\n            y: round(ty),\n            angle: orientAngle,\n            attrs: {\n                '.': {\n                    y: y,\n                    'text-anchor': textAnchor\n                }\n            }\n        });\n    }\n\n    function getBBoxAngles(elBBox) {\n\n        var center = elBBox.center();\n\n        var tl = center.theta(elBBox.origin());\n        var bl = center.theta(elBBox.bottomLeft());\n        var br = center.theta(elBBox.corner());\n        var tr = center.theta(elBBox.topRight());\n\n        return [tl, tr, br, bl];\n    }\n\n    function insideLayout(portPosition, elBBox, autoOrient, opt) {\n\n        var angle = elBBox.center().theta(portPosition);\n        opt = util.defaults({}, opt, { offset: 15 });\n\n        var tx, ty, y, textAnchor;\n        var offset = opt.offset;\n        var orientAngle = 0;\n\n        var bBoxAngles = getBBoxAngles(elBBox);\n\n        if (angle < bBoxAngles[1] || angle > bBoxAngles[2]) {\n            y = '.3em';\n            tx = -offset;\n            ty = 0;\n            textAnchor = 'end';\n        } else if (angle < bBoxAngles[0]) {\n            y = '.6em';\n            tx = 0;\n            ty = offset;\n            if (autoOrient) {\n                orientAngle = 90;\n                textAnchor = 'start';\n            } else {\n                textAnchor = 'middle';\n            }\n        } else if (angle < bBoxAngles[3]) {\n            y = '.3em';\n            tx = offset;\n            ty = 0;\n            textAnchor = 'start';\n        } else {\n            y = '0em';\n            tx = 0;\n            ty = -offset;\n            if (autoOrient) {\n                orientAngle = -90;\n                textAnchor = 'start';\n            } else {\n                textAnchor = 'middle';\n            }\n        }\n\n        var round = Math.round;\n        return labelAttributes({\n            x: round(tx),\n            y: round(ty),\n            angle: orientAngle,\n            attrs: {\n                '.': {\n                    y: y,\n                    'text-anchor': textAnchor\n                }\n            }\n        });\n    }\n\n    function radialLayout(portCenterOffset, autoOrient, opt) {\n\n        opt = util.defaults({}, opt, { offset: 20 });\n\n        var origin = g.point(0, 0);\n        var angle = -portCenterOffset.theta(origin);\n        var orientAngle = angle;\n        var offset = portCenterOffset.clone()\n            .move(origin, opt.offset)\n            .difference(portCenterOffset)\n            .round();\n\n        var y = '.3em';\n        var textAnchor;\n\n        if ((angle + 90) % 180 === 0) {\n            textAnchor = autoOrient ? 'end' : 'middle';\n            if (!autoOrient && angle === -270) {\n                y = '0em';\n            }\n        } else if (angle > -270 && angle < -90) {\n            textAnchor = 'start';\n            orientAngle = angle - 180;\n        } else {\n            textAnchor = 'end';\n        }\n\n        var round = Math.round;\n        return labelAttributes({\n            x: round(offset.x),\n            y: round(offset.y),\n            angle: autoOrient ? orientAngle : 0,\n            attrs: {\n                '.': {\n                    y: y,\n                    'text-anchor': textAnchor\n                }\n            }\n        });\n    }\n\n    joint.layout.PortLabel = {\n\n        manual: function(portPosition, elBBox, opt) {\n            return labelAttributes(opt, elBBox);\n        },\n\n        left: function(portPosition, elBBox, opt) {\n            return labelAttributes(opt, { x: -15, attrs: { '.': { y: '.3em', 'text-anchor': 'end' }}});\n        },\n\n        right: function(portPosition, elBBox, opt) {\n            return labelAttributes(opt, { x: 15, attrs: { '.': { y: '.3em', 'text-anchor': 'start' }}});\n        },\n\n        top: function(portPosition, elBBox, opt) {\n            return labelAttributes(opt, { y: -15, attrs: { '.': { 'text-anchor': 'middle' }}});\n        },\n\n        bottom: function(portPosition, elBBox, opt) {\n            return labelAttributes(opt, { y: 15, attrs: { '.': { y: '.6em', 'text-anchor': 'middle' }}});\n        },\n\n        outsideOriented: function(portPosition, elBBox, opt) {\n            return outsideLayout(portPosition, elBBox, true, opt);\n        },\n\n        outside: function(portPosition, elBBox, opt) {\n            return outsideLayout(portPosition, elBBox, false, opt);\n        },\n\n        insideOriented: function(portPosition, elBBox, opt) {\n            return insideLayout(portPosition, elBBox, true, opt);\n        },\n\n        inside: function(portPosition, elBBox, opt) {\n            return insideLayout(portPosition, elBBox, false, opt);\n        },\n\n        radial: function(portPosition, elBBox, opt) {\n            return radialLayout(portPosition.difference(elBBox.center()), false, opt);\n        },\n\n        radialOriented: function(portPosition, elBBox, opt) {\n            return radialLayout(portPosition.difference(elBBox.center()), true, opt);\n        }\n    };\n\n})(g, joint, joint.util);\n\njoint.highlighters.addClass = {\n\n    className: joint.util.addClassNamePrefix('highlighted'),\n\n    /**\n     * @param {joint.dia.CellView} cellView\n     * @param {Element} magnetEl\n     * @param {object=} opt\n     */\n    highlight: function(cellView, magnetEl, opt) {\n\n        var options = opt || {};\n        var className = options.className || this.className;\n        V(magnetEl).addClass(className);\n    },\n\n    /**\n     * @param {joint.dia.CellView} cellView\n     * @param {Element} magnetEl\n     * @param {object=} opt\n     */\n    unhighlight: function(cellView, magnetEl, opt) {\n\n        var options = opt || {};\n        var className = options.className || this.className;\n        V(magnetEl).removeClass(className);\n    }\n};\n\njoint.highlighters.opacity = {\n\n    /**\n     * @param {joint.dia.CellView} cellView\n     * @param {Element} magnetEl\n     */\n    highlight: function(cellView, magnetEl) {\n\n        V(magnetEl).addClass(joint.util.addClassNamePrefix('highlight-opacity'));\n    },\n\n    /**\n     * @param {joint.dia.CellView} cellView\n     * @param {Element} magnetEl\n     */\n    unhighlight: function(cellView, magnetEl) {\n\n        V(magnetEl).removeClass(joint.util.addClassNamePrefix('highlight-opacity'));\n    }\n};\n\njoint.highlighters.stroke = {\n\n    defaultOptions: {\n        padding: 3,\n        rx: 0,\n        ry: 0,\n        attrs: {\n            'stroke-width': 3,\n            'stroke': '#FEB663'\n        }\n    },\n\n    _views: {},\n\n    getHighlighterId: function(magnetEl, opt) {\n\n        return magnetEl.id + JSON.stringify(opt);\n    },\n\n    removeHighlighter: function(id) {\n        if (this._views[id]) {\n            this._views[id].remove();\n            this._views[id] = null;\n        }\n    },\n\n    /**\n     * @param {joint.dia.CellView} cellView\n     * @param {Element} magnetEl\n     * @param {object=} opt\n     */\n    highlight: function(cellView, magnetEl, opt) {\n\n        var id = this.getHighlighterId(magnetEl, opt);\n\n        // Only highlight once.\n        if (this._views[id]) return;\n\n        var options = joint.util.defaults(opt || {}, this.defaultOptions);\n\n        var magnetVel = V(magnetEl);\n        var magnetBBox;\n\n        try {\n\n            var pathData = magnetVel.convertToPathData();\n\n        } catch (error) {\n\n            // Failed to get path data from magnet element.\n            // Draw a rectangle around the entire cell view instead.\n            magnetBBox = magnetVel.bbox(true/* without transforms */);\n            pathData = V.rectToPath(joint.util.assign({}, options, magnetBBox));\n        }\n\n        var highlightVel = V('path').attr({\n            'd': pathData,\n            'pointer-events': 'none',\n            'vector-effect': 'non-scaling-stroke',\n            'fill': 'none'\n        }).attr(options.attrs);\n\n        var highlightMatrix = magnetVel.getTransformToElement(cellView.el);\n\n        // Add padding to the highlight element.\n        var padding = options.padding;\n        if (padding) {\n\n            magnetBBox || (magnetBBox = magnetVel.bbox(true));\n\n            var cx = magnetBBox.x + (magnetBBox.width / 2);\n            var cy = magnetBBox.y + (magnetBBox.height / 2);\n\n            magnetBBox = V.transformRect(magnetBBox, highlightMatrix);\n\n            var width = Math.max(magnetBBox.width, 1);\n            var height = Math.max(magnetBBox.height, 1);\n            var sx = (width + padding) / width;\n            var sy = (height + padding) / height;\n\n            var paddingMatrix = V.createSVGMatrix({\n                a: sx,\n                b: 0,\n                c: 0,\n                d: sy,\n                e: cx - sx * cx,\n                f: cy - sy * cy\n            });\n\n            highlightMatrix = highlightMatrix.multiply(paddingMatrix);\n        }\n\n        highlightVel.transform(highlightMatrix);\n\n        // joint.mvc.View will handle the theme class name and joint class name prefix.\n        var highlightView = this._views[id] = new joint.mvc.View({\n            svgElement: true,\n            className: 'highlight-stroke',\n            el: highlightVel.node\n        });\n\n        // Remove the highlight view when the cell is removed from the graph.\n        var removeHandler = this.removeHighlighter.bind(this, id);\n        var cell = cellView.model;\n        highlightView.listenTo(cell, 'remove', removeHandler);\n        highlightView.listenTo(cell.graph, 'reset', removeHandler);\n\n        cellView.vel.append(highlightVel);\n    },\n\n    /**\n     * @param {joint.dia.CellView} cellView\n     * @param {Element} magnetEl\n     * @param {object=} opt\n     */\n    unhighlight: function(cellView, magnetEl, opt) {\n\n        this.removeHighlighter(this.getHighlighterId(magnetEl, opt));\n    }\n};\n\n(function(joint, util) {\n\n    function bboxWrapper(method) {\n\n        return function(view, magnet, ref, opt) {\n\n            var rotate = !!opt.rotate;\n            var bbox = (rotate) ? view.getNodeUnrotatedBBox(magnet) : view.getNodeBBox(magnet);\n            var anchor = bbox[method]();\n\n            var dx = opt.dx;\n            if (dx) {\n                var dxPercentage = util.isPercentage(dx);\n                dx = parseFloat(dx);\n                if (isFinite(dx)) {\n                    if (dxPercentage) {\n                        dx /= 100;\n                        dx *= bbox.width;\n                    }\n                    anchor.x += dx;\n                }\n            }\n\n            var dy = opt.dy;\n            if (dy) {\n                var dyPercentage = util.isPercentage(dy);\n                dy = parseFloat(dy);\n                if (isFinite(dy)) {\n                    if (dyPercentage) {\n                        dy /= 100;\n                        dy *= bbox.height;\n                    }\n                    anchor.y += dy;\n                }\n            }\n\n            return (rotate) ? anchor.rotate(view.model.getBBox().center(), -view.model.angle()) : anchor;\n        };\n    }\n\n    function resolveRefAsBBoxCenter(fn) {\n\n        return function(view, magnet, ref, opt) {\n\n            if (ref instanceof Element) {\n                var refView = this.paper.findView(ref);\n                var refPoint = (refView)\n                    ? refView.getNodeBBox(ref).center()\n                    : new g.Point();\n\n                return fn.call(this, view, magnet, refPoint, opt);\n            }\n\n            return fn.apply(this, arguments);\n        };\n    }\n\n    function perpendicular(view, magnet, refPoint, opt) {\n\n        var angle = view.model.angle();\n        var bbox = view.getNodeBBox(magnet);\n        var anchor = bbox.center();\n        var topLeft = bbox.origin();\n        var bottomRight = bbox.corner();\n\n        var padding = opt.padding;\n        if (!isFinite(padding)) padding = 0;\n\n        if ((topLeft.y + padding) <= refPoint.y && refPoint.y <= (bottomRight.y - padding)) {\n            var dy = (refPoint.y - anchor.y);\n            anchor.x += (angle === 0 || angle === 180) ? 0 : dy * 1 / Math.tan(g.toRad(angle));\n            anchor.y += dy;\n        } else if ((topLeft.x + padding) <= refPoint.x && refPoint.x <= (bottomRight.x - padding)) {\n            var dx = (refPoint.x - anchor.x);\n            anchor.y += (angle === 90 || angle === 270) ? 0 : dx * Math.tan(g.toRad(angle));\n            anchor.x += dx;\n        }\n\n        return anchor;\n    }\n\n    function midSide(view, magnet, refPoint, opt) {\n\n        var rotate = !!opt.rotate;\n        var bbox, angle, center;\n        if (rotate) {\n            bbox = view.getNodeUnrotatedBBox(magnet);\n            center = view.model.getBBox().center();\n            angle = view.model.angle();\n        } else {\n            bbox = view.getNodeBBox(magnet);\n        }\n\n        var padding = opt.padding;\n        if (isFinite(padding)) bbox.inflate(padding);\n\n        if (rotate) refPoint.rotate(center, angle);\n\n        var side = bbox.sideNearestToPoint(refPoint);\n        var anchor;\n        switch (side) {\n            case 'left': anchor = bbox.leftMiddle(); break;\n            case 'right': anchor = bbox.rightMiddle(); break;\n            case 'top': anchor = bbox.topMiddle(); break;\n            case 'bottom': anchor = bbox.bottomMiddle(); break;\n        }\n\n        return (rotate) ? anchor.rotate(center, -angle) : anchor;\n    }\n\n    // Can find anchor from model, when there is no selector or the link end\n    // is connected to a port\n    function modelCenter(view, magnet) {\n\n        var model = view.model;\n        var bbox = model.getBBox();\n        var center = bbox.center();\n        var angle = model.angle();\n\n        var portId = view.findAttribute('port', magnet);\n        if (portId) {\n            var portGroup = model.portProp(portId, 'group');\n            var portsPositions = model.getPortsPositions(portGroup);\n            var anchor = new g.Point(portsPositions[portId]).offset(bbox.origin());\n            anchor.rotate(center, -angle);\n            return anchor;\n        }\n\n        return center;\n    }\n\n    joint.anchors = {\n        center: bboxWrapper('center'),\n        top: bboxWrapper('topMiddle'),\n        bottom: bboxWrapper('bottomMiddle'),\n        left: bboxWrapper('leftMiddle'),\n        right: bboxWrapper('rightMiddle'),\n        topLeft: bboxWrapper('origin'),\n        topRight: bboxWrapper('topRight'),\n        bottomLeft: bboxWrapper('bottomLeft'),\n        bottomRight: bboxWrapper('corner'),\n        perpendicular: resolveRefAsBBoxCenter(perpendicular),\n        midSide: resolveRefAsBBoxCenter(midSide),\n        modelCenter: modelCenter\n    };\n\n})(joint, joint.util);\n\n(function(joint, util, g, V) {\n\n    function closestIntersection(intersections, refPoint) {\n\n        if (intersections.length === 1) return intersections[0];\n        return util.sortBy(intersections, function(i) { return i.squaredDistance(refPoint); })[0];\n    }\n\n    function offset(p1, p2, offset) {\n\n        if (!isFinite(offset)) return p1;\n        var length = p1.distance(p2);\n        if (offset === 0 && length > 0) return p1;\n        return p1.move(p2, -Math.min(offset, length - 1));\n    }\n\n    function stroke(magnet) {\n\n        var stroke = magnet.getAttribute('stroke-width');\n        if (stroke === null) return 0;\n        return parseFloat(stroke) || 0;\n    }\n\n    // Connection Points\n\n    function anchor(line, view, magnet, opt) {\n\n        return offset(line.end, line.start, opt.offset);\n    }\n\n    function bboxIntersection(line, view, magnet, opt) {\n\n        var bbox = view.getNodeBBox(magnet);\n        if (opt.stroke) bbox.inflate(stroke(magnet) / 2);\n        var intersections = line.intersect(bbox);\n        var cp = (intersections)\n            ? closestIntersection(intersections, line.start)\n            : line.end;\n        return offset(cp, line.start, opt.offset);\n    }\n\n    function rectangleIntersection(line, view, magnet, opt) {\n\n        var angle = view.model.angle();\n        if (angle === 0) {\n            return bboxIntersection(line, view, magnet, opt);\n        }\n\n        var bboxWORotation = view.getNodeUnrotatedBBox(magnet);\n        if (opt.stroke) bboxWORotation.inflate(stroke(magnet) / 2);\n        var center = bboxWORotation.center();\n        var lineWORotation = line.clone().rotate(center, angle);\n        var intersections = lineWORotation.setLength(1e6).intersect(bboxWORotation);\n        var cp = (intersections)\n            ? closestIntersection(intersections, lineWORotation.start).rotate(center, -angle)\n            : line.end;\n        return offset(cp, line.start, opt.offset);\n    }\n\n    function findShapeNode(magnet) {\n        if (!magnet) return null;\n        var node = magnet;\n        do {\n            var tagName = node.tagName;\n            if (typeof tagName !== 'string') return null;\n            tagName = tagName.toUpperCase();\n            if (tagName === 'G') {\n                node = node.firstElementChild;\n            } else if (tagName === 'TITLE') {\n                node = node.nextElementSibling;\n            } else break;\n        } while (node);\n        return node;\n    }\n\n    var BNDR_SUBDIVISIONS = 'segmentSubdivisons';\n    var BNDR_SHAPE_BBOX = 'shapeBBox';\n\n    function boundaryIntersection(line, view, magnet, opt) {\n\n        var node, intersection;\n        var selector = opt.selector;\n        var anchor = line.end;\n\n        if (typeof selector === 'string') {\n            node = view.findBySelector(selector)[0];\n        } else if (Array.isArray(selector)) {\n            node = util.getByPath(magnet, selector);\n        } else {\n            node = findShapeNode(magnet);\n        }\n\n        if (!V.isSVGGraphicsElement(node)) {\n            if (node === magnet || !V.isSVGGraphicsElement(magnet)) return anchor;\n            node = magnet;\n        }\n\n        var localShape = view.getNodeShape(node);\n        var magnetMatrix = view.getNodeMatrix(node);\n        var translateMatrix = view.getRootTranslateMatrix();\n        var rotateMatrix = view.getRootRotateMatrix();\n        var targetMatrix = translateMatrix.multiply(rotateMatrix).multiply(magnetMatrix);\n        var localMatrix = targetMatrix.inverse();\n        var localLine = V.transformLine(line, localMatrix);\n        var localRef = localLine.start.clone();\n        var data = view.getNodeData(node);\n\n        if (opt.insideout === false) {\n            if (!data[BNDR_SHAPE_BBOX]) data[BNDR_SHAPE_BBOX] = localShape.bbox();\n            var localBBox = data[BNDR_SHAPE_BBOX];\n            if (localBBox.containsPoint(localRef)) return anchor;\n        }\n\n        // Caching segment subdivisions for paths\n        var pathOpt;\n        if (localShape instanceof g.Path) {\n            var precision = opt.precision || 2;\n            if (!data[BNDR_SUBDIVISIONS]) data[BNDR_SUBDIVISIONS] = localShape.getSegmentSubdivisions({ precision: precision });\n            pathOpt = {\n                precision: precision,\n                segmentSubdivisions: data[BNDR_SUBDIVISIONS]\n            };\n        }\n\n        if (opt.extrapolate === true) localLine.setLength(1e6);\n\n        intersection = localLine.intersect(localShape, pathOpt);\n        if (intersection) {\n            // More than one intersection\n            if (V.isArray(intersection)) intersection = closestIntersection(intersection, localRef);\n        } else if (opt.sticky === true) {\n            // No intersection, find the closest point instead\n            if (localShape instanceof g.Rect) {\n                intersection = localShape.pointNearestToPoint(localRef);\n            } else if (localShape instanceof g.Ellipse) {\n                intersection = localShape.intersectionWithLineFromCenterToPoint(localRef);\n            } else {\n                intersection = localShape.closestPoint(localRef, pathOpt);\n            }\n        }\n\n        var cp = (intersection) ? V.transformPoint(intersection, targetMatrix) : anchor;\n        var cpOffset = opt.offset || 0;\n        if (opt.stroke) cpOffset += stroke(node) / 2;\n\n        return offset(cp, line.start, cpOffset);\n    }\n\n    joint.connectionPoints = {\n        anchor: anchor,\n        bbox: bboxIntersection,\n        rectangle: rectangleIntersection,\n        boundary: boundaryIntersection\n    };\n\n})(joint, joint.util, g, V);\n\n(function(joint, util) {\n\n    function abs2rel(value, max) {\n\n        if (max === 0) return '0%';\n        return Math.round(value / max * 100) + '%';\n    }\n\n    function pin(relative) {\n\n        return function(end, view, magnet, coords) {\n\n            var angle = view.model.angle();\n            var bbox = view.getNodeUnrotatedBBox(magnet);\n            var origin = view.model.getBBox().center();\n            coords.rotate(origin, angle);\n            var dx = coords.x - bbox.x;\n            var dy = coords.y - bbox.y;\n\n            if (relative) {\n                dx = abs2rel(dx, bbox.width);\n                dy = abs2rel(dy, bbox.height);\n            }\n\n            end.anchor = {\n                name: 'topLeft',\n                args: {\n                    dx: dx,\n                    dy: dy,\n                    rotate: true\n                }\n            };\n\n            return end;\n        };\n    }\n\n    joint.connectionStrategies = {\n        useDefaults: util.noop,\n        pinAbsolute: pin(false),\n        pinRelative: pin(true)\n    };\n\n})(joint, joint.util);\n\n(function(joint, util, V, g) {\n\n    function getAnchor(coords, view, magnet) {\n        // take advantage of an existing logic inside of the\n        // pin relative connection strategy\n        var end = joint.connectionStrategies.pinRelative.call(\n            this.paper,\n            {},\n            view,\n            magnet,\n            coords,\n            this.model\n        );\n        return end.anchor;\n    }\n\n    function snapAnchor(coords, view, magnet, type, relatedView, toolView) {\n        var snapRadius = toolView.options.snapRadius;\n        var isSource = (type === 'source');\n        var refIndex = (isSource ? 0 : -1);\n        var ref = this.model.vertex(refIndex) || this.getEndAnchor(isSource ? 'target' : 'source');\n        if (ref) {\n            if (Math.abs(ref.x - coords.x) < snapRadius) coords.x = ref.x;\n            if (Math.abs(ref.y - coords.y) < snapRadius) coords.y = ref.y;\n        }\n        return coords;\n    }\n\n    var ToolView = joint.dia.ToolView;\n\n    // Vertex Handles\n    var VertexHandle = joint.mvc.View.extend({\n        tagName: 'circle',\n        svgElement: true,\n        className: 'marker-vertex',\n        events: {\n            mousedown: 'onPointerDown',\n            touchstart: 'onPointerDown',\n            dblclick: 'onDoubleClick'\n        },\n        documentEvents: {\n            mousemove: 'onPointerMove',\n            touchmove: 'onPointerMove',\n            mouseup: 'onPointerUp',\n            touchend: 'onPointerUp',\n            touchcancel: 'onPointerUp'\n        },\n        attributes: {\n            'r': 6,\n            'fill': '#33334F',\n            'stroke': '#FFFFFF',\n            'stroke-width': 2,\n            'cursor': 'move'\n        },\n        position: function(x, y) {\n            this.vel.attr({ cx: x, cy: y });\n        },\n        onPointerDown: function(evt) {\n            evt.stopPropagation();\n            evt.preventDefault();\n            this.options.paper.undelegateEvents();\n            this.delegateDocumentEvents(null, evt.data);\n            this.trigger('will-change');\n        },\n        onPointerMove: function(evt) {\n            this.trigger('changing', this, evt);\n        },\n        onDoubleClick: function(evt) {\n            this.trigger('remove', this, evt);\n        },\n        onPointerUp: function(evt) {\n            this.trigger('changed', this, evt);\n            this.undelegateDocumentEvents();\n            this.options.paper.delegateEvents();\n        }\n    });\n\n    var Vertices = ToolView.extend({\n        name: 'vertices',\n        options: {\n            handleClass: VertexHandle,\n            snapRadius: 20,\n            redundancyRemoval: true,\n            vertexAdding: true,\n        },\n        children: [{\n            tagName: 'path',\n            selector: 'connection',\n            className: 'joint-vertices-path',\n            attributes: {\n                'fill': 'none',\n                'stroke': 'transparent',\n                'stroke-width': 10,\n                'cursor': 'cell'\n            }\n        }],\n        handles: null,\n        events: {\n            'mousedown .joint-vertices-path': 'onPathPointerDown',\n            'touchstart .joint-vertices-path': 'onPathPointerDown'\n        },\n        onRender: function() {\n            this.resetHandles();\n            if (this.options.vertexAdding) {\n                this.renderChildren();\n                this.updatePath();\n            }\n            var relatedView = this.relatedView;\n            var vertices = relatedView.model.vertices();\n            for (var i = 0, n = vertices.length; i < n; i++) {\n                var vertex = vertices[i];\n                var handle = new (this.options.handleClass)({ index: i, paper: this.paper });\n                handle.render();\n                handle.position(vertex.x, vertex.y);\n                this.simulateRelatedView(handle.el);\n                handle.vel.appendTo(this.el);\n                this.handles.push(handle);\n                this.startHandleListening(handle);\n            }\n            return this;\n        },\n        update: function() {\n            this.render();\n            return this;\n        },\n        updatePath: function() {\n            var connection = this.childNodes.connection;\n            if (connection) connection.setAttribute('d', this.relatedView.getConnection().serialize());\n        },\n        startHandleListening: function(handle) {\n            var relatedView = this.relatedView;\n            if (relatedView.can('vertexMove')) {\n                this.listenTo(handle, 'will-change', this.onHandleWillChange);\n                this.listenTo(handle, 'changing', this.onHandleChanging);\n                this.listenTo(handle, 'changed', this.onHandleChanged);\n            }\n            if (relatedView.can('vertexRemove')) {\n                this.listenTo(handle, 'remove', this.onHandleRemove);\n            }\n        },\n        resetHandles: function() {\n            var handles = this.handles;\n            this.handles = [];\n            this.stopListening();\n            if (!Array.isArray(handles)) return;\n            for (var i = 0, n = handles.length; i < n; i++) {\n                handles[i].remove();\n            }\n        },\n        getNeighborPoints: function(index) {\n            var linkView = this.relatedView;\n            var vertices = linkView.model.vertices();\n            var prev = (index > 0) ? vertices[index - 1] : linkView.sourceAnchor;\n            var next = (index < vertices.length - 1) ? vertices[index + 1] : linkView.targetAnchor;\n            return {\n                prev: new g.Point(prev),\n                next: new g.Point(next)\n            };\n        },\n        onHandleWillChange: function(handle, evt) {\n            this.focus();\n            this.relatedView.model.startBatch('vertex-move', { ui: true, tool: this.cid });\n        },\n        onHandleChanging: function(handle, evt) {\n            var relatedView = this.relatedView;\n            var paper = relatedView.paper;\n            var index = handle.options.index;\n            var normalizedEvent = util.normalizeEvent(evt);\n            var vertex = paper.snapToGrid(normalizedEvent.clientX, normalizedEvent.clientY).toJSON();\n            this.snapVertex(vertex, index);\n            relatedView.model.vertex(index, vertex, { ui: true, tool: this.cid });\n            handle.position(vertex.x, vertex.y);\n        },\n        snapVertex: function(vertex, index) {\n            var snapRadius = this.options.snapRadius;\n            if (snapRadius > 0) {\n                var neighbors = this.getNeighborPoints(index);\n                var prev = neighbors.prev;\n                var next = neighbors.next;\n                if (Math.abs(vertex.x - prev.x) < snapRadius) {\n                    vertex.x = prev.x;\n                } else if (Math.abs(vertex.x - next.x) < snapRadius) {\n                    vertex.x = next.x;\n                }\n                if (Math.abs(vertex.y - prev.y) < snapRadius) {\n                    vertex.y = neighbors.prev.y;\n                } else if (Math.abs(vertex.y - next.y) < snapRadius) {\n                    vertex.y = next.y;\n                }\n            }\n        },\n        onHandleChanged: function(handle, evt) {\n            if (this.options.vertexAdding) this.updatePath();\n            if (!this.options.redundancyRemoval) return;\n            var linkView = this.relatedView;\n            var verticesRemoved = linkView.removeRedundantLinearVertices({ ui: true, tool: this.cid });\n            if (verticesRemoved) this.render();\n            this.blur();\n            linkView.model.stopBatch('vertex-move', { ui: true, tool: this.cid });\n            if (this.eventData(evt).vertexAdded) {\n                linkView.model.stopBatch('vertex-add', { ui: true, tool: this.cid });\n            }\n        },\n        onHandleRemove: function(handle) {\n            var index = handle.options.index;\n            this.relatedView.model.removeVertex(index, { ui: true });\n        },\n        onPathPointerDown: function(evt) {\n            evt.stopPropagation();\n            evt.preventDefault();\n            var normalizedEvent = util.normalizeEvent(evt);\n            var vertex = this.paper.snapToGrid(normalizedEvent.clientX, normalizedEvent.clientY).toJSON();\n            var relatedView = this.relatedView;\n            relatedView.model.startBatch('vertex-add', { ui: true, tool: this.cid });\n            var index = relatedView.getVertexIndex(vertex.x, vertex.y);\n            this.snapVertex(vertex, index);\n            relatedView.model.insertVertex(index, vertex, { ui: true, tool: this.cid });\n            this.render();\n            var handle = this.handles[index];\n            this.eventData(evt, { vertexAdded: true });\n            handle.onPointerDown(evt);\n        },\n        onRemove: function() {\n            this.resetHandles();\n        }\n    }, {\n        VertexHandle: VertexHandle // keep as class property\n    });\n\n    var SegmentHandle = joint.mvc.View.extend({\n        tagName: 'g',\n        svgElement: true,\n        className: 'marker-segment',\n        events: {\n            mousedown: 'onPointerDown',\n            touchstart: 'onPointerDown'\n        },\n        documentEvents: {\n            mousemove: 'onPointerMove',\n            touchmove: 'onPointerMove',\n            mouseup: 'onPointerUp',\n            touchend: 'onPointerUp',\n            touchcancel: 'onPointerUp'\n        },\n        children: [{\n            tagName: 'line',\n            selector: 'line',\n            attributes: {\n                'stroke': '#33334F',\n                'stroke-width': 2,\n                'fill': 'none',\n                'pointer-events': 'none'\n            }\n        }, {\n            tagName: 'rect',\n            selector: 'handle',\n            attributes: {\n                'width': 20,\n                'height': 8,\n                'x': -10,\n                'y': -4,\n                'rx': 4,\n                'ry': 4,\n                'fill': '#33334F',\n                'stroke': '#FFFFFF',\n                'stroke-width': 2\n            }\n        }],\n        onRender: function() {\n            this.renderChildren();\n        },\n        position: function(x, y, angle, view) {\n\n            var matrix = V.createSVGMatrix().translate(x, y).rotate(angle);\n            var handle = this.childNodes.handle;\n            handle.setAttribute('transform', V.matrixToTransformString(matrix));\n            handle.setAttribute('cursor', (angle % 180 === 0) ? 'row-resize' : 'col-resize');\n\n            var viewPoint = view.getClosestPoint(new g.Point(x, y));\n            var line = this.childNodes.line;\n            line.setAttribute('x1', x);\n            line.setAttribute('y1', y);\n            line.setAttribute('x2', viewPoint.x);\n            line.setAttribute('y2', viewPoint.y);\n        },\n        onPointerDown: function(evt) {\n            this.trigger('change:start', this, evt);\n            evt.stopPropagation();\n            evt.preventDefault();\n            this.options.paper.undelegateEvents();\n            this.delegateDocumentEvents(null, evt.data);\n        },\n        onPointerMove: function(evt) {\n            this.trigger('changing', this, evt);\n        },\n        onPointerUp: function(evt) {\n            this.undelegateDocumentEvents();\n            this.options.paper.delegateEvents();\n            this.trigger('change:end', this, evt);\n        },\n        show: function() {\n            this.el.style.display = '';\n        },\n        hide: function() {\n            this.el.style.display = 'none';\n        }\n    });\n\n    var Segments = ToolView.extend({\n        name: 'segments',\n        precision: .5,\n        options: {\n            handleClass: SegmentHandle,\n            segmentLengthThreshold: 40,\n            redundancyRemoval: true,\n            anchor: getAnchor,\n            snapRadius: 10,\n            snapHandle: true\n        },\n        handles: null,\n        onRender: function() {\n            this.resetHandles();\n            var relatedView = this.relatedView;\n            var vertices = relatedView.model.vertices();\n            vertices.unshift(relatedView.sourcePoint);\n            vertices.push(relatedView.targetPoint);\n            for (var i = 0, n = vertices.length; i < n - 1; i++) {\n                var vertex = vertices[i];\n                var nextVertex = vertices[i + 1];\n                var handle = this.renderHandle(vertex, nextVertex);\n                this.simulateRelatedView(handle.el);\n                this.handles.push(handle);\n                handle.options.index = i;\n            }\n            return this;\n        },\n        renderHandle: function(vertex, nextVertex) {\n            var handle = new (this.options.handleClass)({ paper: this.paper });\n            handle.render();\n            this.updateHandle(handle, vertex, nextVertex);\n            handle.vel.appendTo(this.el);\n            this.startHandleListening(handle);\n            return handle;\n        },\n        update: function() {\n            this.render();\n            return this;\n        },\n        startHandleListening: function(handle) {\n            this.listenTo(handle, 'change:start', this.onHandleChangeStart);\n            this.listenTo(handle, 'changing', this.onHandleChanging);\n            this.listenTo(handle, 'change:end', this.onHandleChangeEnd);\n        },\n        resetHandles: function() {\n            var handles = this.handles;\n            this.handles = [];\n            this.stopListening();\n            if (!Array.isArray(handles)) return;\n            for (var i = 0, n = handles.length; i < n; i++) {\n                handles[i].remove();\n            }\n        },\n        shiftHandleIndexes: function(value) {\n            var handles = this.handles;\n            for (var i = 0, n = handles.length; i < n; i++) handles[i].options.index += value;\n        },\n        resetAnchor: function(type, anchor) {\n            var relatedModel = this.relatedView.model;\n            if (anchor) {\n                relatedModel.prop([type, 'anchor'], anchor, {\n                    rewrite: true,\n                    ui: true,\n                    tool: this.cid\n                });\n            } else {\n                relatedModel.removeProp([type, 'anchor'], {\n                    ui: true,\n                    tool: this.cid\n                });\n            }\n        },\n        snapHandle: function(handle, position, data) {\n\n            var index = handle.options.index;\n            var linkView = this.relatedView;\n            var link = linkView.model;\n            var vertices = link.vertices();\n            var axis = handle.options.axis;\n            var prev = vertices[index - 2] || data.sourceAnchor;\n            var next = vertices[index + 1] || data.targetAnchor;\n            var snapRadius = this.options.snapRadius;\n            if (Math.abs(position[axis] - prev[axis]) < snapRadius) {\n                position[axis] = prev[axis];\n            } else if (Math.abs(position[axis] - next[axis]) < snapRadius) {\n                position[axis] = next[axis];\n            }\n            return position;\n        },\n\n        onHandleChanging: function(handle, evt) {\n\n            var data = this.eventData(evt);\n            var relatedView = this.relatedView;\n            var paper = relatedView.paper;\n            var index = handle.options.index - 1;\n            var normalizedEvent = util.normalizeEvent(evt);\n            var coords = paper.snapToGrid(normalizedEvent.clientX, normalizedEvent.clientY);\n            var position = this.snapHandle(handle, coords.clone(), data);\n            var axis = handle.options.axis;\n            var offset = (this.options.snapHandle) ? 0 : (coords[axis] - position[axis]);\n            var link = relatedView.model;\n            var vertices = util.cloneDeep(link.vertices());\n            var vertex = vertices[index];\n            var nextVertex = vertices[index + 1];\n            var anchorFn = this.options.anchor;\n            if (typeof anchorFn !== 'function') anchorFn = null;\n\n            // First Segment\n            var sourceView = relatedView.sourceView;\n            var sourceBBox = relatedView.sourceBBox;\n            var changeSourceAnchor = false;\n            var deleteSourceAnchor = false;\n            if (!vertex) {\n                vertex = relatedView.sourceAnchor.toJSON();\n                vertex[axis] = position[axis];\n                if (sourceBBox.containsPoint(vertex)) {\n                    vertex[axis] = position[axis];\n                    changeSourceAnchor = true;\n                } else {\n                    // we left the area of the source magnet for the first time\n                    vertices.unshift(vertex);\n                    this.shiftHandleIndexes(1);\n                    deleteSourceAnchor = true;\n                }\n            } else if (index === 0) {\n                if (sourceBBox.containsPoint(vertex)) {\n                    vertices.shift();\n                    this.shiftHandleIndexes(-1);\n                    changeSourceAnchor = true;\n                } else {\n                    vertex[axis] = position[axis];\n                    deleteSourceAnchor = true;\n                }\n            } else {\n                vertex[axis] = position[axis];\n            }\n\n            if (anchorFn && sourceView) {\n                if (changeSourceAnchor) {\n                    var sourceAnchorPosition = data.sourceAnchor.clone();\n                    sourceAnchorPosition[axis] = position[axis];\n                    var sourceAnchor = anchorFn.call(relatedView, sourceAnchorPosition, sourceView, relatedView.sourceMagnet || sourceView.el, 'source', relatedView);\n                    this.resetAnchor('source', sourceAnchor);\n                }\n                if (deleteSourceAnchor) {\n                    this.resetAnchor('source', data.sourceAnchorDef);\n                }\n            }\n\n            // Last segment\n            var targetView = relatedView.targetView;\n            var targetBBox = relatedView.targetBBox;\n            var changeTargetAnchor = false;\n            var deleteTargetAnchor = false;\n            if (!nextVertex) {\n                nextVertex = relatedView.targetAnchor.toJSON();\n                nextVertex[axis] = position[axis];\n                if (targetBBox.containsPoint(nextVertex)) {\n                    changeTargetAnchor = true;\n                } else {\n                    // we left the area of the target magnet for the first time\n                    vertices.push(nextVertex);\n                    deleteTargetAnchor = true;\n                }\n            } else if (index === vertices.length - 2) {\n                if (targetBBox.containsPoint(nextVertex)) {\n                    vertices.pop();\n                    changeTargetAnchor = true;\n                } else {\n                    nextVertex[axis] = position[axis];\n                    deleteTargetAnchor = true;\n                }\n            } else {\n                nextVertex[axis] = position[axis];\n            }\n\n            if (anchorFn && targetView) {\n                if (changeTargetAnchor) {\n                    var targetAnchorPosition = data.targetAnchor.clone();\n                    targetAnchorPosition[axis] = position[axis];\n                    var targetAnchor = anchorFn.call(relatedView, targetAnchorPosition, targetView, relatedView.targetMagnet || targetView.el, 'target', relatedView);\n                    this.resetAnchor('target', targetAnchor);\n                }\n                if (deleteTargetAnchor) {\n                    this.resetAnchor('target', data.targetAnchorDef);\n                }\n            }\n\n            link.vertices(vertices, { ui: true, tool: this.cid });\n            this.updateHandle(handle, vertex, nextVertex, offset);\n        },\n        onHandleChangeStart: function(handle, evt) {\n            var index = handle.options.index;\n            var handles = this.handles;\n            if (!Array.isArray(handles)) return;\n            for (var i = 0, n = handles.length; i < n; i++) {\n                if (i !== index) handles[i].hide();\n            }\n            this.focus();\n            var relatedView = this.relatedView;\n            var relatedModel = relatedView.model;\n            this.eventData(evt, {\n                sourceAnchor: relatedView.sourceAnchor.clone(),\n                targetAnchor: relatedView.targetAnchor.clone(),\n                sourceAnchorDef: util.clone(relatedModel.prop(['source', 'anchor'])),\n                targetAnchorDef: util.clone(relatedModel.prop(['target', 'anchor']))\n            });\n            relatedView.model.startBatch('segment-move', { ui: true, tool: this.cid });\n        },\n        onHandleChangeEnd: function(handle) {\n            var linkView = this.relatedView;\n            if (this.options.redundancyRemoval) {\n                linkView.removeRedundantLinearVertices({ ui: true, tool: this.cid });\n            }\n            this.render();\n            this.blur();\n            linkView.model.stopBatch('segment-move', { ui: true, tool: this.cid });\n        },\n        updateHandle: function(handle, vertex, nextVertex, offset) {\n            var vertical = Math.abs(vertex.x - nextVertex.x) < this.precision;\n            var horizontal = Math.abs(vertex.y - nextVertex.y) < this.precision;\n            if (vertical || horizontal) {\n                var segmentLine = new g.Line(vertex, nextVertex);\n                var length = segmentLine.length();\n                if (length < this.options.segmentLengthThreshold) {\n                    handle.hide();\n                } else {\n                    var position = segmentLine.midpoint();\n                    var axis = (vertical) ? 'x' : 'y';\n                    position[axis] += offset || 0;\n                    var angle = segmentLine.vector().vectorAngle(new g.Point(1, 0));\n                    handle.position(position.x, position.y, angle, this.relatedView);\n                    handle.show();\n                    handle.options.axis = axis;\n                }\n            } else {\n                handle.hide();\n            }\n        },\n        onRemove: function() {\n            this.resetHandles();\n        }\n    }, {\n        SegmentHandle: SegmentHandle // keep as class property\n    });\n\n    // End Markers\n    var Arrowhead = ToolView.extend({\n        tagName: 'path',\n        xAxisVector: new g.Point(1, 0),\n        events: {\n            mousedown: 'onPointerDown',\n            touchstart: 'onPointerDown'\n        },\n        documentEvents: {\n            mousemove: 'onPointerMove',\n            touchmove: 'onPointerMove',\n            mouseup: 'onPointerUp',\n            touchend: 'onPointerUp',\n            touchcancel: 'onPointerUp'\n        },\n        onRender: function() {\n            this.update();\n        },\n        update: function() {\n            var ratio = this.ratio;\n            var view = this.relatedView;\n            var tangent = view.getTangentAtRatio(ratio);\n            var position, angle;\n            if (tangent) {\n                position = tangent.start;\n                angle = tangent.vector().vectorAngle(this.xAxisVector) || 0;\n            } else {\n                position = view.getPointAtRatio(ratio);\n                angle = 0;\n            }\n            var matrix = V.createSVGMatrix().translate(position.x, position.y).rotate(angle);\n            this.vel.transform(matrix, { absolute: true });\n            return this;\n        },\n        onPointerDown: function(evt) {\n            evt.stopPropagation();\n            evt.preventDefault();\n            var relatedView = this.relatedView;\n            relatedView.model.startBatch('arrowhead-move', { ui: true, tool: this.cid });\n            if (relatedView.can('arrowheadMove')) {\n                relatedView.startArrowheadMove(this.arrowheadType);\n                this.delegateDocumentEvents();\n                relatedView.paper.undelegateEvents();\n            }\n            this.focus();\n            this.el.style.pointerEvents = 'none';\n        },\n        onPointerMove: function(evt) {\n            var normalizedEvent = util.normalizeEvent(evt);\n            var coords = this.paper.snapToGrid(normalizedEvent.clientX, normalizedEvent.clientY);\n            this.relatedView.pointermove(normalizedEvent, coords.x, coords.y);\n        },\n        onPointerUp: function(evt) {\n            this.undelegateDocumentEvents();\n            var relatedView = this.relatedView;\n            var paper = relatedView.paper;\n            var normalizedEvent = util.normalizeEvent(evt);\n            var coords = paper.snapToGrid(normalizedEvent.clientX, normalizedEvent.clientY);\n            relatedView.pointerup(normalizedEvent, coords.x, coords.y);\n            paper.delegateEvents();\n            this.blur();\n            this.el.style.pointerEvents = '';\n            relatedView.model.stopBatch('arrowhead-move', { ui: true, tool: this.cid });\n        }\n    });\n\n    var TargetArrowhead = Arrowhead.extend({\n        name: 'target-arrowhead',\n        ratio: 1,\n        arrowheadType: 'target',\n        attributes: {\n            'd': 'M -10 -8 10 0 -10 8 Z',\n            'fill': '#33334F',\n            'stroke': '#FFFFFF',\n            'stroke-width': 2,\n            'cursor': 'move',\n            'class': 'target-arrowhead'\n        }\n    });\n\n    var SourceArrowhead = Arrowhead.extend({\n        name: 'source-arrowhead',\n        ratio: 0,\n        arrowheadType: 'source',\n        attributes: {\n            'd': 'M 10 -8 -10 0 10 8 Z',\n            'fill': '#33334F',\n            'stroke': '#FFFFFF',\n            'stroke-width': 2,\n            'cursor': 'move',\n            'class': 'source-arrowhead'\n        }\n    });\n\n    var Button = ToolView.extend({\n        name: 'button',\n        events: {\n            'mousedown': 'onPointerDown',\n            'touchstart': 'onPointerDown'\n        },\n        options: {\n            distance: 0,\n            offset: 0,\n            rotate: false\n        },\n        onRender: function() {\n            this.renderChildren(this.options.markup);\n            this.update();\n        },\n        update: function() {\n            var tangent, position, angle;\n            var distance = this.options.distance || 0;\n            if (util.isPercentage(distance)) {\n                tangent = this.relatedView.getTangentAtRatio(parseFloat(distance) / 100);\n            } else {\n                tangent = this.relatedView.getTangentAtLength(distance);\n            }\n            if (tangent) {\n                position = tangent.start;\n                angle = tangent.vector().vectorAngle(new g.Point(1,0)) || 0;\n            } else {\n                position = this.relatedView.getConnection().start;\n                angle = 0;\n            }\n            var matrix = V.createSVGMatrix()\n                .translate(position.x, position.y)\n                .rotate(angle)\n                .translate(0, this.options.offset || 0);\n            if (!this.options.rotate) matrix = matrix.rotate(-angle);\n            this.vel.transform(matrix, { absolute: true });\n            return this;\n        },\n        onPointerDown: function(evt) {\n            evt.stopPropagation();\n            evt.preventDefault();\n            var actionFn = this.options.action;\n            if (typeof actionFn === 'function') {\n                actionFn.call(this.relatedView, evt, this.relatedView);\n            }\n        }\n    });\n\n\n    var Remove = Button.extend({\n        children: [{\n            tagName: 'circle',\n            selector: 'button',\n            attributes: {\n                'r': 7,\n                'fill': '#FF1D00',\n                'cursor': 'pointer'\n            }\n        }, {\n            tagName: 'path',\n            selector: 'icon',\n            attributes: {\n                'd': 'M -3 -3 3 3 M -3 3 3 -3',\n                'fill': 'none',\n                'stroke': '#FFFFFF',\n                'stroke-width': 2,\n                'pointer-events': 'none'\n            }\n        }],\n        options: {\n            distance: 60,\n            offset: 0,\n            action: function(evt) {\n                this.model.remove({ ui: true, tool: this.cid });\n            }\n        }\n    });\n\n    var Boundary = ToolView.extend({\n        name: 'boundary',\n        tagName: 'rect',\n        options: {\n            padding: 10\n        },\n        attributes: {\n            'fill': 'none',\n            'stroke': '#33334F',\n            'stroke-width': .5,\n            'stroke-dasharray': '5, 5',\n            'pointer-events': 'none'\n        },\n        onRender: function() {\n            this.update();\n        },\n        update: function() {\n            var padding = this.options.padding;\n            if (!isFinite(padding)) padding = 0;\n            var bbox = this.relatedView.getConnection().bbox().inflate(padding);\n            this.vel.attr(bbox.toJSON());\n            return this;\n        }\n    });\n\n    var Anchor = ToolView.extend({\n        tagName: 'g',\n        type: null,\n        children: [{\n            tagName: 'circle',\n            selector: 'anchor',\n            attributes: {\n                'cursor': 'pointer'\n            }\n        }, {\n            tagName: 'rect',\n            selector: 'area',\n            attributes: {\n                'pointer-events': 'none',\n                'fill': 'none',\n                'stroke': '#33334F',\n                'stroke-dasharray': '2,4',\n                'rx': 5,\n                'ry': 5\n            }\n        }],\n        events: {\n            mousedown: 'onPointerDown',\n            touchstart: 'onPointerDown',\n            dblclick: 'onPointerDblClick'\n        },\n        documentEvents: {\n            mousemove: 'onPointerMove',\n            touchmove: 'onPointerMove',\n            mouseup: 'onPointerUp',\n            touchend: 'onPointerUp',\n            touchcancel: 'onPointerUp'\n        },\n        options: {\n            snap: snapAnchor,\n            anchor: getAnchor,\n            customAnchorAttributes: {\n                'stroke-width': 4,\n                'stroke': '#33334F',\n                'fill': '#FFFFFF',\n                'r': 5\n            },\n            defaultAnchorAttributes: {\n                'stroke-width': 2,\n                'stroke': '#FFFFFF',\n                'fill': '#33334F',\n                'r': 6\n            },\n            areaPadding: 6,\n            snapRadius: 10,\n            restrictArea: true,\n            redundancyRemoval: true\n        },\n        onRender: function() {\n            this.renderChildren();\n            this.toggleArea(false);\n            this.update();\n        },\n        update: function() {\n            var type = this.type;\n            var relatedView = this.relatedView;\n            var view = relatedView.getEndView(type);\n            if (view) {\n                this.updateAnchor();\n                this.updateArea();\n                this.el.style.display = '';\n            } else {\n                this.el.style.display = 'none';\n            }\n            return this;\n        },\n        updateAnchor: function() {\n            var childNodes = this.childNodes;\n            if (!childNodes) return;\n            var anchorNode = childNodes.anchor;\n            if (!anchorNode) return;\n            var relatedView = this.relatedView;\n            var type = this.type;\n            var position = relatedView.getEndAnchor(type);\n            var options = this.options;\n            var customAnchor = relatedView.model.prop([type, 'anchor']);\n            anchorNode.setAttribute('transform', 'translate(' + position.x + ',' + position.y + ')');\n            var anchorAttributes = (customAnchor) ? options.customAnchorAttributes : options.defaultAnchorAttributes;\n            for (var attrName in anchorAttributes) {\n                anchorNode.setAttribute(attrName, anchorAttributes[attrName]);\n            }\n        },\n        updateArea: function() {\n            var childNodes = this.childNodes;\n            if (!childNodes) return;\n            var areaNode = childNodes.area;\n            if (!areaNode) return;\n            var relatedView = this.relatedView;\n            var type = this.type;\n            var view = relatedView.getEndView(type);\n            var magnet = relatedView.getEndMagnet(type);\n            var padding = this.options.areaPadding;\n            if (!isFinite(padding)) padding = 0;\n            var bbox = view.getNodeUnrotatedBBox(magnet).inflate(padding);\n            var angle = view.model.angle();\n            areaNode.setAttribute('x', -bbox.width / 2);\n            areaNode.setAttribute('y', -bbox.height / 2);\n            areaNode.setAttribute('width', bbox.width);\n            areaNode.setAttribute('height', bbox.height);\n            var origin = view.model.getBBox().center();\n            var center = bbox.center().rotate(origin, -angle);\n            areaNode.setAttribute('transform', 'translate(' + center.x + ',' + center.y + ') rotate(' + angle +')');\n        },\n        toggleArea: function(visible) {\n            this.childNodes.area.style.display = (visible) ? '' : 'none';\n        },\n        onPointerDown: function(evt) {\n            evt.stopPropagation();\n            evt.preventDefault();\n            this.paper.undelegateEvents();\n            this.delegateDocumentEvents();\n            this.focus();\n            this.toggleArea(this.options.restrictArea);\n            this.relatedView.model.startBatch('anchor-move', { ui: true, tool: this.cid });\n        },\n        resetAnchor: function(anchor) {\n            var type = this.type;\n            var relatedModel = this.relatedView.model;\n            if (anchor) {\n                relatedModel.prop([type, 'anchor'], anchor, {\n                    rewrite: true,\n                    ui: true,\n                    tool: this.cid\n                });\n            } else {\n                relatedModel.removeProp([type, 'anchor'], {\n                    ui: true,\n                    tool: this.cid\n                });\n            }\n        },\n        onPointerMove: function(evt) {\n\n            var relatedView = this.relatedView;\n            var type = this.type;\n            var view = relatedView.getEndView(type);\n            var magnet = relatedView.getEndMagnet(type);\n            var normalizedEvent = util.normalizeEvent(evt);\n            var coords = this.paper.clientToLocalPoint(normalizedEvent.clientX, normalizedEvent.clientY);\n            var snapFn = this.options.snap;\n            if (typeof snapFn === 'function') {\n                coords = snapFn.call(relatedView, coords, view, magnet, type, relatedView, this);\n                coords = new g.Point(coords);\n            }\n\n            if (this.options.restrictArea) {\n                // snap coords within node bbox\n                var bbox = view.getNodeUnrotatedBBox(magnet);\n                var angle = view.model.angle();\n                var origin = view.model.getBBox().center();\n                var rotatedCoords = coords.clone().rotate(origin, angle);\n                if (!bbox.containsPoint(rotatedCoords)) {\n                    coords = bbox.pointNearestToPoint(rotatedCoords).rotate(origin, -angle);\n                }\n            }\n\n            var anchor;\n            var anchorFn = this.options.anchor;\n            if (typeof anchorFn === 'function') {\n                anchor = anchorFn.call(relatedView, coords, view, magnet, type, relatedView);\n            }\n\n            this.resetAnchor(anchor);\n            this.update();\n        },\n\n        onPointerUp: function(evt) {\n            this.paper.delegateEvents();\n            this.undelegateDocumentEvents();\n            this.blur();\n            this.toggleArea(false);\n            var linkView = this.relatedView;\n            if (this.options.redundancyRemoval) linkView.removeRedundantLinearVertices({ ui: true, tool: this.cid });\n            linkView.model.stopBatch('anchor-move', { ui: true, tool: this.cid });\n        },\n\n        onPointerDblClick: function() {\n            this.resetAnchor();\n            this.update();\n        }\n    });\n\n    var SourceAnchor = Anchor.extend({\n        name: 'source-anchor',\n        type: 'source'\n    });\n\n    var TargetAnchor = Anchor.extend({\n        name: 'target-anchor',\n        type: 'target'\n    });\n\n    // Export\n    joint.linkTools = {\n        Vertices: Vertices,\n        Segments: Segments,\n        SourceArrowhead: SourceArrowhead,\n        TargetArrowhead: TargetArrowhead,\n        SourceAnchor: SourceAnchor,\n        TargetAnchor: TargetAnchor,\n        Button: Button,\n        Remove: Remove,\n        Boundary: Boundary\n    };\n\n})(joint, joint.util, V, g);\n\njoint.dia.Element.define('erd.Entity', {\n    size: { width: 150, height: 60 },\n    attrs: {\n        '.outer': {\n            fill: '#2ECC71', stroke: '#27AE60', 'stroke-width': 2,\n            points: '100,0 100,60 0,60 0,0'\n        },\n        '.inner': {\n            fill: '#2ECC71', stroke: '#27AE60', 'stroke-width': 2,\n            points: '95,5 95,55 5,55 5,5',\n            display: 'none'\n        },\n        text: {\n            text: 'Entity',\n            'font-family': 'Arial', 'font-size': 14,\n            'ref-x': .5, 'ref-y': .5,\n            'y-alignment': 'middle', 'text-anchor': 'middle'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><polygon class=\"outer\"/><polygon class=\"inner\"/></g><text/></g>',\n});\n\n\njoint.shapes.erd.Entity.define('erd.WeakEntity', {\n    attrs: {\n        '.inner': { display: 'auto' },\n        text: { text: 'Weak Entity' }\n    }\n});\n\njoint.dia.Element.define('erd.Relationship', {\n    size: { width: 80, height: 80 },\n    attrs: {\n        '.outer': {\n            fill: '#3498DB', stroke: '#2980B9', 'stroke-width': 2,\n            points: '40,0 80,40 40,80 0,40'\n        },\n        '.inner': {\n            fill: '#3498DB', stroke: '#2980B9', 'stroke-width': 2,\n            points: '40,5 75,40 40,75 5,40',\n            display: 'none'\n        },\n        text: {\n            text: 'Relationship',\n            'font-family': 'Arial', 'font-size': 12,\n            'ref-x': .5, 'ref-y': .5,\n            'y-alignment': 'middle', 'text-anchor': 'middle'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><polygon class=\"outer\"/><polygon class=\"inner\"/></g><text/></g>',\n});\n\njoint.shapes.erd.Relationship.define('erd.IdentifyingRelationship', {\n    attrs: {\n        '.inner': { display: 'auto' },\n        text: { text: 'Identifying' }\n    }\n});\n\njoint.dia.Element.define('erd.Attribute', {\n    size: { width: 100, height: 50 },\n    attrs: {\n        'ellipse': {\n            transform: 'translate(50, 25)'\n        },\n        '.outer': {\n            stroke: '#D35400', 'stroke-width': 2,\n            cx: 0, cy: 0, rx: 50, ry: 25,\n            fill: '#E67E22'\n        },\n        '.inner': {\n            stroke: '#D35400', 'stroke-width': 2,\n            cx: 0, cy: 0, rx: 45, ry: 20,\n            fill: '#E67E22', display: 'none'\n        },\n        text: {\n            'font-family': 'Arial', 'font-size': 14,\n            'ref-x': .5, 'ref-y': .5,\n            'y-alignment': 'middle', 'text-anchor': 'middle'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><ellipse class=\"outer\"/><ellipse class=\"inner\"/></g><text/></g>',\n});\n\njoint.shapes.erd.Attribute.define('erd.Multivalued', {\n    attrs: {\n        '.inner': { display: 'block' },\n        text: { text: 'multivalued' }\n    }\n});\n\njoint.shapes.erd.Attribute.define('erd.Derived', {\n    attrs: {\n        '.outer': { 'stroke-dasharray': '3,5' },\n        text: { text: 'derived' }\n    }\n});\n\njoint.shapes.erd.Attribute.define('erd.Key', {\n    attrs: {\n        ellipse: { 'stroke-width': 4 },\n        text: { text: 'key', 'font-weight': '800', 'text-decoration': 'underline' }\n    }\n});\n\njoint.shapes.erd.Attribute.define('erd.Normal', {\n    attrs: { text: { text: 'Normal' }}\n});\n\njoint.dia.Element.define('erd.ISA', {\n    type: 'erd.ISA',\n    size: { width: 100, height: 50 },\n    attrs: {\n        polygon: {\n            points: '0,0 50,50 100,0',\n            fill: '#F1C40F', stroke: '#F39C12', 'stroke-width': 2\n        },\n        text: {\n            text: 'ISA', 'font-size': 18,\n            'ref-x': .5, 'ref-y': .3,\n            'y-alignment': 'middle', 'text-anchor': 'middle'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><polygon/></g><text/></g>',\n});\n\njoint.dia.Link.define('erd.Line', {}, {\n    cardinality: function(value) {\n        this.set('labels', [{ position: -20, attrs: { text: { dy: -8, text: value }}}]);\n    }\n});\n\njoint.shapes.basic.Circle.define('fsa.State', {\n    attrs: {\n        circle: { 'stroke-width': 3 },\n        text: { 'font-weight': '800' }\n    }\n});\n\njoint.dia.Element.define('fsa.StartState', {\n    size: { width: 20, height: 20 },\n    attrs: {\n        circle: {\n            transform: 'translate(10, 10)',\n            r: 10,\n            fill: '#000000'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><circle/></g></g>',\n});\n\njoint.dia.Element.define('fsa.EndState', {\n    size: { width: 20, height: 20 },\n    attrs: {\n        '.outer': {\n            transform: 'translate(10, 10)',\n            r: 10,\n            fill: '#ffffff',\n            stroke: '#000000'\n        },\n\n        '.inner': {\n            transform: 'translate(10, 10)',\n            r: 6,\n            fill: '#000000'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><circle class=\"outer\"/><circle class=\"inner\"/></g></g>',\n});\n\njoint.dia.Link.define('fsa.Arrow', {\n    attrs: { '.marker-target': { d: 'M 10 0 L 0 5 L 10 10 z' }},\n    smooth: true\n});\n\njoint.dia.Element.define('org.Member', {\n    size: { width: 180, height: 70 },\n    attrs: {\n        rect: { width: 170, height: 60 },\n\n        '.card': {\n            fill: '#FFFFFF', stroke: '#000000', 'stroke-width': 2,\n            'pointer-events': 'visiblePainted', rx: 10, ry: 10\n        },\n\n        image: {\n            width: 48, height: 48,\n            ref: '.card', 'ref-x': 10, 'ref-y': 5\n        },\n\n        '.rank': {\n            'text-decoration': 'underline',\n            ref: '.card', 'ref-x': 0.9, 'ref-y': 0.2,\n            'font-family': 'Courier New', 'font-size': 14,\n            'text-anchor': 'end'\n        },\n\n        '.name': {\n            'font-weight': '800',\n            ref: '.card', 'ref-x': 0.9, 'ref-y': 0.6,\n            'font-family': 'Courier New', 'font-size': 14,\n            'text-anchor': 'end'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><rect class=\"card\"/><image/></g><text class=\"rank\"/><text class=\"name\"/></g>',\n});\n\njoint.dia.Link.define('org.Arrow', {\n    source: { selector: '.card' }, target: { selector: '.card' },\n    attrs: { '.connection': { stroke: '#585858', 'stroke-width': 3 }},\n    z: -1\n});\n\njoint.shapes.basic.Generic.define('chess.KingWhite', {\n    size: { width: 42, height: 38 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\"><path      d=\"M 22.5,11.63 L 22.5,6\"      style=\"fill:none; stroke:#000000; stroke-linejoin:miter;\" />    <path      d=\"M 20,8 L 25,8\"      style=\"fill:none; stroke:#000000; stroke-linejoin:miter;\" />    <path      d=\"M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25\"      style=\"fill:#ffffff; stroke:#000000; stroke-linecap:butt; stroke-linejoin:miter;\" />    <path      d=\"M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z \"      style=\"fill:#ffffff; stroke:#000000;\" />    <path      d=\"M 11.5,30 C 17,27 27,27 32.5,30\"      style=\"fill:none; stroke:#000000;\" />    <path      d=\"M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5\"      style=\"fill:none; stroke:#000000;\" />    <path      d=\"M 11.5,37 C 17,34 27,34 32.5,37\"      style=\"fill:none; stroke:#000000;\" />  </g></g></g>'\n});\n\njoint.shapes.basic.Generic.define('chess.KingBlack', {\n    size: { width: 42, height: 38 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <path       d=\"M 22.5,11.63 L 22.5,6\"       style=\"fill:none; stroke:#000000; stroke-linejoin:miter;\"       id=\"path6570\" />    <path       d=\"M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25\"       style=\"fill:#000000;fill-opacity:1; stroke-linecap:butt; stroke-linejoin:miter;\" />    <path       d=\"M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z \"       style=\"fill:#000000; stroke:#000000;\" />    <path       d=\"M 20,8 L 25,8\"       style=\"fill:none; stroke:#000000; stroke-linejoin:miter;\" />    <path       d=\"M 32,29.5 C 32,29.5 40.5,25.5 38.03,19.85 C 34.15,14 25,18 22.5,24.5 L 22.51,26.6 L 22.5,24.5 C 20,18 9.906,14 6.997,19.85 C 4.5,25.5 11.85,28.85 11.85,28.85\"       style=\"fill:none; stroke:#ffffff;\" />    <path       d=\"M 11.5,30 C 17,27 27,27 32.5,30 M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5 M 11.5,37 C 17,34 27,34 32.5,37\"       style=\"fill:none; stroke:#ffffff;\" />  </g></g></g>'\n});\n\njoint.shapes.basic.Generic.define('chess.QueenWhite', {\n    size: { width: 42, height: 38 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <path      d=\"M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z\"      transform=\"translate(-1,-1)\" />    <path      d=\"M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z\"      transform=\"translate(15.5,-5.5)\" />    <path      d=\"M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z\"      transform=\"translate(32,-1)\" />    <path      d=\"M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z\"      transform=\"translate(7,-4.5)\" />    <path      d=\"M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z\"      transform=\"translate(24,-4)\" />    <path      d=\"M 9,26 C 17.5,24.5 30,24.5 36,26 L 38,14 L 31,25 L 31,11 L 25.5,24.5 L 22.5,9.5 L 19.5,24.5 L 14,10.5 L 14,25 L 7,14 L 9,26 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 11.5,30 C 15,29 30,29 33.5,30\"      style=\"fill:none;\" />    <path      d=\"M 12,33.5 C 18,32.5 27,32.5 33,33.5\"      style=\"fill:none;\" />  </g></g></g>'\n});\n\njoint.shapes.basic.Generic.define('chess.QueenBlack', {\n    size: { width: 42, height: 38 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <g style=\"fill:#000000; stroke:none;\">      <circle cx=\"6\"    cy=\"12\" r=\"2.75\" />      <circle cx=\"14\"   cy=\"9\"  r=\"2.75\" />      <circle cx=\"22.5\" cy=\"8\"  r=\"2.75\" />      <circle cx=\"31\"   cy=\"9\"  r=\"2.75\" />      <circle cx=\"39\"   cy=\"12\" r=\"2.75\" />    </g>    <path       d=\"M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z\"       style=\"stroke-linecap:butt; stroke:#000000;\" />    <path       d=\"M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z\"       style=\"stroke-linecap:butt;\" />    <path       d=\"M 11,38.5 A 35,35 1 0 0 34,38.5\"       style=\"fill:none; stroke:#000000; stroke-linecap:butt;\" />    <path       d=\"M 11,29 A 35,35 1 0 1 34,29\"       style=\"fill:none; stroke:#ffffff;\" />    <path       d=\"M 12.5,31.5 L 32.5,31.5\"       style=\"fill:none; stroke:#ffffff;\" />    <path       d=\"M 11.5,34.5 A 35,35 1 0 0 33.5,34.5\"       style=\"fill:none; stroke:#ffffff;\" />    <path       d=\"M 10.5,37.5 A 35,35 1 0 0 34.5,37.5\"       style=\"fill:none; stroke:#ffffff;\" />  </g></g></g>'\n});\n\njoint.shapes.basic.Generic.define('chess.RookWhite', {\n    size: { width: 32, height: 34 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <path      d=\"M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14\"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 34,14 L 31,17 L 14,17 L 11,14\" />    <path      d=\"M 31,17 L 31,29.5 L 14,29.5 L 14,17\"      style=\"stroke-linecap:butt; stroke-linejoin:miter;\" />    <path      d=\"M 31,29.5 L 32.5,32 L 12.5,32 L 14,29.5\" />    <path      d=\"M 11,14 L 34,14\"      style=\"fill:none; stroke:#000000; stroke-linejoin:miter;\" />  </g></g></g>'\n});\n\njoint.shapes.basic.Generic.define('chess.RookBlack', {\n    size: { width: 32, height: 34 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <path      d=\"M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 12.5,32 L 14,29.5 L 31,29.5 L 32.5,32 L 12.5,32 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 14,29.5 L 14,16.5 L 31,16.5 L 31,29.5 L 14,29.5 z \"      style=\"stroke-linecap:butt;stroke-linejoin:miter;\" />    <path      d=\"M 14,16.5 L 11,14 L 34,14 L 31,16.5 L 14,16.5 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14 L 11,14 z \"      style=\"stroke-linecap:butt;\" />    <path      d=\"M 12,35.5 L 33,35.5 L 33,35.5\"      style=\"fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;\" />    <path      d=\"M 13,31.5 L 32,31.5\"      style=\"fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;\" />    <path      d=\"M 14,29.5 L 31,29.5\"      style=\"fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;\" />    <path      d=\"M 14,16.5 L 31,16.5\"      style=\"fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;\" />    <path      d=\"M 11,14 L 34,14\"      style=\"fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;\" />  </g></g></g>'\n});\n\njoint.shapes.basic.Generic.define('chess.BishopWhite', {\n    size: { width: 38, height: 38 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <g style=\"fill:#ffffff; stroke:#000000; stroke-linecap:butt;\">       <path        d=\"M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z\" />      <path        d=\"M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z\" />      <path        d=\"M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z\" />    </g>    <path      d=\"M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18\"      style=\"fill:none; stroke:#000000; stroke-linejoin:miter;\" />  </g></g></g>'\n});\n\njoint.shapes.basic.Generic.define('chess.BishopBlack', {\n    size: { width: 38, height: 38 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <g style=\"fill:#000000; stroke:#000000; stroke-linecap:butt;\">       <path        d=\"M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z\" />      <path        d=\"M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z\" />      <path        d=\"M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z\" />    </g>    <path       d=\"M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18\"       style=\"fill:none; stroke:#ffffff; stroke-linejoin:miter;\" />  </g></g></g>'\n});\n\njoint.shapes.basic.Generic.define('chess.KnightWhite', {\n    size: { width: 38, height: 37 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <path      d=\"M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18\"      style=\"fill:#ffffff; stroke:#000000;\" />    <path      d=\"M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10\"      style=\"fill:#ffffff; stroke:#000000;\" />    <path      d=\"M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z\"      style=\"fill:#000000; stroke:#000000;\" />    <path      d=\"M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z\"      transform=\"matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)\"      style=\"fill:#000000; stroke:#000000;\" />  </g></g></g>'\n});\n\njoint.shapes.basic.Generic.define('chess.KnightBlack', {\n    size: { width: 38, height: 37 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><g style=\"opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\">    <path      d=\"M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18\"      style=\"fill:#000000; stroke:#000000;\" />    <path      d=\"M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10\"      style=\"fill:#000000; stroke:#000000;\" />    <path      d=\"M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z\"      style=\"fill:#ffffff; stroke:#ffffff;\" />    <path      d=\"M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z\"      transform=\"matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)\"      style=\"fill:#ffffff; stroke:#ffffff;\" />    <path      d=\"M 24.55,10.4 L 24.1,11.85 L 24.6,12 C 27.75,13 30.25,14.49 32.5,18.75 C 34.75,23.01 35.75,29.06 35.25,39 L 35.2,39.5 L 37.45,39.5 L 37.5,39 C 38,28.94 36.62,22.15 34.25,17.66 C 31.88,13.17 28.46,11.02 25.06,10.5 L 24.55,10.4 z \"      style=\"fill:#ffffff; stroke:none;\" />  </g></g></g>'\n});\n\njoint.shapes.basic.Generic.define('chess.PawnWhite', {\n    size: { width: 28, height: 33 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><path d=\"M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z \"  style=\"opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\" /></g></g>'\n});\n\njoint.shapes.basic.Generic.define('chess.PawnBlack', {\n    size: { width: 28, height: 33 }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><path d=\"M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z \"  style=\"opacity:1; fill:#000000; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;\" /></g></g>'\n});\n\njoint.shapes.basic.Generic.define('pn.Place', {\n    size: { width: 50, height: 50 },\n    attrs: {\n        '.root': {\n            r: 25,\n            fill: '#ffffff',\n            stroke: '#000000',\n            transform: 'translate(25, 25)'\n        },\n        '.label': {\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-y': -20,\n            ref: '.root',\n            fill: '#000000',\n            'font-size': 12\n        },\n        '.tokens > circle': {\n            fill: '#000000',\n            r: 5\n        },\n        '.tokens.one > circle': { transform: 'translate(25, 25)' },\n\n        '.tokens.two > circle:nth-child(1)': { transform: 'translate(19, 25)' },\n        '.tokens.two > circle:nth-child(2)': { transform: 'translate(31, 25)' },\n\n        '.tokens.three > circle:nth-child(1)': { transform: 'translate(18, 29)' },\n        '.tokens.three > circle:nth-child(2)': { transform: 'translate(25, 19)' },\n        '.tokens.three > circle:nth-child(3)': { transform: 'translate(32, 29)' },\n\n        '.tokens.alot > text': {\n            transform: 'translate(25, 18)',\n            'text-anchor': 'middle',\n            fill: '#000000'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><circle class=\"root\"/><g class=\"tokens\" /></g><text class=\"label\"/></g>',\n});\n\njoint.shapes.pn.PlaceView = joint.dia.ElementView.extend({\n\n    initialize: function() {\n\n        joint.dia.ElementView.prototype.initialize.apply(this, arguments);\n\n        this.model.on('change:tokens', function() {\n\n            this.renderTokens();\n            this.update();\n\n        }, this);\n    },\n\n    render: function() {\n\n        joint.dia.ElementView.prototype.render.apply(this, arguments);\n\n        this.renderTokens();\n        this.update();\n    },\n\n    renderTokens: function() {\n\n        var $tokens = this.$('.tokens').empty();\n        $tokens[0].className.baseVal = 'tokens';\n\n        var tokens = this.model.get('tokens');\n\n        if (!tokens) return;\n\n        switch (tokens) {\n\n            case 1:\n                $tokens[0].className.baseVal += ' one';\n                $tokens.append(V('<circle/>').node);\n                break;\n\n            case 2:\n                $tokens[0].className.baseVal += ' two';\n                $tokens.append(V('<circle/>').node, V('<circle/>').node);\n                break;\n\n            case 3:\n                $tokens[0].className.baseVal += ' three';\n                $tokens.append(V('<circle/>').node, V('<circle/>').node, V('<circle/>').node);\n                break;\n\n            default:\n                $tokens[0].className.baseVal += ' alot';\n                $tokens.append(V('<text/>').text(tokens + '').node);\n                break;\n        }\n    }\n});\n\njoint.shapes.basic.Generic.define('pn.Transition', {\n    size: { width: 12, height: 50 },\n    attrs: {\n        'rect': {\n            width: 12,\n            height: 50,\n            fill: '#000000',\n            stroke: '#000000'\n        },\n        '.label': {\n            'text-anchor': 'middle',\n            'ref-x': .5,\n            'ref-y': -20,\n            ref: 'rect',\n            fill: '#000000',\n            'font-size': 12\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><rect class=\"root\"/></g></g><text class=\"label\"/>',\n});\n\njoint.dia.Link.define('pn.Link', {\n    attrs: { '.marker-target': { d: 'M 10 0 L 0 5 L 10 10 z' }}\n});\n\n/**\n * @deprecated use the port api insteac\n */\njoint.shapes.basic.Generic.define('devs.Model', {\n    inPorts: [],\n    outPorts: [],\n    size: {\n        width: 80,\n        height: 80\n    },\n    attrs: {\n        '.': {\n            magnet: false\n        },\n        '.label': {\n            text: 'Model',\n            'ref-x': .5,\n            'ref-y': 10,\n            'font-size': 18,\n            'text-anchor': 'middle',\n            fill: '#000'\n        },\n        '.body': {\n            'ref-width': '100%',\n            'ref-height': '100%',\n            stroke: '#000'\n        }\n    },\n    ports: {\n        groups: {\n            'in': {\n                position: {\n                    name: 'left'\n                },\n                attrs: {\n                    '.port-label': {\n                        fill: '#000'\n                    },\n                    '.port-body': {\n                        fill: '#fff',\n                        stroke: '#000',\n                        r: 10,\n                        magnet: true\n                    }\n                },\n                label: {\n                    position: {\n                        name: 'left',\n                        args: {\n                            y: 10\n                        }\n                    }\n                }\n            },\n            'out': {\n                position: {\n                    name: 'right'\n                },\n                attrs: {\n                    '.port-label': {\n                        fill: '#000'\n                    },\n                    '.port-body': {\n                        fill: '#fff',\n                        stroke: '#000',\n                        r: 10,\n                        magnet: true\n                    }\n                },\n                label: {\n                    position: {\n                        name: 'right',\n                        args: {\n                            y: 10\n                        }\n                    }\n                }\n            }\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><rect class=\"body\"/><text class=\"label\"/></g>',\n    portMarkup: '<circle class=\"port-body\"/>',\n    portLabelMarkup: '<text class=\"port-label\"/>',\n\n    initialize: function() {\n\n        joint.shapes.basic.Generic.prototype.initialize.apply(this, arguments);\n\n        this.on('change:inPorts change:outPorts', this.updatePortItems, this);\n        this.updatePortItems();\n    },\n\n    updatePortItems: function(model, changed, opt) {\n\n        // Make sure all ports are unique.\n        var inPorts = joint.util.uniq(this.get('inPorts'));\n        var outPorts = joint.util.difference(joint.util.uniq(this.get('outPorts')), inPorts);\n\n        var inPortItems = this.createPortItems('in', inPorts);\n        var outPortItems = this.createPortItems('out', outPorts);\n\n        this.prop('ports/items', inPortItems.concat(outPortItems), joint.util.assign({ rewrite: true }, opt));\n    },\n\n    createPortItem: function(group, port) {\n\n        return {\n            id: port,\n            group: group,\n            attrs: {\n                '.port-label': {\n                    text: port\n                }\n            }\n        };\n    },\n\n    createPortItems: function(group, ports) {\n\n        return joint.util.toArray(ports).map(this.createPortItem.bind(this, group));\n    },\n\n    _addGroupPort: function(port, group, opt) {\n\n        var ports = this.get(group);\n        return this.set(group, Array.isArray(ports) ? ports.concat(port) : [port], opt);\n    },\n\n    addOutPort: function(port, opt) {\n\n        return this._addGroupPort(port, 'outPorts', opt);\n    },\n\n    addInPort: function(port, opt) {\n\n        return this._addGroupPort(port, 'inPorts', opt);\n    },\n\n    _removeGroupPort: function(port, group, opt) {\n\n        return this.set(group, joint.util.without(this.get(group), port), opt);\n    },\n\n    removeOutPort: function(port, opt) {\n\n        return this._removeGroupPort(port, 'outPorts', opt);\n    },\n\n    removeInPort: function(port, opt) {\n\n        return this._removeGroupPort(port, 'inPorts', opt);\n    },\n\n    _changeGroup: function(group, properties, opt) {\n\n        return this.prop('ports/groups/' + group, joint.util.isObject(properties) ? properties : {}, opt);\n    },\n\n    changeInGroup: function(properties, opt) {\n\n        return this._changeGroup('in', properties, opt);\n    },\n\n    changeOutGroup: function(properties, opt) {\n\n        return this._changeGroup('out', properties, opt);\n    }\n});\n\njoint.shapes.devs.Model.define('devs.Atomic', {\n    size: {\n        width: 80,\n        height: 80\n    },\n    attrs: {\n        '.label': {\n            text: 'Atomic'\n        }\n    }\n});\n\njoint.shapes.devs.Model.define('devs.Coupled', {\n    size: {\n        width: 200,\n        height: 300\n    },\n    attrs: {\n        '.label': {\n            text: 'Coupled'\n        }\n    }\n});\n\njoint.dia.Link.define('devs.Link', {\n    attrs: {\n        '.connection': {\n            'stroke-width': 2\n        }\n    }\n});\n\njoint.shapes.basic.Generic.define('uml.Class', {\n    attrs: {\n        rect: { 'width': 200 },\n\n        '.uml-class-name-rect': { 'stroke': 'black', 'stroke-width': 2, 'fill': '#3498db' },\n        '.uml-class-attrs-rect': { 'stroke': 'black', 'stroke-width': 2, 'fill': '#2980b9' },\n        '.uml-class-methods-rect': { 'stroke': 'black', 'stroke-width': 2, 'fill': '#2980b9' },\n\n        '.uml-class-name-text': {\n            'ref': '.uml-class-name-rect',\n            'ref-y': .5,\n            'ref-x': .5,\n            'text-anchor': 'middle',\n            'y-alignment': 'middle',\n            'font-weight': 'bold',\n            'fill': 'black',\n            'font-size': 12,\n            'font-family': 'Times New Roman'\n        },\n        '.uml-class-attrs-text': {\n            'ref': '.uml-class-attrs-rect', 'ref-y': 5, 'ref-x': 5,\n            'fill': 'black', 'font-size': 12, 'font-family': 'Times New Roman'\n        },\n        '.uml-class-methods-text': {\n            'ref': '.uml-class-methods-rect', 'ref-y': 5, 'ref-x': 5,\n            'fill': 'black', 'font-size': 12, 'font-family': 'Times New Roman'\n        }\n    },\n\n    name: [],\n    attributes: [],\n    methods: []\n}, {\n    markup: [\n        '<g class=\"rotatable\">',\n        '<g class=\"scalable\">',\n        '<rect class=\"uml-class-name-rect\"/><rect class=\"uml-class-attrs-rect\"/><rect class=\"uml-class-methods-rect\"/>',\n        '</g>',\n        '<text class=\"uml-class-name-text\"/><text class=\"uml-class-attrs-text\"/><text class=\"uml-class-methods-text\"/>',\n        '</g>'\n    ].join(''),\n\n    initialize: function() {\n\n        this.on('change:name change:attributes change:methods', function() {\n            this.updateRectangles();\n            this.trigger('uml-update');\n        }, this);\n\n        this.updateRectangles();\n\n        joint.shapes.basic.Generic.prototype.initialize.apply(this, arguments);\n    },\n\n    getClassName: function() {\n        return this.get('name');\n    },\n\n    updateRectangles: function() {\n\n        var attrs = this.get('attrs');\n\n        var rects = [\n            { type: 'name', text: this.getClassName() },\n            { type: 'attrs', text: this.get('attributes') },\n            { type: 'methods', text: this.get('methods') }\n        ];\n\n        var offsetY = 0;\n\n        rects.forEach(function(rect) {\n\n            var lines = Array.isArray(rect.text) ? rect.text : [rect.text];\n            var rectHeight = lines.length * 20 + 20;\n\n            attrs['.uml-class-' + rect.type + '-text'].text = lines.join('\\n');\n            attrs['.uml-class-' + rect.type + '-rect'].height = rectHeight;\n            attrs['.uml-class-' + rect.type + '-rect'].transform = 'translate(0,' + offsetY + ')';\n\n            offsetY += rectHeight;\n        });\n    }\n\n});\n\njoint.shapes.uml.ClassView = joint.dia.ElementView.extend({\n\n    initialize: function() {\n\n        joint.dia.ElementView.prototype.initialize.apply(this, arguments);\n\n        this.listenTo(this.model, 'uml-update', function() {\n            this.update();\n            this.resize();\n        });\n    }\n});\n\njoint.shapes.uml.Class.define('uml.Abstract', {\n    attrs: {\n        '.uml-class-name-rect': { fill: '#e74c3c' },\n        '.uml-class-attrs-rect': { fill: '#c0392b' },\n        '.uml-class-methods-rect': { fill: '#c0392b' }\n    }\n}, {\n\n    getClassName: function() {\n        return ['<<Abstract>>', this.get('name')];\n    }\n\n});\njoint.shapes.uml.AbstractView = joint.shapes.uml.ClassView;\n\njoint.shapes.uml.Class.define('uml.Interface', {\n    attrs: {\n        '.uml-class-name-rect': { fill: '#f1c40f' },\n        '.uml-class-attrs-rect': { fill: '#f39c12' },\n        '.uml-class-methods-rect': { fill: '#f39c12' }\n    }\n}, {\n    getClassName: function() {\n        return ['<<Interface>>', this.get('name')];\n    }\n});\njoint.shapes.uml.InterfaceView = joint.shapes.uml.ClassView;\n\njoint.dia.Link.define('uml.Generalization', {\n    attrs: { '.marker-target': { d: 'M 20 0 L 0 10 L 20 20 z', fill: 'white' }}\n});\n\njoint.dia.Link.define('uml.Implementation', {\n    attrs: {\n        '.marker-target': { d: 'M 20 0 L 0 10 L 20 20 z', fill: 'white' },\n        '.connection': { 'stroke-dasharray': '3,3' }\n    }\n});\n\njoint.dia.Link.define('uml.Aggregation', {\n    attrs: { '.marker-target': { d: 'M 40 10 L 20 20 L 0 10 L 20 0 z', fill: 'white' }}\n});\n\njoint.dia.Link.define('uml.Composition', {\n    attrs: { '.marker-target': { d: 'M 40 10 L 20 20 L 0 10 L 20 0 z', fill: 'black' }}\n});\n\njoint.dia.Link.define('uml.Association');\n\n// Statechart\n\njoint.shapes.basic.Generic.define('uml.State', {\n    attrs: {\n        '.uml-state-body': {\n            'width': 200, 'height': 200, 'rx': 10, 'ry': 10,\n            'fill': '#ecf0f1', 'stroke': '#bdc3c7', 'stroke-width': 3\n        },\n        '.uml-state-separator': {\n            'stroke': '#bdc3c7', 'stroke-width': 2\n        },\n        '.uml-state-name': {\n            'ref': '.uml-state-body', 'ref-x': .5, 'ref-y': 5, 'text-anchor': 'middle',\n            'fill': '#000000', 'font-family': 'Courier New', 'font-size': 14\n        },\n        '.uml-state-events': {\n            'ref': '.uml-state-separator', 'ref-x': 5, 'ref-y': 5,\n            'fill': '#000000', 'font-family': 'Courier New', 'font-size': 14\n        }\n    },\n\n    name: 'State',\n    events: []\n\n}, {\n    markup: [\n        '<g class=\"rotatable\">',\n        '<g class=\"scalable\">',\n        '<rect class=\"uml-state-body\"/>',\n        '</g>',\n        '<path class=\"uml-state-separator\"/>',\n        '<text class=\"uml-state-name\"/>',\n        '<text class=\"uml-state-events\"/>',\n        '</g>'\n    ].join(''),\n\n    initialize: function() {\n\n        this.on({\n            'change:name': this.updateName,\n            'change:events': this.updateEvents,\n            'change:size': this.updatePath\n        }, this);\n\n        this.updateName();\n        this.updateEvents();\n        this.updatePath();\n\n        joint.shapes.basic.Generic.prototype.initialize.apply(this, arguments);\n    },\n\n    updateName: function() {\n\n        this.attr('.uml-state-name/text', this.get('name'));\n    },\n\n    updateEvents: function() {\n\n        this.attr('.uml-state-events/text', this.get('events').join('\\n'));\n    },\n\n    updatePath: function() {\n\n        var d = 'M 0 20 L ' + this.get('size').width + ' 20';\n\n        // We are using `silent: true` here because updatePath() is meant to be called\n        // on resize and there's no need to to update the element twice (`change:size`\n        // triggers also an update).\n        this.attr('.uml-state-separator/d', d, { silent: true });\n    }\n});\n\njoint.shapes.basic.Circle.define('uml.StartState', {\n    type: 'uml.StartState',\n    attrs: { circle: { 'fill': '#34495e', 'stroke': '#2c3e50', 'stroke-width': 2, 'rx': 1 }}\n});\n\njoint.shapes.basic.Generic.define('uml.EndState', {\n    size: { width: 20, height: 20 },\n    attrs: {\n        'circle.outer': {\n            transform: 'translate(10, 10)',\n            r: 10,\n            fill: '#ffffff',\n            stroke: '#2c3e50'\n        },\n\n        'circle.inner': {\n            transform: 'translate(10, 10)',\n            r: 6,\n            fill: '#34495e'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><circle class=\"outer\"/><circle class=\"inner\"/></g></g>',\n});\n\njoint.dia.Link.define('uml.Transition', {\n    attrs: {\n        '.marker-target': { d: 'M 10 0 L 0 5 L 10 10 z', fill: '#34495e', stroke: '#2c3e50' },\n        '.connection': { stroke: '#2c3e50' }\n    }\n});\n\njoint.shapes.basic.Generic.define('logic.Gate', {\n    size: { width: 80, height: 40 },\n    attrs: {\n        '.': { magnet: false },\n        '.body': { width: 100, height: 50 },\n        circle: { r: 7, stroke: 'black', fill: 'transparent', 'stroke-width': 2 }\n    }\n}, {\n    operation: function() {\n        return true;\n    }\n});\n\njoint.shapes.logic.Gate.define('logic.IO', {\n    size: { width: 60, height: 30 },\n    attrs: {\n        '.body': { fill: 'white', stroke: 'black', 'stroke-width': 2 },\n        '.wire': { ref: '.body', 'ref-y': .5, stroke: 'black' },\n        text: {\n            fill: 'black',\n            ref: '.body', 'ref-x': .5, 'ref-y': .5, 'y-alignment': 'middle',\n            'text-anchor': 'middle',\n            'font-weight': 'bold',\n            'font-variant': 'small-caps',\n            'text-transform': 'capitalize',\n            'font-size': '14px'\n        }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><rect class=\"body\"/></g><path class=\"wire\"/><circle/><text/></g>',\n});\n\njoint.shapes.logic.IO.define('logic.Input', {\n    attrs: {\n        '.wire': { 'ref-dx': 0, d: 'M 0 0 L 23 0' },\n        circle: { ref: '.body', 'ref-dx': 30, 'ref-y': 0.5, magnet: true, 'class': 'output', port: 'out' },\n        text: { text: 'input' }\n    }\n});\n\njoint.shapes.logic.IO.define('logic.Output', {\n    attrs: {\n        '.wire': { 'ref-x': 0, d: 'M 0 0 L -23 0' },\n        circle: { ref: '.body', 'ref-x': -30, 'ref-y': 0.5, magnet: 'passive', 'class': 'input', port: 'in' },\n        text: { text: 'output' }\n    }\n});\n\njoint.shapes.logic.Gate.define('logic.Gate11', {\n    attrs: {\n        '.input': { ref: '.body', 'ref-x': -2, 'ref-y': 0.5, magnet: 'passive', port: 'in' },\n        '.output': { ref: '.body', 'ref-dx': 2, 'ref-y': 0.5, magnet: true, port: 'out' }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><image class=\"body\"/></g><circle class=\"input\"/><circle class=\"output\"/></g>',\n});\n\njoint.shapes.logic.Gate.define('logic.Gate21', {\n    attrs: {\n        '.input1': { ref: '.body', 'ref-x': -2, 'ref-y': 0.3, magnet: 'passive', port: 'in1' },\n        '.input2': { ref: '.body', 'ref-x': -2, 'ref-y': 0.7, magnet: 'passive', port: 'in2' },\n        '.output': { ref: '.body', 'ref-dx': 2, 'ref-y': 0.5, magnet: true, port: 'out' }\n    }\n}, {\n    markup: '<g class=\"rotatable\"><g class=\"scalable\"><image class=\"body\"/></g><circle class=\"input input1\"/><circle  class=\"input input2\"/><circle class=\"output\"/></g>',\n});\n\njoint.shapes.logic.Gate11.define('logic.Repeater', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzIuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICA8L2c+Cjwvc3ZnPgo=' }}\n}, {\n    operation: function(input) {\n        return input;\n    }\n});\n\njoint.shapes.logic.Gate11.define('logic.Not', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzkuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDI2NzEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzYiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA4MCwyNSBBIDQsNCAwIDEgMSA3MiwyNSBBIDQsNCAwIDEgMSA4MCwyNSB6IgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEsMCkiIC8+CiAgPC9nPgo8L3N2Zz4K' }}\n}, {\n    operation: function(input) {\n        return !input;\n    }\n});\n\njoint.shapes.logic.Gate21.define('logic.Or', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik9SIEFOU0kuc3ZnIgogICBpbmtzY2FwZTpvdXRwdXRfZXh0ZW5zaW9uPSJvcmcuaW5rc2NhcGUub3V0cHV0LnN2Zy5pbmtzY2FwZSI+CiAgPGRlZnMKICAgICBpZD0iZGVmczQiPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTAgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjcxNCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iMSA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMC41IDogMC4zMzMzMzMzMyA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODA2IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODE5IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjM3Mi4wNDcyNCA6IDM1MC43ODczOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI3NDQuMDk0NDggOiA1MjYuMTgxMDkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzc3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49Ijc1IDogNDAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTUwIDogNjAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDYwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTMyNzUiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNTAgOiAzMy4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTAwIDogNTAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTU1MzMiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzIgOiAyMS4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNjQgOiAzMiA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMzIgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjU1NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDE2LjY2NjY2NyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDI1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAyNSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iNCIKICAgICBpbmtzY2FwZTpjeD0iMTEzLjAwMDM5IgogICAgIGlua3NjYXBlOmN5PSIxMi44OTM3MzEiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9InB4IgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9ImcyNTYwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTpncmlkLWJib3g9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1wb2ludHM9InRydWUiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAwMDAiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxMzk5IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijg3NCIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMzciCiAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii00IgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Im0gNzAsMjUgYyAyMCwwIDI1LDAgMjUsMCIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMSwxNSA1LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzIsMzUgNSwzNSIKICAgICAgIGlkPSJwYXRoMzk0NCIgLz4KICAgIDxnCiAgICAgICBpZD0iZzI1NjAiCiAgICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2LjUsLTM5LjUpIj4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=' }}\n}, {\n    operation: function(input1, input2) {\n        return input1 || input2;\n    }\n});\n\njoint.shapes.logic.Gate21.define('logic.And', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IkFORCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI4IgogICAgIGlua3NjYXBlOmN4PSI1Ni42OTgzNDgiCiAgICAgaW5rc2NhcGU6Y3k9IjI1LjMyNjg5OSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZvbnQtc2l6ZTptZWRpdW07Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWluZGVudDowO3RleHQtYWxpZ246c3RhcnQ7dGV4dC1kZWNvcmF0aW9uOm5vbmU7bGluZS1oZWlnaHQ6bm9ybWFsO2xldHRlci1zcGFjaW5nOm5vcm1hbDt3b3JkLXNwYWNpbmc6bm9ybWFsO3RleHQtdHJhbnNmb3JtOm5vbmU7ZGlyZWN0aW9uOmx0cjtibG9jay1wcm9ncmVzc2lvbjp0Yjt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6c3RhcnQ7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDozO21hcmtlcjpub25lO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGU7Zm9udC1mYW1pbHk6Qml0c3RyZWFtIFZlcmEgU2FuczstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOkJpdHN0cmVhbSBWZXJhIFNhbnMiCiAgICAgICBkPSJNIDMwLDUgTCAzMCw2LjQyODU3MTQgTCAzMCw0My41NzE0MjkgTCAzMCw0NSBMIDMxLjQyODU3MSw0NSBMIDUwLjQ3NjE5LDQ1IEMgNjEuNzQ0MDk4LDQ1IDcwLjQ3NjE5LDM1Ljk5OTk1NSA3MC40NzYxOSwyNSBDIDcwLjQ3NjE5LDE0LjAwMDA0NSA2MS43NDQwOTksNS4wMDAwMDAyIDUwLjQ3NjE5LDUgQyA1MC40NzYxOSw1IDUwLjQ3NjE5LDUgMzEuNDI4NTcxLDUgTCAzMCw1IHogTSAzMi44NTcxNDMsNy44NTcxNDI5IEMgNDAuODM0MjY0LDcuODU3MTQyOSA0NS45MTgzNjgsNy44NTcxNDI5IDQ4LjA5NTIzOCw3Ljg1NzE0MjkgQyA0OS4yODU3MTQsNy44NTcxNDI5IDQ5Ljg4MDk1Miw3Ljg1NzE0MjkgNTAuMTc4NTcxLDcuODU3MTQyOSBDIDUwLjMyNzM4MSw3Ljg1NzE0MjkgNTAuNDA5MjI3LDcuODU3MTQyOSA1MC40NDY0MjksNy44NTcxNDI5IEMgNTAuNDY1MDI5LDcuODU3MTQyOSA1MC40NzE1NDMsNy44NTcxNDI5IDUwLjQ3NjE5LDcuODU3MTQyOSBDIDYwLjIzNjg1Myw3Ljg1NzE0MyA2Ny4xNDI4NTcsMTUuNDk3MDk4IDY3LjE0Mjg1NywyNSBDIDY3LjE0Mjg1NywzNC41MDI5MDIgNTkuNzYwNjYyLDQyLjE0Mjg1NyA1MCw0Mi4xNDI4NTcgTCAzMi44NTcxNDMsNDIuMTQyODU3IEwgMzIuODU3MTQzLDcuODU3MTQyOSB6IgogICAgICAgaWQ9InBhdGgyODg0IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2NjY2NzY2NjY3Nzc3NzY2NjIiAvPgogIDwvZz4KPC9zdmc+Cg==' }}\n\n}, {\n    operation: function(input1, input2) {\n        return input1 && input2;\n    }\n});\n\njoint.shapes.logic.Gate21.define('logic.Nor', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjEiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjY3NzY0NCIKICAgICBpbmtzY2FwZTpjeT0iMjIuMTAyMzQ0IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjM3IgogICAgIGlua3NjYXBlOndpbmRvdy15PSItNCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc5LDI1IEMgOTksMjUgOTUsMjUgOTUsMjUiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgICBpZD0icGF0aDI2MDQiCiAgICAgICAgIHNvZGlwb2RpOmN4PSI3NSIKICAgICAgICAgc29kaXBvZGk6Y3k9IjI1IgogICAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgICAgc29kaXBvZGk6cnk9IjQiCiAgICAgICAgIGQ9Ik0gNzksMjUgQSA0LDQgMCAxIDEgNzEsMjUgQSA0LDQgMCAxIDEgNzksMjUgeiIKICAgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTI2LjUsMzkuNSkiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K' }}\n}, {\n    operation: function(input1, input2) {\n        return !(input1 || input2);\n    }\n});\n\njoint.shapes.logic.Gate21.define('logic.Nand', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5BTkQgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iMTYiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjI4MzMwNyIKICAgICBpbmtzY2FwZTpjeT0iMTYuNDQyODQzIgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzksMjUgQyA5MS44LDI1IDk1LDI1IDk1LDI1IgogICAgICAgaWQ9InBhdGgzMDU5IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMxLDE1IDUsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMiwzNSA1LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmb250LXNpemU6bWVkaXVtO2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1pbmRlbnQ6MDt0ZXh0LWFsaWduOnN0YXJ0O3RleHQtZGVjb3JhdGlvbjpub25lO2xpbmUtaGVpZ2h0Om5vcm1hbDtsZXR0ZXItc3BhY2luZzpub3JtYWw7d29yZC1zcGFjaW5nOm5vcm1hbDt0ZXh0LXRyYW5zZm9ybTpub25lO2RpcmVjdGlvbjpsdHI7YmxvY2stcHJvZ3Jlc3Npb246dGI7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOnN0YXJ0O2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MzttYXJrZXI6bm9uZTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlO2ZvbnQtZmFtaWx5OkJpdHN0cmVhbSBWZXJhIFNhbnM7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpCaXRzdHJlYW0gVmVyYSBTYW5zIgogICAgICAgZD0iTSAzMCw1IEwgMzAsNi40Mjg1NzE0IEwgMzAsNDMuNTcxNDI5IEwgMzAsNDUgTCAzMS40Mjg1NzEsNDUgTCA1MC40NzYxOSw0NSBDIDYxLjc0NDA5OCw0NSA3MC40NzYxOSwzNS45OTk5NTUgNzAuNDc2MTksMjUgQyA3MC40NzYxOSwxNC4wMDAwNDUgNjEuNzQ0MDk5LDUuMDAwMDAwMiA1MC40NzYxOSw1IEMgNTAuNDc2MTksNSA1MC40NzYxOSw1IDMxLjQyODU3MSw1IEwgMzAsNSB6IE0gMzIuODU3MTQzLDcuODU3MTQyOSBDIDQwLjgzNDI2NCw3Ljg1NzE0MjkgNDUuOTE4MzY4LDcuODU3MTQyOSA0OC4wOTUyMzgsNy44NTcxNDI5IEMgNDkuMjg1NzE0LDcuODU3MTQyOSA0OS44ODA5NTIsNy44NTcxNDI5IDUwLjE3ODU3MSw3Ljg1NzE0MjkgQyA1MC4zMjczODEsNy44NTcxNDI5IDUwLjQwOTIyNyw3Ljg1NzE0MjkgNTAuNDQ2NDI5LDcuODU3MTQyOSBDIDUwLjQ2NTAyOSw3Ljg1NzE0MjkgNTAuNDcxNTQzLDcuODU3MTQyOSA1MC40NzYxOSw3Ljg1NzE0MjkgQyA2MC4yMzY4NTMsNy44NTcxNDMgNjcuMTQyODU3LDE1LjQ5NzA5OCA2Ny4xNDI4NTcsMjUgQyA2Ny4xNDI4NTcsMzQuNTAyOTAyIDU5Ljc2MDY2Miw0Mi4xNDI4NTcgNTAsNDIuMTQyODU3IEwgMzIuODU3MTQzLDQyLjE0Mjg1NyBMIDMyLjg1NzE0Myw3Ljg1NzE0MjkgeiIKICAgICAgIGlkPSJwYXRoMjg4NCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2Njc2NjY2Nzc3Nzc2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDQwMDgiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg==' }}\n}, {\n    operation: function(input1, input2) {\n        return !(input1 && input2);\n    }\n});\n\njoint.shapes.logic.Gate21.define('logic.Xor', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhPUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjUuNjU2ODU0MiIKICAgICBpbmtzY2FwZTpjeD0iMjUuOTM4MTE2IgogICAgIGlua3NjYXBlOmN5PSIxNy4yMzAwNSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzAuMzg1NzE3LDE1IEwgNC45OTk5OTk4LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5NzY7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEuMzYyMDkxLDM1IEwgNC45OTk5OTk4LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPGcKICAgICAgIGlkPSJnMjU2MCIKICAgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjYuNSwtMzkuNSkiPgogICAgICA8cGF0aAogICAgICAgICBpZD0icGF0aDM1MTYiCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi4yNSw4MS41MDAwMDUgQyAtMy44NDczNzQsODQuMTQ0NDA1IC00LjUsODQuNTAwMDA1IC00LjUsODQuNTAwMDA1IEwgLTguMTU2MjUsODQuNTAwMDA1IEwgLTYuMTU2MjUsODIuMDYyNTA1IEMgLTYuMTU2MjUsODIuMDYyNTA1IC0wLjUsNzUuMDYyNDUxIC0wLjUsNjQuNSBDIC0wLjUsNTMuOTM3NTQ5IC02LjE1NjI1LDQ2LjkzNzUgLTYuMTU2MjUsNDYuOTM3NSBMIC04LjE1NjI1LDQ0LjUgTCAtNC41LDQ0LjUgQyAtMy43MTg3NSw0NS40Mzc1IC0zLjA3ODEyNSw0Ni4xNTYyNSAtMi4yODEyNSw0Ny41IEMgLTAuNDA4NTMxLDUwLjU5OTgxNSAyLjUsNTYuNTI2NjQ2IDIuNSw2NC41IEMgMi41LDcyLjQ1MDY1IC0wLjM5NjY5Nyw3OC4zNzk0MjUgLTIuMjUsODEuNTAwMDA1IHoiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY3NjY2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K' }}\n}, {\n    operation: function(input1, input2) {\n        return (!input1 || input2) && (input1 || !input2);\n    }\n});\n\njoint.shapes.logic.Gate21.define('logic.Xnor', {\n    attrs: { image: { 'xlink:href': 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhOT1IgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNTU3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTYuNjY2NjY3IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDI1IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI0IgogICAgIGlua3NjYXBlOmN4PSI5NS43MjM2NiIKICAgICBpbmtzY2FwZTpjeT0iLTI2Ljc3NTAyMyIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyLjAwMDAwMDI0O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc4LjMzMzMzMiwyNSBDIDkxLjY2NjY2NiwyNSA5NSwyNSA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMC4zODU3MTcsMTUgTCA0Ljk5OTk5OTgsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk3NjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMS4zNjIwOTEsMzUgTCA0Ljk5OTk5OTgsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIGlkPSJwYXRoMzUxNiIKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjI1LDgxLjUwMDAwNSBDIC0zLjg0NzM3NCw4NC4xNDQ0MDUgLTQuNSw4NC41MDAwMDUgLTQuNSw4NC41MDAwMDUgTCAtOC4xNTYyNSw4NC41MDAwMDUgTCAtNi4xNTYyNSw4Mi4wNjI1MDUgQyAtNi4xNTYyNSw4Mi4wNjI1MDUgLTAuNSw3NS4wNjI0NTEgLTAuNSw2NC41IEMgLTAuNSw1My45Mzc1NDkgLTYuMTU2MjUsNDYuOTM3NSAtNi4xNTYyNSw0Ni45Mzc1IEwgLTguMTU2MjUsNDQuNSBMIC00LjUsNDQuNSBDIC0zLjcxODc1LDQ1LjQzNzUgLTMuMDc4MTI1LDQ2LjE1NjI1IC0yLjI4MTI1LDQ3LjUgQyAtMC40MDg1MzEsNTAuNTk5ODE1IDIuNSw1Ni41MjY2NDYgMi41LDY0LjUgQyAyLjUsNzIuNDUwNjUgLTAuMzk2Njk3LDc4LjM3OTQyNSAtMi4yNSw4MS41MDAwMDUgeiIKICAgICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2Njc2NjY2NzYyIgLz4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDM1NTEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg==' }}\n}, {\n    operation: function(input1, input2) {\n        return (!input1 || !input2) && (input1 || input2);\n    }\n});\n\njoint.dia.Link.define('logic.Wire', {\n    attrs: {\n        '.connection': { 'stroke-width': 2 },\n        '.marker-vertex': { r: 7 }\n    },\n\n    router: { name: 'orthogonal' },\n    connector: { name: 'rounded', args: { radius: 10 }}\n}, {\n    arrowheadMarkup: [\n        '<g class=\"marker-arrowhead-group marker-arrowhead-group-<%= end %>\">',\n        '<circle class=\"marker-arrowhead\" end=\"<%= end %>\" r=\"7\"/>',\n        '</g>'\n    ].join(''),\n\n    vertexMarkup: [\n        '<g class=\"marker-vertex-group\" transform=\"translate(<%= x %>, <%= y %>)\">',\n        '<circle class=\"marker-vertex\" idx=\"<%= idx %>\" r=\"10\" />',\n        '<g class=\"marker-vertex-remove-group\">',\n        '<path class=\"marker-vertex-remove-area\" idx=\"<%= idx %>\" d=\"M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z\" transform=\"translate(5, -33)\"/>',\n        '<path class=\"marker-vertex-remove\" idx=\"<%= idx %>\" transform=\"scale(.8) translate(9.5, -37)\" d=\"M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z\">',\n        '<title>Remove vertex.</title>',\n        '</path>',\n        '</g>',\n        '</g>'\n    ].join('')\n});\n\nif (typeof exports === 'object') {\n\n    var graphlib = require('graphlib');\n    var dagre = require('dagre');\n}\n\n// In the browser, these variables are set to undefined because of JavaScript hoisting.\n// In that case, should grab them from the window object.\ngraphlib = graphlib || (typeof window !== 'undefined' && window.graphlib);\ndagre = dagre || (typeof window !== 'undefined' && window.dagre);\n\njoint.layout.DirectedGraph = {\n\n    exportElement: function(element) {\n\n        // The width and height of the element.\n        return element.size();\n    },\n\n    exportLink: function(link) {\n\n        var labelSize = link.get('labelSize') || {};\n        var edge = {\n            // The number of ranks to keep between the source and target of the edge.\n            minLen: link.get('minLen') || 1,\n            // The weight to assign edges. Higher weight edges are generally\n            // made shorter and straighter than lower weight edges.\n            weight: link.get('weight') || 1,\n            // Where to place the label relative to the edge.\n            // l = left, c = center r = right.\n            labelpos: link.get('labelPosition') || 'c',\n            // How many pixels to move the label away from the edge.\n            // Applies only when labelpos is l or r.\n            labeloffset: link.get('labelOffset') || 0,\n            // The width of the edge label in pixels.\n            width: labelSize.width || 0,\n            // The height of the edge label in pixels.\n            height: labelSize.height || 0\n        };\n\n        return edge;\n    },\n\n    importElement: function(opt, v, gl) {\n\n        var element = this.getCell(v);\n        var glNode = gl.node(v);\n\n        if (opt.setPosition) {\n            opt.setPosition(element, glNode);\n        } else {\n            element.set('position', {\n                x: glNode.x - glNode.width / 2,\n                y: glNode.y - glNode.height / 2\n            });\n        }\n    },\n\n    importLink: function(opt, edgeObj, gl) {\n\n        var link = this.getCell(edgeObj.name);\n        var glEdge = gl.edge(edgeObj);\n        var points = glEdge.points || [];\n\n        // check the `setLinkVertices` here for backwards compatibility\n        if (opt.setVertices || opt.setLinkVertices) {\n            if (joint.util.isFunction(opt.setVertices)) {\n                opt.setVertices(link, points);\n            } else {\n                // Remove the first and last point from points array.\n                // Those are source/target element connection points\n                // ie. they lies on the edge of connected elements.\n                link.set('vertices', points.slice(1, points.length - 1));\n            }\n        }\n\n        if (opt.setLabels && ('x' in glEdge) && ('y' in glEdge)) {\n            var labelPosition = { x: glEdge.x, y: glEdge.y };\n            if (joint.util.isFunction(opt.setLabels)) {\n                opt.setLabels(link, labelPosition, points);\n            } else {\n                // Convert the absolute label position to a relative position\n                // towards the closest point on the edge\n                var polyline = g.Polyline(points);\n                var length = polyline.closestPointLength(labelPosition);\n                var closestPoint = polyline.pointAtLength(length);\n                var distance = length / polyline.length();\n                link.label(0, {\n                    position: {\n                        distance: distance,\n                        offset: g.Point(labelPosition).difference(closestPoint).toJSON()\n                    }\n                });\n            }\n        }\n    },\n\n    layout: function(graphOrCells, opt) {\n\n        var graph;\n\n        if (graphOrCells instanceof joint.dia.Graph) {\n            graph = graphOrCells;\n        } else {\n            // Reset cells in dry mode so the graph reference is not stored on the cells.\n            // `sort: false` to prevent elements to change their order based on the z-index\n            graph = (new joint.dia.Graph()).resetCells(graphOrCells, { dry: true, sort: false });\n        }\n\n        // This is not needed anymore.\n        graphOrCells = null;\n\n        opt = joint.util.defaults(opt || {}, {\n            resizeClusters: true,\n            clusterPadding: 10,\n            exportElement: this.exportElement,\n            exportLink: this.exportLink\n        });\n\n        // create a graphlib.Graph that represents the joint.dia.Graph\n        var glGraph = graph.toGraphLib({\n            directed: true,\n            // We are about to use edge naming feature.\n            multigraph: true,\n            // We are able to layout graphs with embeds.\n            compound: true,\n            setNodeLabel: opt.exportElement,\n            setEdgeLabel: opt.exportLink,\n            setEdgeName: function(link) {\n                // Graphlib edges have no ids. We use edge name property\n                // to store and retrieve ids instead.\n                return link.id;\n            }\n        });\n\n        var glLabel = {};\n        var marginX = opt.marginX || 0;\n        var marginY = opt.marginY || 0;\n\n        // Dagre layout accepts options as lower case.\n        // Direction for rank nodes. Can be TB, BT, LR, or RL\n        if (opt.rankDir) glLabel.rankdir = opt.rankDir;\n        // Alignment for rank nodes. Can be UL, UR, DL, or DR\n        if (opt.align) glLabel.align = opt.align;\n        // Number of pixels that separate nodes horizontally in the layout.\n        if (opt.nodeSep) glLabel.nodesep = opt.nodeSep;\n        // Number of pixels that separate edges horizontally in the layout.\n        if (opt.edgeSep) glLabel.edgesep = opt.edgeSep;\n        // Number of pixels between each rank in the layout.\n        if (opt.rankSep) glLabel.ranksep = opt.rankSep;\n        // Type of algorithm to assign a rank to each node in the input graph.\n        // Possible values: network-simplex, tight-tree or longest-path\n        if (opt.ranker) glLabel.ranker = opt.ranker;\n        // Number of pixels to use as a margin around the left and right of the graph.\n        if (marginX) glLabel.marginx = marginX;\n        // Number of pixels to use as a margin around the top and bottom of the graph.\n        if (marginY) glLabel.marginy = marginY;\n\n        // Set the option object for the graph label.\n        glGraph.setGraph(glLabel);\n\n        // Executes the layout.\n        dagre.layout(glGraph, { debugTiming: !!opt.debugTiming });\n\n        // Wrap all graph changes into a batch.\n        graph.startBatch('layout');\n\n        // Update the graph.\n        graph.fromGraphLib(glGraph, {\n            importNode: this.importElement.bind(graph, opt),\n            importEdge: this.importLink.bind(graph, opt)\n        });\n\n        if (opt.resizeClusters) {\n            // Resize and reposition cluster elements (parents of other elements)\n            // to fit their children.\n            // 1. filter clusters only\n            // 2. map id on cells\n            // 3. sort cells by their depth (the deepest first)\n            // 4. resize cell to fit their direct children only.\n            var clusters = glGraph.nodes()\n                .filter(function(v) { return glGraph.children(v).length > 0; })\n                .map(graph.getCell.bind(graph))\n                .sort(function(aCluster, bCluster) {\n                    return bCluster.getAncestors().length - aCluster.getAncestors().length;\n                });\n\n            joint.util.invoke(clusters, 'fitEmbeds', { padding: opt.clusterPadding });\n        }\n\n        graph.stopBatch('layout');\n\n        // Width and height of the graph extended by margins.\n        var glSize = glGraph.graph();\n        // Return the bounding box of the graph after the layout.\n        return g.Rect(\n            marginX,\n            marginY,\n            Math.abs(glSize.width - 2 * marginX),\n            Math.abs(glSize.height - 2 * marginY)\n        );\n    },\n\n    fromGraphLib: function(glGraph, opt) {\n\n        opt = opt || {};\n\n        var importNode = opt.importNode || joint.util.noop;\n        var importEdge = opt.importEdge || joint.util.noop;\n        var graph = (this instanceof joint.dia.Graph) ? this : new joint.dia.Graph;\n\n        // Import all nodes.\n        glGraph.nodes().forEach(function(node) {\n            importNode.call(graph, node, glGraph, graph, opt);\n        });\n\n        // Import all edges.\n        glGraph.edges().forEach(function(edge) {\n            importEdge.call(graph, edge, glGraph, graph, opt);\n        });\n\n        return graph;\n    },\n\n    // Create new graphlib graph from existing JointJS graph.\n    toGraphLib: function(graph, opt) {\n\n        opt = opt || {};\n\n        var glGraphType = joint.util.pick(opt, 'directed', 'compound', 'multigraph');\n        var glGraph = new graphlib.Graph(glGraphType);\n        var setNodeLabel = opt.setNodeLabel || joint.util.noop;\n        var setEdgeLabel = opt.setEdgeLabel || joint.util.noop;\n        var setEdgeName = opt.setEdgeName || joint.util.noop;\n        var collection = graph.get('cells');\n\n        for (var i = 0, n = collection.length; i < n; i++) {\n\n            var cell = collection.at(i);\n            if (cell.isLink()) {\n\n                var source = cell.get('source');\n                var target = cell.get('target');\n\n                // Links that end at a point are ignored.\n                if (!source.id || !target.id) break;\n\n                // Note that if we are creating a multigraph we can name the edges. If\n                // we try to name edges on a non-multigraph an exception is thrown.\n                glGraph.setEdge(source.id, target.id, setEdgeLabel(cell), setEdgeName(cell));\n\n            } else {\n\n                glGraph.setNode(cell.id, setNodeLabel(cell));\n\n                // For the compound graphs we have to take embeds into account.\n                if (glGraph.isCompound() && cell.has('parent')) {\n                    var parentId = cell.get('parent');\n                    if (collection.has(parentId)) {\n                        // Make sure the parent cell is included in the graph (this can\n                        // happen when the layout is run on part of the graph only).\n                        glGraph.setParent(cell.id, parentId);\n                    }\n                }\n            }\n        }\n\n        return glGraph;\n    }\n};\n\njoint.dia.Graph.prototype.toGraphLib = function(opt) {\n\n    return joint.layout.DirectedGraph.toGraphLib(this, opt);\n};\n\njoint.dia.Graph.prototype.fromGraphLib = function(glGraph, opt) {\n\n    return joint.layout.DirectedGraph.fromGraphLib.call(this, glGraph, opt);\n};\n\n\n    joint.g = g;\n    joint.V = joint.Vectorizer = V;\n\n    return joint;\n\n}));\n"]}